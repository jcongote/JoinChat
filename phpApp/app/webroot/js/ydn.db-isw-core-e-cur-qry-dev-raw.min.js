/*
 Portions of this code are from MochiKit, received by
 The Closure Authors under the MIT license. All other code is Copyright
 2005-2009 The Closure Authors. All Rights Reserved.
 Copyright 2012 YDN Authors, Yathit. All Rights Reserved.
 Licensed under the Apache License, Version 2.0 (the "License");.
 Copyright 2012 YDN Authors, Yathit. All Rights Reserved.
 Licensed under the Apache License, Version 2.0 (the "License");.
*/
var CLOSURE_DEFINES={"goog.ENABLE_DEBUG_LOADER":!1},COMPILED=!0,goog=goog||{};goog.global=this;goog.isDef=function(a){return void 0!==a};goog.exportPath_=function(a,b,c){a=a.split(".");c=c||goog.global;a[0]in c||!c.execScript||c.execScript("var "+a[0]);for(var d;a.length&&(d=a.shift());)!a.length&&goog.isDef(b)?c[d]=b:c=c[d]?c[d]:c[d]={}};
goog.define=function(a,b){var c=b;COMPILED||(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,a)?c=goog.global.CLOSURE_UNCOMPILED_DEFINES[a]:goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,a)&&(c=goog.global.CLOSURE_DEFINES[a]));goog.exportPath_(a,c)};goog.DEBUG=!0;goog.LOCALE="en";goog.TRUSTED_SITE=!0;goog.STRICT_MODE_COMPATIBLE=!1;
goog.provide=function(a){if(!COMPILED&&goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');goog.constructNamespace_(a)};goog.constructNamespace_=function(a,b){if(!COMPILED){delete goog.implicitNamespaces_[a];for(var c=a;(c=c.substring(0,c.lastIndexOf(".")))&&!goog.getObjectByName(c);)goog.implicitNamespaces_[c]=!0}goog.exportPath_(a,b)};
goog.module=function(a){if(!goog.isString(a)||!a)throw Error("Invalid module identifier");if(!goog.isInModuleLoader_())throw Error("Module "+a+" has been loaded incorrectly.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");goog.moduleLoaderState_.moduleName=a;if(!COMPILED){if(goog.isProvided_(a))throw Error('Namespace "'+a+'" already declared.');delete goog.implicitNamespaces_[a]}};goog.module.get=function(a){return goog.module.getInternal_(a)};
goog.module.getInternal_=function(a){if(!COMPILED)return goog.isProvided_(a)?a in goog.loadedModules_?goog.loadedModules_[a]:goog.getObjectByName(a):null};goog.moduleLoaderState_=null;goog.isInModuleLoader_=function(){return null!=goog.moduleLoaderState_};goog.module.declareTestMethods=function(){if(!goog.isInModuleLoader_())throw Error("goog.module.declareTestMethods must be called from within a goog.module");goog.moduleLoaderState_.declareTestMethods=!0};
goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_())throw Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0};
goog.setTestOnly=function(a){if(COMPILED&&!goog.DEBUG)throw a=a||"",Error("Importing test-only code into non-debug environment"+(a?": "+a:"."));};goog.forwardDeclare=function(a){};COMPILED||(goog.isProvided_=function(a){return a in goog.loadedModules_||!goog.implicitNamespaces_[a]&&goog.isDefAndNotNull(goog.getObjectByName(a))},goog.implicitNamespaces_={"goog.module":!0});
goog.getObjectByName=function(a,b){for(var c=a.split("."),d=b||goog.global,e;e=c.shift();)if(goog.isDefAndNotNull(d[e]))d=d[e];else return null;return d};goog.globalize=function(a,b){var c=b||goog.global,d;for(d in a)c[d]=a[d]};goog.addDependency=function(a,b,c,d){if(goog.DEPENDENCIES_ENABLED){var e;a=a.replace(/\\/g,"/");for(var f=goog.dependencies_,g=0;e=b[g];g++)f.nameToPath[e]=a,f.pathIsModule[a]=!!d;for(d=0;b=c[d];d++)a in f.requires||(f.requires[a]={}),f.requires[a][b]=!0}};
goog.ENABLE_DEBUG_LOADER=!0;goog.logToConsole_=function(a){goog.global.console&&goog.global.console.error(a)};
goog.require=function(a){if(!COMPILED){goog.ENABLE_DEBUG_LOADER&&goog.IS_OLD_IE_&&goog.maybeProcessDeferredDep_(a);if(goog.isProvided_(a))return goog.isInModuleLoader_()?goog.module.getInternal_(a):null;if(goog.ENABLE_DEBUG_LOADER){var b=goog.getPathFromDeps_(a);if(b)return goog.included_[b]=!0,goog.writeScripts_(),null}a="goog.require could not find: "+a;goog.logToConsole_(a);throw Error(a);}};goog.basePath="";goog.nullFunction=function(){};goog.identityFunction=function(a,b){return a};
goog.abstractMethod=function(){throw Error("unimplemented abstract method");};goog.addSingletonGetter=function(a){a.getInstance=function(){if(a.instance_)return a.instance_;goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=a);return a.instance_=new a}};goog.instantiatedSingletons_=[];goog.LOAD_MODULE_USING_EVAL=!0;goog.SEAL_MODULE_EXPORTS=goog.DEBUG;goog.loadedModules_={};goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER;
goog.DEPENDENCIES_ENABLED&&(goog.included_={},goog.dependencies_={pathIsModule:{},nameToPath:{},requires:{},visited:{},written:{},deferred:{}},goog.inHtmlDocument_=function(){var a=goog.global.document;return"undefined"!=typeof a&&"write"in a},goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH)goog.basePath=goog.global.CLOSURE_BASE_PATH;else if(goog.inHtmlDocument_())for(var a=goog.global.document.getElementsByTagName("script"),b=a.length-1;0<=b;--b){var c=a[b].src,d=c.lastIndexOf("?"),
d=-1==d?c.length:d;if("base.js"==c.substr(d-7,7)){goog.basePath=c.substr(0,d-7);break}}},goog.importScript_=function(a,b){(goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_)(a,b)&&(goog.dependencies_.written[a]=!0)},goog.IS_OLD_IE_=goog.global.document&&goog.global.document.all&&!goog.global.atob,goog.importModule_=function(a){goog.importScript_("",'goog.retrieveAndExecModule_("'+a+'");')&&(goog.dependencies_.written[a]=!0)},goog.queuedModules_=[],goog.retrieveAndExecModule_=function(a){for(var b=
a,c;-1!=(c=a.indexOf("/./"));)a=a.substr(0,c)+a.substr(c+2);for(;-1!=(c=a.indexOf("/../"));){var d=a.lastIndexOf("/",c-1);a=a.substr(0,d)+a.substr(c+3)}c=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;var e=null,d=new goog.global.XMLHttpRequest;d.onload=function(){e=this.responseText};d.open("get",a,!1);d.send();e=d.responseText;if(null!=e)d=goog.wrapModule_(a,e),goog.IS_OLD_IE_?(goog.dependencies_.deferred[b]=d,goog.queuedModules_.push(b)):c(a,d);else throw Error("load of "+a+"failed");
},goog.wrapModule_=function(a,b){return goog.LOAD_MODULE_USING_EVAL&&goog.isDef(goog.global.JSON)?"goog.loadModule("+goog.global.JSON.stringify(b+"\n//# sourceURL="+a+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+b+"\n;return exports});\n//# sourceURL="+a+"\n"},goog.loadQueuedModules_=function(){var a=goog.queuedModules_.length;if(0<a){var b=goog.queuedModules_;goog.queuedModules_=[];for(var c=0;c<a;c++)goog.maybeProcessDeferredPath_(b[c])}},goog.maybeProcessDeferredDep_=function(a){goog.isDeferredModule_(a)&&
goog.allDepsAreAvailable_(a)&&(a=goog.getPathFromDeps_(a),goog.maybeProcessDeferredPath_(goog.basePath+a))},goog.isDeferredModule_=function(a){return(a=goog.getPathFromDeps_(a))&&goog.dependencies_.pathIsModule[a]?goog.basePath+a in goog.dependencies_.deferred:!1},goog.allDepsAreAvailable_=function(a){if((a=goog.getPathFromDeps_(a))&&a in goog.dependencies_.requires)for(var b in goog.dependencies_.requires[a])if(!goog.isProvided_(b)&&!goog.isDeferredModule_(b))return!1;return!0},goog.maybeProcessDeferredPath_=
function(a){if(a in goog.dependencies_.deferred){var b=goog.dependencies_.deferred[a];delete goog.dependencies_.deferred[a];goog.globalEval(b)}},goog.loadModule=function(a){var b=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:void 0,declareTestMethods:!1};var c;if(goog.isFunction(a))c=a.call(goog.global,{});else if(goog.isString(a))c=goog.loadModuleFromSource_.call(goog.global,a);else throw Error("Invalid module definition");var d=goog.moduleLoaderState_.moduleName;if(!goog.isString(d)||
!d)throw Error('Invalid module name "'+d+'"');goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(d,c):goog.SEAL_MODULE_EXPORTS&&Object.seal&&Object.seal(c);goog.loadedModules_[d]=c;if(goog.moduleLoaderState_.declareTestMethods)for(var e in c)if(0===e.indexOf("test",0)||"tearDown"==e||"setUp"==e||"setUpPage"==e||"tearDownPage"==e)goog.global[e]=c[e]}finally{goog.moduleLoaderState_=b}},goog.loadModuleFromSource_=function(a){eval(a);return{}},goog.writeScriptTag_=function(a,b){if(goog.inHtmlDocument_()){var c=
goog.global.document;if("complete"==c.readyState){if(/\bdeps.js$/.test(a))return!1;throw Error('Cannot write "'+a+'" after document load');}var d=goog.IS_OLD_IE_;void 0===b?d?(d=" onreadystatechange='goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+")' ",c.write('<script type="text/javascript" src="'+a+'"'+d+">\x3c/script>")):c.write('<script type="text/javascript" src="'+a+'">\x3c/script>'):c.write('<script type="text/javascript">'+b+"\x3c/script>");return!0}return!1},goog.lastNonModuleScriptIndex_=
0,goog.onScriptLoad_=function(a,b){"complete"==a.readyState&&goog.lastNonModuleScriptIndex_==b&&goog.loadQueuedModules_();return!0},goog.writeScripts_=function(){function a(e){if(!(e in d.written)){if(!(e in d.visited)&&(d.visited[e]=!0,e in d.requires))for(var f in d.requires[e])if(!goog.isProvided_(f))if(f in d.nameToPath)a(d.nameToPath[f]);else throw Error("Undefined nameToPath for "+f);e in c||(c[e]=!0,b.push(e))}}var b=[],c={},d=goog.dependencies_,e;for(e in goog.included_)d.written[e]||a(e);
for(var f=0;f<b.length;f++)e=b[f],goog.dependencies_.written[e]=!0;var g=goog.moduleLoaderState_;goog.moduleLoaderState_=null;for(f=0;f<b.length;f++)if(e=b[f])d.pathIsModule[e]?goog.importModule_(goog.basePath+e):goog.importScript_(goog.basePath+e);else throw goog.moduleLoaderState_=g,Error("Undefined script input");goog.moduleLoaderState_=g},goog.getPathFromDeps_=function(a){return a in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[a]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||
goog.importScript_(goog.basePath+"deps.js"));
goog.typeOf=function(a){var b=typeof a;if("object"==b)if(a){if(a instanceof Array)return"array";if(a instanceof Object)return b;var c=Object.prototype.toString.call(a);if("[object Window]"==c)return"object";if("[object Array]"==c||"number"==typeof a.length&&"undefined"!=typeof a.splice&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("splice"))return"array";if("[object Function]"==c||"undefined"!=typeof a.call&&"undefined"!=typeof a.propertyIsEnumerable&&!a.propertyIsEnumerable("call"))return"function"}else return"null";
else if("function"==b&&"undefined"==typeof a.call)return"object";return b};goog.isNull=function(a){return null===a};goog.isDefAndNotNull=function(a){return null!=a};goog.isArray=function(a){return"array"==goog.typeOf(a)};goog.isArrayLike=function(a){var b=goog.typeOf(a);return"array"==b||"object"==b&&"number"==typeof a.length};goog.isDateLike=function(a){return goog.isObject(a)&&"function"==typeof a.getFullYear};goog.isString=function(a){return"string"==typeof a};
goog.isBoolean=function(a){return"boolean"==typeof a};goog.isNumber=function(a){return"number"==typeof a};goog.isFunction=function(a){return"function"==goog.typeOf(a)};goog.isObject=function(a){var b=typeof a;return"object"==b&&null!=a||"function"==b};goog.getUid=function(a){return a[goog.UID_PROPERTY_]||(a[goog.UID_PROPERTY_]=++goog.uidCounter_)};goog.hasUid=function(a){return!!a[goog.UID_PROPERTY_]};goog.removeUid=function(a){"removeAttribute"in a&&a.removeAttribute(goog.UID_PROPERTY_);try{delete a[goog.UID_PROPERTY_]}catch(b){}};
goog.UID_PROPERTY_="closure_uid_"+(1E9*Math.random()>>>0);goog.uidCounter_=0;goog.getHashCode=goog.getUid;goog.removeHashCode=goog.removeUid;goog.cloneObject=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if(a.clone)return a.clone();var b="array"==b?[]:{},c;for(c in a)b[c]=goog.cloneObject(a[c]);return b}return a};goog.bindNative_=function(a,b,c){return a.call.apply(a.bind,arguments)};
goog.bindJs_=function(a,b,c){if(!a)throw Error();if(2<arguments.length){var d=Array.prototype.slice.call(arguments,2);return function(){var c=Array.prototype.slice.call(arguments);Array.prototype.unshift.apply(c,d);return a.apply(b,c)}}return function(){return a.apply(b,arguments)}};goog.bind=function(a,b,c){Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_;return goog.bind.apply(null,arguments)};
goog.partial=function(a,b){var c=Array.prototype.slice.call(arguments,1);return function(){var b=c.slice();b.push.apply(b,arguments);return a.apply(this,b)}};goog.mixin=function(a,b){for(var c in b)a[c]=b[c]};goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date};
goog.globalEval=function(a){if(goog.global.execScript)goog.global.execScript(a,"JavaScript");else if(goog.global.eval)if(null==goog.evalWorksForGlobals_&&(goog.global.eval("var _et_ = 1;"),"undefined"!=typeof goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_)goog.global.eval(a);else{var b=goog.global.document,c=b.createElement("script");c.type="text/javascript";c.defer=!1;c.appendChild(b.createTextNode(a));b.body.appendChild(c);
b.body.removeChild(c)}else throw Error("goog.globalEval not available");};goog.evalWorksForGlobals_=null;goog.getCssName=function(a,b){var c=function(a){return goog.cssNameMapping_[a]||a},d=function(a){a=a.split("-");for(var b=[],d=0;d<a.length;d++)b.push(c(a[d]));return b.join("-")},d=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?c:d:function(a){return a};return b?a+"-"+d(b):d(a)};goog.setCssNameMapping=function(a,b){goog.cssNameMapping_=a;goog.cssNameMappingStyle_=b};
!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING);goog.getMsg=function(a,b){b&&(a=a.replace(/\{\$([^}]+)}/g,function(a,d){return d in b?b[d]:a}));return a};goog.getMsgWithFallback=function(a,b){return a};goog.exportSymbol=function(a,b,c){goog.exportPath_(a,b,c)};goog.exportProperty=function(a,b,c){a[b]=c};
goog.inherits=function(a,b){function c(){}c.prototype=b.prototype;a.superClass_=b.prototype;a.prototype=new c;a.prototype.constructor=a;a.base=function(a,c,f){var g=Array.prototype.slice.call(arguments,2);return b.prototype[c].apply(a,g)}};
goog.base=function(a,b,c){var d=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!d)throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(d.superClass_)return d.superClass_.constructor.apply(a,Array.prototype.slice.call(arguments,1));for(var e=Array.prototype.slice.call(arguments,2),f=!1,g=a.constructor;g;g=g.superClass_&&g.superClass_.constructor)if(g.prototype[b]===d)f=!0;else if(f)return g.prototype[b].apply(a,
e);if(a[b]===d)return a.constructor.prototype[b].apply(a,e);throw Error("goog.base called from a method of one name to a method of a different name");};goog.scope=function(a){a.call(goog.global)};COMPILED||(goog.global.COMPILED=COMPILED);
goog.defineClass=function(a,b){var c=b.constructor,d=b.statics;c&&c!=Object.prototype.constructor||(c=function(){throw Error("cannot instantiate an interface (no constructor defined).");});c=goog.defineClass.createSealingConstructor_(c,a);a&&goog.inherits(c,a);delete b.constructor;delete b.statics;goog.defineClass.applyProperties_(c.prototype,b);null!=d&&(d instanceof Function?d(c):goog.defineClass.applyProperties_(c,d));return c};goog.defineClass.SEAL_CLASS_INSTANCES=goog.DEBUG;
goog.defineClass.createSealingConstructor_=function(a,b){if(goog.defineClass.SEAL_CLASS_INSTANCES&&Object.seal instanceof Function){if(b&&b.prototype&&b.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_])return a;var c=function(){var b=a.apply(this,arguments)||this;b[goog.UID_PROPERTY_]=b[goog.UID_PROPERTY_];this.constructor===c&&Object.seal(b);return b};return c}return a};goog.defineClass.OBJECT_PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
goog.defineClass.applyProperties_=function(a,b){for(var c in b)Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c]);for(var d=0;d<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;d++)c=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[d],Object.prototype.hasOwnProperty.call(b,c)&&(a[c]=b[c])};goog.tagUnsealableClass=function(a){!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES&&(a.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0)};goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable";
goog.Thenable=function(){};goog.Thenable.prototype.then=function(a,b,c){};goog.Thenable.IMPLEMENTED_BY_PROP="$goog_Thenable";goog.Thenable.addImplementation=function(a){goog.exportProperty(a.prototype,"then",a.prototype.then);COMPILED?a.prototype[goog.Thenable.IMPLEMENTED_BY_PROP]=!0:a.prototype.$goog_Thenable=!0};goog.Thenable.isImplementedBy=function(a){if(!a)return!1;try{return COMPILED?!!a[goog.Thenable.IMPLEMENTED_BY_PROP]:!!a.$goog_Thenable}catch(b){return!1}};goog.debug={};
goog.debug.Error=function(a){if(Error.captureStackTrace)Error.captureStackTrace(this,goog.debug.Error);else{var b=Error().stack;b&&(this.stack=b)}a&&(this.message=String(a))};goog.inherits(goog.debug.Error,Error);goog.debug.Error.prototype.name="CustomError";goog.dom={};goog.dom.NodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12};goog.string={};
goog.string.DETECT_DOUBLE_ESCAPING=!1;goog.string.FORCE_NON_DOM_HTML_UNESCAPING=!1;goog.string.Unicode={NBSP:"\u00a0"};goog.string.startsWith=function(a,b){return 0==a.lastIndexOf(b,0)};goog.string.endsWith=function(a,b){var c=a.length-b.length;return 0<=c&&a.indexOf(b,c)==c};goog.string.caseInsensitiveStartsWith=function(a,b){return 0==goog.string.caseInsensitiveCompare(b,a.substr(0,b.length))};
goog.string.caseInsensitiveEndsWith=function(a,b){return 0==goog.string.caseInsensitiveCompare(b,a.substr(a.length-b.length,b.length))};goog.string.caseInsensitiveEquals=function(a,b){return a.toLowerCase()==b.toLowerCase()};goog.string.subs=function(a,b){for(var c=a.split("%s"),d="",e=Array.prototype.slice.call(arguments,1);e.length&&1<c.length;)d+=c.shift()+e.shift();return d+c.join("%s")};goog.string.collapseWhitespace=function(a){return a.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")};
goog.string.isEmptyOrWhitespace=function(a){return/^[\s\xa0]*$/.test(a)};goog.string.isEmptyString=function(a){return 0==a.length};goog.string.isEmpty=goog.string.isEmptyOrWhitespace;goog.string.isEmptyOrWhitespaceSafe=function(a){return goog.string.isEmptyOrWhitespace(goog.string.makeSafe(a))};goog.string.isEmptySafe=goog.string.isEmptyOrWhitespaceSafe;goog.string.isBreakingWhitespace=function(a){return!/[^\t\n\r ]/.test(a)};goog.string.isAlpha=function(a){return!/[^a-zA-Z]/.test(a)};
goog.string.isNumeric=function(a){return!/[^0-9]/.test(a)};goog.string.isAlphaNumeric=function(a){return!/[^a-zA-Z0-9]/.test(a)};goog.string.isSpace=function(a){return" "==a};goog.string.isUnicodeChar=function(a){return 1==a.length&&" "<=a&&"~">=a||"\u0080"<=a&&"\ufffd">=a};goog.string.stripNewlines=function(a){return a.replace(/(\r\n|\r|\n)+/g," ")};goog.string.canonicalizeNewlines=function(a){return a.replace(/(\r\n|\r|\n)/g,"\n")};
goog.string.normalizeWhitespace=function(a){return a.replace(/\xa0|\s/g," ")};goog.string.normalizeSpaces=function(a){return a.replace(/\xa0|[ \t]+/g," ")};goog.string.collapseBreakingSpaces=function(a){return a.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")};goog.string.trim=goog.TRUSTED_SITE&&String.prototype.trim?function(a){return a.trim()}:function(a){return a.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")};goog.string.trimLeft=function(a){return a.replace(/^[\s\xa0]+/,"")};
goog.string.trimRight=function(a){return a.replace(/[\s\xa0]+$/,"")};goog.string.caseInsensitiveCompare=function(a,b){var c=String(a).toLowerCase(),d=String(b).toLowerCase();return c<d?-1:c==d?0:1};goog.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g;
goog.string.numerateCompare=function(a,b){if(a==b)return 0;if(!a)return-1;if(!b)return 1;for(var c=a.toLowerCase().match(goog.string.numerateCompareRegExp_),d=b.toLowerCase().match(goog.string.numerateCompareRegExp_),e=Math.min(c.length,d.length),f=0;f<e;f++){var g=c[f],h=d[f];if(g!=h)return c=parseInt(g,10),!isNaN(c)&&(d=parseInt(h,10),!isNaN(d)&&c-d)?c-d:g<h?-1:1}return c.length!=d.length?c.length-d.length:a<b?-1:1};goog.string.urlEncode=function(a){return encodeURIComponent(String(a))};
goog.string.urlDecode=function(a){return decodeURIComponent(a.replace(/\+/g," "))};goog.string.newLineToBr=function(a,b){return a.replace(/(\r\n|\r|\n)/g,b?"<br />":"<br>")};
goog.string.htmlEscape=function(a,b){if(b)a=a.replace(goog.string.AMP_RE_,"&amp;").replace(goog.string.LT_RE_,"&lt;").replace(goog.string.GT_RE_,"&gt;").replace(goog.string.QUOT_RE_,"&quot;").replace(goog.string.SINGLE_QUOTE_RE_,"&#39;").replace(goog.string.NULL_RE_,"&#0;"),goog.string.DETECT_DOUBLE_ESCAPING&&(a=a.replace(goog.string.E_RE_,"&#101;"));else{if(!goog.string.ALL_RE_.test(a))return a;-1!=a.indexOf("&")&&(a=a.replace(goog.string.AMP_RE_,"&amp;"));-1!=a.indexOf("<")&&(a=a.replace(goog.string.LT_RE_,
"&lt;"));-1!=a.indexOf(">")&&(a=a.replace(goog.string.GT_RE_,"&gt;"));-1!=a.indexOf('"')&&(a=a.replace(goog.string.QUOT_RE_,"&quot;"));-1!=a.indexOf("'")&&(a=a.replace(goog.string.SINGLE_QUOTE_RE_,"&#39;"));-1!=a.indexOf("\x00")&&(a=a.replace(goog.string.NULL_RE_,"&#0;"));goog.string.DETECT_DOUBLE_ESCAPING&&-1!=a.indexOf("e")&&(a=a.replace(goog.string.E_RE_,"&#101;"))}return a};goog.string.AMP_RE_=/&/g;goog.string.LT_RE_=/</g;goog.string.GT_RE_=/>/g;goog.string.QUOT_RE_=/"/g;
goog.string.SINGLE_QUOTE_RE_=/'/g;goog.string.NULL_RE_=/\x00/g;goog.string.E_RE_=/e/g;goog.string.ALL_RE_=goog.string.DETECT_DOUBLE_ESCAPING?/[\x00&<>"'e]/:/[\x00&<>"']/;goog.string.unescapeEntities=function(a){return goog.string.contains(a,"&")?!goog.string.FORCE_NON_DOM_HTML_UNESCAPING&&"document"in goog.global?goog.string.unescapeEntitiesUsingDom_(a):goog.string.unescapePureXmlEntities_(a):a};
goog.string.unescapeEntitiesWithDocument=function(a,b){return goog.string.contains(a,"&")?goog.string.unescapeEntitiesUsingDom_(a,b):a};
goog.string.unescapeEntitiesUsingDom_=function(a,b){var c={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'},d;d=b?b.createElement("div"):goog.global.document.createElement("div");return a.replace(goog.string.HTML_ENTITY_PATTERN_,function(a,b){var g=c[a];if(g)return g;if("#"==b.charAt(0)){var h=Number("0"+b.substr(1));isNaN(h)||(g=String.fromCharCode(h))}g||(d.innerHTML=a+" ",g=d.firstChild.nodeValue.slice(0,-1));return c[a]=g})};
goog.string.unescapePureXmlEntities_=function(a){return a.replace(/&([^;]+);/g,function(a,c){switch(c){case "amp":return"&";case "lt":return"<";case "gt":return">";case "quot":return'"';default:if("#"==c.charAt(0)){var d=Number("0"+c.substr(1));if(!isNaN(d))return String.fromCharCode(d)}return a}})};goog.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g;goog.string.whitespaceEscape=function(a,b){return goog.string.newLineToBr(a.replace(/  /g," &#160;"),b)};
goog.string.preserveSpaces=function(a){return a.replace(/(^|[\n ]) /g,"$1"+goog.string.Unicode.NBSP)};goog.string.stripQuotes=function(a,b){for(var c=b.length,d=0;d<c;d++){var e=1==c?b:b.charAt(d);if(a.charAt(0)==e&&a.charAt(a.length-1)==e)return a.substring(1,a.length-1)}return a};goog.string.truncate=function(a,b,c){c&&(a=goog.string.unescapeEntities(a));a.length>b&&(a=a.substring(0,b-3)+"...");c&&(a=goog.string.htmlEscape(a));return a};
goog.string.truncateMiddle=function(a,b,c,d){c&&(a=goog.string.unescapeEntities(a));if(d&&a.length>b){d>b&&(d=b);var e=a.length-d;a=a.substring(0,b-d)+"..."+a.substring(e)}else a.length>b&&(d=Math.floor(b/2),e=a.length-d,a=a.substring(0,d+b%2)+"..."+a.substring(e));c&&(a=goog.string.htmlEscape(a));return a};goog.string.specialEscapeChars_={"\x00":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\x0B",'"':'\\"',"\\":"\\\\"};goog.string.jsEscapeCache_={"'":"\\'"};
goog.string.quote=function(a){a=String(a);if(a.quote)return a.quote();for(var b=['"'],c=0;c<a.length;c++){var d=a.charAt(c),e=d.charCodeAt(0);b[c+1]=goog.string.specialEscapeChars_[d]||(31<e&&127>e?d:goog.string.escapeChar(d))}b.push('"');return b.join("")};goog.string.escapeString=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=goog.string.escapeChar(a.charAt(c));return b.join("")};
goog.string.escapeChar=function(a){if(a in goog.string.jsEscapeCache_)return goog.string.jsEscapeCache_[a];if(a in goog.string.specialEscapeChars_)return goog.string.jsEscapeCache_[a]=goog.string.specialEscapeChars_[a];var b=a,c=a.charCodeAt(0);if(31<c&&127>c)b=a;else{if(256>c){if(b="\\x",16>c||256<c)b+="0"}else b="\\u",4096>c&&(b+="0");b+=c.toString(16).toUpperCase()}return goog.string.jsEscapeCache_[a]=b};goog.string.contains=function(a,b){return-1!=a.indexOf(b)};
goog.string.caseInsensitiveContains=function(a,b){return goog.string.contains(a.toLowerCase(),b.toLowerCase())};goog.string.countOf=function(a,b){return a&&b?a.split(b).length-1:0};goog.string.removeAt=function(a,b,c){var d=a;0<=b&&(b<a.length&&0<c)&&(d=a.substr(0,b)+a.substr(b+c,a.length-b-c));return d};goog.string.remove=function(a,b){var c=RegExp(goog.string.regExpEscape(b),"");return a.replace(c,"")};
goog.string.removeAll=function(a,b){var c=RegExp(goog.string.regExpEscape(b),"g");return a.replace(c,"")};goog.string.regExpEscape=function(a){return String(a).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")};goog.string.repeat=function(a,b){return Array(b+1).join(a)};goog.string.padNumber=function(a,b,c){a=goog.isDef(c)?a.toFixed(c):String(a);c=a.indexOf(".");-1==c&&(c=a.length);return goog.string.repeat("0",Math.max(0,b-c))+a};
goog.string.makeSafe=function(a){return null==a?"":String(a)};goog.string.buildString=function(a){return Array.prototype.join.call(arguments,"")};goog.string.getRandomString=function(){return Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^goog.now()).toString(36)};
goog.string.compareVersions=function(a,b){for(var c=0,d=goog.string.trim(String(a)).split("."),e=goog.string.trim(String(b)).split("."),f=Math.max(d.length,e.length),g=0;0==c&&g<f;g++){var h=d[g]||"",k=e[g]||"",l=RegExp("(\\d*)(\\D*)","g"),m=RegExp("(\\d*)(\\D*)","g");do{var n=l.exec(h)||["","",""],p=m.exec(k)||["","",""];if(0==n[0].length&&0==p[0].length)break;var c=0==n[1].length?0:parseInt(n[1],10),q=0==p[1].length?0:parseInt(p[1],10),c=goog.string.compareElements_(c,q)||goog.string.compareElements_(0==
n[2].length,0==p[2].length)||goog.string.compareElements_(n[2],p[2])}while(0==c)}return c};goog.string.compareElements_=function(a,b){return a<b?-1:a>b?1:0};goog.string.HASHCODE_MAX_=4294967296;goog.string.hashCode=function(a){for(var b=0,c=0;c<a.length;++c)b=31*b+a.charCodeAt(c),b%=goog.string.HASHCODE_MAX_;return b};goog.string.uniqueStringCounter_=2147483648*Math.random()|0;goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++};
goog.string.toNumber=function(a){var b=Number(a);return 0==b&&goog.string.isEmpty(a)?NaN:b};goog.string.isLowerCamelCase=function(a){return/^[a-z]+([A-Z][a-z]*)*$/.test(a)};goog.string.isUpperCamelCase=function(a){return/^([A-Z][a-z]*)+$/.test(a)};goog.string.toCamelCase=function(a){return String(a).replace(/\-([a-z])/g,function(a,c){return c.toUpperCase()})};goog.string.toSelectorCase=function(a){return String(a).replace(/([A-Z])/g,"-$1").toLowerCase()};
goog.string.toTitleCase=function(a,b){var c=goog.isString(b)?goog.string.regExpEscape(b):"\\s";return a.replace(RegExp("(^"+(c?"|["+c+"]+":"")+")([a-z])","g"),function(a,b,c){return b+c.toUpperCase()})};goog.string.capitalize=function(a){return String(a.charAt(0)).toUpperCase()+String(a.substr(1)).toLowerCase()};goog.string.parseInt=function(a){isFinite(a)&&(a=String(a));return goog.isString(a)?/^\s*-?0x/i.test(a)?parseInt(a,16):parseInt(a,10):NaN};
goog.string.splitLimit=function(a,b,c){a=a.split(b);for(var d=[];0<c&&a.length;)d.push(a.shift()),c--;a.length&&d.push(a.join(b));return d};goog.string.editDistance=function(a,b){var c=[],d=[];if(a==b)return 0;if(!a.length||!b.length)return Math.max(a.length,b.length);for(var e=0;e<b.length+1;e++)c[e]=e;for(e=0;e<a.length;e++){d[0]=e+1;for(var f=0;f<b.length;f++)d[f+1]=Math.min(d[f]+1,c[f+1]+1,c[f]+(a[e]!=b[f]));for(f=0;f<c.length;f++)c[f]=d[f]}return d[b.length]};goog.asserts={};
goog.asserts.ENABLE_ASSERTS=goog.DEBUG;goog.asserts.AssertionError=function(a,b){b.unshift(a);goog.debug.Error.call(this,goog.string.subs.apply(null,b));b.shift();this.messagePattern=a};goog.inherits(goog.asserts.AssertionError,goog.debug.Error);goog.asserts.AssertionError.prototype.name="AssertionError";goog.asserts.DEFAULT_ERROR_HANDLER=function(a){throw a;};goog.asserts.errorHandler_=goog.asserts.DEFAULT_ERROR_HANDLER;
goog.asserts.doAssertFailure_=function(a,b,c,d){var e="Assertion failed";if(c)var e=e+(": "+c),f=d;else a&&(e+=": "+a,f=b);a=new goog.asserts.AssertionError(""+e,f||[]);goog.asserts.errorHandler_(a)};goog.asserts.setErrorHandler=function(a){goog.asserts.ENABLE_ASSERTS&&(goog.asserts.errorHandler_=a)};goog.asserts.assert=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!a&&goog.asserts.doAssertFailure_("",null,b,Array.prototype.slice.call(arguments,2));return a};
goog.asserts.fail=function(a,b){goog.asserts.ENABLE_ASSERTS&&goog.asserts.errorHandler_(new goog.asserts.AssertionError("Failure"+(a?": "+a:""),Array.prototype.slice.call(arguments,1)))};goog.asserts.assertNumber=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isNumber(a)&&goog.asserts.doAssertFailure_("Expected number but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};
goog.asserts.assertString=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isString(a)&&goog.asserts.doAssertFailure_("Expected string but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.assertFunction=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isFunction(a)&&goog.asserts.doAssertFailure_("Expected function but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};
goog.asserts.assertObject=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isObject(a)&&goog.asserts.doAssertFailure_("Expected object but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.assertArray=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isArray(a)&&goog.asserts.doAssertFailure_("Expected array but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};
goog.asserts.assertBoolean=function(a,b,c){goog.asserts.ENABLE_ASSERTS&&!goog.isBoolean(a)&&goog.asserts.doAssertFailure_("Expected boolean but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};goog.asserts.assertElement=function(a,b,c){!goog.asserts.ENABLE_ASSERTS||goog.isObject(a)&&a.nodeType==goog.dom.NodeType.ELEMENT||goog.asserts.doAssertFailure_("Expected Element but got %s: %s.",[goog.typeOf(a),a],b,Array.prototype.slice.call(arguments,2));return a};
goog.asserts.assertInstanceof=function(a,b,c,d){!goog.asserts.ENABLE_ASSERTS||a instanceof b||goog.asserts.doAssertFailure_("Expected instanceof %s but got %s.",[goog.asserts.getType_(b),goog.asserts.getType_(a)],c,Array.prototype.slice.call(arguments,3));return a};goog.asserts.assertObjectPrototypeIsIntact=function(){for(var a in Object.prototype)goog.asserts.fail(a+" should not be enumerable in Object.prototype.")};
goog.asserts.getType_=function(a){return a instanceof Function?a.displayName||a.name||"unknown type name":a instanceof Object?a.constructor.displayName||a.constructor.name||Object.prototype.toString.call(a):null===a?"null":typeof a};goog.debug.entryPointRegistry={};goog.debug.EntryPointMonitor=function(){};goog.debug.entryPointRegistry.refList_=[];goog.debug.entryPointRegistry.monitors_=[];goog.debug.entryPointRegistry.monitorsMayExist_=!1;
goog.debug.entryPointRegistry.register=function(a){goog.debug.entryPointRegistry.refList_[goog.debug.entryPointRegistry.refList_.length]=a;if(goog.debug.entryPointRegistry.monitorsMayExist_)for(var b=goog.debug.entryPointRegistry.monitors_,c=0;c<b.length;c++)a(goog.bind(b[c].wrap,b[c]))};
goog.debug.entryPointRegistry.monitorAll=function(a){goog.debug.entryPointRegistry.monitorsMayExist_=!0;for(var b=goog.bind(a.wrap,a),c=0;c<goog.debug.entryPointRegistry.refList_.length;c++)goog.debug.entryPointRegistry.refList_[c](b);goog.debug.entryPointRegistry.monitors_.push(a)};
goog.debug.entryPointRegistry.unmonitorAllIfPossible=function(a){var b=goog.debug.entryPointRegistry.monitors_;goog.asserts.assert(a==b[b.length-1],"Only the most recent monitor can be unwrapped.");a=goog.bind(a.unwrap,a);for(var c=0;c<goog.debug.entryPointRegistry.refList_.length;c++)goog.debug.entryPointRegistry.refList_[c](a);b.length--};goog.functions={};goog.functions.constant=function(a){return function(){return a}};goog.functions.FALSE=goog.functions.constant(!1);goog.functions.TRUE=goog.functions.constant(!0);
goog.functions.NULL=goog.functions.constant(null);goog.functions.identity=function(a,b){return a};goog.functions.error=function(a){return function(){throw Error(a);}};goog.functions.fail=function(a){return function(){throw a;}};goog.functions.lock=function(a,b){b=b||0;return function(){return a.apply(this,Array.prototype.slice.call(arguments,0,b))}};goog.functions.nth=function(a){return function(){return arguments[a]}};
goog.functions.withReturnValue=function(a,b){return goog.functions.sequence(a,goog.functions.constant(b))};goog.functions.equalTo=function(a,b){return function(c){return b?a==c:a===c}};goog.functions.compose=function(a,b){var c=arguments,d=c.length;return function(){var a;d&&(a=c[d-1].apply(this,arguments));for(var b=d-2;0<=b;b--)a=c[b].call(this,a);return a}};goog.functions.sequence=function(a){var b=arguments,c=b.length;return function(){for(var a,e=0;e<c;e++)a=b[e].apply(this,arguments);return a}};
goog.functions.and=function(a){var b=arguments,c=b.length;return function(){for(var a=0;a<c;a++)if(!b[a].apply(this,arguments))return!1;return!0}};goog.functions.or=function(a){var b=arguments,c=b.length;return function(){for(var a=0;a<c;a++)if(b[a].apply(this,arguments))return!0;return!1}};goog.functions.not=function(a){return function(){return!a.apply(this,arguments)}};
goog.functions.create=function(a,b){var c=function(){};c.prototype=a.prototype;c=new c;a.apply(c,Array.prototype.slice.call(arguments,1));return c};goog.functions.CACHE_RETURN_VALUE=!0;goog.functions.cacheReturnValue=function(a){var b=!1,c;return function(){if(!goog.functions.CACHE_RETURN_VALUE)return a();b||(c=a(),b=!0);return c}};goog.array={};goog.NATIVE_ARRAY_PROTOTYPES=goog.TRUSTED_SITE;goog.array.ASSUME_NATIVE_FUNCTIONS=!1;goog.array.peek=function(a){return a[a.length-1]};goog.array.last=goog.array.peek;
goog.array.ARRAY_PROTOTYPE_=Array.prototype;goog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.indexOf)?function(a,b,c){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.indexOf.call(a,b,c)}:function(a,b,c){c=null==c?0:0>c?Math.max(0,a.length+c):c;if(goog.isString(a))return goog.isString(b)&&1==b.length?a.indexOf(b,c):-1;for(;c<a.length;c++)if(c in a&&a[c]===b)return c;return-1};
goog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.lastIndexOf)?function(a,b,c){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(a,b,null==c?a.length-1:c)}:function(a,b,c){c=null==c?a.length-1:c;0>c&&(c=Math.max(0,a.length+c));if(goog.isString(a))return goog.isString(b)&&1==b.length?a.lastIndexOf(b,c):-1;for(;0<=c;c--)if(c in a&&a[c]===b)return c;return-1};
goog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.forEach)?function(a,b,c){goog.asserts.assert(null!=a.length);goog.array.ARRAY_PROTOTYPE_.forEach.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;f<d;f++)f in e&&b.call(c,e[f],f,a)};goog.array.forEachRight=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,d=d-1;0<=d;--d)d in e&&b.call(c,e[d],d,a)};
goog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.filter)?function(a,b,c){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.filter.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=[],f=0,g=goog.isString(a)?a.split(""):a,h=0;h<d;h++)if(h in g){var k=g[h];b.call(c,k,h,a)&&(e[f++]=k)}return e};
goog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.map)?function(a,b,c){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.map.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=Array(d),f=goog.isString(a)?a.split(""):a,g=0;g<d;g++)g in f&&(e[g]=b.call(c,f[g],g,a));return e};
goog.array.reduce=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.reduce)?function(a,b,c,d){goog.asserts.assert(null!=a.length);d&&(b=goog.bind(b,d));return goog.array.ARRAY_PROTOTYPE_.reduce.call(a,b,c)}:function(a,b,c,d){var e=c;goog.array.forEach(a,function(c,g){e=b.call(d,e,c,g,a)});return e};
goog.array.reduceRight=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.reduceRight)?function(a,b,c,d){goog.asserts.assert(null!=a.length);d&&(b=goog.bind(b,d));return goog.array.ARRAY_PROTOTYPE_.reduceRight.call(a,b,c)}:function(a,b,c,d){var e=c;goog.array.forEachRight(a,function(c,g){e=b.call(d,e,c,g,a)});return e};
goog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.some)?function(a,b,c){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.some.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return!0;return!1};
goog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.every)?function(a,b,c){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.every.call(a,b,c)}:function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&!b.call(c,e[f],f,a))return!1;return!0};goog.array.count=function(a,b,c){var d=0;goog.array.forEach(a,function(a,f,g){b.call(c,a,f,g)&&++d},c);return d};
goog.array.find=function(a,b,c){b=goog.array.findIndex(a,b,c);return 0>b?null:goog.isString(a)?a.charAt(b):a[b]};goog.array.findIndex=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,f=0;f<d;f++)if(f in e&&b.call(c,e[f],f,a))return f;return-1};goog.array.findRight=function(a,b,c){b=goog.array.findIndexRight(a,b,c);return 0>b?null:goog.isString(a)?a.charAt(b):a[b]};
goog.array.findIndexRight=function(a,b,c){for(var d=a.length,e=goog.isString(a)?a.split(""):a,d=d-1;0<=d;d--)if(d in e&&b.call(c,e[d],d,a))return d;return-1};goog.array.contains=function(a,b){return 0<=goog.array.indexOf(a,b)};goog.array.isEmpty=function(a){return 0==a.length};goog.array.clear=function(a){if(!goog.isArray(a))for(var b=a.length-1;0<=b;b--)delete a[b];a.length=0};goog.array.insert=function(a,b){goog.array.contains(a,b)||a.push(b)};
goog.array.insertAt=function(a,b,c){goog.array.splice(a,c,0,b)};goog.array.insertArrayAt=function(a,b,c){goog.partial(goog.array.splice,a,c,0).apply(null,b)};goog.array.insertBefore=function(a,b,c){var d;2==arguments.length||0>(d=goog.array.indexOf(a,c))?a.push(b):goog.array.insertAt(a,b,d)};goog.array.remove=function(a,b){var c=goog.array.indexOf(a,b),d;(d=0<=c)&&goog.array.removeAt(a,c);return d};
goog.array.removeAt=function(a,b){goog.asserts.assert(null!=a.length);return 1==goog.array.ARRAY_PROTOTYPE_.splice.call(a,b,1).length};goog.array.removeIf=function(a,b,c){b=goog.array.findIndex(a,b,c);return 0<=b?(goog.array.removeAt(a,b),!0):!1};goog.array.removeAllIf=function(a,b,c){var d=0;goog.array.forEachRight(a,function(e,f){b.call(c,e,f,a)&&goog.array.removeAt(a,f)&&d++});return d};goog.array.concat=function(a){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)};
goog.array.join=function(a){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)};goog.array.toArray=function(a){var b=a.length;if(0<b){for(var c=Array(b),d=0;d<b;d++)c[d]=a[d];return c}return[]};goog.array.clone=goog.array.toArray;goog.array.extend=function(a,b){for(var c=1;c<arguments.length;c++){var d=arguments[c];if(goog.isArrayLike(d)){var e=a.length||0,f=d.length||0;a.length=e+f;for(var g=0;g<f;g++)a[e+g]=d[g]}else a.push(d)}};
goog.array.splice=function(a,b,c,d){goog.asserts.assert(null!=a.length);return goog.array.ARRAY_PROTOTYPE_.splice.apply(a,goog.array.slice(arguments,1))};goog.array.slice=function(a,b,c){goog.asserts.assert(null!=a.length);return 2>=arguments.length?goog.array.ARRAY_PROTOTYPE_.slice.call(a,b):goog.array.ARRAY_PROTOTYPE_.slice.call(a,b,c)};
goog.array.removeDuplicates=function(a,b,c){b=b||a;var d=function(a){return goog.isObject(g)?"o"+goog.getUid(g):(typeof g).charAt(0)+g};c=c||d;for(var d={},e=0,f=0;f<a.length;){var g=a[f++],h=c(g);Object.prototype.hasOwnProperty.call(d,h)||(d[h]=!0,b[e++]=g)}b.length=e};goog.array.binarySearch=function(a,b,c){return goog.array.binarySearch_(a,c||goog.array.defaultCompare,!1,b)};goog.array.binarySelect=function(a,b,c){return goog.array.binarySearch_(a,b,!0,void 0,c)};
goog.array.binarySearch_=function(a,b,c,d,e){for(var f=0,g=a.length,h;f<g;){var k=f+g>>1,l;l=c?b.call(e,a[k],k,a):b(d,a[k]);0<l?f=k+1:(g=k,h=!l)}return h?f:~f};goog.array.sort=function(a,b){a.sort(b||goog.array.defaultCompare)};goog.array.stableSort=function(a,b){for(var c=0;c<a.length;c++)a[c]={index:c,value:a[c]};var d=b||goog.array.defaultCompare;goog.array.sort(a,function(a,b){return d(a.value,b.value)||a.index-b.index});for(c=0;c<a.length;c++)a[c]=a[c].value};
goog.array.sortByKey=function(a,b,c){var d=c||goog.array.defaultCompare;goog.array.sort(a,function(a,c){return d(b(a),b(c))})};goog.array.sortObjectsByKey=function(a,b,c){goog.array.sortByKey(a,function(a){return a[b]},c)};goog.array.isSorted=function(a,b,c){b=b||goog.array.defaultCompare;for(var d=1;d<a.length;d++){var e=b(a[d-1],a[d]);if(0<e||0==e&&c)return!1}return!0};
goog.array.equals=function(a,b,c){if(!goog.isArrayLike(a)||!goog.isArrayLike(b)||a.length!=b.length)return!1;var d=a.length;c=c||goog.array.defaultCompareEquality;for(var e=0;e<d;e++)if(!c(a[e],b[e]))return!1;return!0};goog.array.compare3=function(a,b,c){c=c||goog.array.defaultCompare;for(var d=Math.min(a.length,b.length),e=0;e<d;e++){var f=c(a[e],b[e]);if(0!=f)return f}return goog.array.defaultCompare(a.length,b.length)};goog.array.defaultCompare=function(a,b){return a>b?1:a<b?-1:0};
goog.array.defaultCompareEquality=function(a,b){return a===b};goog.array.binaryInsert=function(a,b,c){c=goog.array.binarySearch(a,b,c);return 0>c?(goog.array.insertAt(a,b,-(c+1)),!0):!1};goog.array.binaryRemove=function(a,b,c){b=goog.array.binarySearch(a,b,c);return 0<=b?goog.array.removeAt(a,b):!1};goog.array.bucket=function(a,b,c){for(var d={},e=0;e<a.length;e++){var f=a[e],g=b.call(c,f,e,a);goog.isDef(g)&&(d[g]||(d[g]=[])).push(f)}return d};
goog.array.toObject=function(a,b,c){var d={};goog.array.forEach(a,function(e,f){d[b.call(c,e,f,a)]=e});return d};goog.array.range=function(a,b,c){var d=[],e=0,f=a;c=c||1;void 0!==b&&(e=a,f=b);if(0>c*(f-e))return[];if(0<c)for(a=e;a<f;a+=c)d.push(a);else for(a=e;a>f;a+=c)d.push(a);return d};goog.array.repeat=function(a,b){for(var c=[],d=0;d<b;d++)c[d]=a;return c};
goog.array.flatten=function(a){for(var b=[],c=0;c<arguments.length;c++){var d=arguments[c];if(goog.isArray(d))for(var e=0;e<d.length;e+=8192)for(var f=goog.array.slice(d,e,e+8192),f=goog.array.flatten.apply(null,f),g=0;g<f.length;g++)b.push(f[g]);else b.push(d)}return b};goog.array.rotate=function(a,b){goog.asserts.assert(null!=a.length);a.length&&(b%=a.length,0<b?goog.array.ARRAY_PROTOTYPE_.unshift.apply(a,a.splice(-b,b)):0>b&&goog.array.ARRAY_PROTOTYPE_.push.apply(a,a.splice(0,-b)));return a};
goog.array.moveItem=function(a,b,c){goog.asserts.assert(0<=b&&b<a.length);goog.asserts.assert(0<=c&&c<a.length);b=goog.array.ARRAY_PROTOTYPE_.splice.call(a,b,1);goog.array.ARRAY_PROTOTYPE_.splice.call(a,c,0,b[0])};goog.array.zip=function(a){if(!arguments.length)return[];for(var b=[],c=0;;c++){for(var d=[],e=0;e<arguments.length;e++){var f=arguments[e];if(c>=f.length)return b;d.push(f[c])}b.push(d)}};
goog.array.shuffle=function(a,b){for(var c=b||Math.random,d=a.length-1;0<d;d--){var e=Math.floor(c()*(d+1)),f=a[d];a[d]=a[e];a[e]=f}};goog.labs={};goog.labs.userAgent={};goog.labs.userAgent.util={};goog.labs.userAgent.util.getNativeUserAgentString_=function(){var a=goog.labs.userAgent.util.getNavigator_();return a&&(a=a.userAgent)?a:""};goog.labs.userAgent.util.getNavigator_=function(){return goog.global.navigator};goog.labs.userAgent.util.userAgent_=goog.labs.userAgent.util.getNativeUserAgentString_();
goog.labs.userAgent.util.setUserAgent=function(a){goog.labs.userAgent.util.userAgent_=a||goog.labs.userAgent.util.getNativeUserAgentString_()};goog.labs.userAgent.util.getUserAgent=function(){return goog.labs.userAgent.util.userAgent_};goog.labs.userAgent.util.matchUserAgent=function(a){var b=goog.labs.userAgent.util.getUserAgent();return goog.string.contains(b,a)};
goog.labs.userAgent.util.matchUserAgentIgnoreCase=function(a){var b=goog.labs.userAgent.util.getUserAgent();return goog.string.caseInsensitiveContains(b,a)};goog.labs.userAgent.util.extractVersionTuples=function(a){for(var b=RegExp("(\\w[\\w ]+)/([^\\s]+)\\s*(?:\\((.*?)\\))?","g"),c=[],d;d=b.exec(a);)c.push([d[1],d[2],d[3]||void 0]);return c};goog.object={};goog.object.forEach=function(a,b,c){for(var d in a)b.call(c,a[d],d,a)};
goog.object.filter=function(a,b,c){var d={},e;for(e in a)b.call(c,a[e],e,a)&&(d[e]=a[e]);return d};goog.object.map=function(a,b,c){var d={},e;for(e in a)d[e]=b.call(c,a[e],e,a);return d};goog.object.some=function(a,b,c){for(var d in a)if(b.call(c,a[d],d,a))return!0;return!1};goog.object.every=function(a,b,c){for(var d in a)if(!b.call(c,a[d],d,a))return!1;return!0};goog.object.getCount=function(a){var b=0,c;for(c in a)b++;return b};goog.object.getAnyKey=function(a){for(var b in a)return b};
goog.object.getAnyValue=function(a){for(var b in a)return a[b]};goog.object.contains=function(a,b){return goog.object.containsValue(a,b)};goog.object.getValues=function(a){var b=[],c=0,d;for(d in a)b[c++]=a[d];return b};goog.object.getKeys=function(a){var b=[],c=0,d;for(d in a)b[c++]=d;return b};goog.object.getValueByKeys=function(a,b){for(var c=goog.isArrayLike(b),d=c?b:arguments,c=c?0:1;c<d.length&&(a=a[d[c]],goog.isDef(a));c++);return a};goog.object.containsKey=function(a,b){return b in a};
goog.object.containsValue=function(a,b){for(var c in a)if(a[c]==b)return!0;return!1};goog.object.findKey=function(a,b,c){for(var d in a)if(b.call(c,a[d],d,a))return d};goog.object.findValue=function(a,b,c){return(b=goog.object.findKey(a,b,c))&&a[b]};goog.object.isEmpty=function(a){for(var b in a)return!1;return!0};goog.object.clear=function(a){for(var b in a)delete a[b]};goog.object.remove=function(a,b){var c;(c=b in a)&&delete a[b];return c};
goog.object.add=function(a,b,c){if(b in a)throw Error('The object already contains the key "'+b+'"');goog.object.set(a,b,c)};goog.object.get=function(a,b,c){return b in a?a[b]:c};goog.object.set=function(a,b,c){a[b]=c};goog.object.setIfUndefined=function(a,b,c){return b in a?a[b]:a[b]=c};goog.object.equals=function(a,b){for(var c in a)if(!(c in b)||a[c]!==b[c])return!1;for(c in b)if(!(c in a))return!1;return!0};goog.object.clone=function(a){var b={},c;for(c in a)b[c]=a[c];return b};
goog.object.unsafeClone=function(a){var b=goog.typeOf(a);if("object"==b||"array"==b){if(a.clone)return a.clone();var b="array"==b?[]:{},c;for(c in a)b[c]=goog.object.unsafeClone(a[c]);return b}return a};goog.object.transpose=function(a){var b={},c;for(c in a)b[a[c]]=c;return b};goog.object.PROTOTYPE_FIELDS_="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");
goog.object.extend=function(a,b){for(var c,d,e=1;e<arguments.length;e++){d=arguments[e];for(c in d)a[c]=d[c];for(var f=0;f<goog.object.PROTOTYPE_FIELDS_.length;f++)c=goog.object.PROTOTYPE_FIELDS_[f],Object.prototype.hasOwnProperty.call(d,c)&&(a[c]=d[c])}};
goog.object.create=function(a){var b=arguments.length;if(1==b&&goog.isArray(arguments[0]))return goog.object.create.apply(null,arguments[0]);if(b%2)throw Error("Uneven number of arguments");for(var c={},d=0;d<b;d+=2)c[arguments[d]]=arguments[d+1];return c};goog.object.createSet=function(a){var b=arguments.length;if(1==b&&goog.isArray(arguments[0]))return goog.object.createSet.apply(null,arguments[0]);for(var c={},d=0;d<b;d++)c[arguments[d]]=!0;return c};
goog.object.createImmutableView=function(a){var b=a;Object.isFrozen&&!Object.isFrozen(a)&&(b=Object.create(a),Object.freeze(b));return b};goog.object.isImmutableView=function(a){return!!Object.isFrozen&&Object.isFrozen(a)};goog.labs.userAgent.browser={};goog.labs.userAgent.browser.matchOpera_=function(){return goog.labs.userAgent.util.matchUserAgent("Opera")||goog.labs.userAgent.util.matchUserAgent("OPR")};
goog.labs.userAgent.browser.matchIE_=function(){return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")};goog.labs.userAgent.browser.matchFirefox_=function(){return goog.labs.userAgent.util.matchUserAgent("Firefox")};goog.labs.userAgent.browser.matchSafari_=function(){return goog.labs.userAgent.util.matchUserAgent("Safari")&&!goog.labs.userAgent.util.matchUserAgent("Chrome")&&!goog.labs.userAgent.util.matchUserAgent("CriOS")&&!goog.labs.userAgent.util.matchUserAgent("Android")};
goog.labs.userAgent.browser.matchCoast_=function(){return goog.labs.userAgent.util.matchUserAgent("Coast")};goog.labs.userAgent.browser.matchIosWebview_=function(){return(goog.labs.userAgent.util.matchUserAgent("iPad")||goog.labs.userAgent.util.matchUserAgent("iPhone"))&&!goog.labs.userAgent.browser.matchSafari_()&&!goog.labs.userAgent.browser.matchChrome_()&&!goog.labs.userAgent.browser.matchCoast_()&&goog.labs.userAgent.util.matchUserAgent("AppleWebKit")};
goog.labs.userAgent.browser.matchChrome_=function(){return goog.labs.userAgent.util.matchUserAgent("Chrome")||goog.labs.userAgent.util.matchUserAgent("CriOS")};goog.labs.userAgent.browser.matchAndroidBrowser_=function(){return!goog.labs.userAgent.browser.isChrome()&&goog.labs.userAgent.util.matchUserAgent("Android")};goog.labs.userAgent.browser.isOpera=goog.labs.userAgent.browser.matchOpera_;goog.labs.userAgent.browser.isIE=goog.labs.userAgent.browser.matchIE_;
goog.labs.userAgent.browser.isFirefox=goog.labs.userAgent.browser.matchFirefox_;goog.labs.userAgent.browser.isSafari=goog.labs.userAgent.browser.matchSafari_;goog.labs.userAgent.browser.isCoast=goog.labs.userAgent.browser.matchCoast_;goog.labs.userAgent.browser.isIosWebview=goog.labs.userAgent.browser.matchIosWebview_;goog.labs.userAgent.browser.isChrome=goog.labs.userAgent.browser.matchChrome_;goog.labs.userAgent.browser.isAndroidBrowser=goog.labs.userAgent.browser.matchAndroidBrowser_;
goog.labs.userAgent.browser.isSilk=function(){return goog.labs.userAgent.util.matchUserAgent("Silk")};
goog.labs.userAgent.browser.getVersion=function(){function a(a){a=goog.array.find(a,d);return c[a]||""}var b=goog.labs.userAgent.util.getUserAgent();if(goog.labs.userAgent.browser.isIE())return goog.labs.userAgent.browser.getIEVersion_(b);var b=goog.labs.userAgent.util.extractVersionTuples(b),c={};goog.array.forEach(b,function(a){c[a[0]]=a[1]});var d=goog.partial(goog.object.containsKey,c);return goog.labs.userAgent.browser.isOpera()?a(["Version","Opera","OPR"]):goog.labs.userAgent.browser.isChrome()?
a(["Chrome","CriOS"]):(b=b[2])&&b[1]||""};goog.labs.userAgent.browser.isVersionOrHigher=function(a){return 0<=goog.string.compareVersions(goog.labs.userAgent.browser.getVersion(),a)};
goog.labs.userAgent.browser.getIEVersion_=function(a){var b=/rv: *([\d\.]*)/.exec(a);if(b&&b[1])return b[1];var b="",c=/MSIE +([\d\.]+)/.exec(a);if(c&&c[1])if(a=/Trident\/(\d.\d)/.exec(a),"7.0"==c[1])if(a&&a[1])switch(a[1]){case "4.0":b="8.0";break;case "5.0":b="9.0";break;case "6.0":b="10.0";break;case "7.0":b="11.0"}else b="7.0";else b=c[1];return b};goog.async={};goog.async.throwException=function(a){goog.global.setTimeout(function(){throw a;},0)};
goog.async.nextTick=function(a,b,c){var d=a;b&&(d=goog.bind(a,b));d=goog.async.nextTick.wrapCallback_(d);!goog.isFunction(goog.global.setImmediate)||!c&&goog.global.Window&&goog.global.Window.prototype.setImmediate==goog.global.setImmediate?(goog.async.nextTick.setImmediate_||(goog.async.nextTick.setImmediate_=goog.async.nextTick.getSetImmediateEmulator_()),goog.async.nextTick.setImmediate_(d)):goog.global.setImmediate(d)};
goog.async.nextTick.getSetImmediateEmulator_=function(){var a=goog.global.MessageChannel;"undefined"===typeof a&&("undefined"!==typeof window&&window.postMessage&&window.addEventListener)&&(a=function(){var a=document.createElement("iframe");a.style.display="none";a.src="";document.documentElement.appendChild(a);var b=a.contentWindow,a=b.document;a.open();a.write("");a.close();var c="callImmediate"+Math.random(),d="file:"==b.location.protocol?"*":b.location.protocol+"//"+b.location.host,a=goog.bind(function(a){if(("*"==
d||a.origin==d)&&a.data==c)this.port1.onmessage()},this);b.addEventListener("message",a,!1);this.port1={};this.port2={postMessage:function(){b.postMessage(c,d)}}});if("undefined"!==typeof a&&!goog.labs.userAgent.browser.isIE()){var b=new a,c={},d=c;b.port1.onmessage=function(){if(goog.isDef(c.next)){c=c.next;var a=c.cb;c.cb=null;a()}};return function(a){d.next={cb:a};d=d.next;b.port2.postMessage(0)}}return"undefined"!==typeof document&&"onreadystatechange"in document.createElement("script")?function(a){var b=
document.createElement("script");b.onreadystatechange=function(){b.onreadystatechange=null;b.parentNode.removeChild(b);b=null;a();a=null};document.documentElement.appendChild(b)}:function(a){goog.global.setTimeout(a,0)}};goog.async.nextTick.wrapCallback_=goog.functions.identity;goog.debug.entryPointRegistry.register(function(a){goog.async.nextTick.wrapCallback_=a});goog.testing={};goog.testing.watchers={};goog.testing.watchers.resetWatchers_=[];
goog.testing.watchers.signalClockReset=function(){for(var a=goog.testing.watchers.resetWatchers_,b=0;b<a.length;b++)goog.testing.watchers.resetWatchers_[b]()};goog.testing.watchers.watchClockReset=function(a){goog.testing.watchers.resetWatchers_.push(a)};
goog.async.run=function(a,b){goog.async.run.schedule_||goog.async.run.initializeRunner_();goog.async.run.workQueueScheduled_||(goog.async.run.schedule_(),goog.async.run.workQueueScheduled_=!0);goog.async.run.workQueue_.push(new goog.async.run.WorkItem_(a,b))};goog.async.run.initializeRunner_=function(){if(goog.global.Promise&&goog.global.Promise.resolve){var a=goog.global.Promise.resolve();goog.async.run.schedule_=function(){a.then(goog.async.run.processWorkQueue)}}else goog.async.run.schedule_=function(){goog.async.nextTick(goog.async.run.processWorkQueue)}};
goog.async.run.forceNextTick=function(){goog.async.run.schedule_=function(){goog.async.nextTick(goog.async.run.processWorkQueue)}};goog.async.run.workQueueScheduled_=!1;goog.async.run.workQueue_=[];goog.DEBUG&&(goog.async.run.resetQueue_=function(){goog.async.run.workQueueScheduled_=!1;goog.async.run.workQueue_=[]},goog.testing.watchers.watchClockReset(goog.async.run.resetQueue_));
goog.async.run.processWorkQueue=function(){for(;goog.async.run.workQueue_.length;){var a=goog.async.run.workQueue_;goog.async.run.workQueue_=[];for(var b=0;b<a.length;b++){var c=a[b];try{c.fn.call(c.scope)}catch(d){goog.async.throwException(d)}}}goog.async.run.workQueueScheduled_=!1};goog.async.run.WorkItem_=function(a,b){this.fn=a;this.scope=b};goog.promise={};goog.promise.Resolver=function(){};
goog.Promise=function(a,b){this.state_=goog.Promise.State_.PENDING;this.result_=void 0;this.callbackEntries_=this.parent_=null;this.executing_=!1;0<goog.Promise.UNHANDLED_REJECTION_DELAY?this.unhandledRejectionId_=0:0==goog.Promise.UNHANDLED_REJECTION_DELAY&&(this.hadUnhandledRejection_=!1);goog.Promise.LONG_STACK_TRACES&&(this.stack_=[],this.addStackTrace_(Error("created")),this.currentStep_=0);try{var c=this;a.call(b,function(a){c.resolve_(goog.Promise.State_.FULFILLED,a)},function(a){if(goog.DEBUG&&
!(a instanceof goog.Promise.CancellationError))try{if(a instanceof Error)throw a;throw Error("Promise rejected.");}catch(b){}c.resolve_(goog.Promise.State_.REJECTED,a)})}catch(d){this.resolve_(goog.Promise.State_.REJECTED,d)}};goog.Promise.LONG_STACK_TRACES=!1;goog.Promise.UNHANDLED_REJECTION_DELAY=0;goog.Promise.State_={PENDING:0,BLOCKED:1,FULFILLED:2,REJECTED:3};goog.Promise.resolve=function(a){return new goog.Promise(function(b,c){b(a)})};
goog.Promise.reject=function(a){return new goog.Promise(function(b,c){c(a)})};goog.Promise.race=function(a){return new goog.Promise(function(b,c){a.length||b(void 0);for(var d=0,e;e=a[d];d++)e.then(b,c)})};goog.Promise.all=function(a){return new goog.Promise(function(b,c){var d=a.length,e=[];if(d)for(var f=function(a,c){d--;e[a]=c;0==d&&b(e)},g=function(a){c(a)},h=0,k;k=a[h];h++)k.then(goog.partial(f,h),g);else b(e)})};
goog.Promise.firstFulfilled=function(a){return new goog.Promise(function(b,c){var d=a.length,e=[];if(d)for(var f=function(a){b(a)},g=function(a,b){d--;e[a]=b;0==d&&c(e)},h=0,k;k=a[h];h++)k.then(f,goog.partial(g,h));else b(void 0)})};goog.Promise.withResolver=function(){var a,b,c=new goog.Promise(function(c,e){a=c;b=e});return new goog.Promise.Resolver_(c,a,b)};
goog.Promise.prototype.then=function(a,b,c){null!=a&&goog.asserts.assertFunction(a,"opt_onFulfilled should be a function.");null!=b&&goog.asserts.assertFunction(b,"opt_onRejected should be a function. Did you pass opt_context as the second argument instead of the third?");goog.Promise.LONG_STACK_TRACES&&this.addStackTrace_(Error("then"));return this.addChildPromise_(goog.isFunction(a)?a:null,goog.isFunction(b)?b:null,c)};goog.Thenable.addImplementation(goog.Promise);
goog.Promise.prototype.thenAlways=function(a,b){goog.Promise.LONG_STACK_TRACES&&this.addStackTrace_(Error("thenAlways"));var c=function(){try{a.call(b)}catch(c){goog.Promise.handleRejection_.call(null,c)}};this.addCallbackEntry_({child:null,onRejected:c,onFulfilled:c});return this};goog.Promise.prototype.thenCatch=function(a,b){goog.Promise.LONG_STACK_TRACES&&this.addStackTrace_(Error("thenCatch"));return this.addChildPromise_(null,a,b)};
goog.Promise.prototype.cancel=function(a){this.state_==goog.Promise.State_.PENDING&&goog.async.run(function(){var b=new goog.Promise.CancellationError(a);this.cancelInternal_(b)},this)};goog.Promise.prototype.cancelInternal_=function(a){this.state_==goog.Promise.State_.PENDING&&(this.parent_?this.parent_.cancelChild_(this,a):this.resolve_(goog.Promise.State_.REJECTED,a))};
goog.Promise.prototype.cancelChild_=function(a,b){if(this.callbackEntries_){for(var c=0,d=-1,e=0,f;f=this.callbackEntries_[e];e++)if(f=f.child)if(c++,f==a&&(d=e),0<=d&&1<c)break;0<=d&&(this.state_==goog.Promise.State_.PENDING&&1==c?this.cancelInternal_(b):(c=this.callbackEntries_.splice(d,1)[0],this.executeCallback_(c,goog.Promise.State_.REJECTED,b)))}};
goog.Promise.prototype.addCallbackEntry_=function(a){this.callbackEntries_&&this.callbackEntries_.length||this.state_!=goog.Promise.State_.FULFILLED&&this.state_!=goog.Promise.State_.REJECTED||this.scheduleCallbacks_();this.callbackEntries_||(this.callbackEntries_=[]);this.callbackEntries_.push(a)};
goog.Promise.prototype.addChildPromise_=function(a,b,c){var d={child:null,onFulfilled:null,onRejected:null};d.child=new goog.Promise(function(e,f){d.onFulfilled=a?function(b){try{var d=a.call(c,b);e(d)}catch(k){f(k)}}:e;d.onRejected=b?function(a){try{var d=b.call(c,a);!goog.isDef(d)&&a instanceof goog.Promise.CancellationError?f(a):e(d)}catch(k){f(k)}}:f});d.child.parent_=this;this.addCallbackEntry_(d);return d.child};
goog.Promise.prototype.unblockAndFulfill_=function(a){goog.asserts.assert(this.state_==goog.Promise.State_.BLOCKED);this.state_=goog.Promise.State_.PENDING;this.resolve_(goog.Promise.State_.FULFILLED,a)};goog.Promise.prototype.unblockAndReject_=function(a){goog.asserts.assert(this.state_==goog.Promise.State_.BLOCKED);this.state_=goog.Promise.State_.PENDING;this.resolve_(goog.Promise.State_.REJECTED,a)};
goog.Promise.prototype.resolve_=function(a,b){if(this.state_==goog.Promise.State_.PENDING){if(this==b)a=goog.Promise.State_.REJECTED,b=new TypeError("Promise cannot resolve to itself");else{if(goog.Thenable.isImplementedBy(b)){this.state_=goog.Promise.State_.BLOCKED;b.then(this.unblockAndFulfill_,this.unblockAndReject_,this);return}if(goog.isObject(b))try{var c=b.then;if(goog.isFunction(c)){this.tryThen_(b,c);return}}catch(d){a=goog.Promise.State_.REJECTED,b=d}}this.result_=b;this.state_=a;this.scheduleCallbacks_();
a!=goog.Promise.State_.REJECTED||b instanceof goog.Promise.CancellationError||goog.Promise.addUnhandledRejection_(this,b)}};goog.Promise.prototype.tryThen_=function(a,b){this.state_=goog.Promise.State_.BLOCKED;var c=this,d=!1,e=function(a){d||(d=!0,c.unblockAndFulfill_(a))},f=function(a){d||(d=!0,c.unblockAndReject_(a))};try{b.call(a,e,f)}catch(g){f(g)}};goog.Promise.prototype.scheduleCallbacks_=function(){this.executing_||(this.executing_=!0,goog.async.run(this.executeCallbacks_,this))};
goog.Promise.prototype.executeCallbacks_=function(){for(;this.callbackEntries_&&this.callbackEntries_.length;){var a=this.callbackEntries_;this.callbackEntries_=[];for(var b=0;b<a.length;b++)goog.Promise.LONG_STACK_TRACES&&this.currentStep_++,this.executeCallback_(a[b],this.state_,this.result_)}this.executing_=!1};goog.Promise.prototype.executeCallback_=function(a,b,c){if(b==goog.Promise.State_.FULFILLED)a.onFulfilled(c);else a.child&&this.removeUnhandledRejection_(),a.onRejected(c)};
goog.Promise.prototype.addStackTrace_=function(a){if(goog.Promise.LONG_STACK_TRACES&&goog.isString(a.stack)){var b=a.stack.split("\n",4)[3];a=a.message;a+=Array(11-a.length).join(" ");this.stack_.push(a+b)}};
goog.Promise.prototype.appendLongStack_=function(a){if(goog.Promise.LONG_STACK_TRACES&&a&&goog.isString(a.stack)&&this.stack_.length){for(var b=["Promise trace:"],c=this;c;c=c.parent_){for(var d=this.currentStep_;0<=d;d--)b.push(c.stack_[d]);b.push("Value: ["+(c.state_==goog.Promise.State_.REJECTED?"REJECTED":"FULFILLED")+"] <"+String(c.result_)+">")}a.stack+="\n\n"+b.join("\n")}};
goog.Promise.prototype.removeUnhandledRejection_=function(){if(0<goog.Promise.UNHANDLED_REJECTION_DELAY)for(var a=this;a&&a.unhandledRejectionId_;a=a.parent_)goog.global.clearTimeout(a.unhandledRejectionId_),a.unhandledRejectionId_=0;else if(0==goog.Promise.UNHANDLED_REJECTION_DELAY)for(a=this;a&&a.hadUnhandledRejection_;a=a.parent_)a.hadUnhandledRejection_=!1};
goog.Promise.addUnhandledRejection_=function(a,b){0<goog.Promise.UNHANDLED_REJECTION_DELAY?a.unhandledRejectionId_=goog.global.setTimeout(function(){a.appendLongStack_(b);goog.Promise.handleRejection_.call(null,b)},goog.Promise.UNHANDLED_REJECTION_DELAY):0==goog.Promise.UNHANDLED_REJECTION_DELAY&&(a.hadUnhandledRejection_=!0,goog.async.run(function(){a.hadUnhandledRejection_&&(a.appendLongStack_(b),goog.Promise.handleRejection_.call(null,b))}))};goog.Promise.handleRejection_=goog.async.throwException;
goog.Promise.setUnhandledRejectionHandler=function(a){goog.Promise.handleRejection_=a};goog.Promise.CancellationError=function(a){goog.Promise.CancellationError.base(this,"constructor",a)};goog.inherits(goog.Promise.CancellationError,goog.debug.Error);goog.Promise.CancellationError.prototype.name="cancel";goog.Promise.Resolver_=function(a,b,c){this.promise=a;this.resolve=b;this.reject=c};
goog.async.Deferred=function(a,b){this.sequence_=[];this.onCancelFunction_=a;this.defaultScope_=b||null;this.hadError_=this.fired_=!1;this.result_=void 0;this.silentlyCanceled_=this.blocking_=this.blocked_=!1;this.unhandledErrorId_=0;this.parent_=null;this.branches_=0;if(goog.async.Deferred.LONG_STACK_TRACES&&(this.constructorStack_=null,Error.captureStackTrace)){var c={stack:""};Error.captureStackTrace(c,goog.async.Deferred);"string"==typeof c.stack&&(this.constructorStack_=c.stack.replace(/^[^\n]*\n/,
""))}};goog.async.Deferred.STRICT_ERRORS=!1;goog.async.Deferred.LONG_STACK_TRACES=!1;goog.async.Deferred.prototype.cancel=function(a){if(this.hasFired())this.result_ instanceof goog.async.Deferred&&this.result_.cancel();else{if(this.parent_){var b=this.parent_;delete this.parent_;a?b.cancel(a):b.branchCancel_()}this.onCancelFunction_?this.onCancelFunction_.call(this.defaultScope_,this):this.silentlyCanceled_=!0;this.hasFired()||this.errback(new goog.async.Deferred.CanceledError(this))}};
goog.async.Deferred.prototype.branchCancel_=function(){this.branches_--;0>=this.branches_&&this.cancel()};goog.async.Deferred.prototype.continue_=function(a,b){this.blocked_=!1;this.updateResult_(a,b)};goog.async.Deferred.prototype.updateResult_=function(a,b){this.fired_=!0;this.result_=b;this.hadError_=!a;this.fire_()};goog.async.Deferred.prototype.check_=function(){if(this.hasFired()){if(!this.silentlyCanceled_)throw new goog.async.Deferred.AlreadyCalledError(this);this.silentlyCanceled_=!1}};
goog.async.Deferred.prototype.callback=function(a){this.check_();this.assertNotDeferred_(a);this.updateResult_(!0,a)};goog.async.Deferred.prototype.errback=function(a){this.check_();this.assertNotDeferred_(a);this.makeStackTraceLong_(a);this.updateResult_(!1,a)};goog.async.Deferred.prototype.makeStackTraceLong_=function(a){goog.async.Deferred.LONG_STACK_TRACES&&(this.constructorStack_&&goog.isObject(a)&&a.stack&&/^[^\n]+(\n   [^\n]+)+/.test(a.stack))&&(a.stack=a.stack+"\nDEFERRED OPERATION:\n"+this.constructorStack_)};
goog.async.Deferred.prototype.assertNotDeferred_=function(a){goog.asserts.assert(!(a instanceof goog.async.Deferred),"An execution sequence may not be initiated with a blocking Deferred.")};goog.async.Deferred.prototype.addCallback=function(a,b){return this.addCallbacks(a,null,b)};goog.async.Deferred.prototype.addErrback=function(a,b){return this.addCallbacks(null,a,b)};goog.async.Deferred.prototype.addBoth=function(a,b){return this.addCallbacks(a,a,b)};
goog.async.Deferred.prototype.addCallbacks=function(a,b,c){goog.asserts.assert(!this.blocking_,"Blocking Deferreds can not be re-used");this.sequence_.push([a,b,c]);this.hasFired()&&this.fire_();return this};goog.async.Deferred.prototype.then=function(a,b,c){var d,e,f=new goog.Promise(function(a,b){d=a;e=b});this.addCallbacks(d,function(a){a instanceof goog.async.Deferred.CanceledError?f.cancel():e(a)});return f.then(a,b,c)};goog.Thenable.addImplementation(goog.async.Deferred);
goog.async.Deferred.prototype.chainDeferred=function(a){this.addCallbacks(a.callback,a.errback,a);return this};goog.async.Deferred.prototype.awaitDeferred=function(a){return a instanceof goog.async.Deferred?this.addCallback(goog.bind(a.branch,a)):this.addCallback(function(){return a})};goog.async.Deferred.prototype.branch=function(a){var b=new goog.async.Deferred;this.chainDeferred(b);a&&(b.parent_=this,this.branches_++);return b};goog.async.Deferred.prototype.hasFired=function(){return this.fired_};
goog.async.Deferred.prototype.isError=function(a){return a instanceof Error};goog.async.Deferred.prototype.hasErrback_=function(){return goog.array.some(this.sequence_,function(a){return goog.isFunction(a[1])})};
goog.async.Deferred.prototype.fire_=function(){this.unhandledErrorId_&&(this.hasFired()&&this.hasErrback_())&&(goog.async.Deferred.unscheduleError_(this.unhandledErrorId_),this.unhandledErrorId_=0);this.parent_&&(this.parent_.branches_--,delete this.parent_);for(var a=this.result_,b=!1,c=!1;this.sequence_.length&&!this.blocked_;){var d=this.sequence_.shift(),e=d[0],f=d[1],d=d[2];if(e=this.hadError_?f:e)try{var g=e.call(d||this.defaultScope_,a);goog.isDef(g)&&(this.hadError_=this.hadError_&&(g==a||
this.isError(g)),this.result_=a=g);goog.Thenable.isImplementedBy(a)&&(this.blocked_=c=!0)}catch(h){a=h,this.hadError_=!0,this.makeStackTraceLong_(a),this.hasErrback_()||(b=!0)}}this.result_=a;c?(c=goog.bind(this.continue_,this,!0),g=goog.bind(this.continue_,this,!1),a instanceof goog.async.Deferred?(a.addCallbacks(c,g),a.blocking_=!0):a.then(c,g)):!goog.async.Deferred.STRICT_ERRORS||(!this.isError(a)||a instanceof goog.async.Deferred.CanceledError)||(b=this.hadError_=!0);b&&(this.unhandledErrorId_=
goog.async.Deferred.scheduleError_(a))};goog.async.Deferred.succeed=function(a){var b=new goog.async.Deferred;b.callback(a);return b};goog.async.Deferred.fromPromise=function(a){var b=new goog.async.Deferred;b.callback();b.addCallback(function(){return a});return b};goog.async.Deferred.fail=function(a){var b=new goog.async.Deferred;b.errback(a);return b};goog.async.Deferred.canceled=function(){var a=new goog.async.Deferred;a.cancel();return a};
goog.async.Deferred.when=function(a,b,c){return a instanceof goog.async.Deferred?a.branch(!0).addCallback(b,c):goog.async.Deferred.succeed(a).addCallback(b,c)};goog.async.Deferred.AlreadyCalledError=function(a){goog.debug.Error.call(this);this.deferred=a};goog.inherits(goog.async.Deferred.AlreadyCalledError,goog.debug.Error);goog.async.Deferred.AlreadyCalledError.prototype.message="Deferred has already fired";goog.async.Deferred.AlreadyCalledError.prototype.name="AlreadyCalledError";
goog.async.Deferred.CanceledError=function(a){goog.debug.Error.call(this);this.deferred=a};goog.inherits(goog.async.Deferred.CanceledError,goog.debug.Error);goog.async.Deferred.CanceledError.prototype.message="Deferred was canceled";goog.async.Deferred.CanceledError.prototype.name="CanceledError";goog.async.Deferred.Error_=function(a){this.id_=goog.global.setTimeout(goog.bind(this.throwError,this),0);this.error_=a};
goog.async.Deferred.Error_.prototype.throwError=function(){goog.asserts.assert(goog.async.Deferred.errorMap_[this.id_],"Cannot throw an error that is not scheduled.");delete goog.async.Deferred.errorMap_[this.id_];throw this.error_;};goog.async.Deferred.Error_.prototype.resetTimer=function(){goog.global.clearTimeout(this.id_)};goog.async.Deferred.errorMap_={};goog.async.Deferred.scheduleError_=function(a){a=new goog.async.Deferred.Error_(a);goog.async.Deferred.errorMap_[a.id_]=a;return a.id_};
goog.async.Deferred.unscheduleError_=function(a){var b=goog.async.Deferred.errorMap_[a];b&&(b.resetTimer(),delete goog.async.Deferred.errorMap_[a])};goog.async.Deferred.assertNoErrors=function(){var a=goog.async.Deferred.errorMap_,b;for(b in a){var c=a[b];c.resetTimer();c.throwError()}};var ydn={debug:{}};ydn.debug.error={};ydn.debug.error.ArgumentException=function(a){goog.debug.Error.call(this,a);this.name="ydn.error.ArgumentException"};goog.inherits(ydn.debug.error.ArgumentException,goog.debug.Error);
ydn.debug.error.TypeError=function(a){goog.debug.Error.call(this,a);this.name="ydn.error.TypeError"};goog.inherits(ydn.debug.error.TypeError,goog.debug.Error);ydn.debug.error.NotSupportedException=function(a){goog.debug.Error.call(this,a);this.name="ydn.error.NotSupportedException"};goog.inherits(ydn.debug.error.NotSupportedException,goog.debug.Error);ydn.debug.error.NotImplementedException=function(a){goog.debug.Error.call(this,a);this.name="ydn.error.NotImplementedException"};
goog.inherits(ydn.debug.error.NotImplementedException,goog.debug.Error);ydn.debug.error.InvalidOperationException=function(a){goog.debug.Error.call(this,a);this.name="ydn.error.InvalidOperationException"};goog.inherits(ydn.debug.error.InvalidOperationException,goog.debug.Error);ydn.debug.error.InternalError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.debug.error.InternalError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InternalError"};
goog.inherits(ydn.debug.error.InternalError,Error);ydn.debug.error.InternalError.prototype.name="ydn.error.InternalError";ydn.debug.error.ConstraintError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.debug.error.ConstraintError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.ConstraintError"};goog.inherits(ydn.debug.error.ConstraintError,Error);ydn.debug.error.ConstraintError.prototype.name="ydn.error.ConstraintError";goog.structs={};
goog.structs.getCount=function(a){return"function"==typeof a.getCount?a.getCount():goog.isArrayLike(a)||goog.isString(a)?a.length:goog.object.getCount(a)};goog.structs.getValues=function(a){if("function"==typeof a.getValues)return a.getValues();if(goog.isString(a))return a.split("");if(goog.isArrayLike(a)){for(var b=[],c=a.length,d=0;d<c;d++)b.push(a[d]);return b}return goog.object.getValues(a)};
goog.structs.getKeys=function(a){if("function"==typeof a.getKeys)return a.getKeys();if("function"!=typeof a.getValues){if(goog.isArrayLike(a)||goog.isString(a)){var b=[];a=a.length;for(var c=0;c<a;c++)b.push(c);return b}return goog.object.getKeys(a)}};goog.structs.contains=function(a,b){return"function"==typeof a.contains?a.contains(b):"function"==typeof a.containsValue?a.containsValue(b):goog.isArrayLike(a)||goog.isString(a)?goog.array.contains(a,b):goog.object.containsValue(a,b)};
goog.structs.isEmpty=function(a){return"function"==typeof a.isEmpty?a.isEmpty():goog.isArrayLike(a)||goog.isString(a)?goog.array.isEmpty(a):goog.object.isEmpty(a)};goog.structs.clear=function(a){"function"==typeof a.clear?a.clear():goog.isArrayLike(a)?goog.array.clear(a):goog.object.clear(a)};
goog.structs.forEach=function(a,b,c){if("function"==typeof a.forEach)a.forEach(b,c);else if(goog.isArrayLike(a)||goog.isString(a))goog.array.forEach(a,b,c);else for(var d=goog.structs.getKeys(a),e=goog.structs.getValues(a),f=e.length,g=0;g<f;g++)b.call(c,e[g],d&&d[g],a)};
goog.structs.filter=function(a,b,c){if("function"==typeof a.filter)return a.filter(b,c);if(goog.isArrayLike(a)||goog.isString(a))return goog.array.filter(a,b,c);var d,e=goog.structs.getKeys(a),f=goog.structs.getValues(a),g=f.length;if(e){d={};for(var h=0;h<g;h++)b.call(c,f[h],e[h],a)&&(d[e[h]]=f[h])}else for(d=[],h=0;h<g;h++)b.call(c,f[h],void 0,a)&&d.push(f[h]);return d};
goog.structs.map=function(a,b,c){if("function"==typeof a.map)return a.map(b,c);if(goog.isArrayLike(a)||goog.isString(a))return goog.array.map(a,b,c);var d,e=goog.structs.getKeys(a),f=goog.structs.getValues(a),g=f.length;if(e){d={};for(var h=0;h<g;h++)d[e[h]]=b.call(c,f[h],e[h],a)}else for(d=[],h=0;h<g;h++)d[h]=b.call(c,f[h],void 0,a);return d};
goog.structs.some=function(a,b,c){if("function"==typeof a.some)return a.some(b,c);if(goog.isArrayLike(a)||goog.isString(a))return goog.array.some(a,b,c);for(var d=goog.structs.getKeys(a),e=goog.structs.getValues(a),f=e.length,g=0;g<f;g++)if(b.call(c,e[g],d&&d[g],a))return!0;return!1};
goog.structs.every=function(a,b,c){if("function"==typeof a.every)return a.every(b,c);if(goog.isArrayLike(a)||goog.isString(a))return goog.array.every(a,b,c);for(var d=goog.structs.getKeys(a),e=goog.structs.getValues(a),f=e.length,g=0;g<f;g++)if(!b.call(c,e[g],d&&d[g],a))return!1;return!0};goog.structs.Collection=function(){};goog.math={};goog.math.randomInt=function(a){return Math.floor(Math.random()*a)};goog.math.uniformRandom=function(a,b){return a+Math.random()*(b-a)};
goog.math.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};goog.math.modulo=function(a,b){var c=a%b;return 0>c*b?c+b:c};goog.math.lerp=function(a,b,c){return a+c*(b-a)};goog.math.nearlyEquals=function(a,b,c){return Math.abs(a-b)<=(c||1E-6)};goog.math.standardAngle=function(a){return goog.math.modulo(a,360)};goog.math.standardAngleInRadians=function(a){return goog.math.modulo(a,2*Math.PI)};goog.math.toRadians=function(a){return a*Math.PI/180};goog.math.toDegrees=function(a){return 180*a/Math.PI};
goog.math.angleDx=function(a,b){return b*Math.cos(goog.math.toRadians(a))};goog.math.angleDy=function(a,b){return b*Math.sin(goog.math.toRadians(a))};goog.math.angle=function(a,b,c,d){return goog.math.standardAngle(goog.math.toDegrees(Math.atan2(d-b,c-a)))};goog.math.angleDifference=function(a,b){var c=goog.math.standardAngle(b)-goog.math.standardAngle(a);180<c?c-=360:-180>=c&&(c=360+c);return c};goog.math.sign=function(a){return 0==a?0:0>a?-1:1};
goog.math.longestCommonSubsequence=function(a,b,c,d){c=c||function(a,b){return a==b};d=d||function(b,c){return a[b]};for(var e=a.length,f=b.length,g=[],h=0;h<e+1;h++)g[h]=[],g[h][0]=0;for(var k=0;k<f+1;k++)g[0][k]=0;for(h=1;h<=e;h++)for(k=1;k<=f;k++)c(a[h-1],b[k-1])?g[h][k]=g[h-1][k-1]+1:g[h][k]=Math.max(g[h-1][k],g[h][k-1]);for(var l=[],h=e,k=f;0<h&&0<k;)c(a[h-1],b[k-1])?(l.unshift(d(h-1,k-1)),h--,k--):g[h-1][k]>g[h][k-1]?h--:k--;return l};
goog.math.sum=function(a){return goog.array.reduce(arguments,function(a,c){return a+c},0)};goog.math.average=function(a){return goog.math.sum.apply(null,arguments)/arguments.length};goog.math.sampleVariance=function(a){var b=arguments.length;if(2>b)return 0;var c=goog.math.average.apply(null,arguments);return goog.math.sum.apply(null,goog.array.map(arguments,function(a){return Math.pow(a-c,2)}))/(b-1)};goog.math.standardDeviation=function(a){return Math.sqrt(goog.math.sampleVariance.apply(null,arguments))};
goog.math.isInt=function(a){return isFinite(a)&&0==a%1};goog.math.isFiniteNumber=function(a){return isFinite(a)&&!isNaN(a)};goog.math.log10Floor=function(a){if(0<a){var b=Math.round(Math.log(a)*Math.LOG10E);return b-(parseFloat("1e"+b)>a)}return 0==a?-Infinity:NaN};goog.math.safeFloor=function(a,b){goog.asserts.assert(!goog.isDef(b)||0<b);return Math.floor(a+(b||2E-15))};goog.math.safeCeil=function(a,b){goog.asserts.assert(!goog.isDef(b)||0<b);return Math.ceil(a-(b||2E-15))};goog.iter={};
goog.iter.StopIteration="StopIteration"in goog.global?goog.global.StopIteration:Error("StopIteration");goog.iter.Iterator=function(){};goog.iter.Iterator.prototype.next=function(){throw goog.iter.StopIteration;};goog.iter.Iterator.prototype.__iterator__=function(a){return this};
goog.iter.toIterator=function(a){if(a instanceof goog.iter.Iterator)return a;if("function"==typeof a.__iterator__)return a.__iterator__(!1);if(goog.isArrayLike(a)){var b=0,c=new goog.iter.Iterator;c.next=function(){for(;;){if(b>=a.length)throw goog.iter.StopIteration;if(b in a)return a[b++];b++}};return c}throw Error("Not implemented");};
goog.iter.forEach=function(a,b,c){if(goog.isArrayLike(a))try{goog.array.forEach(a,b,c)}catch(d){if(d!==goog.iter.StopIteration)throw d;}else{a=goog.iter.toIterator(a);try{for(;;)b.call(c,a.next(),void 0,a)}catch(e){if(e!==goog.iter.StopIteration)throw e;}}};goog.iter.filter=function(a,b,c){var d=goog.iter.toIterator(a);a=new goog.iter.Iterator;a.next=function(){for(;;){var a=d.next();if(b.call(c,a,void 0,d))return a}};return a};
goog.iter.filterFalse=function(a,b,c){return goog.iter.filter(a,goog.functions.not(b),c)};goog.iter.range=function(a,b,c){var d=0,e=a,f=c||1;1<arguments.length&&(d=a,e=b);if(0==f)throw Error("Range step argument must not be zero");var g=new goog.iter.Iterator;g.next=function(){if(0<f&&d>=e||0>f&&d<=e)throw goog.iter.StopIteration;var a=d;d+=f;return a};return g};goog.iter.join=function(a,b){return goog.iter.toArray(a).join(b)};
goog.iter.map=function(a,b,c){var d=goog.iter.toIterator(a);a=new goog.iter.Iterator;a.next=function(){var a=d.next();return b.call(c,a,void 0,d)};return a};goog.iter.reduce=function(a,b,c,d){var e=c;goog.iter.forEach(a,function(a){e=b.call(d,e,a)});return e};goog.iter.some=function(a,b,c){a=goog.iter.toIterator(a);try{for(;;)if(b.call(c,a.next(),void 0,a))return!0}catch(d){if(d!==goog.iter.StopIteration)throw d;}return!1};
goog.iter.every=function(a,b,c){a=goog.iter.toIterator(a);try{for(;;)if(!b.call(c,a.next(),void 0,a))return!1}catch(d){if(d!==goog.iter.StopIteration)throw d;}return!0};goog.iter.chain=function(a){return goog.iter.chainFromIterable(arguments)};
goog.iter.chainFromIterable=function(a){var b=goog.iter.toIterator(a);a=new goog.iter.Iterator;var c=null;a.next=function(){for(;;){if(null==c){var a=b.next();c=goog.iter.toIterator(a)}try{return c.next()}catch(e){if(e!==goog.iter.StopIteration)throw e;c=null}}};return a};goog.iter.dropWhile=function(a,b,c){var d=goog.iter.toIterator(a);a=new goog.iter.Iterator;var e=!0;a.next=function(){for(;;){var a=d.next();if(!e||!b.call(c,a,void 0,d))return e=!1,a}};return a};
goog.iter.takeWhile=function(a,b,c){var d=goog.iter.toIterator(a);a=new goog.iter.Iterator;a.next=function(){var a=d.next();if(b.call(c,a,void 0,d))return a;throw goog.iter.StopIteration;};return a};goog.iter.toArray=function(a){if(goog.isArrayLike(a))return goog.array.toArray(a);a=goog.iter.toIterator(a);var b=[];goog.iter.forEach(a,function(a){b.push(a)});return b};
goog.iter.equals=function(a,b,c){a=goog.iter.zipLongest({},a,b);var d=c||goog.array.defaultCompareEquality;return goog.iter.every(a,function(a){return d(a[0],a[1])})};goog.iter.nextOrValue=function(a,b){try{return goog.iter.toIterator(a).next()}catch(c){if(c!=goog.iter.StopIteration)throw c;return b}};
goog.iter.product=function(a){if(goog.array.some(arguments,function(a){return!a.length})||!arguments.length)return new goog.iter.Iterator;var b=new goog.iter.Iterator,c=arguments,d=goog.array.repeat(0,c.length);b.next=function(){if(d){for(var a=goog.array.map(d,function(a,b){return c[b][a]}),b=d.length-1;0<=b;b--){goog.asserts.assert(d);if(d[b]<c[b].length-1){d[b]++;break}if(0==b){d=null;break}d[b]=0}return a}throw goog.iter.StopIteration;};return b};
goog.iter.cycle=function(a){var b=goog.iter.toIterator(a),c=[],d=0;a=new goog.iter.Iterator;var e=!1;a.next=function(){var a=null;if(!e)try{return a=b.next(),c.push(a),a}catch(g){if(g!=goog.iter.StopIteration||goog.array.isEmpty(c))throw g;e=!0}a=c[d];d=(d+1)%c.length;return a};return a};goog.iter.count=function(a,b){var c=a||0,d=goog.isDef(b)?b:1,e=new goog.iter.Iterator;e.next=function(){var a=c;c+=d;return a};return e};
goog.iter.repeat=function(a){var b=new goog.iter.Iterator;b.next=goog.functions.constant(a);return b};goog.iter.accumulate=function(a){var b=goog.iter.toIterator(a),c=0;a=new goog.iter.Iterator;a.next=function(){return c+=b.next()};return a};goog.iter.zip=function(a){var b=arguments,c=new goog.iter.Iterator;if(0<b.length){var d=goog.array.map(b,goog.iter.toIterator);c.next=function(){return goog.array.map(d,function(a){return a.next()})}}return c};
goog.iter.zipLongest=function(a,b){var c=goog.array.slice(arguments,1),d=new goog.iter.Iterator;if(0<c.length){var e=goog.array.map(c,goog.iter.toIterator);d.next=function(){var b=!1,c=goog.array.map(e,function(c){var d;try{d=c.next(),b=!0}catch(e){if(e!==goog.iter.StopIteration)throw e;d=a}return d});if(!b)throw goog.iter.StopIteration;return c}}return d};goog.iter.compress=function(a,b){var c=goog.iter.toIterator(b);return goog.iter.filter(a,function(){return!!c.next()})};
goog.iter.GroupByIterator_=function(a,b){this.iterator=goog.iter.toIterator(a);this.keyFunc=b||goog.functions.identity};goog.inherits(goog.iter.GroupByIterator_,goog.iter.Iterator);goog.iter.GroupByIterator_.prototype.next=function(){for(;this.currentKey==this.targetKey;)this.currentValue=this.iterator.next(),this.currentKey=this.keyFunc(this.currentValue);this.targetKey=this.currentKey;return[this.currentKey,this.groupItems_(this.targetKey)]};
goog.iter.GroupByIterator_.prototype.groupItems_=function(a){for(var b=[];this.currentKey==a;){b.push(this.currentValue);try{this.currentValue=this.iterator.next()}catch(c){if(c!==goog.iter.StopIteration)throw c;break}this.currentKey=this.keyFunc(this.currentValue)}return b};goog.iter.groupBy=function(a,b){return new goog.iter.GroupByIterator_(a,b)};
goog.iter.starMap=function(a,b,c){var d=goog.iter.toIterator(a);a=new goog.iter.Iterator;a.next=function(){var a=goog.iter.toArray(d.next());return b.apply(c,goog.array.concat(a,void 0,d))};return a};
goog.iter.tee=function(a,b){var c=goog.iter.toIterator(a),d=goog.isNumber(b)?b:2,e=goog.array.map(goog.array.range(d),function(){return[]}),f=function(){var a=c.next();goog.array.forEach(e,function(b){b.push(a)})};return goog.array.map(e,function(a){var b=new goog.iter.Iterator;b.next=function(){goog.array.isEmpty(a)&&f();goog.asserts.assert(!goog.array.isEmpty(a));return a.shift()};return b})};goog.iter.enumerate=function(a,b){return goog.iter.zip(goog.iter.count(b),a)};
goog.iter.limit=function(a,b){goog.asserts.assert(goog.math.isInt(b)&&0<=b);var c=goog.iter.toIterator(a),d=new goog.iter.Iterator,e=b;d.next=function(){if(0<e--)return c.next();throw goog.iter.StopIteration;};return d};goog.iter.consume=function(a,b){goog.asserts.assert(goog.math.isInt(b)&&0<=b);for(var c=goog.iter.toIterator(a);0<b--;)goog.iter.nextOrValue(c,null);return c};
goog.iter.slice=function(a,b,c){goog.asserts.assert(goog.math.isInt(b)&&0<=b);a=goog.iter.consume(a,b);goog.isNumber(c)&&(goog.asserts.assert(goog.math.isInt(c)&&c>=b),a=goog.iter.limit(a,c-b));return a};goog.iter.hasDuplicates_=function(a){var b=[];goog.array.removeDuplicates(a,b);return a.length!=b.length};goog.iter.permutations=function(a,b){var c=goog.iter.toArray(a),d=goog.isNumber(b)?b:c.length,c=goog.array.repeat(c,d),c=goog.iter.product.apply(void 0,c);return goog.iter.filter(c,function(a){return!goog.iter.hasDuplicates_(a)})};
goog.iter.combinations=function(a,b){function c(a){return d[a]}var d=goog.iter.toArray(a),e=goog.iter.range(d.length),e=goog.iter.permutations(e,b),f=goog.iter.filter(e,function(a){return goog.array.isSorted(a)}),e=new goog.iter.Iterator;e.next=function(){return goog.array.map(f.next(),c)};return e};
goog.iter.combinationsWithReplacement=function(a,b){function c(a){return d[a]}var d=goog.iter.toArray(a),e=goog.array.range(d.length),e=goog.array.repeat(e,b),e=goog.iter.product.apply(void 0,e),f=goog.iter.filter(e,function(a){return goog.array.isSorted(a)}),e=new goog.iter.Iterator;e.next=function(){return goog.array.map(f.next(),c)};return e};
goog.structs.Map=function(a,b){this.map_={};this.keys_=[];this.version_=this.count_=0;var c=arguments.length;if(1<c){if(c%2)throw Error("Uneven number of arguments");for(var d=0;d<c;d+=2)this.set(arguments[d],arguments[d+1])}else a&&this.addAll(a)};goog.structs.Map.prototype.getCount=function(){return this.count_};goog.structs.Map.prototype.getValues=function(){this.cleanupKeysArray_();for(var a=[],b=0;b<this.keys_.length;b++)a.push(this.map_[this.keys_[b]]);return a};
goog.structs.Map.prototype.getKeys=function(){this.cleanupKeysArray_();return this.keys_.concat()};goog.structs.Map.prototype.containsKey=function(a){return goog.structs.Map.hasKey_(this.map_,a)};goog.structs.Map.prototype.containsValue=function(a){for(var b=0;b<this.keys_.length;b++){var c=this.keys_[b];if(goog.structs.Map.hasKey_(this.map_,c)&&this.map_[c]==a)return!0}return!1};
goog.structs.Map.prototype.equals=function(a,b){if(this===a)return!0;if(this.count_!=a.getCount())return!1;var c=b||goog.structs.Map.defaultEquals;this.cleanupKeysArray_();for(var d,e=0;d=this.keys_[e];e++)if(!c(this.get(d),a.get(d)))return!1;return!0};goog.structs.Map.defaultEquals=function(a,b){return a===b};goog.structs.Map.prototype.isEmpty=function(){return 0==this.count_};goog.structs.Map.prototype.clear=function(){this.map_={};this.version_=this.count_=this.keys_.length=0};
goog.structs.Map.prototype.remove=function(a){return goog.structs.Map.hasKey_(this.map_,a)?(delete this.map_[a],this.count_--,this.version_++,this.keys_.length>2*this.count_&&this.cleanupKeysArray_(),!0):!1};
goog.structs.Map.prototype.cleanupKeysArray_=function(){if(this.count_!=this.keys_.length){for(var a=0,b=0;a<this.keys_.length;){var c=this.keys_[a];goog.structs.Map.hasKey_(this.map_,c)&&(this.keys_[b++]=c);a++}this.keys_.length=b}if(this.count_!=this.keys_.length){for(var d={},b=a=0;a<this.keys_.length;)c=this.keys_[a],goog.structs.Map.hasKey_(d,c)||(this.keys_[b++]=c,d[c]=1),a++;this.keys_.length=b}};
goog.structs.Map.prototype.get=function(a,b){return goog.structs.Map.hasKey_(this.map_,a)?this.map_[a]:b};goog.structs.Map.prototype.set=function(a,b){goog.structs.Map.hasKey_(this.map_,a)||(this.count_++,this.keys_.push(a),this.version_++);this.map_[a]=b};goog.structs.Map.prototype.addAll=function(a){var b;a instanceof goog.structs.Map?(b=a.getKeys(),a=a.getValues()):(b=goog.object.getKeys(a),a=goog.object.getValues(a));for(var c=0;c<b.length;c++)this.set(b[c],a[c])};
goog.structs.Map.prototype.forEach=function(a,b){for(var c=this.getKeys(),d=0;d<c.length;d++){var e=c[d],f=this.get(e);a.call(b,f,e,this)}};goog.structs.Map.prototype.clone=function(){return new goog.structs.Map(this)};goog.structs.Map.prototype.transpose=function(){for(var a=new goog.structs.Map,b=0;b<this.keys_.length;b++){var c=this.keys_[b];a.set(this.map_[c],c)}return a};
goog.structs.Map.prototype.toObject=function(){this.cleanupKeysArray_();for(var a={},b=0;b<this.keys_.length;b++){var c=this.keys_[b];a[c]=this.map_[c]}return a};goog.structs.Map.prototype.getKeyIterator=function(){return this.__iterator__(!0)};goog.structs.Map.prototype.getValueIterator=function(){return this.__iterator__(!1)};
goog.structs.Map.prototype.__iterator__=function(a){this.cleanupKeysArray_();var b=0,c=this.keys_,d=this.map_,e=this.version_,f=this,g=new goog.iter.Iterator;g.next=function(){for(;;){if(e!=f.version_)throw Error("The map has changed since the iterator was created");if(b>=c.length)throw goog.iter.StopIteration;var g=c[b++];return a?g:d[g]}};return g};goog.structs.Map.hasKey_=function(a,b){return Object.prototype.hasOwnProperty.call(a,b)};
goog.structs.Set=function(a){this.map_=new goog.structs.Map;a&&this.addAll(a)};goog.structs.Set.getKey_=function(a){var b=typeof a;return"object"==b&&a||"function"==b?"o"+goog.getUid(a):b.substr(0,1)+a};goog.structs.Set.prototype.getCount=function(){return this.map_.getCount()};goog.structs.Set.prototype.add=function(a){this.map_.set(goog.structs.Set.getKey_(a),a)};goog.structs.Set.prototype.addAll=function(a){a=goog.structs.getValues(a);for(var b=a.length,c=0;c<b;c++)this.add(a[c])};
goog.structs.Set.prototype.removeAll=function(a){a=goog.structs.getValues(a);for(var b=a.length,c=0;c<b;c++)this.remove(a[c])};goog.structs.Set.prototype.remove=function(a){return this.map_.remove(goog.structs.Set.getKey_(a))};goog.structs.Set.prototype.clear=function(){this.map_.clear()};goog.structs.Set.prototype.isEmpty=function(){return this.map_.isEmpty()};goog.structs.Set.prototype.contains=function(a){return this.map_.containsKey(goog.structs.Set.getKey_(a))};
goog.structs.Set.prototype.containsAll=function(a){return goog.structs.every(a,this.contains,this)};goog.structs.Set.prototype.intersection=function(a){var b=new goog.structs.Set;a=goog.structs.getValues(a);for(var c=0;c<a.length;c++){var d=a[c];this.contains(d)&&b.add(d)}return b};goog.structs.Set.prototype.difference=function(a){var b=this.clone();b.removeAll(a);return b};goog.structs.Set.prototype.getValues=function(){return this.map_.getValues()};goog.structs.Set.prototype.clone=function(){return new goog.structs.Set(this)};
goog.structs.Set.prototype.equals=function(a){return this.getCount()==goog.structs.getCount(a)&&this.isSubsetOf(a)};goog.structs.Set.prototype.isSubsetOf=function(a){var b=goog.structs.getCount(a);if(this.getCount()>b)return!1;!(a instanceof goog.structs.Set)&&5<b&&(a=new goog.structs.Set(a));return goog.structs.every(this,function(b){return goog.structs.contains(a,b)})};goog.structs.Set.prototype.__iterator__=function(a){return this.map_.__iterator__(!1)};goog.labs.userAgent.engine={};
goog.labs.userAgent.engine.isPresto=function(){return goog.labs.userAgent.util.matchUserAgent("Presto")};goog.labs.userAgent.engine.isTrident=function(){return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")};goog.labs.userAgent.engine.isWebKit=function(){return goog.labs.userAgent.util.matchUserAgentIgnoreCase("WebKit")};
goog.labs.userAgent.engine.isGecko=function(){return goog.labs.userAgent.util.matchUserAgent("Gecko")&&!goog.labs.userAgent.engine.isWebKit()&&!goog.labs.userAgent.engine.isTrident()};goog.labs.userAgent.engine.getVersion=function(){var a=goog.labs.userAgent.util.getUserAgent();if(a){var a=goog.labs.userAgent.util.extractVersionTuples(a),b=a[1];if(b)return"Gecko"==b[0]?goog.labs.userAgent.engine.getVersionForKey_(a,"Firefox"):b[1];var a=a[0],c;if(a&&(c=a[2])&&(c=/Trident\/([^\s;]+)/.exec(c)))return c[1]}return""};
goog.labs.userAgent.engine.isVersionOrHigher=function(a){return 0<=goog.string.compareVersions(goog.labs.userAgent.engine.getVersion(),a)};goog.labs.userAgent.engine.getVersionForKey_=function(a,b){var c=goog.array.find(a,function(a){return b==a[0]});return c&&c[1]||""};goog.labs.userAgent.platform={};goog.labs.userAgent.platform.isAndroid=function(){return goog.labs.userAgent.util.matchUserAgent("Android")};goog.labs.userAgent.platform.isIpod=function(){return goog.labs.userAgent.util.matchUserAgent("iPod")};
goog.labs.userAgent.platform.isIphone=function(){return goog.labs.userAgent.util.matchUserAgent("iPhone")&&!goog.labs.userAgent.util.matchUserAgent("iPod")&&!goog.labs.userAgent.util.matchUserAgent("iPad")};goog.labs.userAgent.platform.isIpad=function(){return goog.labs.userAgent.util.matchUserAgent("iPad")};goog.labs.userAgent.platform.isIos=function(){return goog.labs.userAgent.platform.isIphone()||goog.labs.userAgent.platform.isIpad()||goog.labs.userAgent.platform.isIpod()};
goog.labs.userAgent.platform.isMacintosh=function(){return goog.labs.userAgent.util.matchUserAgent("Macintosh")};goog.labs.userAgent.platform.isLinux=function(){return goog.labs.userAgent.util.matchUserAgent("Linux")};goog.labs.userAgent.platform.isWindows=function(){return goog.labs.userAgent.util.matchUserAgent("Windows")};goog.labs.userAgent.platform.isChromeOS=function(){return goog.labs.userAgent.util.matchUserAgent("CrOS")};
goog.labs.userAgent.platform.getVersion=function(){var a=goog.labs.userAgent.util.getUserAgent(),b="";goog.labs.userAgent.platform.isWindows()?(b=/Windows (?:NT|Phone) ([0-9.]+)/,b=(a=b.exec(a))?a[1]:"0.0"):goog.labs.userAgent.platform.isIos()?(b=/(?:iPhone|iPod|iPad|CPU)\s+OS\s+(\S+)/,b=(a=b.exec(a))&&a[1].replace(/_/g,".")):goog.labs.userAgent.platform.isMacintosh()?(b=/Mac OS X ([0-9_.]+)/,b=(a=b.exec(a))?a[1].replace(/_/g,"."):"10"):goog.labs.userAgent.platform.isAndroid()?(b=/Android\s+([^\);]+)(\)|;)/,
b=(a=b.exec(a))&&a[1]):goog.labs.userAgent.platform.isChromeOS()&&(b=/(?:CrOS\s+(?:i686|x86_64)\s+([0-9.]+))/,b=(a=b.exec(a))&&a[1]);return b||""};goog.labs.userAgent.platform.isVersionOrHigher=function(a){return 0<=goog.string.compareVersions(goog.labs.userAgent.platform.getVersion(),a)};goog.userAgent={};goog.userAgent.ASSUME_IE=!1;goog.userAgent.ASSUME_GECKO=!1;goog.userAgent.ASSUME_WEBKIT=!1;goog.userAgent.ASSUME_MOBILE_WEBKIT=!1;goog.userAgent.ASSUME_OPERA=!1;
goog.userAgent.ASSUME_ANY_VERSION=!1;goog.userAgent.BROWSER_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_GECKO||goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_OPERA;goog.userAgent.getUserAgentString=function(){return goog.labs.userAgent.util.getUserAgent()};goog.userAgent.getNavigator=function(){return goog.global.navigator||null};goog.userAgent.OPERA=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_OPERA:goog.labs.userAgent.browser.isOpera();
goog.userAgent.IE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_IE:goog.labs.userAgent.browser.isIE();goog.userAgent.GECKO=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_GECKO:goog.labs.userAgent.engine.isGecko();goog.userAgent.WEBKIT=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_MOBILE_WEBKIT:goog.labs.userAgent.engine.isWebKit();goog.userAgent.isMobile_=function(){return goog.userAgent.WEBKIT&&goog.labs.userAgent.util.matchUserAgent("Mobile")};
goog.userAgent.MOBILE=goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.isMobile_();goog.userAgent.SAFARI=goog.userAgent.WEBKIT;goog.userAgent.determinePlatform_=function(){var a=goog.userAgent.getNavigator();return a&&a.platform||""};goog.userAgent.PLATFORM=goog.userAgent.determinePlatform_();goog.userAgent.ASSUME_MAC=!1;goog.userAgent.ASSUME_WINDOWS=!1;goog.userAgent.ASSUME_LINUX=!1;goog.userAgent.ASSUME_X11=!1;goog.userAgent.ASSUME_ANDROID=!1;goog.userAgent.ASSUME_IPHONE=!1;
goog.userAgent.ASSUME_IPAD=!1;goog.userAgent.PLATFORM_KNOWN_=goog.userAgent.ASSUME_MAC||goog.userAgent.ASSUME_WINDOWS||goog.userAgent.ASSUME_LINUX||goog.userAgent.ASSUME_X11||goog.userAgent.ASSUME_ANDROID||goog.userAgent.ASSUME_IPHONE||goog.userAgent.ASSUME_IPAD;goog.userAgent.MAC=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_MAC:goog.labs.userAgent.platform.isMacintosh();goog.userAgent.WINDOWS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_WINDOWS:goog.labs.userAgent.platform.isWindows();
goog.userAgent.LINUX=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_LINUX:goog.labs.userAgent.platform.isLinux();goog.userAgent.isX11_=function(){var a=goog.userAgent.getNavigator();return!!a&&goog.string.contains(a.appVersion||"","X11")};goog.userAgent.X11=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_X11:goog.userAgent.isX11_();goog.userAgent.ANDROID=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_ANDROID:goog.labs.userAgent.platform.isAndroid();
goog.userAgent.IPHONE=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPHONE:goog.labs.userAgent.platform.isIphone();goog.userAgent.IPAD=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPAD:goog.labs.userAgent.platform.isIpad();
goog.userAgent.determineVersion_=function(){var a="",b;if(goog.userAgent.OPERA&&goog.global.opera)return a=goog.global.opera.version,goog.isFunction(a)?a():a;goog.userAgent.GECKO?b=/rv\:([^\);]+)(\)|;)/:goog.userAgent.IE?b=/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/:goog.userAgent.WEBKIT&&(b=/WebKit\/(\S+)/);b&&(a=(a=b.exec(goog.userAgent.getUserAgentString()))?a[1]:"");return goog.userAgent.IE&&(b=goog.userAgent.getDocumentMode_(),b>parseFloat(a))?String(b):a};
goog.userAgent.getDocumentMode_=function(){var a=goog.global.document;return a?a.documentMode:void 0};goog.userAgent.VERSION=goog.userAgent.determineVersion_();goog.userAgent.compare=function(a,b){return goog.string.compareVersions(a,b)};goog.userAgent.isVersionOrHigherCache_={};
goog.userAgent.isVersionOrHigher=function(a){return goog.userAgent.ASSUME_ANY_VERSION||goog.userAgent.isVersionOrHigherCache_[a]||(goog.userAgent.isVersionOrHigherCache_[a]=0<=goog.string.compareVersions(goog.userAgent.VERSION,a))};goog.userAgent.isVersion=goog.userAgent.isVersionOrHigher;goog.userAgent.isDocumentModeOrHigher=function(a){return goog.userAgent.IE&&goog.userAgent.DOCUMENT_MODE>=a};goog.userAgent.isDocumentMode=goog.userAgent.isDocumentModeOrHigher;
goog.userAgent.DOCUMENT_MODE=function(){var a=goog.global.document;return a&&goog.userAgent.IE?goog.userAgent.getDocumentMode_()||("CSS1Compat"==a.compatMode?parseInt(goog.userAgent.VERSION,10):5):void 0}();goog.debug.LOGGING_ENABLED=goog.DEBUG;goog.debug.catchErrors=function(a,b,c){c=c||goog.global;var d=c.onerror,e=!!b;goog.userAgent.WEBKIT&&!goog.userAgent.isVersionOrHigher("535.3")&&(e=!e);c.onerror=function(b,c,h,k,l){d&&d(b,c,h,k,l);a({message:b,fileName:c,line:h,col:k,error:l});return e}};
goog.debug.expose=function(a,b){if("undefined"==typeof a)return"undefined";if(null==a)return"NULL";var c=[],d;for(d in a)if(b||!goog.isFunction(a[d])){var e=d+" = ";try{e+=a[d]}catch(f){e+="*** "+f+" ***"}c.push(e)}return c.join("\n")};
goog.debug.deepExpose=function(a,b){var c=[],d=function(a,f,g){var h=f+"  ";g=new goog.structs.Set(g);try{if(goog.isDef(a))if(goog.isNull(a))c.push("NULL");else if(goog.isString(a))c.push('"'+a.replace(/\n/g,"\n"+f)+'"');else if(goog.isFunction(a))c.push(String(a).replace(/\n/g,"\n"+f));else if(goog.isObject(a))if(g.contains(a))c.push("*** reference loop detected ***");else{g.add(a);c.push("{");for(var k in a)if(b||!goog.isFunction(a[k]))c.push("\n"),c.push(h),c.push(k+" = "),d(a[k],h,g);c.push("\n"+
f+"}")}else c.push(a);else c.push("undefined")}catch(l){c.push("*** "+l+" ***")}};d(a,"",new goog.structs.Set);return c.join("")};goog.debug.exposeArray=function(a){for(var b=[],c=0;c<a.length;c++)goog.isArray(a[c])?b.push(goog.debug.exposeArray(a[c])):b.push(a[c]);return"[ "+b.join(", ")+" ]"};
goog.debug.exposeException=function(a,b){try{var c=goog.debug.normalizeErrorObject(a);return"Message: "+goog.string.htmlEscape(c.message)+'\nUrl: <a href="view-source:'+c.fileName+'" target="_new">'+c.fileName+"</a>\nLine: "+c.lineNumber+"\n\nBrowser stack:\n"+goog.string.htmlEscape(c.stack+"-> ")+"[end]\n\nJS stack traversal:\n"+goog.string.htmlEscape(goog.debug.getStacktrace(b)+"-> ")}catch(d){return"Exception trying to expose exception! You win, we lose. "+d}};
goog.debug.normalizeErrorObject=function(a){var b=goog.getObjectByName("window.location.href");if(goog.isString(a))return{message:a,name:"Unknown error",lineNumber:"Not available",fileName:b,stack:"Not available"};var c,d,e=!1;try{c=a.lineNumber||a.line||"Not available"}catch(f){c="Not available",e=!0}try{d=a.fileName||a.filename||a.sourceURL||goog.global.$googDebugFname||b}catch(g){d="Not available",e=!0}return!e&&a.lineNumber&&a.fileName&&a.stack&&a.message&&a.name?a:{message:a.message||"Not available",
name:a.name||"UnknownError",lineNumber:c,fileName:d,stack:a.stack||"Not available"}};goog.debug.enhanceError=function(a,b){var c;"string"==typeof a?(c=Error(a),Error.captureStackTrace&&Error.captureStackTrace(c,goog.debug.enhanceError)):c=a;c.stack||(c.stack=goog.debug.getStacktrace(goog.debug.enhanceError));if(b){for(var d=0;c["message"+d];)++d;c["message"+d]=String(b)}return c};
goog.debug.getStacktraceSimple=function(a){if(goog.STRICT_MODE_COMPATIBLE){var b=goog.debug.getNativeStackTrace_(goog.debug.getStacktraceSimple);if(b)return b}for(var b=[],c=arguments.callee.caller,d=0;c&&(!a||d<a);){b.push(goog.debug.getFunctionName(c));b.push("()\n");try{c=c.caller}catch(e){b.push("[exception trying to get caller]\n");break}d++;if(d>=goog.debug.MAX_STACK_DEPTH){b.push("[...long stack...]");break}}a&&d>=a?b.push("[...reached max depth limit...]"):b.push("[end]");return b.join("")};
goog.debug.MAX_STACK_DEPTH=50;goog.debug.getNativeStackTrace_=function(a){var b=Error();if(Error.captureStackTrace)return Error.captureStackTrace(b,a),String(b.stack);try{throw b;}catch(c){b=c}return(a=b.stack)?String(a):null};goog.debug.getStacktrace=function(a){var b;goog.STRICT_MODE_COMPATIBLE&&(b=goog.debug.getNativeStackTrace_(a||goog.debug.getStacktrace));b||(b=goog.debug.getStacktraceHelper_(a||arguments.callee.caller,[]));return b};
goog.debug.getStacktraceHelper_=function(a,b){var c=[];if(goog.array.contains(b,a))c.push("[...circular reference...]");else if(a&&b.length<goog.debug.MAX_STACK_DEPTH){c.push(goog.debug.getFunctionName(a)+"(");for(var d=a.arguments,e=0;d&&e<d.length;e++){0<e&&c.push(", ");var f;f=d[e];switch(typeof f){case "object":f=f?"object":"null";break;case "string":break;case "number":f=String(f);break;case "boolean":f=f?"true":"false";break;case "function":f=(f=goog.debug.getFunctionName(f))?f:"[fn]";break;
default:f=typeof f}40<f.length&&(f=f.substr(0,40)+"...");c.push(f)}b.push(a);c.push(")\n");try{c.push(goog.debug.getStacktraceHelper_(a.caller,b))}catch(g){c.push("[exception trying to get caller]\n")}}else a?c.push("[...long stack...]"):c.push("[end]");return c.join("")};goog.debug.setFunctionResolver=function(a){goog.debug.fnNameResolver_=a};
goog.debug.getFunctionName=function(a){if(goog.debug.fnNameCache_[a])return goog.debug.fnNameCache_[a];if(goog.debug.fnNameResolver_){var b=goog.debug.fnNameResolver_(a);if(b)return goog.debug.fnNameCache_[a]=b}a=String(a);goog.debug.fnNameCache_[a]||(b=/function ([^\(]+)/.exec(a),goog.debug.fnNameCache_[a]=b?b[1]:"[Anonymous]");return goog.debug.fnNameCache_[a]};
goog.debug.makeWhitespaceVisible=function(a){return a.replace(/ /g,"[_]").replace(/\f/g,"[f]").replace(/\n/g,"[n]\n").replace(/\r/g,"[r]").replace(/\t/g,"[t]")};goog.debug.fnNameCache_={};goog.debug.LogRecord=function(a,b,c,d,e){this.reset(a,b,c,d,e)};goog.debug.LogRecord.prototype.sequenceNumber_=0;goog.debug.LogRecord.prototype.exception_=null;goog.debug.LogRecord.prototype.exceptionText_=null;goog.debug.LogRecord.ENABLE_SEQUENCE_NUMBERS=!0;goog.debug.LogRecord.nextSequenceNumber_=0;
goog.debug.LogRecord.prototype.reset=function(a,b,c,d,e){goog.debug.LogRecord.ENABLE_SEQUENCE_NUMBERS&&(this.sequenceNumber_="number"==typeof e?e:goog.debug.LogRecord.nextSequenceNumber_++);this.time_=d||goog.now();this.level_=a;this.msg_=b;this.loggerName_=c;delete this.exception_;delete this.exceptionText_};goog.debug.LogRecord.prototype.getLoggerName=function(){return this.loggerName_};goog.debug.LogRecord.prototype.getException=function(){return this.exception_};
goog.debug.LogRecord.prototype.setException=function(a){this.exception_=a};goog.debug.LogRecord.prototype.getExceptionText=function(){return this.exceptionText_};goog.debug.LogRecord.prototype.setExceptionText=function(a){this.exceptionText_=a};goog.debug.LogRecord.prototype.setLoggerName=function(a){this.loggerName_=a};goog.debug.LogRecord.prototype.getLevel=function(){return this.level_};goog.debug.LogRecord.prototype.setLevel=function(a){this.level_=a};
goog.debug.LogRecord.prototype.getMessage=function(){return this.msg_};goog.debug.LogRecord.prototype.setMessage=function(a){this.msg_=a};goog.debug.LogRecord.prototype.getMillis=function(){return this.time_};goog.debug.LogRecord.prototype.setMillis=function(a){this.time_=a};goog.debug.LogRecord.prototype.getSequenceNumber=function(){return this.sequenceNumber_};
goog.debug.LogBuffer=function(){goog.asserts.assert(goog.debug.LogBuffer.isBufferingEnabled(),"Cannot use goog.debug.LogBuffer without defining goog.debug.LogBuffer.CAPACITY.");this.clear()};goog.debug.LogBuffer.getInstance=function(){goog.debug.LogBuffer.instance_||(goog.debug.LogBuffer.instance_=new goog.debug.LogBuffer);return goog.debug.LogBuffer.instance_};goog.debug.LogBuffer.CAPACITY=0;
goog.debug.LogBuffer.prototype.addRecord=function(a,b,c){var d=(this.curIndex_+1)%goog.debug.LogBuffer.CAPACITY;this.curIndex_=d;if(this.isFull_)return d=this.buffer_[d],d.reset(a,b,c),d;this.isFull_=d==goog.debug.LogBuffer.CAPACITY-1;return this.buffer_[d]=new goog.debug.LogRecord(a,b,c)};goog.debug.LogBuffer.isBufferingEnabled=function(){return 0<goog.debug.LogBuffer.CAPACITY};
goog.debug.LogBuffer.prototype.clear=function(){this.buffer_=Array(goog.debug.LogBuffer.CAPACITY);this.curIndex_=-1;this.isFull_=!1};goog.debug.LogBuffer.prototype.forEachRecord=function(a){var b=this.buffer_;if(b[0]){var c=this.curIndex_,d=this.isFull_?c:-1;do d=(d+1)%goog.debug.LogBuffer.CAPACITY,a(b[d]);while(d!=c)}};goog.debug.Logger=function(a){this.name_=a;this.handlers_=this.children_=this.level_=this.parent_=null};goog.debug.Logger.ROOT_LOGGER_NAME="";goog.debug.Logger.ENABLE_HIERARCHY=!0;
goog.debug.Logger.ENABLE_HIERARCHY||(goog.debug.Logger.rootHandlers_=[]);goog.debug.Logger.Level=function(a,b){this.name=a;this.value=b};goog.debug.Logger.Level.prototype.toString=function(){return this.name};goog.debug.Logger.Level.OFF=new goog.debug.Logger.Level("OFF",Infinity);goog.debug.Logger.Level.SHOUT=new goog.debug.Logger.Level("SHOUT",1200);goog.debug.Logger.Level.SEVERE=new goog.debug.Logger.Level("SEVERE",1E3);goog.debug.Logger.Level.WARNING=new goog.debug.Logger.Level("WARNING",900);
goog.debug.Logger.Level.INFO=new goog.debug.Logger.Level("INFO",800);goog.debug.Logger.Level.CONFIG=new goog.debug.Logger.Level("CONFIG",700);goog.debug.Logger.Level.FINE=new goog.debug.Logger.Level("FINE",500);goog.debug.Logger.Level.FINER=new goog.debug.Logger.Level("FINER",400);goog.debug.Logger.Level.FINEST=new goog.debug.Logger.Level("FINEST",300);goog.debug.Logger.Level.ALL=new goog.debug.Logger.Level("ALL",0);
goog.debug.Logger.Level.PREDEFINED_LEVELS=[goog.debug.Logger.Level.OFF,goog.debug.Logger.Level.SHOUT,goog.debug.Logger.Level.SEVERE,goog.debug.Logger.Level.WARNING,goog.debug.Logger.Level.INFO,goog.debug.Logger.Level.CONFIG,goog.debug.Logger.Level.FINE,goog.debug.Logger.Level.FINER,goog.debug.Logger.Level.FINEST,goog.debug.Logger.Level.ALL];goog.debug.Logger.Level.predefinedLevelsCache_=null;
goog.debug.Logger.Level.createPredefinedLevelsCache_=function(){goog.debug.Logger.Level.predefinedLevelsCache_={};for(var a=0,b;b=goog.debug.Logger.Level.PREDEFINED_LEVELS[a];a++)goog.debug.Logger.Level.predefinedLevelsCache_[b.value]=b,goog.debug.Logger.Level.predefinedLevelsCache_[b.name]=b};
goog.debug.Logger.Level.getPredefinedLevel=function(a){goog.debug.Logger.Level.predefinedLevelsCache_||goog.debug.Logger.Level.createPredefinedLevelsCache_();return goog.debug.Logger.Level.predefinedLevelsCache_[a]||null};
goog.debug.Logger.Level.getPredefinedLevelByValue=function(a){goog.debug.Logger.Level.predefinedLevelsCache_||goog.debug.Logger.Level.createPredefinedLevelsCache_();if(a in goog.debug.Logger.Level.predefinedLevelsCache_)return goog.debug.Logger.Level.predefinedLevelsCache_[a];for(var b=0;b<goog.debug.Logger.Level.PREDEFINED_LEVELS.length;++b){var c=goog.debug.Logger.Level.PREDEFINED_LEVELS[b];if(c.value<=a)return c}return null};goog.debug.Logger.getLogger=function(a){return goog.debug.LogManager.getLogger(a)};
goog.debug.Logger.logToProfilers=function(a){goog.global.console&&(goog.global.console.timeStamp?goog.global.console.timeStamp(a):goog.global.console.markTimeline&&goog.global.console.markTimeline(a));goog.global.msWriteProfilerMark&&goog.global.msWriteProfilerMark(a)};goog.debug.Logger.prototype.getName=function(){return this.name_};
goog.debug.Logger.prototype.addHandler=function(a){goog.debug.LOGGING_ENABLED&&(goog.debug.Logger.ENABLE_HIERARCHY?(this.handlers_||(this.handlers_=[]),this.handlers_.push(a)):(goog.asserts.assert(!this.name_,"Cannot call addHandler on a non-root logger when goog.debug.Logger.ENABLE_HIERARCHY is false."),goog.debug.Logger.rootHandlers_.push(a)))};
goog.debug.Logger.prototype.removeHandler=function(a){if(goog.debug.LOGGING_ENABLED){var b=goog.debug.Logger.ENABLE_HIERARCHY?this.handlers_:goog.debug.Logger.rootHandlers_;return!!b&&goog.array.remove(b,a)}return!1};goog.debug.Logger.prototype.getParent=function(){return this.parent_};goog.debug.Logger.prototype.getChildren=function(){this.children_||(this.children_={});return this.children_};
goog.debug.Logger.prototype.setLevel=function(a){goog.debug.LOGGING_ENABLED&&(goog.debug.Logger.ENABLE_HIERARCHY?this.level_=a:(goog.asserts.assert(!this.name_,"Cannot call setLevel() on a non-root logger when goog.debug.Logger.ENABLE_HIERARCHY is false."),goog.debug.Logger.rootLevel_=a))};goog.debug.Logger.prototype.getLevel=function(){return goog.debug.LOGGING_ENABLED?this.level_:goog.debug.Logger.Level.OFF};
goog.debug.Logger.prototype.getEffectiveLevel=function(){if(!goog.debug.LOGGING_ENABLED)return goog.debug.Logger.Level.OFF;if(!goog.debug.Logger.ENABLE_HIERARCHY)return goog.debug.Logger.rootLevel_;if(this.level_)return this.level_;if(this.parent_)return this.parent_.getEffectiveLevel();goog.asserts.fail("Root logger has no level set.");return null};goog.debug.Logger.prototype.isLoggable=function(a){return goog.debug.LOGGING_ENABLED&&a.value>=this.getEffectiveLevel().value};
goog.debug.Logger.prototype.log=function(a,b,c){goog.debug.LOGGING_ENABLED&&this.isLoggable(a)&&(goog.isFunction(b)&&(b=b()),this.doLogRecord_(this.getLogRecord(a,b,c,goog.debug.Logger.prototype.log)))};
goog.debug.Logger.prototype.getLogRecord=function(a,b,c,d){var e=goog.debug.LogBuffer.isBufferingEnabled()?goog.debug.LogBuffer.getInstance().addRecord(a,b,this.name_):new goog.debug.LogRecord(a,String(b),this.name_);if(c){var f;f=goog.STRICT_MODE_COMPATIBLE?d||goog.debug.Logger.prototype.getLogRecord:d||arguments.callee.caller;e.setException(c);e.setExceptionText(goog.debug.exposeException(c,f))}return e};
goog.debug.Logger.prototype.shout=function(a,b){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.SHOUT,a,b)};goog.debug.Logger.prototype.severe=function(a,b){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.SEVERE,a,b)};goog.debug.Logger.prototype.warning=function(a,b){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.WARNING,a,b)};goog.debug.Logger.prototype.info=function(a,b){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.INFO,a,b)};
goog.debug.Logger.prototype.config=function(a,b){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.CONFIG,a,b)};goog.debug.Logger.prototype.fine=function(a,b){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.FINE,a,b)};goog.debug.Logger.prototype.finer=function(a,b){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.FINER,a,b)};goog.debug.Logger.prototype.finest=function(a,b){goog.debug.LOGGING_ENABLED&&this.log(goog.debug.Logger.Level.FINEST,a,b)};
goog.debug.Logger.prototype.logRecord=function(a){goog.debug.LOGGING_ENABLED&&this.isLoggable(a.getLevel())&&this.doLogRecord_(a)};goog.debug.Logger.prototype.doLogRecord_=function(a){goog.debug.Logger.logToProfilers("log:"+a.getMessage());if(goog.debug.Logger.ENABLE_HIERARCHY)for(var b=this;b;)b.callPublish_(a),b=b.getParent();else for(var b=0,c;c=goog.debug.Logger.rootHandlers_[b++];)c(a)};goog.debug.Logger.prototype.callPublish_=function(a){if(this.handlers_)for(var b=0,c;c=this.handlers_[b];b++)c(a)};
goog.debug.Logger.prototype.setParent_=function(a){this.parent_=a};goog.debug.Logger.prototype.addChild_=function(a,b){this.getChildren()[a]=b};goog.debug.LogManager={};goog.debug.LogManager.loggers_={};goog.debug.LogManager.rootLogger_=null;
goog.debug.LogManager.initialize=function(){goog.debug.LogManager.rootLogger_||(goog.debug.LogManager.rootLogger_=new goog.debug.Logger(goog.debug.Logger.ROOT_LOGGER_NAME),goog.debug.LogManager.loggers_[goog.debug.Logger.ROOT_LOGGER_NAME]=goog.debug.LogManager.rootLogger_,goog.debug.LogManager.rootLogger_.setLevel(goog.debug.Logger.Level.CONFIG))};goog.debug.LogManager.getLoggers=function(){return goog.debug.LogManager.loggers_};
goog.debug.LogManager.getRoot=function(){goog.debug.LogManager.initialize();return goog.debug.LogManager.rootLogger_};goog.debug.LogManager.getLogger=function(a){goog.debug.LogManager.initialize();return goog.debug.LogManager.loggers_[a]||goog.debug.LogManager.createLogger_(a)};goog.debug.LogManager.createFunctionForCatchErrors=function(a){return function(b){(a||goog.debug.LogManager.getRoot()).severe("Error: "+b.message+" ("+b.fileName+" @ Line: "+b.line+")")}};
goog.debug.LogManager.createLogger_=function(a){var b=new goog.debug.Logger(a);if(goog.debug.Logger.ENABLE_HIERARCHY){var c=a.lastIndexOf("."),d=a.substr(0,c),c=a.substr(c+1),d=goog.debug.LogManager.getLogger(d);d.addChild_(c,b);b.setParent_(d)}return goog.debug.LogManager.loggers_[a]=b};goog.log={};goog.log.ENABLED=goog.debug.LOGGING_ENABLED;goog.log.ROOT_LOGGER_NAME=goog.debug.Logger.ROOT_LOGGER_NAME;goog.log.Logger=goog.debug.Logger;goog.log.Level=goog.debug.Logger.Level;goog.log.LogRecord=goog.debug.LogRecord;
goog.log.getLogger=function(a,b){if(goog.log.ENABLED){var c=goog.debug.LogManager.getLogger(a);b&&c&&c.setLevel(b);return c}return null};goog.log.addHandler=function(a,b){goog.log.ENABLED&&a&&a.addHandler(b)};goog.log.removeHandler=function(a,b){return goog.log.ENABLED&&a?a.removeHandler(b):!1};goog.log.log=function(a,b,c,d){goog.log.ENABLED&&a&&a.log(b,c,d)};goog.log.error=function(a,b,c){goog.log.ENABLED&&a&&a.severe(b,c)};goog.log.warning=function(a,b,c){goog.log.ENABLED&&a&&a.warning(b,c)};
goog.log.info=function(a,b,c){goog.log.ENABLED&&a&&a.info(b,c)};goog.log.fine=function(a,b,c){goog.log.ENABLED&&a&&a.fine(b,c)};ydn.base={};ydn.base.JQUERY=!1;goog.log.finest=function(a,b,c){goog.log.ENABLED&&a&&a.log(goog.debug.Logger.Level.FINEST,b,c)};goog.log.finer=function(a,b,c){goog.log.ENABLED&&a&&a.log(goog.debug.Logger.Level.FINER,b,c)};ydn.async={};ydn.async.Deferred=function(a,b){goog.async.Deferred.call(this,a,b);this.progbacks_=[]};goog.inherits(ydn.async.Deferred,goog.async.Deferred);
ydn.async.Deferred.prototype.addProgback=function(a,b){this.progbacks_.push([a,b]);return this};ydn.async.Deferred.prototype.notify=function(a){for(var b=0;b<this.progbacks_.length;b++)this.progbacks_[b][0].call(this.progbacks_[b][1],a)};ydn.async.Deferred.prototype.callback=function(a){this.progbacks_.length=0;ydn.async.Deferred.superClass_.callback.call(this,a)};ydn.async.Deferred.prototype.errback=function(a){this.progbacks_.length=0;ydn.async.Deferred.superClass_.errback.call(this,a)};
ydn.async.Deferred.prototype.promise=function(){return this};ydn.base.exports={};goog.exportProperty(goog.async.Deferred.prototype,"done",goog.async.Deferred.prototype.addCallback);goog.exportProperty(goog.async.Deferred.prototype,"fail",goog.async.Deferred.prototype.addErrback);goog.exportProperty(goog.async.Deferred.prototype,"always",goog.async.Deferred.prototype.addBoth);goog.exportProperty(ydn.async.Deferred.prototype,"then",ydn.async.Deferred.prototype.then);ydn.db={};
ydn.db.KeyRange=function(a,b,c,d){a>b&&(b=a=void 0);goog.isNull(a)&&(a=void 0);goog.isNull(b)&&(b=void 0);this.lower=a;this.upper=b;this.lowerOpen=!!c;this.upperOpen=!!d};ydn.db.KeyRange.prototype.lower=void 0;ydn.db.KeyRange.prototype.upper=void 0;ydn.db.KeyRange.prototype.toJSON=function(){return ydn.db.KeyRange.toJSON(this)};ydn.db.KeyRange.prototype.toIDBKeyRange=function(){return ydn.db.KeyRange.parseIDBKeyRange(this)};
ydn.db.KeyRange.clone=function(a){if(goog.isDefAndNotNull(a))return new ydn.db.KeyRange(a.lower,a.upper,!!a.lowerOpen,!!a.upperOpen)};ydn.db.KeyRange.only=function(a){return new ydn.db.KeyRange(a,a,!1,!1)};ydn.db.KeyRange.bound=function(a,b,c,d){return new ydn.db.KeyRange(a,b,c,d)};ydn.db.KeyRange.upperBound=function(a,b){return new ydn.db.KeyRange(void 0,a,void 0,!!b)};ydn.db.KeyRange.lowerBound=function(a,b){return new ydn.db.KeyRange(a,void 0,!!b,void 0)};
ydn.db.KeyRange.starts=function(a){var b;if(goog.isArray(a))b=goog.array.clone(a),b.push("\uffff");else if(goog.isString(a))b=a+"\uffff";else if(goog.isNumber(a))b=a+2.220460492503131E-16,a-=2.220460492503131E-16;else return ydn.db.KeyRange.only(a);return ydn.db.KeyRange.bound(a,b,!1,!0)};ydn.db.KeyRange.toJSON=function(a){a=a||{};return{lower:a.lower,upper:a.upper,lowerOpen:a.lowerOpen,upperOpen:a.upperOpen}};
ydn.db.KeyRange.parseKeyRange=function(a){if(!goog.isDefAndNotNull(a))return null;if(a instanceof ydn.db.KeyRange)return a;if(goog.isObject(a))return new ydn.db.KeyRange(a.lower,a.upper,a.lowerOpen,a.upperOpen);throw new ydn.debug.error.ArgumentException("Invalid key range: "+a+" of type "+typeof a);};
ydn.db.KeyRange.parseIDBKeyRange=function(a){return goog.isDefAndNotNull(a)?goog.isDefAndNotNull(a.upper)&&goog.isDefAndNotNull(a.lower)?ydn.db.IDBKeyRange.bound(a.lower,a.upper,!!a.lowerOpen,!!a.upperOpen):goog.isDefAndNotNull(a.upper)?ydn.db.IDBKeyRange.upperBound(a.upper,a.upperOpen):goog.isDefAndNotNull(a.lower)?ydn.db.IDBKeyRange.lowerBound(a.lower,a.lowerOpen):null:null};
ydn.db.KeyRange.validate=function(a){if(a instanceof ydn.db.KeyRange)return"";if(goog.isDefAndNotNull(a)){if(goog.isObject(a)){for(var b in a)if(a.hasOwnProperty(b)&&!goog.array.contains(["lower","upper","lowerOpen","upperOpen"],b))return'invalid attribute "'+b+'" in key range object';return""}return"key range must be an object"}return""};
ydn.db.KeyRange.prototype.and=function(a){var b=this.lower,c=this.upper,d=this.lowerOpen,e=this.upperOpen;goog.isDefAndNotNull(a.lower)&&(!goog.isDefAndNotNull(this.lower)||a.lower>=this.lower)&&(b=a.lower,d=a.lowerOpen||this.lowerOpen);goog.isDefAndNotNull(a.upper)&&(!goog.isDefAndNotNull(this.upper)||a.upper<=this.upper)&&(c=a.upper,e=a.upperOpen||this.upperOpen);return ydn.db.KeyRange.bound(b,c,d,e)};
ydn.db.KeyRange.toString=function(a){if(!a)return"";var b=a.lowerOpen?"(":"[";goog.isDefAndNotNull(a.lower)&&(b+=a.lower+", ");goog.isDefAndNotNull(a.upper)&&(b+=a.upper);return b+=a.upperOpen?")":"]"};
ydn.db.KeyRange.toSql=function(a,b,c,d,e){if(c)if(!c.lowerOpen&&!c.upperOpen&&goog.isDefAndNotNull(c.lower)&&goog.isDefAndNotNull(c.upper)&&0===ydn.db.cmp(c.lower,c.upper))d.push(a+" = ?"),e.push(ydn.db.schema.Index.js2sql(c.lower,b));else{if(goog.isDefAndNotNull(c.lower)){var f=c.lowerOpen?" > ":" >= ";d.push(a+f+"?");e.push(ydn.db.schema.Index.js2sql(c.lower,b))}goog.isDefAndNotNull(c.upper)&&(f=c.upperOpen?" < ":" <= ",d.push(a+f+"?"),e.push(ydn.db.schema.Index.js2sql(c.upper,b)))}};
ydn.db.KeyRange.where=function(a,b,c,d){var e,f,g,h;if("starts"==a||"^"==a)return goog.asserts.assert(goog.isString(b)||goog.isArray(b),"key value of starts with must be an array or a string"),goog.asserts.assert(!goog.isDef(c),"op2 must not be defined"),goog.asserts.assert(!goog.isDef(d),"value2 must not be defined"),ydn.db.KeyRange.starts(b);if("<"==a||"<="==a)e=b,g="<"==a;else if(">"==a||">="==a)f=b,h=">"==a;else if("="==a||"=="==a)e=f=b;else throw new ydn.debug.error.ArgumentException("invalid op: "+
a);if("<"==c||"<="==c)e=d,g="<"==c;else if(">"==c||">="==c)f=d,h=">"==c;else if(goog.isDef(c))throw new ydn.debug.error.ArgumentException("invalid op2: "+c);return ydn.db.KeyRange.bound(f,e,h,g)};ydn.db.IDBKeyRange=goog.global.IDBKeyRange||goog.global.webkitIDBKeyRange||ydn.db.KeyRange;ydn.db.utils={};
ydn.db.utils.getValueByKeys=function(a,b){var c,d;2==arguments.length&&goog.isString(arguments[1])?(c=!0,d=arguments[1].split(".")):d=(c=goog.isArrayLike(b))?b:arguments;for(c=c?0:1;c<d.length&&(a=a[d[c]],goog.isDef(a));c++);return a};ydn.db.utils.setValueByKeys=function(a,b,c){if(a)if(-1==b.indexOf("."))a[b]=c;else{b=b.split(".");for(var d=b.pop(),e;e=b.shift();)goog.isObject(a[e])||(goog.asserts.assert(!goog.isDef(a[e]),'key "'+e+'" is not on path'),a[e]={}),a=a[e];a[d]=c}};
ydn.db.utils.ARRAY_TERMINATOR={};ydn.db.utils.BYTE_TERMINATOR=0;ydn.db.utils.TYPE_NUMBER=1;ydn.db.utils.TYPE_DATE=2;ydn.db.utils.TYPE_STRING=3;ydn.db.utils.TYPE_ARRAY=4;ydn.db.utils.MAX_TYPE_BYTE_SIZE=12;
ydn.db.utils.encodeKey=function(a){a=[a];for(var b=new ydn.db.utils.HexStringWriter,c=0,d,e;void 0!==(e=a.pop());){0===c%4&&c+ydn.db.utils.TYPE_ARRAY>ydn.db.utils.MAX_TYPE_BYTE_SIZE&&(b.write(c),c=0);d=typeof e;if(e instanceof Array)if(c+=ydn.db.utils.TYPE_ARRAY,0<e.length){a.push(ydn.db.utils.ARRAY_TERMINATOR);for(d=e.length;d--;)a.push(e[d]);continue}else b.write(c);else if("number"===d)c+=ydn.db.utils.TYPE_NUMBER,b.write(c),ydn.db.utils.encodeNumber(b,e);else if(e instanceof Date)c+=ydn.db.utils.TYPE_DATE,
b.write(c),ydn.db.utils.encodeNumber(b,e.valueOf());else if("string"===d)c+=ydn.db.utils.TYPE_STRING,b.write(c),ydn.db.utils.encodeString(b,e);else if(e===ydn.db.utils.ARRAY_TERMINATOR)b.write(ydn.db.utils.BYTE_TERMINATOR);else return"";c=0}return b.trim().toString()};
ydn.db.utils.decodeKey=function(a){for(var b=[],c=b,d=[],e,f,g=new ydn.db.utils.HexStringReader(a);null!=g.read();)if(0===g.current)c=d.pop();else{if(null===g.current)break;do{e=g.current/4|0;a=g.current%4;for(var h=0;h<e;h++)f=[],c.push(f),d.push(c),c=f;if(0===a&&g.current+ydn.db.utils.TYPE_ARRAY>ydn.db.utils.MAX_TYPE_BYTE_SIZE)g.read();else break}while(1);a===ydn.db.utils.TYPE_NUMBER?c.push(ydn.db.utils.decodeNumber(g)):a===ydn.db.utils.TYPE_DATE?c.push(new Date(ydn.db.utils.decodeNumber(g))):a===
ydn.db.utils.TYPE_STRING?c.push(ydn.db.utils.decodeString(g)):0===a&&(c=d.pop())}return b[0]};ydn.db.utils.p16=65536;ydn.db.utils.p32=4294967296;ydn.db.utils.p48=281474976710656;ydn.db.utils.p52=4503599627370496;ydn.db.utils.pNeg1074=4.9E-324;ydn.db.utils.pNeg1022=2.2250738585072014E-308;
ydn.db.utils.ieee754=function(a){var b=0,c=0,d=0;if(0!==a)if(isFinite(a)){0>a&&(b=1,a=-a);d=0;if(a>=ydn.db.utils.pNeg1022){for(c=a;1>c;)d--,c*=2;for(;2<=c;)d++,c/=2;c=d+1023}d=c?Math.floor((a/Math.pow(2,d)-1)*ydn.db.utils.p52):Math.floor(a/ydn.db.utils.pNeg1074)}else c=2047,isNaN(a)?d=0x8000000000000:-Infinity===a&&(b=1);return{sign:b,exponent:c,mantissa:d}};
ydn.db.utils.encodeNumber=function(a,b){var c=ydn.db.utils.ieee754(b);c.sign&&(c.mantissa=ydn.db.utils.p52-1-c.mantissa,c.exponent=2047-c.exponent);var d=c.mantissa;a.write((c.sign?0:128)|c.exponent>>4);a.write((c.exponent&15)<<4|0|d/ydn.db.utils.p48);d%=ydn.db.utils.p48;c=0|d/ydn.db.utils.p32;a.write(c>>8,c&255);d%=ydn.db.utils.p32;c=0|d/ydn.db.utils.p16;a.write(c>>8,c&255);c=d%ydn.db.utils.p16;a.write(c>>8,c&255)};
ydn.db.utils.decodeNumber=function(a){var b=a.read()|0,c=b>>7?!1:!0,d=c?-1:1,e=(b&127)<<4,b=a.read()|0,e=e+(b>>4);c&&(e=2047-e);for(var b=[c?15-(b&15):b&15],f=6;f--;)b.push(c?255-(a.read()|0):a.read()|0);a=0;for(f=7;f--;)a=a/256+b[f];a/=16;return 0===a&&0===e?0:(a+1)*Math.pow(2,e-1023)*d};ydn.db.utils.secondLayer=16510;
ydn.db.utils.encodeString=function(a,b){for(var c=0;c<b.length;c++){var d=b.charCodeAt(c);126>=d?a.write(d+1):d<=ydn.db.utils.secondLayer?(d-=127,a.write(128|d>>8,d&255)):a.write(192|d>>10,d>>2|255,(d|3)<<6)}a.write(ydn.db.utils.BYTE_TERMINATOR)};
ydn.db.utils.decodeString=function(a){for(var b=[],c=0,d=0,e=0,f,g;;){f=a.read();if(0===f||null==f)break;0===c?(g=f>>6,2>g&&!isNaN(f)?b.push(String.fromCharCode(f-1)):(c=g,d=f<<10,e++)):2===c?(b.push(String.fromCharCode(d+f+127)),c=d=e=0):2===e?(d+=f<<2,e++):(b.push(String.fromCharCode(d|f>>6)),c=d=e=0)}return b.join("")};ydn.db.utils.HexStringReader=function(a){this.current=null;this.string=a;this.lastIndex=this.string.length-1;this.index=-1};
ydn.db.utils.HexStringReader.prototype.read=function(){return this.current=this.index<this.lastIndex?parseInt(this.string.charAt(++this.index)+this.string.charAt(++this.index),16):null};ydn.db.utils.HexStringWriter=function(){this.buffer=[];this.c=void 0};ydn.db.utils.HexStringWriter.prototype.write=function(a){for(var b=0;b<arguments.length;b++)this.c=arguments[b].toString(16),this.buffer.push(2===this.c.length?this.c:this.c="0"+this.c)};
ydn.db.utils.HexStringWriter.prototype.trim=function(){for(var a=this.buffer.length;"00"===this.buffer[--a];);this.buffer.length=++a;return this};ydn.db.utils.HexStringWriter.prototype.toString=function(){return this.buffer.length?this.buffer.join(""):""};ydn.db.utils.cmp=function(a,b){var c=ydn.db.utils.encodeKey(a),d=ydn.db.utils.encodeKey(b);return c>d?1:c==d?0:-1};
ydn.db.Where=function(a,b,c,d,e){this.key_range_=b instanceof ydn.db.KeyRange?b:goog.isString(b)&&goog.isDef(c)?ydn.db.KeyRange.where(b,c,d,e):ydn.db.KeyRange.parseKeyRange(b);this.field=a};ydn.db.Where.prototype.field="";ydn.db.Where.prototype.getField=function(){return this.field};ydn.db.Where.prototype.getKeyRange=function(){return this.key_range_};
ydn.db.Where.resolvedStartsWith=function(a){return goog.isDefAndNotNull(a)&&goog.isDefAndNotNull(a.lower)&&goog.isDefAndNotNull(a.upper)?goog.isArray(a.lower)&&goog.isArray(a.upper)?a.lower.length==a.upper.length-1&&"\uffff"==a.upper[a.upper.length-1]&&a.lower.every(function(b,c){return b==a.upper[c]}):!a.lowerOpen&&!a.upperOpen&&a.lower.length==a.upper.length+1&&"\uffff"==a.upper[a.lower.length-1]:!1};
ydn.db.Where.prototype.and=function(a){if(this.field!=a.field)return null;a=goog.isDefAndNotNull(this.key_range_)&&goog.isDefAndNotNull(a.key_range_)?this.key_range_.and(a.key_range_):this.key_range_||a.key_range_;return new ydn.db.Where(this.field,a)};ydn.db.base={};ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME="_ROWID_";ydn.db.base.DEFAULT_BLOB_COLUMN="_default_";ydn.db.base.DISPATCH_EVENT=!1;ydn.db.base.DEFAULT_RESULT_LIMIT=100;ydn.db.base.DEFAULT_CONNECTION_TIMEOUT=18E5;
ydn.db.base.Mechanisms={IDB:"indexeddb",USER_DATA:"userdata",LOCAL_STORAGE:"localstorage",MEMORY_STORAGE:"memory",SESSION_STORAGE:"sessionstorage",SQLITE:"sqlite",WEBSQL:"websql"};ydn.db.base.TxEventTypes={COMPLETE:"complete",ABORT:"abort",ERROR:"error"};ydn.db.base.StandardTransactionMode={READ_ONLY:"readonly",READ_WRITE:"readwrite",VERSION_CHANGE:"versionchange"};ydn.db.base.OLD_INDEXEDDB_SUPPORT=!1;
ydn.db.base.IDBTransaction=ydn.db.base.OLD_INDEXEDDB_SUPPORT?goog.global.IDBRequest&&"LOADING"in goog.global.IDBRequest?goog.global.IDBTransaction:goog.global.webkitIDBRequest&&"LOADING"in goog.global.webkitIDBRequest&&1===goog.global.webkitIDBTransaction.READ_WRITE?goog.global.webkitIDBTransaction:ydn.db.base.StandardTransactionMode:ydn.db.base.StandardTransactionMode;ydn.db.base.TransactionMode={READ_ONLY:ydn.db.base.IDBTransaction.READ_ONLY,READ_WRITE:ydn.db.base.IDBTransaction.READ_WRITE,VERSION_CHANGE:ydn.db.base.IDBTransaction.VERSION_CHANGE};
ydn.db.base.ENABLE_DEFAULT_TEXT_STORE=!1;ydn.db.base.ENABLE_ENCRYPTION=!1;ydn.db.base.Direction={NEXT:"next",NEXT_UNIQUE:"nextunique",PREV:"prev",PREV_UNIQUE:"prevunique"};ydn.db.base.DIRECTIONS=[ydn.db.base.Direction.NEXT,ydn.db.base.Direction.NEXT_UNIQUE,ydn.db.base.Direction.PREV,ydn.db.base.Direction.PREV_UNIQUE];ydn.db.base.getDirection=function(a,b){return a?b?ydn.db.base.Direction.PREV_UNIQUE:ydn.db.base.Direction.PREV:b?ydn.db.base.Direction.NEXT_UNIQUE:ydn.db.base.Direction.NEXT};
ydn.db.base.indexedDb=goog.global.indexedDB||goog.global.mozIndexedDB||goog.global.webkitIndexedDB||goog.global.moz_indexedDB||goog.global.msIndexedDB;ydn.db.base.PREFIX_MULTIENTRY="ydn.db.me:";ydn.db.base.QueryMethod={NONE:0,LIST_KEY:1,LIST_PRIMARY_KEY:2,LIST_KEYS:3,LIST_VALUE:4,GET:5,COUNT:6};ydn.db.base.SN_ENTITY_HISTORY="_ydn_sync_history";ydn.db.base.entitySchema={name:ydn.db.base.SN_ENTITY_HISTORY,keyPath:"sequence",autoIncrement:!0,indexes:[{name:"key",keyPath:["entity","id"]}]};
goog.disposable={};goog.disposable.IDisposable=function(){};goog.Disposable=function(){goog.Disposable.MONITORING_MODE!=goog.Disposable.MonitoringMode.OFF&&(goog.Disposable.INCLUDE_STACK_ON_CREATION&&(this.creationStack=Error().stack),goog.Disposable.instances_[goog.getUid(this)]=this);this.disposed_=this.disposed_;this.onDisposeCallbacks_=this.onDisposeCallbacks_};goog.Disposable.MonitoringMode={OFF:0,PERMANENT:1,INTERACTIVE:2};goog.Disposable.MONITORING_MODE=0;
goog.Disposable.INCLUDE_STACK_ON_CREATION=!0;goog.Disposable.instances_={};goog.Disposable.getUndisposedObjects=function(){var a=[],b;for(b in goog.Disposable.instances_)goog.Disposable.instances_.hasOwnProperty(b)&&a.push(goog.Disposable.instances_[Number(b)]);return a};goog.Disposable.clearUndisposedObjects=function(){goog.Disposable.instances_={}};goog.Disposable.prototype.disposed_=!1;goog.Disposable.prototype.isDisposed=function(){return this.disposed_};
goog.Disposable.prototype.getDisposed=goog.Disposable.prototype.isDisposed;
goog.Disposable.prototype.dispose=function(){if(!this.disposed_&&(this.disposed_=!0,this.disposeInternal(),goog.Disposable.MONITORING_MODE!=goog.Disposable.MonitoringMode.OFF)){var a=goog.getUid(this);if(goog.Disposable.MONITORING_MODE==goog.Disposable.MonitoringMode.PERMANENT&&!goog.Disposable.instances_.hasOwnProperty(a))throw Error(this+" did not call the goog.Disposable base constructor or was disposed of after a clearUndisposedObjects call");delete goog.Disposable.instances_[a]}};
goog.Disposable.prototype.registerDisposable=function(a){this.addOnDisposeCallback(goog.partial(goog.dispose,a))};goog.Disposable.prototype.addOnDisposeCallback=function(a,b){this.onDisposeCallbacks_||(this.onDisposeCallbacks_=[]);this.onDisposeCallbacks_.push(goog.isDef(b)?goog.bind(a,b):a)};goog.Disposable.prototype.disposeInternal=function(){if(this.onDisposeCallbacks_)for(;this.onDisposeCallbacks_.length;)this.onDisposeCallbacks_.shift()()};
goog.Disposable.isDisposed=function(a){return a&&"function"==typeof a.isDisposed?a.isDisposed():!1};goog.dispose=function(a){a&&"function"==typeof a.dispose&&a.dispose()};goog.disposeAll=function(a){for(var b=0,c=arguments.length;b<c;++b){var d=arguments[b];goog.isArrayLike(d)?goog.disposeAll.apply(null,d):goog.dispose(d)}};ydn.db.core={};ydn.db.core.req={};
ydn.db.core.req.AbstractCursor=function(a,b,c,d){goog.Disposable.call(this);this.store_schema=c;this.store_name=c.getName();this.index_name=void 0;this.is_index=!1;this.key_range=null;this.tx=a;this.tx_no=b;this.count_=0;this.exited_=this.done_=!1;this.query_method=d||ydn.db.base.QueryMethod.LIST_VALUE;this.value_=this.primary_key_=this.key_=void 0;this.onNext=function(a){throw new ydn.debug.error.InternalError;};this.onFail=function(a){throw new ydn.debug.error.InternalError;};this.onTerminated=
function(a,b,c){}};goog.inherits(ydn.db.core.req.AbstractCursor,goog.Disposable);
ydn.db.core.req.AbstractCursor.prototype.init=function(a,b,c,d,e){goog.asserts.assert(this.store_name==a,"expect store name of "+this.store_name+" but "+a+" found.");goog.isDef(b)&&(this.index_name=this.store_schema.getIndexName(b),goog.asserts.assertString(this.index_name,'index "'+b+'" not found in store "'+a+'"'));this.is_index=goog.isString(this.index_name);this.key_range=c||null;this.count_=0;this.exited_=this.done_=!1;this.reverse=d==ydn.db.base.Direction.PREV||d==ydn.db.base.Direction.PREV_UNIQUE;
this.unique=d==ydn.db.base.Direction.NEXT_UNIQUE||d==ydn.db.base.Direction.PREV_UNIQUE;this.dir=d;this.is_key_cursor_=e;this.value_=this.primary_key_=this.key_=void 0};ydn.db.core.req.AbstractCursor.prototype.dir="";ydn.db.core.req.AbstractCursor.prototype.key_range=null;ydn.db.core.req.AbstractCursor.prototype.unique=!1;ydn.db.core.req.AbstractCursor.prototype.reverse=!1;ydn.db.core.req.AbstractCursor.prototype.is_key_cursor_=!0;ydn.db.core.req.AbstractCursor.prototype.logger=goog.log.getLogger("ydn.db.core.req.AbstractCursor");
ydn.db.core.req.AbstractCursor.prototype.isActive=function(){return!!this.tx};ydn.db.core.req.AbstractCursor.prototype.isIndexCursor=function(){return this.is_index};ydn.db.core.req.AbstractCursor.prototype.isPrimaryCursor=function(){return!this.is_index};ydn.db.core.req.AbstractCursor.prototype.isValueCursor=function(){return!this.is_key_cursor_};ydn.db.core.req.AbstractCursor.prototype.onError=function(a){this.onFail(a);this.finalize_();this.done_=!0};
ydn.db.core.req.AbstractCursor.prototype.onSuccess=function(a,b,c){goog.isDefAndNotNull(a)||(goog.log.finer(this.logger,this+" finished."),this.done_=!0);this.key_=a;this.primary_key_=b;this.value_=c;this.count_++;this.done_?(goog.log.finest(this.logger,this+" DONE."),this.onNext(),this.finalize_()):(goog.log.finest(this.logger,this+" new cursor position {"+(this.is_index?this.key_+", "+this.primary_key_:this.key_)+"}"),this.onNext(this.key_))};
ydn.db.core.req.AbstractCursor.prototype.disposeInternal=function(){this.tx=null};goog.DEBUG&&(ydn.db.core.req.AbstractCursor.prototype.toString=function(){var a=goog.isDef(this.index_name)?":"+this.index_name:"";return"Cursor:"+this.store_name+a+"["+(this.tx?"":"~")+this.tx_no+"]"});
ydn.db.core.req.AbstractCursor.prototype.finalize_=function(){goog.isDefAndNotNull(this.primary_key_)?this.primary_key_=ydn.db.Key.clone(this.primary_key_):this.primary_key_=void 0;goog.isDefAndNotNull(this.key_)?this.key_=ydn.db.Key.clone(this.key_):this.key_=void 0;this.onTerminated(this.exited_,this.key_,this.primary_key_)};
ydn.db.core.req.AbstractCursor.prototype.open=function(a,b,c,d){this.tx=a;this.tx_no=b;this.done_=this.exited_=!1;this.key_=c;this.primary_key_=d;this.openCursor(this.key_,this.primary_key_)};ydn.db.core.req.AbstractCursor.prototype.resume=function(a,b){this.done_?this.open(a,b):this.open(a,b,this.key_,this.primary_key_)};ydn.db.core.req.AbstractCursor.prototype.exit=function(){this.exited_=!0;goog.log.finest(this.logger,this+": exit");this.finalize_()};
ydn.db.core.req.AbstractCursor.prototype.getCount=function(){return this.count_};ydn.db.core.req.AbstractCursor.prototype.getKey=function(){return this.key_};ydn.db.core.req.AbstractCursor.prototype.getPrimaryKey=function(){return this.isIndexCursor()?this.primary_key_:this.key_};ydn.db.core.req.AbstractCursor.prototype.getValue=function(a){return this.isValueCursor()?this.value_:this.getPrimaryKey()};ydn.db.core.req.AbstractCursor.prototype.hasDone=function(){return this.done_};
ydn.db.core.req.AbstractCursor.prototype.isExited=function(){return this.exited_};ydn.db.core.req.AbstractCursor.prototype.continuePrimaryKey=function(a){};ydn.db.core.req.AbstractCursor.prototype.continueEffectiveKey=function(a){};ydn.db.core.req.AbstractCursor.prototype.restart=function(a,b){goog.log.finest(this.logger,this+" restarting");this.exited_=this.done_=!1;this.openCursor(b,a)};ydn.db.core.AbstractIterator=function(){};ydn.db.core.req.ICursor=function(){};
ydn.db.core.req.ICursor.prototype.openCursor=function(a,b){};ydn.db.core.req.ICursor.prototype.continuePrimaryKey=function(a){};ydn.db.core.req.ICursor.prototype.continueEffectiveKey=function(a){};ydn.db.core.req.ICursor.prototype.advance=function(a){};ydn.db.core.req.ICursor.prototype.restart=function(a,b){};ydn.db.core.req.ICursor.prototype.hasCursor=function(){};ydn.db.core.req.ICursor.prototype.update=function(a){};ydn.db.core.req.ICursor.prototype.clear=function(){};
ydn.db.core.req.ICursor.prototype.isIndexCursor=function(){};ydn.db.core.req.ICursor.prototype.isPrimaryCursor=function(){};ydn.db.core.req.ICursor.prototype.isValueCursor=function(){};ydn.db.core.req.ICursor.prototype.getKey=function(){};ydn.db.core.req.ICursor.prototype.getPrimaryKey=function(){};ydn.db.core.req.ICursor.prototype.getValue=function(a){};
ydn.db.Iterator=function(a,b,c,d,e,f,g){if(goog.DEBUG&&!goog.isString(a))throw new TypeError("store name must be a string, but "+a+" found.");this.store_name_=a;this.index_name_=b;this.index_key_path_=g;this.is_index_iterator_=!!this.index_name_;if(goog.DEBUG){if(goog.isDef(d)&&!goog.isBoolean(d))throw new ydn.debug.error.ArgumentException("reverse value must be a boolean, but "+typeof d+" found");if(goog.isDef(e)&&!goog.isBoolean(e))throw new ydn.debug.error.ArgumentException("unique value must be a boolean, but "+
typeof e+" found");if(goog.isDef(f)&&!goog.isBoolean(f))throw new ydn.debug.error.ArgumentException("key_only value must be a boolean, but "+typeof f+" found");}this.is_key_iterator_=goog.isDef(f)?f:!!goog.isString(this.index_name_);a=ydn.db.base.Direction.NEXT;d&&e?a=ydn.db.base.Direction.PREV_UNIQUE:d?a=ydn.db.base.Direction.PREV:e&&(a=ydn.db.base.Direction.NEXT_UNIQUE);this.direction_=a;if(goog.DEBUG&&(d=ydn.db.KeyRange.validate(c)))throw new ydn.debug.error.ArgumentException("Invalid key range: "+
d);this.key_range_=ydn.db.KeyRange.parseIDBKeyRange(c);this.state_=ydn.db.Iterator.State.INITIAL;this.prefix_index=NaN};goog.inherits(ydn.db.Iterator,ydn.db.core.AbstractIterator);ydn.db.Iterator.DEBUG=!1;ydn.db.Iterator.prototype.is_key_iterator_=!0;ydn.db.KeyIterator=function(a,b,c){if(3<arguments.length)throw new ydn.debug.error.ArgumentException("too many argument");ydn.db.Iterator.call(this,a,void 0,b,c,void 0,!0)};goog.inherits(ydn.db.KeyIterator,ydn.db.Iterator);
ydn.db.KeyIterator.where=function(a,b,c,d,e){return new ydn.db.KeyIterator(a,ydn.db.KeyRange.where(b,c,d,e))};ydn.db.IndexIterator=function(a,b,c,d,e){if(!goog.isString(b))throw new ydn.debug.error.ArgumentException("index name must be string");ydn.db.Iterator.call(this,a,b,c,d,e,!0)};goog.inherits(ydn.db.IndexIterator,ydn.db.Iterator);ydn.db.IndexIterator.where=function(a,b,c,d,e,f){return new ydn.db.IndexIterator(a,b,ydn.db.KeyRange.where(c,d,e,f))};
ydn.db.ValueIterator=function(a,b,c){if(3<arguments.length)throw new ydn.debug.error.ArgumentException("too many argument");ydn.db.Iterator.call(this,a,void 0,b,c,void 0,!1)};goog.inherits(ydn.db.ValueIterator,ydn.db.Iterator);ydn.db.ValueIterator.where=function(a,b,c,d,e){return new ydn.db.ValueIterator(a,ydn.db.KeyRange.where(b,c,d,e))};
ydn.db.IndexValueIterator=function(a,b,c,d,e){if(!goog.isString(b))throw new ydn.debug.error.ArgumentException("index name must be string");ydn.db.Iterator.call(this,a,b,c,d,e,!1)};goog.inherits(ydn.db.IndexValueIterator,ydn.db.Iterator);ydn.db.IndexValueIterator.where=function(a,b,c,d,e,f){return new ydn.db.IndexValueIterator(a,b,ydn.db.KeyRange.where(c,d,e,f))};ydn.db.Iterator.State={INITIAL:"init",WORKING:"busy",RESTING:"rest",COMPLETED:"done"};ydn.db.Iterator.prototype.logger=goog.log.getLogger("ydn.db.Iterator");
ydn.db.Iterator.prototype.getStoreName=function(){return this.store_name_};ydn.db.Iterator.prototype.getIndexName=function(){return this.index_name_};ydn.db.Iterator.prototype.getIndexKeyPath=function(){return this.index_key_path_};ydn.db.Iterator.prototype.getDirection=function(){return this.direction_};ydn.db.Iterator.prototype.keyRange=function(){return this.key_range_};ydn.db.Iterator.prototype.hasKeyRange=function(){return!!this.key_range_};
ydn.db.Iterator.prototype.getLower=function(){return this.key_range_?void 0:this.key_range_.lower};ydn.db.Iterator.prototype.getLowerOpen=function(){return this.key_range_?void 0:this.key_range_.lowerOpen};ydn.db.Iterator.prototype.getUpper=function(){return this.key_range_?void 0:this.key_range_.upper};ydn.db.Iterator.prototype.getUpperOpen=function(){return this.key_range_?void 0:this.key_range_.upperOpen};
ydn.db.Iterator.prototype.getKeyRange=function(){return this.key_range_?this.key_range_ instanceof ydn.db.IDBKeyRange?this.key_range_:ydn.db.IDBKeyRange.bound(this.key_range_.lower,this.key_range_.upper,this.key_range_.lowerOpen,this.key_range_.upperOpen):null};ydn.db.Iterator.prototype.isKeyIterator=function(){return this.is_key_iterator_};ydn.db.Iterator.prototype.isIndexIterator=function(){return this.is_index_iterator_};ydn.db.Iterator.prototype.isPrimaryIterator=function(){return!this.is_index_iterator_};
ydn.db.Iterator.prototype.clone=function(){var a=new ydn.db.Iterator(this.store_name_,this.index_name_,this.key_range_,this.isReversed(),this.isUnique(),this.isKeyIterator(),this.index_key_path_);a.prefix_index=this.prefix_index;return a};ydn.db.Iterator.prototype.asKeyIterator=function(){return new ydn.db.Iterator(this.store_name_,this.index_name_,this.key_range_,this.isReversed(),this.isUnique(),!0,this.index_key_path_)};
ydn.db.Iterator.prototype.asValueIterator=function(){return new ydn.db.Iterator(this.store_name_,this.index_name_,this.key_range_,this.isReversed(),this.isUnique(),!1,this.index_key_path_)};ydn.db.Iterator.prototype.unique=function(a){return new ydn.db.Iterator(this.store_name_,this.index_name_,this.key_range_,this.isReversed(),a,this.isKeyIterator(),this.index_key_path_)};
ydn.db.Iterator.prototype.copy=function(){return new ydn.db.Iterator(this.store_name_,this.index_name_,this.key_range_,this.isReversed(),this.isUnique(),this.isKeyIterator(),this.index_key_path_)};
goog.DEBUG&&(ydn.db.Iterator.prototype.toJSON=function(){return{store:this.store_name_,index:this.index_name_,keyRange:this.key_range_?ydn.db.KeyRange.toJSON(this.key_range_):null,direction:this.direction_}},ydn.db.Iterator.prototype.toString=function(){var a=goog.isDef(this.index_key_path_)?":"+this.index_key_path_.join(","):goog.isDef(this.index_name_)?":"+this.index_name_:"",a=a+ydn.db.KeyRange.toString(this.key_range_);this.state_!=ydn.db.Iterator.State.INITIAL&&(a+=this.state_+"{"+this.i_key_,
this.isIndexIterator()&&(a+=", "+this.i_primary_key_),a+="}");var b=this.isIndexIterator()?"Index":"",b=b+(this.isKeyIterator()?"Key":"Value");return b+"Iterator:"+this.store_name_+a});ydn.db.Iterator.prototype.resume=function(a,b){var c=new ydn.db.Iterator(this.store_name_,this.index_name_,this.key_range_,this.isReversed(),this.isUnique(),this.is_key_iterator_,this.index_key_path_);c.i_key_=a;c.i_primary_key_=b;c.state_=ydn.db.Iterator.State.RESTING;return c};
ydn.db.Iterator.prototype.reverse=function(a,b){return new ydn.db.Iterator(this.store_name_,this.index_name_,this.key_range_,!this.isReversed(),this.isUnique(),this.is_key_iterator_,this.index_key_path_)};ydn.db.Iterator.prototype.isReversed=function(){return this.direction_===ydn.db.base.Direction.PREV||this.direction_===ydn.db.base.Direction.PREV_UNIQUE};ydn.db.Iterator.prototype.isUnique=function(){return this.direction_===ydn.db.base.Direction.NEXT_UNIQUE||this.direction_===ydn.db.base.Direction.PREV_UNIQUE};
ydn.db.Iterator.prototype.getNextKeyRange=function(){this.state_!=ydn.db.Iterator.State.COMPLETED&&this.state_!=ydn.db.Iterator.State.INITIAL&&goog.isDefAndNotNull(this.i_key_);return this.key_range_};ydn.db.Iterator.prototype.getState=function(){return this.state_};
ydn.db.Iterator.prototype.load=function(a){a=a[0];a.init(this.store_name_,this.index_key_path_||this.index_name_,this.key_range_,this.direction_,this.is_key_iterator_);this.state_=ydn.db.Iterator.State.WORKING;var b=this;a.onTerminated=function(a,d,e){b.i_key_=d;b.i_primary_key_=e;b.state_=a?ydn.db.Iterator.State.RESTING:ydn.db.Iterator.State.COMPLETED};a.openCursor(this.i_key_,this.i_primary_key_);return a};
ydn.db.Iterator.prototype.isFreshState=function(){return this.state_==ydn.db.Iterator.State.INITIAL||this.state_==ydn.db.Iterator.State.COMPLETED};ydn.db.Iterator.prototype.getKey=function(){return this.i_key_};ydn.db.Iterator.prototype.getPrimaryKey=function(){return this.i_primary_key_};
ydn.db.Iterator.prototype.reset=function(a,b,c){a=a||ydn.db.Iterator.State.INITIAL;this.getState()==ydn.db.Iterator.State.WORKING?goog.log.warning(this.logger,this+": resetting state to "+a+" ignore during iteration"):(this.i_key_=b,this.i_primary_key_=c,this.state_=a)};ydn.db.Iterator.prototype.stores=function(){return[this.store_name_]};
ydn.db.Request=function(a,b,c){ydn.async.Deferred.call(this,b,c);this.method_=a;this.progbacks_=[];this.txbacks_=[];this.transformers_=[];this.tx_=null;this.tx_label_="";this.copy_count_=0};goog.inherits(ydn.db.Request,ydn.async.Deferred);ydn.db.Request.DEBUG=!1;ydn.db.Request.prototype.tx_label_="";ydn.db.Request.prototype.logger=goog.log.getLogger("ydn.db.Request");
ydn.db.Request.prototype.setTx=function(a,b){goog.asserts.assert(!this.tx_,"TX already set.");this.tx_=a;this.tx_label_=b;goog.log.finer(this.logger,this+" BEGIN");if(a){for(var c=0;c<this.txbacks_.length;c++)this.txbacks_[c][0].call(this.txbacks_[c][1],a);this.txbacks_.length=0}};ydn.db.Request.prototype.copy=function(){var a=new ydn.db.Request(this.method_);this.copy_count_++;a.setTx(this.tx_,this.tx_label_+"C"+this.copy_count_);return a};
ydn.db.Request.prototype.removeTx=function(){goog.log.finer(this.logger,this+" END");this.tx_=null};ydn.db.Request.prototype.getTx=function(){return this.tx_};ydn.db.Request.prototype.getMethod=function(){return this.method_};ydn.db.Request.prototype.canAbort=function(){return!!this.tx_};
ydn.db.Request.prototype.abort=function(){goog.log.finer(this.logger,this+" aborting "+this.tx_);if(this.tx_)if(goog.isFunction(this.tx_.abort))this.tx_.abort();else if(goog.isFunction(this.tx_.executeSql))this.tx_.executeSql("ABORT",[],function(a,b){},function(a,b){return!0});else throw new ydn.debug.error.NotSupportedException;else throw new ydn.db.InvalidStateError(goog.DEBUG?this+" No active transaction":"");};
ydn.db.Request.prototype.setDbValue=function(a,b){var c=this.transformers_.shift(),d=!!b;if(c){var e=this;c[0].call(c[1],a,d,function(a,b){e.setDbValue(a,b)})}else ydn.db.Request.DEBUG&&goog.global.console.log(this+" receiving "+(d?"fail":"value"),a),d?this.errback(a):this.callback(a)};ydn.db.Request.prototype.await=function(a,b){goog.asserts.assert(!this.hasFired(),"transformer cannot be added after resolved.");this.transformers_.push([a,b])};
ydn.db.Request.prototype.addTxback=function(a,b){this.tx_?a.call(b,this.tx_):this.txbacks_.push([a,b]);return this};ydn.db.Request.prototype.callback=function(a){goog.log.finer(this.logger,this+" SUCCESS");ydn.db.Request.superClass_.callback.call(this,a)};ydn.db.Request.prototype.errback=function(a){goog.log.finer(this.logger,this+" ERROR");ydn.db.Request.superClass_.errback.call(this,a)};ydn.db.Request.prototype.state=function(){return this.hasFired()?this.hadError_?"rejected":"resolved":"pending"};
ydn.db.Request.prototype.dispose_=function(){ydn.db.Request.DEBUG&&goog.global.console.log(this+" dispose ");this.tx_=null;this.tx_label_=this.tx_label_};ydn.db.Request.prototype.getLabel=function(){var a="";this.tx_label_&&(a=this.tx_?"*":"",a="["+this.tx_label_+a+"]");return this.method_+a};ydn.db.Request.succeed=function(a,b){var c=new ydn.db.Request(a);c.setDbValue(b);return c};ydn.db.Request.prototype.toString=function(){return"Request:"+this.getLabel()};
ydn.db.Request.prototype.fire_=function(){this.unhandledErrorId_&&(this.hasFired()&&this.hasErrback_())&&(goog.async.Deferred.unscheduleError_(this.unhandledErrorId_),this.unhandledErrorId_=0);this.parent_&&(this.parent_.branches_--,delete this.parent_);for(var a=this.result_,b=!1,c=!1;this.sequence_.length&&!this.blocked_;){var d=this.sequence_.shift(),e=d[0],f=d[1],d=d[2];if(e=this.hadError_?f:e)e=e.call(d||this.defaultScope_,a),goog.isDef(e)&&(this.hadError_=this.hadError_&&(e==a||this.isError(e)),
this.result_=a=e),goog.Thenable.isImplementedBy(a)&&(this.blocked_=c=!0)}this.result_=a;c?(c=goog.bind(this.continue_,this,!0),e=goog.bind(this.continue_,this,!1),a instanceof goog.async.Deferred?(a.addCallbacks(c,e),a.blocking_=!0):a.then(c,e)):!goog.async.Deferred.STRICT_ERRORS||(!this.isError(a)||a instanceof goog.async.Deferred.CanceledError)||(b=this.hadError_=!0);b&&(this.unhandledErrorId_=goog.async.Deferred.scheduleError_(a))};
ydn.db.Request.prototype.toJSON=function(){var a=(this.tx_label_||"").match(/B(\d+)T(\d+)(?:Q(\d+?))?(?:R(\d+))?/)||[];return{method:this.method_?this.method_.split(":"):[],branchNo:parseFloat(a[1]),transactionNo:parseFloat(a[2]),queueNo:parseFloat(a[3]),requestNo:parseFloat(a[4])}};
ydn.db.Request.Method={ADD:goog.DEBUG?"add":"a",ADDS:goog.DEBUG?"add:array":"b",CLEAR:goog.DEBUG?"clear":"c",COUNT:goog.DEBUG?"count":"d",GET:goog.DEBUG?"get":"e",GET_BY_KEY:goog.DEBUG?"get:key":"ek",GET_ITER:goog.DEBUG?"get:iter":"f",KEYS:goog.DEBUG?"keys":"g",KEYS_ITER:goog.DEBUG?"keys:iter":"h",KEYS_INDEX:goog.DEBUG?"keys:iter:index":"i",LIST:goog.DEBUG?"list":"i2",LOAD:goog.DEBUG?"load":"i3",MAP:goog.DEBUG?"map":"i4",OPEN:goog.DEBUG?"open":"i5",PUT:goog.DEBUG?"put":"j",PUTS:goog.DEBUG?"put:array":
"k",PUT_KEYS:goog.DEBUG?"put:keys":"l",REDUCE:goog.DEBUG?"reduce":"m0",REMOVE_ID:goog.DEBUG?"rm":"m",REMOVE:goog.DEBUG?"rm:iter":"n",REMOVE_KEYS:goog.DEBUG?"rm:keys":"o",REMOVE_INDEX:goog.DEBUG?"rm:iter:index":"p",RUN:goog.DEBUG?"run":"q",SCAN:goog.DEBUG?"scan":"qa",SEARCH:goog.DEBUG?"search":"qb",SQL:goog.DEBUG?"sql":"r",VALUES:goog.DEBUG?"values":"s",VALUES_ITER:goog.DEBUG?"values:iter":"t",VALUES_INDEX:goog.DEBUG?"values:iter:index":"u",VALUES_IDS:goog.DEBUG?"values:array":"v",VALUES_KEYS:goog.DEBUG?
"values:keys":"w",VERSION_CHANGE:goog.DEBUG?"IDBVersionChangeEvent ":"vc",NONE:""};ydn.db.version="0";ydn.db.cmp=ydn.db.base.indexedDb&&ydn.db.base.indexedDb.cmp?goog.bind(ydn.db.base.indexedDb.cmp,ydn.db.base.indexedDb):ydn.db.utils.cmp;ydn.db.databaseDeletors=[];ydn.db.deleteDatabase=function(a,b){for(var c,d=0;d<ydn.db.databaseDeletors.length;d++){var e=ydn.db.databaseDeletors[d](a,b);e&&(c=e)}return c||ydn.db.Request.succeed(ydn.db.Request.Method.VERSION_CHANGE,null)};ydn.db.con={};
ydn.db.con.IStorage=function(){};ydn.db.con.ICursorStream=function(){};
ydn.db.con.IdbCursorStream=function(a,b,c,d){if("transaction"in a)this.db_=a,this.tx_=this.idb_=null;else if("objectStore"in a){if(this.db_=null,this.idb_=a.db,this.tx_=a,goog.DEBUG&&!this.tx_.db.objectStoreNames.contains(b))throw new ydn.error.ArgumentException('store "'+b+'" not in transaction.');}else throw new ydn.error.ArgumentException("storage instance require.");this.store_name_=b;this.index_name_=c;this.sink_=d;this.cursor_=null;this.stack_=[];this.running_=0;this.on_tx_request_=!1};
ydn.db.con.IdbCursorStream.prototype.logger=goog.log.getLogger("ydn.db.con.IdbCursorStream");ydn.db.con.IdbCursorStream.prototype.on_tx_request_=!1;ydn.db.con.IdbCursorStream.prototype.isIndex=function(){return goog.isDefAndNotNull(this.index_name_)};
ydn.db.con.IdbCursorStream.prototype.processRequest_=function(a){this.running_++;var b=this;a.onsuccess=function(a){if(a=a.target.result){if(goog.isFunction(b.sink_)){var d=a.value,d=b.isIndex()?d[b.index_name_]:d;b.sink_(a.primaryKey,d)}else goog.log.warning(b.logger,"sink gone, dropping value for: "+a.primaryKey);if(a&&0<b.stack_.length)a["continue"](b.stack_.shift());else b.running_--,b.clearStack_()}};a.onerror=function(c){goog.log.warning(b.logger,"seeking fail. "+("error"in a?a.error.name+":"+
a.error.message:""));b.running_--;b.clearStack_()}};ydn.db.con.IdbCursorStream.prototype.onFinish=function(a){0==this.stack_.length&&0==this.running_?a():this.collector_=a};
ydn.db.con.IdbCursorStream.prototype.createRequest_=function(){if(!this.on_tx_request_){var a=this,b=function(b,c){a.tx_=null;b!==ydn.db.base.TxEventTypes.COMPLETE&&goog.log.warning(a.logger,c.name+":"+c.message);goog.log.finest(a.logger,a+" transaction "+b)},c=function(b){var c=a.stack_.shift();goog.log.finest(a.logger,a+" transaction started for "+c);b=b.objectStore(a.store_name_);a.processRequest_(b.openCursor(c))};if(this.tx_)goog.log.finest(a.logger,a+" using existing tx."),c(this.tx_);else if(this.idb_)goog.log.finest(a.logger,
a+" creating tx from IDBDatabase."),this.tx=this.idb_.transaction([this.store_name_],ydn.db.base.TransactionMode.READ_ONLY),this.tx.oncomplete=function(a){b(ydn.db.base.TxEventTypes.COMPLETE,a)},this.tx.onerror=function(a){b(ydn.db.base.TxEventTypes.ERROR,a)},this.tx.onabort=function(a){b(ydn.db.base.TxEventTypes.ABORT,a)};else if(this.db_)goog.log.finest(a.logger,a+" creating tx from ydn.db.con.IStorage."),this.on_tx_request_=!0,this.db_.transaction(function(b){a.on_tx_request_=!1;c(b)},[a.store_name_],
ydn.db.base.TransactionMode.READ_ONLY,b);else throw new ydn.error.InternalError(goog.DEBUG?"no way to create a transaction provided.":"");}};ydn.db.con.IdbCursorStream.prototype.clearStack_=function(){if(this.cursor_&&0<this.stack_.length)this.cursor_["continue"](this.stack_.shift());else 0==this.running_&&this.collector_&&this.collector_()};ydn.db.con.IdbCursorStream.prototype.seek=function(a){this.stack_.push(a);this.createRequest_()};
ydn.db.Streamer=function(a,b,c){a&&a instanceof ydn.db.con.Storage?this.db_=a:a&&a.db&&(this.db_=null,this.setTx(a));if(!goog.isString(b))throw new ydn.debug.error.ArgumentException("a store name required.");this.store_name_=b;if(goog.isDef(c)&&!goog.isString(c))throw new ydn.debug.error.ArgumentException("projection index name must be a string.");this.index_name_=c;this.cursor_=null;this.stack_key_=[];this.stack_value_=[];this.is_collecting_=!1};ydn.db.Streamer.prototype.logger=goog.log.getLogger("ydn.db.Streamer");
ydn.db.Streamer.prototype.db_=null;ydn.db.Streamer.prototype.key_only_=!0;ydn.db.Streamer.prototype.storage_=null;ydn.db.Streamer.prototype.sink_=null;ydn.db.Streamer.prototype.getFieldName=function(){return this.index_name_};ydn.db.Streamer.prototype.cursor_=null;ydn.db.Streamer.prototype.isKeyIterator=function(){return this.key_only_};ydn.db.Streamer.prototype.setSink=function(a){this.sink_=a};
ydn.db.Streamer.prototype.setTx=function(a){if(a.db)this.cursor_=new ydn.db.con.IdbCursorStream(a,this.store_name_,this.index_name_,goog.bind(this.collector_,this));else throw new ydn.debug.error.ArgumentException("Invalid IndexedDB Transaction.");};
ydn.db.Streamer.prototype.push_=function(){var a=0<this.stack_value_.length;if(a&&!this.is_collecting_&&goog.isFunction(this.sink_)){var b=this,c=function(){b.push_()},d=this.stack_key_.shift(),e=this.stack_value_.shift(),a=0<this.stack_value_.length,c=this.sink_(d,e,a?c:null);a&&!c&&this.push_()}};ydn.db.Streamer.prototype.is_collecting_=!1;
ydn.db.Streamer.prototype.collect=function(a){if(this.cursor_){this.is_collecting_=!0;var b=this;this.cursor_.onFinish(function(c){a(b.stack_key_,b.stack_value_);b.stack_key_=[];b.stack_value_=[];b.is_collecting_=!1})}else a(this.stack_key_,this.stack_value_),this.stack_key_=[],this.stack_value_=[]};ydn.db.Streamer.prototype.done=function(){if(this.cursor_){var a=new goog.async.Deferred,b=this;this.cursor_.onFinish(function(c){a.callback(b.stack_value_)});return a}return goog.async.Deferred.succeed(this.stack_value_)};
ydn.db.Streamer.prototype.collector_=function(a,b){this.stack_key_.push(a);this.stack_value_.push(b);this.push_()};
ydn.db.Streamer.prototype.push=function(a,b){if(this.is_collecting_)throw new ydn.error.InvalidOperationError(goog.DEBUG?"push not allowed after a collection is started":"");if(2<=arguments.length)this.collector_(a,b);else{if(!this.cursor_){if(!this.db_)throw new ydn.error.InvalidOperationError("Database connection is not setup.");var c=this.db_.getType();if(c)if(c===ydn.db.base.Mechanisms.IDB)this.cursor_=new ydn.db.con.IdbCursorStream(this.db_,this.store_name_,this.index_name_,goog.bind(this.collector_,
this));else throw new ydn.error.NotImplementedException(c);else throw new ydn.error.InvalidOperationError("Database is not connected.");}this.cursor_.seek(a)}};ydn.db.Streamer.prototype.pull=function(a,b){goog.isDef(this.foreign_key_index_name_)?this.key_only_?this.push(b):goog.isDefAndNotNull(b)?this.push(b[this.foreign_key_index_name_]):this.push(void 0,void 0):this.push(a)};ydn.db.Streamer.prototype.setRelation=function(a,b){this.foreign_key_store_name_=a;this.foreign_key_index_name_=b};
ydn.db.Streamer.prototype.getRelation=function(){return[this.foreign_key_store_name_,this.foreign_key_index_name_]};ydn.db.Streamer.prototype.getStoreName=function(){return this.store_name_};ydn.db.Streamer.prototype.getIndexName=function(){return this.index_name_};goog.DEBUG&&(ydn.db.Streamer.prototype.toString=function(){return"Streamer:"+this.store_name_+(this.index_name_||"")});ydn.db.algo={};
ydn.db.algo.AbstractSolver=function(a,b){if(goog.DEBUG&&goog.isDefAndNotNull(a)&&!("push"in a))throw new ydn.error.ArgumentException('output receiver object must have "push" method.');this.out=a||null;this.limit=b;this.match_count=0;this.is_reverse=!1;this.is_duplex_output=a instanceof ydn.db.Streamer&&!!a.getFieldName()};ydn.db.algo.AbstractSolver.prototype.logger=goog.log.getLogger("ydn.db.algo.AbstractSolver");
ydn.db.algo.AbstractSolver.prototype.begin=function(a,b,c){this.is_reverse=b[0].isReversed();if(goog.DEBUG)for(c=0;c<b.length;c++){if(!(b[c]instanceof ydn.db.Iterator))throw new ydn.debug.error.TypeError("item at iterators "+c+" is not an iterator.");if(0<c&&this.is_reverse!=b[c].isReversed())throw new ydn.debug.error.TypeError("iterator at "+c+" must "+(this.is_reverse?"be reverse":"not be reverse"));}this.out instanceof ydn.db.Streamer&&this.out.setTx(a);if(this.is_duplex_output&&(a=b[0].getIndexKeyPath())&&
1<a.length&&a[a.length-1]!=this.out.getFieldName())throw new ydn.error.InvalidOperationError("Output streamer projection field must be same as postfix field in the iterator");a="{";for(c=0;c<b.length;c++)0<c&&(a+=", "),a+=b.toString();a+="}";this.is_reverse&&(a+=" reverse");goog.log.fine(this.logger,this+" begin "+a);return!1};
ydn.db.algo.AbstractSolver.prototype.pusher=function(a,b,c,d,e){b=goog.isDefAndNotNull(d);if(!goog.isDef(d)){d=c[0];b=goog.isDefAndNotNull(d);for(var f=1;b&&f<c.length;f++)goog.isDefAndNotNull(c[f])&&0==ydn.db.cmp(c[f],d)||(b=!1)}return b&&(this.match_count++,this.out&&(this.is_duplex_output?this.out.push(d,e):this.out.push(d)),goog.isDef(this.limit)&&this.match_count>=this.limit)?[]:a};ydn.db.algo.AbstractSolver.prototype.solver=function(a,b){return[]};
ydn.db.algo.AbstractSolver.prototype.finish=function(a){return!1};ydn.db.ConstraintError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.ConstraintError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ConstraintError"};goog.inherits(ydn.db.ConstraintError,Error);ydn.db.ConstraintError.prototype.name="ConstraintError";goog.DEBUG&&(ydn.db.ConstraintError.prototype.toString=function(){return this.name+": "+this.message});
ydn.db.InvalidKeyException=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.InvalidKeyException):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.InvalidKeyException"};goog.inherits(ydn.db.InvalidKeyException,Error);goog.DEBUG&&(ydn.db.InvalidKeyException.prototype.toString=function(){return this.name+": "+this.message});
ydn.db.VersionError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.VersionError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.VersionError"};goog.inherits(ydn.db.VersionError,Error);ydn.db.VersionError.prototype.name="ydn.db.VersionError";goog.DEBUG&&(ydn.db.VersionError.prototype.toString=function(){return this.name+": "+this.message});
ydn.db.InternalError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.InternalError):this.stack=Error().stack||"";a&&(this.message=String(a))};goog.inherits(ydn.db.InternalError,Error);ydn.db.InternalError.prototype.name="ydn.db.InternalError";ydn.db.ScopeError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.ScopeError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.ScopeError"};goog.inherits(ydn.db.ScopeError,Error);
ydn.db.InvalidStateError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.InvalidStateError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="InvalidStateError"};goog.inherits(ydn.db.InvalidStateError,Error);ydn.db.InvalidAccessError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.InvalidAccessError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="InvalidAccessError"};goog.inherits(ydn.db.InvalidAccessError,Error);
ydn.db.NotFoundError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.NotFoundError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="NotFoundError"};goog.inherits(ydn.db.NotFoundError,Error);ydn.db.NotFoundError.prototype.name="NotFoundError";goog.DEBUG&&(ydn.db.NotFoundError.prototype.toString=function(){return this.name+": "+this.message});
ydn.db.DataCloneError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.DataCloneError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="DataCloneError"};goog.inherits(ydn.db.DataCloneError,Error);goog.DEBUG&&(ydn.db.DataCloneError.prototype.toString=function(){return this.name+": "+this.message});
ydn.db.SQLError=function(a,b){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.SQLError):this.stack=Error().stack||"";b&&(this.message=String(b));this.message+=" :"+a.message+" ["+a.code+"]";this.name="SQLError"};goog.inherits(ydn.db.SQLError,Error);goog.DEBUG&&(ydn.db.SQLError.prototype.toString=function(){return this.name+": "+this.message});
ydn.db.SecurityError=function(a,b){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.SecurityError):this.stack=Error().stack||"";b&&(this.message=String(b));this.message+=" :"+a.message;this.name="SecurityError"};goog.inherits(ydn.db.SecurityError,Error);goog.DEBUG&&(ydn.db.SecurityError.prototype.toString=function(){return this.name+": "+this.message});
ydn.db.SqlParseError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.SqlParseError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.SqlParseError"};goog.inherits(ydn.db.SqlParseError,Error);ydn.db.TimeoutError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.TimeoutError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.db.TimeoutError"};goog.inherits(ydn.db.TimeoutError,Error);
ydn.db.TxError=function(a,b){Error.captureStackTrace?Error.captureStackTrace(this,ydn.db.TxError):this.stack=Error().stack||"";b&&(this.message=String(b));this.name="TxError";this.result=a};goog.inherits(ydn.db.TxError,Error);ydn.db.TxError.prototype.getResult=function(){return this.result};ydn.db.TxAbortedError=function(a,b){ydn.db.TxError.call(this,a,b);this.name="TxAbortedError"};goog.inherits(ydn.db.TxAbortedError,ydn.db.TxError);
ydn.db.Key=function(a,b,c){var d;if(goog.isObject(a))d=a.store,b=a.id,goog.isDefAndNotNull(a.parent)&&(c=new ydn.db.Key(a.parent));else if(goog.asserts.assertString(a,"store name of a key object must be a string"),goog.isDef(b))d=a;else if(d=a.lastIndexOf(ydn.db.Key.SEP_PARENT),b=a,0<d&&(b=a.substr(d),c=new ydn.db.Key(a.substring(0,d))),b=b.split(ydn.db.Key.SEP_STORE),d=b[0],b=b[1],!goog.isDef(b))throw Error("Invalid key value: "+a);this.store_name=d;this.id=b;this.parent=c||null};var IDBKey;
ydn.db.Key.prototype.toJSON=function(){var a={store:this.store_name,id:this.id};this.parent&&(a.parent=this.parent.toJSON());return a};ydn.db.Key.SEP_PARENT="^|";ydn.db.Key.SEP_STORE="^:";ydn.db.Key.prototype.valueOf=function(){return(this.parent?this.parent.valueOf()+ydn.db.Key.SEP_PARENT:"")+this.store_name+ydn.db.Key.SEP_STORE+this.id};ydn.db.Key.prototype.toString=function(){return this.valueOf().replace("^|","|").replace("^:",":")};ydn.db.Key.prototype.getStoreName=function(){return this.store_name};
ydn.db.Key.prototype.getId=function(){return this.id};ydn.db.Key.prototype.getNormalizedId=function(){return goog.isArray(this.id)?this.id.join(ydn.db.Key.SEP_PARENT):this.id instanceof Date?+this.id:this.id};ydn.db.Key.prototype.getParent=function(){return this.parent};ydn.db.Key.isValidKey=function(a){return goog.isDefAndNotNull(a)?goog.isNumber(a)||goog.isString(a)||a instanceof Date||goog.isArray(a)&&goog.array.every(a,ydn.db.Key.isValidKey):!1};
ydn.db.Key.clone=function(a){if(goog.isArrayLike(a)){for(var b=[],c=0,d=a.length;c<d;c++)b[c]=a[c];return b}return a};ydn.db.crud={};ydn.db.crud.req={};ydn.db.crud.req.RequestExecutor=function(a,b){this.dbname=a;this.schema=b};ydn.db.crud.req.RequestExecutor.prototype.logger=goog.log.getLogger("ydn.db.crud.req.RequestExecuto");goog.DEBUG&&(ydn.db.crud.req.RequestExecutor.prototype.toString=function(){return"RequestExecutor"});ydn.db.crud.IOperator=function(){};ydn.db.core.IOperator=function(){};
ydn.db.crud.req.ListType={};ydn.db.crud.req.IRequestExecutor=function(){};ydn.db.core.req.IRequestExecutor=function(){};ydn.db.tr={};ydn.db.tr.Mutex=function(a){this.tr_no=a;this.tx_=null;this.tx_count_=0};ydn.db.tr.Mutex.prototype.logger=goog.log.getLogger("ydn.db.tr.Mutex");ydn.db.tr.Mutex.DEBUG=!1;
ydn.db.tr.Mutex.prototype.up=function(a,b,c){ydn.db.tr.Mutex.DEBUG&&goog.global.console.log(this+": up");goog.asserts.assert(!this.tx_,this+": transaction overlap");this.tx_=a;this.out_of_scope_=this.is_locked_=!1;this.store_names=b;this.mode=c;this.tx_count_++;this.oncompleted=null};ydn.db.tr.Mutex.prototype.store_names=null;
ydn.db.tr.Mutex.prototype.sameScope=function(a,b){if(!this.store_names||!this.mode||b!=this.mode||this.store_names.length!=a.length)return!1;for(var c=0;c<a.length;c++)if(-1==this.store_names.indexOf(a[c]))return!1;return!0};
ydn.db.tr.Mutex.prototype.subScope=function(a,b){if(!this.store_names||!this.mode||b!=this.mode&&(this.mode!=ydn.db.base.TransactionMode.READ_WRITE||b!=ydn.db.base.TransactionMode.READ_ONLY)||a.length>this.store_names.length)return!1;for(var c=0;c<a.length;c++)if(-1==this.store_names.indexOf(a[c]))return!1;return!0};
ydn.db.tr.Mutex.prototype.down=function(a,b){if(this.tx_){ydn.db.tr.Mutex.DEBUG&&goog.global.console.log(this+": down");this.mode=this.store_names=this.tx_=null;if(goog.isFunction(this.oncompleted))this.oncompleted(a,b);this.oncompleted=null}else goog.log.warning(this.logger,this+" has no TX to be unlocked for "+a)};ydn.db.tr.Mutex.prototype.out=function(){this.out_of_scope_=!0};ydn.db.tr.Mutex.prototype.inScope=function(){return!this.out_of_scope_};
ydn.db.tr.Mutex.prototype.lock=function(){ydn.db.tr.Mutex.DEBUG&&goog.global.console.log(this+": locked");this.is_locked_=!0};ydn.db.tr.Mutex.prototype.getTxCount=function(){return this.tx_count_};ydn.db.tr.Mutex.prototype.isLocked=function(){return this.is_locked_};ydn.db.tr.Mutex.prototype.isActive=function(){return!!this.tx_};ydn.db.tr.Mutex.prototype.isAvailable=function(){return!this.is_locked_};ydn.db.tr.Mutex.prototype.isActiveAndAvailable=function(){return this.isActive()&&this.isAvailable()};
ydn.db.tr.Mutex.prototype.oncompleted=null;ydn.db.tr.Mutex.prototype.getTx=function(){return this.tx_};ydn.db.tr.Mutex.prototype.getLabel=function(){return"B"+this.tr_no+"T"+this.tx_count_};goog.DEBUG&&(ydn.db.tr.Mutex.prototype.toString=function(){var a=this.tx_?"*":"";return"Mutex:"+this.getLabel()+a});
ydn.db.tr.Thread=function(a,b,c,d,e,f){this.storage_=a;this.q_no_=b;this.r_no_=this.tx_no_=0;this.scope_store_names=d;this.scope_mode=e;this.policy=c||ydn.db.tr.Thread.Policy.SINGLE;this.max_tx_no=f||0;this.break_tx_=!1;this.yield_no_=0};ydn.db.tr.Thread.prototype.logger=goog.log.getLogger("ydn.db.tr.Thread");ydn.db.tr.Thread.prototype.getTxNo=function(){return this.tx_no_};ydn.db.tr.Thread.prototype.type=function(){return this.storage_.getType()};ydn.db.tr.Thread.prototype.getQueueNo=function(){return this.q_no_};
ydn.db.tr.Thread.prototype.addStoreSchema=function(a){return this.storage_.addStoreSchema(a)};ydn.db.tr.Thread.prototype.getStorage=function(){return this.storage_};ydn.db.tr.Thread.prototype.getLabel=function(){return"B"+this.q_no_+"T"+this.tx_no_};ydn.db.tr.Thread.Policy={MULTI:"multi",REPEAT:"repeat",ALL:"all",ATOMIC:"atomic",SINGLE:"single"};
ydn.db.tr.Thread.abort=function(a){if(a)if(goog.isFunction(a.abort))a.abort();else if(goog.isFunction(a.executeSql))a.executeSql("ABORT",[],null,function(a,c){return!0});else throw new ydn.debug.error.NotSupportedException;else throw new ydn.db.InvalidStateError("No active transaction");};
ydn.db.tr.Serial=function(a,b,c,d,e,f){ydn.db.tr.Thread.call(this,a,b,c,d,e,f);this.trQueue_=[];this.completed_handlers_=[];this.s_request_tx=null;this.mu_tx_=new ydn.db.tr.Mutex(b);this.max_tx_no_=f||0;this.has_tx_started_=!1};goog.inherits(ydn.db.tr.Serial,ydn.db.tr.Thread);ydn.db.tr.Serial.DEBUG=!1;ydn.db.tr.Serial.prototype.logger=goog.log.getLogger("ydn.db.tr.Serial");ydn.db.tr.Serial.prototype.getMuTx=function(){return this.mu_tx_};
ydn.db.tr.Serial.prototype.getActiveTx=function(){return this.mu_tx_.isActiveAndAvailable()?this.mu_tx_:null};ydn.db.tr.Serial.prototype.isActive=function(){return this.mu_tx_.isActiveAndAvailable()};ydn.db.tr.Serial.prototype.reusedTx=function(a,b){return this.policy==ydn.db.tr.Thread.Policy.MULTI?this.mu_tx_.subScope(a,b):this.policy==ydn.db.tr.Thread.Policy.REPEAT?this.mu_tx_.sameScope(a,b):this.policy==ydn.db.tr.Thread.Policy.ALL?!0:!1};
ydn.db.tr.Serial.prototype.getTx=function(){return this.mu_tx_.isActiveAndAvailable()?this.mu_tx_.getTx():null};ydn.db.tr.Serial.prototype.lock=function(){this.mu_tx_.lock()};ydn.db.tr.Serial.MAX_QUEUE=1E3;ydn.db.tr.Serial.prototype.popTxQueue_=function(){var a=this.trQueue_.shift();a&&(ydn.db.tr.Serial.DEBUG&&goog.log.finest(this.logger,"pop tx queue["+this.trQueue_.length+"]"),this.processTx(a.fnc,a.store_names,a.mode,a.oncompleted))};
ydn.db.tr.Serial.prototype.peekScopes=function(){return 0<this.trQueue_.length?this.trQueue_[0].store_names:null};ydn.db.tr.Serial.prototype.peekMode=function(){return 0<this.trQueue_.length?this.trQueue_[0].mode:null};ydn.db.tr.Serial.prototype.isNextTxCompatible=function(){var a=this.peekScopes(),b=this.peekMode();return goog.isDefAndNotNull(a)&&goog.isDefAndNotNull(b)?this.reusedTx(a,b):!1};
ydn.db.tr.Serial.prototype.pushTxQueue=function(a,b,c,d){goog.log.finest(this.logger,"push tx queue["+this.trQueue_.length+"]");this.trQueue_.push({fnc:a,store_names:b,mode:c,oncompleted:d})};ydn.db.tr.Serial.prototype.abort=function(){goog.log.finer(this.logger,this+": aborting");ydn.db.tr.Thread.abort(this.s_request_tx)};
ydn.db.tr.Serial.prototype.processTx=function(a,b,c,d){var e=goog.isString(b)?[b]:b;if(goog.DEBUG)if(goog.isArrayLike(e)){if(0==e.length)throw new ydn.debug.error.ArgumentException("number of store names must more than 0");for(var f=0;f<e.length;f++){if(!goog.isString(e[f]))throw new ydn.debug.error.ArgumentException("store name at "+f+" must be string but found "+e[f]+" of type "+typeof e[f]);if(this.scope_store_names_&&!goog.array.contains(this.scope_store_names_,e[f]))throw new ydn.debug.error.ArgumentException('store name "'+
f+e[f]+'" in scope of '+this);}}else throw new ydn.debug.error.ArgumentException("store names must be an array");var g=goog.isDef(c)?c:ydn.db.base.TransactionMode.READ_ONLY,h=this;if(this.mu_tx_.isActive()||!this.getStorage().isReady()&&this.has_tx_started_)this.pushTxQueue(a,b,g,d);else{var k=this.getLabel();d&&this.completed_handlers_.push(d);if(this.max_tx_no_&&this.getTxNo()>=this.max_tx_no_)throw new ydn.debug.error.InvalidOperationException("Exceed maximum number of transactions of "+this.max_tx_no_);
this.has_tx_started_=!0;this.getStorage().transaction(function(c){h.mu_tx_.up(c,b,g);k=h.getLabel();goog.log.fine(h.logger,k+" BEGIN "+ydn.json.stringify(b)+" "+g);a(h);a=null;for(h.mu_tx_.out();h.isNextTxCompatible();)c=h.trQueue_.shift(),c.oncompleted&&h.completed_handlers_.push(c.oncompleted),goog.log.finest(h.logger,"pop tx queue"+(h.trQueue_.length+1)+" reusing T"+h.getTxNo()),c.fnc()},e,g,function(a,b){goog.log.fine(h.logger,k+" "+a);h.mu_tx_.down(a,b);for(var c=0;c<h.completed_handlers_.length;c++)(0,h.completed_handlers_[c])(a,
b);h.completed_handlers_.length=0;h.popTxQueue_();h.r_no_=0})}};ydn.db.tr.Serial.prototype.getLabel=function(){return this.mu_tx_.getLabel()};
ydn.db.tr.Serial.prototype.request=function(a,b,c,d){var e=new ydn.db.Request(a);c=c||ydn.db.base.TransactionMode.READ_ONLY;var f=this;a=function(a,b){e.removeTx();d&&d(a,b)};this.mu_tx_.isActiveAndAvailable()&&this.reusedTx(b,c)?(b=this.mu_tx_.getTx(),this.r_no_++,e.setTx(b,this.getLabel()+"R"+this.r_no_),this.completed_handlers_.push(a)):f.processTx(function(a){a=f.mu_tx_.getTx();f.r_no_++;e.setTx(a,f.getLabel()+"R"+f.r_no_)},b,c,a);return e};
ydn.db.tr.Serial.prototype.exec=function(a,b,c,d,e){d=d||ydn.db.base.TransactionMode.READ_ONLY;var f=this,g;if(f.mu_tx_.isActiveAndAvailable()&&this.reusedTx(c,d)){var h=f.mu_tx_.getTx();f.r_no_++;g=f.getLabel()+"R"+f.r_no_;goog.log.finer(f.logger,g+" BEGIN");b(h,g,function(b,c){f.s_request_tx=h;c?(goog.log.finer(f.logger,g+" ERROR"),a.errback(b)):(goog.log.finer(f.logger,g+" SUCCESS"),a.callback(b));f.s_request_tx=null});goog.log.finer(f.logger,g+" END");b=null}else f.processTx(function(c){var d=
f.mu_tx_.getTx();f.r_no_++;g=f.getLabel()+"R"+f.r_no_;goog.log.finer(f.logger,g+" BEGIN");b(d,g,function(b,c){f.s_request_tx=d;c?(goog.log.finer(f.logger,g+" ERROR"),a.errback(b)):(goog.log.finer(f.logger,g+" SUCCESS"),a.callback(b));f.s_request_tx=null});goog.log.finer(f.logger,g+" END");b=null},c,d,e)};ydn.db.tr.Serial.prototype.getName=function(){return this.getStorage().getName()};
goog.DEBUG&&(ydn.db.tr.Serial.prototype.toString=function(){var a=this.s_request_tx?"*":"";return"Serial:"+this.getLabel()+a});ydn.db.tr.AtomicSerial=function(a,b){ydn.db.tr.Serial.call(this,a,b)};goog.inherits(ydn.db.tr.AtomicSerial,ydn.db.tr.Serial);ydn.db.tr.AtomicSerial.DEBUG=!1;ydn.db.tr.AtomicSerial.prototype.logger=goog.log.getLogger("ydn.db.tr.AtomicSerial");
ydn.db.tr.AtomicSerial.prototype.request=function(a,b,c){var d,e,f,g=ydn.db.tr.AtomicSerial.superClass_.request.call(this,a,b,c,function(a,b){g.removeTx();if(d)a!=ydn.db.base.TxEventTypes.COMPLETE&&(f=!0,e=b),d(e,f);else{var c=new ydn.db.TimeoutError;g.setDbValue(c,!0)}});g.await(function(a,b,c){f=b;e=a;d=c});return g};
ydn.db.tr.AtomicSerial.prototype.exec=function(a,b,c,d,e){var f,g,h=new goog.async.Deferred;h.addCallbacks(function(a){g=!1;f=a},function(a){g=!0;f=a});ydn.db.tr.AtomicSerial.superClass_.exec.call(this,h,b,c,d,function(b,c){if(b!=ydn.db.base.TxEventTypes.COMPLETE)a.errback(c);else if(!0===g)a.errback(f);else if(!1===g)a.callback(f);else{var d=new ydn.db.TimeoutError;a.errback(d)}e&&(e(b,c),e=void 0)})};goog.DEBUG&&(ydn.db.tr.AtomicSerial.prototype.toString=function(){return"Atomic"+ydn.db.tr.AtomicSerial.superClass_.toString.call(this)});
ydn.db.tr.DbOperator=function(a,b,c,d){this.storage_=a;this.schema=b;this.tx_thread=c;this.sync_thread=d;this.executor=null};ydn.db.tr.DbOperator.prototype.logger=goog.log.getLogger("ydn.db.tr.DbOperator");ydn.db.tr.DbOperator.prototype.getTxNo=function(){return this.tx_thread.getTxNo()};ydn.db.tr.DbOperator.prototype.abort=function(){this.tx_thread.abort()};ydn.db.tr.DbOperator.prototype.getExecutor=function(){this.executor||(this.executor=this.storage_.newExecutor());return this.executor};
ydn.db.tr.DbOperator.prototype.getStorage=function(){return this.storage_};ydn.db.tr.DbOperator.prototype.addStoreSchema=function(a){return this.getStorage().addStoreSchema(a)};goog.DEBUG&&(ydn.db.tr.DbOperator.prototype.toString=function(){return"TxStorage:"+this.getStorage().getName()});ydn.db.crud.DbOperator=function(a,b,c,d){ydn.db.tr.DbOperator.call(this,a,b,c,d)};goog.inherits(ydn.db.crud.DbOperator,ydn.db.tr.DbOperator);ydn.db.crud.DbOperator.prototype.logger=goog.log.getLogger("ydn.db.crud.DbOperator");
ydn.db.crud.DbOperator.prototype.getCrudExecutor=function(){return this.getExecutor()};
ydn.db.crud.DbOperator.prototype.count=function(a,b,c,d){var e,f,g,h;if(goog.isDefAndNotNull(a))if(goog.isArray(a)){if(goog.isDef(c)||goog.isDef(b))throw new ydn.debug.error.ArgumentException("too many arguments.");f=a;for(var k=0;k<f.length;k++)if(!this.schema.hasStore(f[k]))throw new ydn.debug.error.ArgumentException('store name "'+f[k]+'" at '+k+" not found.");goog.log.finer(this.logger,"countStores: "+ydn.json.stringify(f));e=this.tx_thread.request(ydn.db.Request.Method.COUNT,f);e.addTxback(function(){this.getCrudExecutor().countStores(e,
f)},this)}else if(goog.isString(a)){k=this.schema.getStore(a);if(!k)throw new ydn.debug.error.ArgumentException('store name "'+a+'" not found.');if(goog.DEBUG&&goog.isDef(d)&&!goog.isBoolean(d))throw new ydn.debug.error.ArgumentException('unique value "'+d+'" must be boolean, but found '+typeof d+".");f=[a];if(goog.isString(b))if(g=b,goog.isObject(c)){if(goog.DEBUG){var l=ydn.db.KeyRange.validate(c);if(l)throw new ydn.debug.error.ArgumentException("invalid key range: "+ydn.json.toShortString(c)+" "+
l);}h=ydn.db.KeyRange.parseIDBKeyRange(c)}else{if(goog.DEBUG&&goog.isDefAndNotNull(c))throw new ydn.debug.error.ArgumentException("invalid key range: "+ydn.json.toShortString(c)+" of type "+typeof c);h=null}else if(goog.isObject(b)||!goog.isDefAndNotNull(b))if(goog.isObject(b)){if(goog.DEBUG&&(l=ydn.db.KeyRange.validate(b)))throw new ydn.debug.error.ArgumentException("invalid key range: "+ydn.json.toShortString(b)+" "+l);h=ydn.db.KeyRange.parseIDBKeyRange(b)}else{if(goog.isDefAndNotNull(b))throw new ydn.debug.error.ArgumentException("key range must be  an object but found "+
ydn.json.toShortString(b)+" of type "+typeof b);h=null}else throw new ydn.debug.error.ArgumentException('invalid second argument for count "'+ydn.json.toShortString(c)+'" of type '+typeof b);goog.log.finer(this.logger,"countKeyRange: "+a+" "+(g?g:"")+ydn.json.stringify(h));e=this.tx_thread.request(ydn.db.Request.Method.COUNT,f);k.hook(e,arguments);e.addTxback(function(a){this.getCrudExecutor().countKeyRange(e,f[0],h,g,!!d)},this)}else throw new ydn.debug.error.ArgumentException("Invalid store name or store names.");
else goog.log.warning(this.logger,"count method requires store name(s)"),k=this.schema.getStoreNames(),e=this.tx_thread.request(ydn.db.Request.Method.COUNT,k),e.await(function(a,b,c){if(b)c(a,!0);else{for(var d=b=0;d<a.length;d++)b+=a[d];c(b,!1)}},this),e.addTxback(function(){this.getCrudExecutor().countStores(e,f)},this);return e};
ydn.db.crud.DbOperator.prototype.get=function(a,b){var c=this,d;if(a instanceof ydn.db.Key){var e=a,f=e.getStoreName(),g=this.schema.getStore(f);if(!g){if(this.schema.isAutoSchema()){if(this.getStorage().isReady())return ydn.db.Request.succeed(ydn.db.Request.Method.GET,void 0);d=new ydn.db.Request(ydn.db.Request.Method.GET);this.getStorage().onReady(function(){c.get(a,b).addCallbacks(function(a){d.callback(a)},function(a){d.errback(a)})});return d}throw new ydn.debug.error.ArgumentException("Store: "+
f+" not found.");}var h=e.getId();goog.log.finer(this.logger,"getByKey: "+f+":"+h);d=this.tx_thread.request(ydn.db.Request.Method.GET_BY_KEY,[f]);g.hook(d,arguments,void 0,this);d.addTxback(function(){this.getCrudExecutor().getById(d,f,h)},this)}else if(goog.isString(a)&&goog.isDef(b)){var k=a,g=this.schema.getStore(k);if(!g){if(this.schema.isAutoSchema()){if(this.getStorage().isReady())return ydn.db.Request.succeed(ydn.db.Request.Method.GET,void 0);d=new ydn.db.Request(ydn.db.Request.Method.GET);
this.getStorage().onReady(function(){c.get(a,b).addCallbacks(function(a){d.callback(a)},function(a){d.errback(a)})});return d}throw new ydn.debug.error.ArgumentException('Store name "'+k+'" not found.');}var l=b;goog.asserts.assert(ydn.db.Key.isValidKey(l),"key "+l+" of type "+typeof l+" is not a valid key");goog.log.finer(this.logger,"getById: "+k+":"+l);d=this.tx_thread.request(ydn.db.Request.Method.GET,[k]);g.hook(d,arguments,void 0,this);d.addTxback(function(){this.getCrudExecutor().getById(d,
k,l)},this)}else throw new ydn.debug.error.ArgumentException("get require valid input arguments.");return d};
ydn.db.crud.DbOperator.prototype.keysByKeyRange=function(a,b,c,d,e){var f=this.schema.getStore(a),g,h,k,l=null;if(goog.isObject(b)){if(goog.DEBUG){var m=ydn.db.KeyRange.validate(b);if(m)throw new ydn.debug.error.ArgumentException("invalid key range: "+b+" "+m);}l=ydn.db.KeyRange.parseIDBKeyRange(b)}else if(goog.DEBUG&&goog.isDefAndNotNull(b))throw new ydn.debug.error.ArgumentException('expect key range object, but found "'+ydn.json.toShortString(b)+'" of type '+typeof b);if(goog.isDef(c))if(goog.isNumber(c))g=
c;else throw new ydn.debug.error.ArgumentException("limit must be a number, but "+c+" is "+typeof c);else g=ydn.db.base.DEFAULT_RESULT_LIMIT;if(goog.isDef(d))if(goog.isNumber(d))h=d;else throw new ydn.debug.error.ArgumentException("offset must be a number, but "+d+" is "+typeof d);else h=0;if(goog.isDef(e))if(goog.isBoolean(e))k=e;else throw new ydn.debug.error.ArgumentException("reverse must be a boolean, but "+e+" is "+typeof e);goog.log.finer(this.logger,"keysByKeyRange: "+a);var n=this.tx_thread.request(ydn.db.Request.Method.KEYS,
[a]);f.hook(n,arguments);n.addTxback(function(){this.getCrudExecutor().list(n,ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,a,null,l,g,h,k,!1)},this);return n};
ydn.db.crud.DbOperator.prototype.keysByIndexKeyRange=function(a,b,c,d,e,f,g){var h,k,l,m,n;if(goog.DEBUG){var p=ydn.db.KeyRange.validate(c);if(p)throw new ydn.debug.error.ArgumentException("invalid key range: "+c+" "+p);}p=this.schema.getStore(a);h=ydn.db.KeyRange.parseIDBKeyRange(c);if(goog.isNumber(d))k=d;else{if(goog.isDef(d))throw new ydn.debug.error.ArgumentException("limit must be a number");k=ydn.db.base.DEFAULT_RESULT_LIMIT}if(goog.isNumber(e))l=e;else{if(goog.isDef(e))throw new ydn.debug.error.ArgumentException("offset must be a number");
l=0}if(goog.isDef(f))if(goog.isBoolean(f))m=f;else throw new ydn.debug.error.ArgumentException("reverse must be a boolean");if(goog.isDef(g))if(goog.isBoolean(g))n=g;else throw new ydn.debug.error.ArgumentException("unique must be a boolean");goog.log.finer(this.logger,"keysByIndexKeyRange: "+a);var q=this.tx_thread.request(ydn.db.Request.Method.KEYS_INDEX,[a]);p.hook(q,arguments);q.addTxback(function(){this.getCrudExecutor().list(q,ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,a,b,h,k,l,m,n)},this);return q};
ydn.db.crud.DbOperator.prototype.keys=function(a,b,c,d,e,f,g){var h=this.schema.getStore(a);if(goog.DEBUG){if(!goog.isString(a))throw new ydn.debug.error.ArgumentException("store name must be a string, but "+a+" of type "+typeof a+" is not.");if(!this.schema.isAutoSchema()){if(!h)throw new ydn.debug.error.ArgumentException('store name "'+a+'" not found.');if(goog.isString(b)&&!h.getIndex(b))throw new ydn.debug.error.ArgumentException('index "'+b+'" not found in store "'+a+'".');}}return this.schema.isAutoSchema()&&
!h?ydn.db.Request.succeed(ydn.db.Request.Method.KEYS,[]):goog.isString(b)?this.keysByIndexKeyRange(a,b,c,d,e,f,g):this.keysByKeyRange(a,b,c,d,e)};
ydn.db.crud.DbOperator.prototype.values=function(a,b,c,d,e,f,g){var h=this,k;if(goog.isString(a)){var l=a,m=this.schema.getStore(l);if(!m){if(this.schema.isAutoSchema()){if(this.getStorage().isReady())return ydn.db.Request.succeed(ydn.db.Request.Method.VALUES,[]);k=new ydn.db.Request(ydn.db.Request.Method.VALUES);this.getStorage().onReady(function(){h.values(a,b,c,d,e,f).addCallbacks(function(a){k.callback(a)},function(a){k.errback(a)})});return k}throw new ydn.db.NotFoundError(l);}if(goog.isArray(b)){if(goog.DEBUG&&
(goog.isDef(c)||goog.isDef(d)))throw new ydn.debug.error.ArgumentException("too many input arguments");var n=b;goog.log.finer(this.logger,"listByIds: "+l+" "+n.length+" ids");k=this.tx_thread.request(ydn.db.Request.Method.VALUES_IDS,[l]);m.hook(k,arguments,void 0,this);k.addTxback(function(){this.getCrudExecutor().listByIds(k,l,n)},this)}else k=goog.isString(b)?this.valuesByIndexKeyRange(l,b,c,d,e,f,g):this.valuesByKeyRange(l,b,c,d,e)}else if(goog.isArray(a))if(a[0]instanceof ydn.db.Key){for(var m=
[],p=a,q=0;q<p.length;q++){var r=p[q].getStoreName();if(!this.schema.hasStore(r)){if(this.schema.isAutoSchema())return m=[],m[p.length-1]=void 0,ydn.db.Request.succeed(ydn.db.Request.Method.GET,m);throw new ydn.debug.error.ArgumentException("Store: "+r+" not found.");}goog.array.contains(m,r)||m.push(r)}goog.log.finer(this.logger,"listByKeys: "+ydn.json.stringify(m)+" "+p.length+" keys");k=this.tx_thread.request(ydn.db.Request.Method.VALUES_KEYS,m);k.addTxback(function(){this.getCrudExecutor().listByKeys(k,
p)},this)}else throw new ydn.debug.error.ArgumentException("first argumentmust be array of ydn.db.Key, but "+a[0]+" of "+typeof a[0]+" found.");else throw new ydn.debug.error.ArgumentException("first argument "+a+" is invalid.");return k};
ydn.db.crud.DbOperator.prototype.valuesByKeyRange=function(a,b,c,d,e){var f=this.schema.getStore(a),g,h,k,l=null;if(goog.isObject(b)){if(goog.DEBUG){var m=ydn.db.KeyRange.validate(b);if(m)throw new ydn.debug.error.ArgumentException("invalid key range: "+b+" "+m);}l=ydn.db.KeyRange.parseIDBKeyRange(b)}else if(goog.DEBUG&&goog.isDefAndNotNull(b))throw new ydn.debug.error.ArgumentException('expect key range object, but found "'+ydn.json.toShortString(b)+'" of type '+typeof b);if(goog.isDef(c))if(goog.isNumber(c))g=
c;else throw new ydn.debug.error.ArgumentException("limit must be a number, but "+c+" is "+typeof c);else g=ydn.db.base.DEFAULT_RESULT_LIMIT;if(goog.isDef(d))if(goog.isNumber(d))h=d;else throw new ydn.debug.error.ArgumentException("offset must be a number, but "+d+" is "+typeof d);else h=0;if(goog.isDef(e))if(goog.isBoolean(e))k=e;else throw new ydn.debug.error.ArgumentException("reverse must be a boolean, but "+e+" is "+typeof e);goog.log.finer(this.logger,(l?"listByKeyRange: ":"listByStore: ")+
a);var n=this.tx_thread.request(ydn.db.Request.Method.VALUES,[a]);f.hook(n,arguments);n.addTxback(function(){this.getCrudExecutor().list(n,ydn.db.base.QueryMethod.LIST_VALUE,a,null,l,g,h,k,!1)},this);return n};
ydn.db.crud.DbOperator.prototype.valuesByIndexKeyRange=function(a,b,c,d,e,f,g){var h=this.schema.getStore(a),k,l,m,n;if(goog.DEBUG){if(!h.hasIndex(b))throw new ydn.debug.error.ArgumentException('index "'+b+'" not found in store "'+a+'"');var p=ydn.db.KeyRange.validate(c);if(p)throw new ydn.debug.error.ArgumentException("invalid key range: "+c+" "+p);}var q=ydn.db.KeyRange.parseIDBKeyRange(c);if(goog.isDef(d))if(goog.isNumber(d))k=d;else throw new ydn.debug.error.ArgumentException("limit must be a number.");
else k=ydn.db.base.DEFAULT_RESULT_LIMIT;if(goog.isDef(e))if(goog.isNumber(e))l=e;else throw new ydn.debug.error.ArgumentException("offset must be a number.");else l=0;if(goog.isBoolean(f))m=f;else if(goog.isDef(f))throw new ydn.debug.error.ArgumentException("reverse must be a boolean, but "+f);if(goog.isDef(g))if(goog.isBoolean(g))n=g;else throw new ydn.debug.error.ArgumentException("unique must be a boolean");goog.log.finer(this.logger,"listByIndexKeyRange: "+a+":"+b);var r=this.tx_thread.request(ydn.db.Request.Method.VALUES_INDEX,
[a]);h.hook(r,arguments);r.addTxback(function(){this.getCrudExecutor().list(r,ydn.db.base.QueryMethod.LIST_VALUE,a,b,q,k,l,m,n)},this);return r};
ydn.db.crud.DbOperator.prototype.list=function(a,b,c,d,e,f,g,h,k){var l=this.schema.getStore(b);if(!l){if(this.schema.isAutoSchema())return ydn.db.Request.succeed(ydn.db.Request.Method.GET,[]);throw new ydn.db.NotFoundError(b);}var m,n=ydn.db.Request.Method.NONE;if(goog.DEBUG){if(c&&!l.hasIndex(c))throw new ydn.debug.error.ArgumentException('index "'+c+'" not found in store "'+b+'"');if(l=ydn.db.KeyRange.validate(d))throw new ydn.debug.error.ArgumentException("invalid key range: "+d+" "+l);}var p=
ydn.db.KeyRange.parseIDBKeyRange(d),q=ydn.db.base.DEFAULT_RESULT_LIMIT;if(goog.isNumber(e))q=e;else if(goog.isDefAndNotNull(e))throw new ydn.debug.error.ArgumentException('limit must be a number but "'+e+'" of type '+typeof e+" found.");var r=0;if(goog.isNumber(f))r=f;else if(goog.isDefAndNotNull(f))throw new ydn.debug.error.ArgumentException('offset must be a number but "'+f+'" of type '+typeof f+" found.");var s=!1;if(goog.isBoolean(g))s=g;else if(goog.isDefAndNotNull(g))throw new ydn.debug.error.ArgumentException('reverse must be a boolean but "'+
g+'" of type '+typeof g+" found.");var t=!1;if(goog.isBoolean(h))t=h;else if(goog.isDefAndNotNull(h))throw new ydn.debug.error.ArgumentException('unique must be a boolean but "'+h+'" of type '+typeof h+" found.");if(r&&k&&goog.isDef(k[0]))throw new ydn.debug.error.ArgumentException("offset must not given when initial cursor position is defined");goog.log.finer(this.logger,a+": "+b+":"+c);n=ydn.db.Request.Method.VALUES_INDEX;m=this.tx_thread.request(n,[b]);m.addTxback(function(){this.getCrudExecutor().list(m,
a,b,c||null,p,q,r,s,t,k)},this);return m};
ydn.db.crud.DbOperator.prototype.add=function(a,b,c){var d=goog.isString(a)?a:goog.isObject(a)?a.name:void 0;if(!goog.isString(d))throw new ydn.debug.error.ArgumentException("store name "+d+" must be a string, but "+typeof d);var e=this.schema.getStore(d);if(!e){if(!this.schema.isAutoSchema())throw new ydn.debug.error.ArgumentException('store name "'+d+'" not found.');a=goog.isObject(a)?a:{name:d};e=ydn.db.schema.Store.fromJSON(a);goog.log.finer(this.logger,"Adding object store: "+d);this.addStoreSchema(e)}else if(this.schema.isAutoSchema()&&
goog.isObject(a)&&(a=ydn.db.schema.Store.fromJSON(a),a=e.difference(a)))throw new ydn.debug.error.NotSupportedException(a);var f;if(!e)throw new ydn.debug.error.ArgumentException('store name "'+d+'" not found.');if(goog.isString(e.keyPath)&&goog.isDef(c))throw new ydn.debug.error.ArgumentException("key must not be provided while the store uses in-line key.");if(!e.usedInlineKey()&&!e.autoIncrement&&!goog.isDef(c))throw new ydn.debug.error.ArgumentException("out-of-line key must be provided.");if(goog.isArray(b)){goog.log.finer(this.logger,
"addObjects: "+d+" "+b.length+" objects");for(a=0;a<b.length;a++)e.generateIndex(b[a]);f=this.tx_thread.request(ydn.db.Request.Method.ADDS,[d],ydn.db.base.TransactionMode.READ_WRITE);f.addTxback(function(){this.getCrudExecutor().insertObjects(f,!1,!1,d,b,c)},this);e.dispatch_events&&f.addCallback(function(a){a=new ydn.db.events.StoreEvent(ydn.db.events.Types.CREATED,this.getStorage(),e.getName(),a,b);this.getStorage().dispatchDbEvent(a)},this)}else if(goog.isObject(b))a="store: "+d+" key: "+e.extractKey(b,
c),goog.log.finer(this.logger,"addObject: "+a),e.generateIndex(b),f=this.tx_thread.request(ydn.db.Request.Method.ADD,[d],ydn.db.base.TransactionMode.READ_WRITE),f.addTxback(function(){this.getCrudExecutor().insertObjects(f,!1,!0,d,[b],[c])},this),e.dispatch_events&&f.addCallback(function(a){a=new ydn.db.events.RecordEvent(ydn.db.events.Types.CREATED,this.getStorage(),e.getName(),a,b);this.getStorage().dispatchDbEvent(a)},this);else throw new ydn.debug.error.ArgumentException("record must be an object or array list of objects, but "+
b+" of type "+typeof b+" found.");return f};
ydn.db.crud.DbOperator.prototype.getStore_=function(a){var b=goog.isString(a)?a:goog.isObject(a)?a.name:void 0;if(!goog.isString(b))throw new ydn.debug.error.ArgumentException("store name must be a string");var c=this.schema.getStore(b);if(!c){if(!this.schema.isAutoSchema())throw new ydn.db.NotFoundError(b);c=goog.isObject(a)?a:{name:b};c=ydn.db.schema.Store.fromJSON(c);goog.log.finer(this.logger,"Adding object store: "+b);this.addStoreSchema(c)}else if(this.schema.isAutoSchema()&&goog.isObject(a)&&
(a=ydn.db.schema.Store.fromJSON(a),a=c.difference(a)))throw new ydn.debug.error.NotSupportedException(a);if(!c)throw new ydn.db.NotFoundError(b);return c};ydn.db.crud.DbOperator.prototype.load=function(a,b,c){var d=c||",",e=this.getStore_(a).getName();a=this.tx_thread.request(ydn.db.Request.Method.LOAD,[e]);var f=this;this.tx_thread.exec(a,function(a,c,k){f.getCrudExecutor().putData(a,c,k,e,b,d)},[e],ydn.db.base.TransactionMode.READ_WRITE);return a};
ydn.db.crud.DbOperator.prototype.search=function(a){var b=a.getStoreList();goog.log.finest(this.logger,"query "+a);var c=this.tx_thread.request(ydn.db.Request.Method.SEARCH,b,ydn.db.base.TransactionMode.READ_ONLY);c.addTxback(function(){var b=this.getCrudExecutor();a.nextLookup(function(e,f,g,h){var k=c.copy();b.list(k,ydn.db.base.QueryMethod.LIST_VALUE,e,f,g.toIDBKeyRange(),100,0,!1,!1);k.addBoth(function(b){var d=null;b instanceof Array||(d=b,b=[]);b=a.addResult(this,b);!0===b?c.notify(a):!1===
b&&c.callback(a.collect());if(d)throw d;},h)})},this);return c};
ydn.db.crud.DbOperator.prototype.put=function(a,b,c){var d,e=this;if(a instanceof ydn.db.Key){var f=a,g=f.getStoreName(),h=this.schema.getStore(g);if(!h)throw new ydn.debug.error.ArgumentException('store "'+g+'" not found.');if(h.usedInlineKey()){var k=h.extractKey(b);if(goog.isDefAndNotNull(k)){if(0!=ydn.db.cmp(k,f.getId()))throw new ydn.debug.error.ArgumentException("Inline key must be "+f+" but "+k+" found.");}else h.setKeyValue(b,f.getId());return this.put(g,b)}return this.put(g,b,f.getId())}if(goog.isArray(a)){if(goog.DEBUG&&
goog.isDef(c))throw new ydn.debug.error.ArgumentException("too many arguments");var l=a;if(goog.DEBUG&&!goog.isDef(b))throw new ydn.debug.error.ArgumentException("record values required");goog.asserts.assertArray(b,"record values must also be in an array");var m=b;goog.asserts.assert(l.length===m.length,"number of keys and number of object must be same, but found "+l.length+" vs. "+m.length);f=[];g=0;for(h=l.length;g<h;g++){k=l[g].getStoreName();-1==goog.array.indexOf(f,k)&&f.push(k);var n=this.schema.getStore(k);
if(!n)throw new ydn.debug.error.ArgumentException('store "'+k+'" not found.');n.usedInlineKey()&&n.setKeyValue(m[g],l[g].getId())}goog.log.finer(this.logger,"putByKeys: to "+ydn.json.stringify(f)+" "+m.length+" objects");for(g=0;g<m.length;g++)n.generateIndex(m[g]);d=this.tx_thread.request(ydn.db.Request.Method.PUT_KEYS,f,ydn.db.base.TransactionMode.READ_WRITE);n.hook(d,arguments);d.addTxback(function(){e.getCrudExecutor().putByKeys(d,m,l)},this)}else if(goog.isString(a)||goog.isObject(a)){var n=
this.getStore_(a),p=n.getName();if(n.usedInlineKey()&&goog.isDef(c))throw new ydn.debug.error.ArgumentException("key must not be provided while the store uses in-line key.");if(!n.usedInlineKey()&&!n.autoIncrement&&!goog.isDef(c))throw new ydn.debug.error.ArgumentException("out-of-line key must be provided.");if(goog.isArray(b)){var q=b,r=c;goog.log.finer(this.logger,"putObjects: "+p+" "+q.length+" objects");for(g=0;g<q.length;g++)n.generateIndex(q[g]);d=this.tx_thread.request(ydn.db.Request.Method.PUTS,
[p],ydn.db.base.TransactionMode.READ_WRITE);n.hook(d,arguments);d.addTxback(function(){this.getCrudExecutor().insertObjects(d,!0,!1,p,q,r)},this);n.dispatch_events&&d.addCallback(function(a){a=new ydn.db.events.StoreEvent(ydn.db.events.Types.UPDATED,this.getStorage(),p,a,q);this.getStorage().dispatchDbEvent(a)},this)}else if(goog.isObject(b)){var s=b,t=c;goog.DEBUG&&(goog.isDef(t)?goog.asserts.assert(ydn.db.Key.isValidKey(t),t+" of type "+typeof t+" is invalid key for "+ydn.json.toShortString(s)):
!n.isAutoIncrement()&&n.usedInlineKey()&&goog.asserts.assert(ydn.db.Key.isValidKey(n.extractKey(s)),"in-line key on "+n.getKeyPath()+" must provided in "+ydn.json.toShortString(s)));goog.log.finer(this.logger,"putObject: "+p+" "+(goog.isDef(t)?t:"(without-key)"));if(goog.isDef(goog.global.Blob)&&s instanceof Blob&&n.isFixed()&&!n.usedInlineKey()&&0==n.countIndex()&&goog.userAgent.WEBKIT)d=new ydn.db.Request(ydn.db.Request.Method.PUT),f=new FileReader,f.onload=function(a){var b=a.target.result,c=e.tx_thread.request(ydn.db.Request.Method.PUT,
[p],ydn.db.base.TransactionMode.READ_WRITE);n.hook(c,[p,s,t]);c.addTxback(function(){e.getCrudExecutor().insertObjects(c,!0,!0,p,[b],[t])},this);c.addCallbacks(function(a){d.callback(a)},function(a){d.errback(a)})},f.onerror=function(a){d.errback(a)},f.onabort=function(a){d.errback(a)},f.readAsDataURL(s);else{n.generateIndex(s);d=this.tx_thread.request(ydn.db.Request.Method.PUT,[p],ydn.db.base.TransactionMode.READ_WRITE);var v=[p,s,t];n.hook(d,v);d.addTxback(function(){var a=goog.isDef(t)?[v[2]]:
void 0;e.getCrudExecutor().insertObjects(d,!0,!0,p,[v[1]],a)},this)}n.dispatch_events&&d.addCallback(function(a){a=new ydn.db.events.RecordEvent(ydn.db.events.Types.UPDATED,this.getStorage(),p,a,s);this.getStorage().dispatchDbEvent(a)},this)}else throw new ydn.debug.error.ArgumentException("put record value must be Object or array of Objects");}else throw new ydn.debug.error.ArgumentException("the first argument of put must be store name, store schema or array of keys.");return d};
ydn.db.crud.DbOperator.prototype.dumpInternal=function(a,b,c,d,e){d=d?this.tx_thread:this.sync_thread;var f,g;if(goog.isString(a)){var h=this.schema.getStore(a);if(goog.DEBUG)if(h){if(!h.usedInlineKey()&&!h.isAutoIncrement()&&!goog.isDefAndNotNull(c))throw new ydn.debug.error.ArgumentException('key required for store "'+a+'"');}else throw new ydn.db.NotFoundError(a);for(var k=0;k<b.length;k++)h.generateIndex(b[k]);f=[a]}else{goog.asserts.assertArray(a,"store name "+a+" + must be an array or string, but "+
typeof a);g=a;f=[];for(var k=0,l=g.length;k<l;k++){var m=g[k].getStoreName(),h=this.schema.getStore(m);-1==goog.array.indexOf(f,m)&&f.push(m);if(goog.DEBUG&&!h)throw new ydn.db.NotFoundError(m);h.generateIndex(b[k])}}var n;if(goog.isString(a))h=this.schema.getStore(a),n=d.request(ydn.db.Request.Method.PUTS,f,ydn.db.base.TransactionMode.READ_WRITE),e&&h.hook(n,[a,b,c],e),n.addTxback(function(){this.getCrudExecutor().insertObjects(n,!0,!1,a,b,c)},this);else{n=d.request(ydn.db.Request.Method.PUT_KEYS,
f,ydn.db.base.TransactionMode.READ_WRITE);if(e)for(k=0;k<f.length;k++)h=this.schema.getStore(f[k]),h.hook(n,[b,g],e);n.addTxback(function(){this.getCrudExecutor().putByKeys(n,b,g)},this)}return n};
ydn.db.crud.DbOperator.prototype.removeInternalByKeys=function(a){for(var b=[],c=0,d=a.length;c<d;c++){var e=a[c].getStoreName();-1==goog.array.indexOf(b,e)&&b.push(e);if(goog.DEBUG&&!this.schema.hasStore(e))throw new ydn.db.NotFoundError(e);}var f=this.sync_thread.request(ydn.db.Request.Method.REMOVE_KEYS,b,ydn.db.base.TransactionMode.READ_WRITE);f.addTxback(function(){this.getCrudExecutor().removeByKeys(f,a)},this);return f};
ydn.db.crud.DbOperator.prototype.removeInternal=function(a,b){var c=this.sync_thread.request(ydn.db.Request.Method.REMOVE,[a],ydn.db.base.TransactionMode.READ_WRITE);c.addTxback(function(){this.getCrudExecutor().removeByKeyRange(c,a,b||null)},this);return c};
ydn.db.crud.DbOperator.prototype.listInternal=function(a,b,c,d,e,f){e=e||ydn.db.base.DEFAULT_RESULT_LIMIT;var g,h=f||0;if(goog.DEBUG)if(f=this.schema.getStore(a)){if(b&&!f.hasIndex(b))throw new ydn.db.NotFoundError('index "'+b+'" in store "'+a+'"');}else throw new ydn.db.NotFoundError(a);var k=ydn.db.KeyRange.parseIDBKeyRange(c);goog.isString(b)?(g=this.sync_thread.request(ydn.db.Request.Method.VALUES_INDEX,[a]),g.addTxback(function(){this.getCrudExecutor().list(g,ydn.db.base.QueryMethod.LIST_VALUE,
a,b,k,e,h,d,!1)},this)):(g=this.sync_thread.request(ydn.db.Request.Method.VALUES,[a]),g.addTxback(function(){this.getCrudExecutor().list(g,ydn.db.base.QueryMethod.LIST_VALUE,a,null,k,e,h,d,!1)},this));return g};
ydn.db.crud.DbOperator.prototype.valuesInternal=function(a){var b=[],c=a.length;if(0==c)return ydn.db.Request.succeed(ydn.db.Request.Method.KEYS,[]);for(var d=0;d<c;d++){var e=a[d].getStoreName();-1==goog.array.indexOf(b,e)&&b.push(e);if(goog.DEBUG&&!this.schema.hasStore(e))throw new ydn.db.NotFoundError(e);}var f=this,g=this.sync_thread.request(ydn.db.Request.Method.KEYS,b);g.addTxback(function(){f.getCrudExecutor().listByKeys(g,a)},this);return g};
ydn.db.crud.DbOperator.prototype.countInternal=function(a,b){var c=(b?this.tx_thread:this.sync_thread).request(ydn.db.Request.Method.COUNT,a);c.addTxback(function(){this.getCrudExecutor().countStores(c,a)},this);return c};
ydn.db.crud.DbOperator.prototype.keysInternal=function(a,b,c,d,e,f,g){var h;d=d||ydn.db.base.DEFAULT_RESULT_LIMIT;if(goog.DEBUG){var k=this.schema.getStore(a);if(k){if(b&&!k.hasIndex(b))throw new ydn.db.NotFoundError('index "'+b+'" in store "'+a+'"');}else throw new ydn.db.NotFoundError(a);}goog.isString(b)?(h=this.sync_thread.request(ydn.db.Request.Method.KEYS_INDEX,[a]),h.addTxback(function(){this.getCrudExecutor().list(h,ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,a,b,c,d,e,f,g)},this)):(h=this.sync_thread.request(ydn.db.Request.Method.KEYS,
[a]),h.addTxback(function(){this.getCrudExecutor().list(h,ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,a,null,c,d,e,f,g)},this));return h};
ydn.db.crud.DbOperator.prototype.clear=function(a,b,c){if(goog.DEBUG&&goog.isDef(c))throw new ydn.debug.error.ArgumentException("too many input arguments");var d;if(goog.isString(a)){c=this.schema.getStore(a);if(!c)throw new ydn.debug.error.ArgumentException('store name "'+a+'" not found.');if(goog.isObject(b)){var e=ydn.db.KeyRange.parseIDBKeyRange(b);if(goog.isNull(e))throw new ydn.debug.error.ArgumentException("clear method requires a valid non-null KeyRange object.");goog.log.finer(this.logger,
"clearByKeyRange: "+a+":"+ydn.json.stringify(e));d=this.tx_thread.request(ydn.db.Request.Method.CLEAR,[a],ydn.db.base.TransactionMode.READ_WRITE);c.hook(d,[a,e]);d.addTxback(function(){this.getCrudExecutor().clearByKeyRange(d,a,e)},this)}else{if(goog.isDef(b))throw new ydn.debug.error.ArgumentException("clear method requires a valid KeyRange object as second argument, but found "+b+" of type "+typeof b);goog.log.finer(this.logger,"clearByStore: "+a);d=this.tx_thread.request(ydn.db.Request.Method.CLEAR,
[a],ydn.db.base.TransactionMode.READ_WRITE);d.addTxback(function(){this.getCrudExecutor().clearByStores(d,[a])},this)}}else if(!goog.isDef(a)||goog.isArray(a)&&goog.isString(a[0])){var f=a||this.schema.getStoreNames();goog.log.finer(this.logger,"clearByStores: "+ydn.json.stringify(f));d=this.tx_thread.request(ydn.db.Request.Method.CLEAR,f,ydn.db.base.TransactionMode.READ_WRITE);d.addTxback(function(){this.getCrudExecutor().clearByStores(d,f)},this)}else throw new ydn.debug.error.ArgumentException('first argument "'+
a+'" is invalid.');return d};
ydn.db.crud.DbOperator.prototype.remove=function(a,b,c){var d;if(goog.isString(a)){var e=this.schema.getStore(a);if(!e)throw new ydn.debug.error.ArgumentException('store name "'+a+'" not found.');if(goog.isDef(c))if(goog.isString(b)){var f=e.getIndex(b);if(!f)throw new ydn.debug.error.ArgumentException("index: "+b+" not found in "+a);if(goog.isObject(c)||goog.isNull(c)){var g=ydn.db.KeyRange.parseIDBKeyRange(c);goog.log.finer(this.logger,"removeByIndexKeyRange: "+a+":"+f.getName()+" "+a);d=this.tx_thread.request(ydn.db.Request.Method.REMOVE_INDEX,
[a],ydn.db.base.TransactionMode.READ_WRITE);d.addTxback(function(){this.getCrudExecutor().removeByIndexKeyRange(d,a,f.getName(),g)},this)}else throw new ydn.debug.error.ArgumentException("key range "+c+' is invalid type "'+typeof c+'".');}else throw new ydn.debug.error.ArgumentException('index name "'+b+'" must be a string, but '+typeof b+" found.");else if(goog.isString(b)||goog.isNumber(b)||goog.isArrayLike(b)||b instanceof Date){goog.log.finer(this.logger,"removeById: "+a+":"+b);d=this.tx_thread.request(ydn.db.Request.Method.REMOVE_ID,
[a],ydn.db.base.TransactionMode.READ_WRITE);var h=[a,b];e.hook(d,h);d.addTxback(function(){this.getCrudExecutor().removeById(d,a,h[1])},this);e.dispatch_events&&d.addCallback(function(c){c=1==c?b:void 0;c=new ydn.db.events.RecordEvent(ydn.db.events.Types.DELETED,this.getStorage(),a,c,void 0);this.getStorage().dispatchDbEvent(c)},this)}else if(goog.isObject(b))g=ydn.db.KeyRange.parseIDBKeyRange(b),goog.log.finer(this.logger,"removeByKeyRange: "+a+":"+ydn.json.stringify(g)),d=this.tx_thread.request(ydn.db.Request.Method.REMOVE,
[a],ydn.db.base.TransactionMode.READ_WRITE),e.hook(d,[a,g]),d.addTxback(function(){this.getCrudExecutor().removeByKeyRange(d,a,g)},this),e.dispatch_events&&d.addCallback(function(b){var c=[];c.length=b;b=new ydn.db.events.StoreEvent(ydn.db.events.Types.DELETED,this.getStorage(),a,c,void 0);this.getStorage().dispatchDbEvent(b)},this);else throw new ydn.debug.error.ArgumentException('Invalid key or key range "'+b+'" of type '+typeof b);}else if(a instanceof ydn.db.Key){var k=a.getStoreName(),e=this.schema.getStore(k);
goog.asserts.assert(e,'store "'+k+'" not found.');d=this.tx_thread.request(ydn.db.Request.Method.REMOVE_ID,[k],ydn.db.base.TransactionMode.READ_WRITE);var l=[k,a.getId()];e.hook(d,l);d.addTxback(function(){this.getCrudExecutor().removeById(d,k,l[1])},this)}else if(goog.isArray(a)){c=[];for(var e=0,m=a.length;e<m;e++){if(goog.DEBUG&&!(a[e]instanceof ydn.db.Key))throw new ydn.debug.error.ArgumentException("key list element at "+e+" of "+m+' must be yn.db.Key, but "'+ydn.json.toShortString(a[e])+'" ('+
goog.typeOf(a[e])+") is not ydn.db.Key.");var n=a[e].getStoreName();-1==goog.array.indexOf(c,n)&&c.push(n)}if(1>c.length)throw new ydn.debug.error.ArgumentException('at least one valid key required in key list "'+ydn.json.toShortString(a)+'"');d=this.tx_thread.request(ydn.db.Request.Method.REMOVE_KEYS,c,ydn.db.base.TransactionMode.READ_WRITE);d.addTxback(function(){this.getCrudExecutor().removeByKeys(d,a)},this)}else throw new ydn.debug.error.ArgumentException('first argument requires store name, key (ydn.db.Key) or list of keys (array) , but "'+
ydn.json.toShortString(a)+'" ('+goog.typeOf(a)+") found.");return d};goog.DEBUG&&(ydn.db.crud.DbOperator.prototype.toString=function(){return"DbOperator:"+this.getStorage().getName()});ydn.db.core.DbOperator=function(a,b,c,d){ydn.db.crud.DbOperator.call(this,a,b,c,d)};goog.inherits(ydn.db.core.DbOperator,ydn.db.crud.DbOperator);ydn.db.core.DbOperator.prototype.logger=goog.log.getLogger("ydn.db.core.DbOperator");ydn.db.core.DbOperator.DEBUG=!1;
ydn.db.core.DbOperator.prototype.get=function(a,b){if(a instanceof ydn.db.Iterator){var c=a.getStoreName(),d=this.schema.getStore(c);if(!d)throw new ydn.debug.error.ArgumentException('store "'+c+'" not found.');var e=a.getIndexName();if(goog.isDef(e)&&!d.hasIndex(e))throw new ydn.debug.error.ArgumentException('index "'+e+'" not found in store "'+c+'".');goog.log.finer(this.logger,"getByIterator:"+a);var f=this.tx_thread.request(ydn.db.Request.Method.GET_ITER,[c]);f.addTxback(function(){this.iterate(ydn.db.base.QueryMethod.GET,
f,a,1)},this);return f}return ydn.db.core.DbOperator.superClass_.get.call(this,a,b)};
ydn.db.core.DbOperator.prototype.keys=function(a,b,c,d,e,f,g){if(a instanceof ydn.db.Iterator){var h=ydn.db.base.DEFAULT_RESULT_LIMIT;if(goog.isNumber(b)){if(h=b,1>h)throw new ydn.debug.error.ArgumentException("limit must be a positive value, but "+b);}else if(goog.isDef(b))throw new ydn.debug.error.ArgumentException("limit must be a number,  but "+b);if(goog.isDef(c))throw new ydn.debug.error.ArgumentException("offset must not be specified");goog.log.finer(this.logger,"keysByIterator:"+a);var k=
this.tx_thread.request(ydn.db.Request.Method.KEYS_ITER,[a.getStoreName()]);k.addTxback(function(){a.isIndexIterator()?this.iterate(ydn.db.base.QueryMethod.LIST_KEY,k,a,h):this.iterate(ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,k,a,h)},this);return k}return ydn.db.core.DbOperator.superClass_.keys.call(this,a,b,c,d,e,f,g)};
ydn.db.core.DbOperator.prototype.count=function(a,b,c,d){if(a instanceof ydn.db.Iterator){if(goog.isDef(b)||goog.isDef(c))throw new ydn.debug.error.ArgumentException("too many arguments.");goog.log.finer(this.logger,"countIterator:"+a);var e=this.tx_thread.request(ydn.db.Request.Method.COUNT,[a.getStoreName()]);e.addTxback(function(){this.iterate(ydn.db.base.QueryMethod.COUNT,e,a)},this);return e}return ydn.db.core.DbOperator.superClass_.count.call(this,a,b,c,d)};
ydn.db.core.DbOperator.prototype.values=function(a,b,c,d,e,f){if(a instanceof ydn.db.Iterator){var g;if(goog.isNumber(b)){if(g=b,1>g)throw new ydn.debug.error.ArgumentException("limit must be a positive value, but "+g);}else if(goog.isDef(b))throw new ydn.debug.error.ArgumentException("limit must be a number, but "+b);if(goog.isDef(c))throw new ydn.debug.error.ArgumentException("offset must not be specified");goog.log.finer(this.logger,"listByIterator:"+a);var h=this.tx_thread.request(ydn.db.Request.Method.VALUES_ITER,
[a.getStoreName()]);h.addTxback(function(){a.isKeyIterator()?this.iterate(ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,h,a,g):this.iterate(ydn.db.base.QueryMethod.LIST_VALUE,h,a,g)},this);return h}return ydn.db.core.DbOperator.superClass_.values.call(this,a,b,c,d,e,f)};
ydn.db.core.DbOperator.prototype.scan=function(a,b,c){if(goog.DEBUG){if(!goog.isArray(b))throw new ydn.debug.error.ArgumentException("iterators argument must be an array, but "+b+" of type "+typeof b+" found");for(var d=0;d<b.length;d++)if(!(b[d]instanceof ydn.db.Iterator))throw new ydn.debug.error.ArgumentException("Iterator at "+d+" must be cursor range iterator.");}c=c||ydn.db.base.TransactionMode.READ_ONLY;for(var e=[],d=0;d<b.length;d++)for(var f=b[d].stores(),g=0;g<f.length;g++)goog.array.contains(e,
f[g])||e.push(f[g]);goog.log.finer(this.logger,this+": scan for "+b.length+" iterators on "+e);var h=this,d=this.tx_thread.request(ydn.db.Request.Method.SCAN,e);this.tx_thread.exec(d,function(c,d,e){var f=d+" "+h+" scanning";goog.log.finest(h.logger,f);var g=!1,q,r=[],s=[],t=[],v=[],w=0,x=function(c,d){if(g)throw ydn.db.core.DbOperator.DEBUG&&goog.global.console.log("iterator "+c+" done"),new ydn.error.InternalError;w++;var k=w===q,l=r[c],z=b[l],l=v[l],x=l.getPrimaryKey(),y=l.getValue();if(ydn.db.core.DbOperator.DEBUG){var A=
d+(goog.isDefAndNotNull(x)?", "+x:"");goog.global.console.log(l+" new position "+A+(k?" (all result done)":""))}s[c]=d;z.isIndexIterator()?z.isKeyIterator()?t[c]=x:t[c]=y:z.isKeyIterator()?t[c]=d:t[c]=y;if(k){y=a instanceof ydn.db.algo.AbstractSolver?a.solver(s,t):a(s,t);ydn.db.core.DbOperator.DEBUG&&goog.global.console.log(h+" received result from solver "+y+" for keys "+ydn.json.stringify(s));k=[];z=[];l=[];x=[];if(goog.isArray(y))for(var u=0;u<y.length;u++)!0===y[u]?l[u]=1:!1===y[u]?x[u]=!0:z[u]=
y[u];else if(goog.isNull(y))k=[];else if(goog.isDef(y))if(goog.isObject(y)){if(goog.DEBUG)for(u in k=["advance","continue","continuePrimary","restart"],y)if(!goog.array.contains(k,u))throw new ydn.debug.error.InvalidOperationException('Unknown attribute "'+u+'" in cursor advancement object');k=y.continuePrimary||[];z=y["continue"]||[];l=y.advance||[];x=y.restart||[]}else throw new ydn.debug.error.InvalidOperationException("scan callback output");else for(k=[],u=0;u<b.length;u++)goog.isDef(r[u])&&
(l[u]=1);for(u=w=y=0;u<b.length;u++)goog.isDefAndNotNull(k[u])||(goog.isDef(z[u])||goog.isDefAndNotNull(x[u])||goog.isDefAndNotNull(l[u]))||w++;for(u=0;u<b.length;u++)if(goog.isDefAndNotNull(k[u])||goog.isDef(z[u])||goog.isDefAndNotNull(x[u])||goog.isDefAndNotNull(l[u])){A=r[u];if(!goog.isDef(A))throw new ydn.error.InvalidOperationException(u+" is not an iterator.");var A=b[A],B=v[u];if(goog.DEBUG&&!goog.isDefAndNotNull(s[u])){var H=u+"/"+b.length;if(goog.isDefAndNotNull(l[u]))throw new ydn.error.InvalidOperationError(B+
" "+H+" must not advance "+l[u]+" steps");if(goog.isDef(z[u]))throw new ydn.error.InvalidOperationError(B+" "+H+" must not continue to key "+z[u]);if(goog.isDefAndNotNull(k[u]))throw new ydn.error.InvalidOperationError(B+" "+H+" must not continue to primary key "+k[u]);}s[u]=void 0;t[u]=void 0;if(goog.isDefAndNotNull(x[u]))ydn.db.core.DbOperator.DEBUG&&goog.global.console.log("cursor "+B+" of iterator "+A+": restarting."),goog.asserts.assert(!0===x[u],u+" restart must be true"),B.restart();else if(goog.isDef(z[u]))ydn.db.core.DbOperator.DEBUG&&
goog.global.console.log(A+": continuing to "+z[u]),B.continueEffectiveKey(z[u]);else if(goog.isDefAndNotNull(k[u]))ydn.db.core.DbOperator.DEBUG&&goog.global.console.log(B+": continuing to primary key "+k[u]),B.continuePrimaryKey(k[u]);else if(goog.isDefAndNotNull(l[u]))ydn.db.core.DbOperator.DEBUG&&goog.global.console.log(A+": advancing "+l[u]+" steps."),goog.asserts.assert(1===l[u],u+" advance value must be 1"),B.advance(1);else throw new ydn.error.InternalError(A+": has no action");y++}if(0==y){for(u=
0;u<v.length;u++)v[u].exit();g=!0;goog.array.clear(v);goog.log.finer(h.logger,"success "+f);e(void 0)}}},z=function(a){for(var b=0;b<v.length;b++)v[b].exit();goog.array.clear(v);goog.log.finer(h.logger,f+" error");e(a,!0)},y=function(){for(var a=0,e=0;e<b.length;e++){var f=b[e],g=[h.getIndexExecutor().getCursor(c,d,f.getStoreName())],f=f.load(g);f.onFail=z;f.onNext=goog.partial(x,a);v[e]=f;r[a]=e;a++}q=b.length};a instanceof ydn.db.algo.AbstractSolver?a.begin(c,b,function(){y()})||y():y()},e,c);return d};
ydn.db.core.DbOperator.prototype.getIndexExecutor=function(){return this.getExecutor()};
ydn.db.core.DbOperator.prototype.open=function(a,b,c,d){if(goog.DEBUG){if(!(b instanceof ydn.db.Iterator))throw new ydn.debug.error.ArgumentException("Second argument must be cursor range iterator.");for(var e=b.stores(),f=0;f<e.length;f++)if(!this.schema.getStore(e[f]))throw new ydn.debug.error.ArgumentException('Store "'+e[f]+'" not found.');}c=c||ydn.db.base.TransactionMode.READ_ONLY;var g=this,h=this.tx_thread.request(ydn.db.Request.Method.OPEN,b.stores(),c);goog.log.finer(this.logger,"open:"+
c+" "+b);h.addTxback(function(c){var e=h.getLabel();goog.log.finer(g.logger,e+" iterating "+b);for(var f=b.stores(),n=[],p=0;p<f.length;p++)n[p]=g.getIndexExecutor().getCursor(c,e,f[p]);var q=b.load(n);q.onFail=function(a){h.setDbValue(a,!0)};q.onNext=function(b){goog.isDefAndNotNull(b)?(b=a.call(d,q),!0===b?q.restart():goog.isObject(b)?!0===b.restart?q.restart(b["continue"],b.continuePrimary):goog.isDefAndNotNull(b["continue"])?q.continueEffectiveKey(b["continue"]):goog.isDefAndNotNull(b.continuePrimary)?
q.continuePrimaryKey(b.continuePrimary):(q.exit(),h.setDbValue(void 0)):goog.isNull(b)?(q.exit(),h.setDbValue(void 0)):goog.isDefAndNotNull(b)?q.continueEffectiveKey(b):q.advance(1)):(q.exit(),h.setDbValue(void 0))}},this);return h};
ydn.db.core.DbOperator.prototype.map=function(a,b){for(var c=this,d=a.stores(),e,f=0;e=d[f];f++)if(!e)throw new ydn.debug.error.ArgumentException('Store "'+e+'" not found.');e=this.tx_thread.request(ydn.db.Request.Method.MAP,d);goog.log.finest(this.logger,"map:"+a);this.tx_thread.exec(e,function(d,e,f){goog.log.finest(c.logger,e+" iterating "+a);for(var l=a.stores(),m=[],n=0;n<l.length;n++)m[n]=c.getIndexExecutor().getCursor(d,e,l[n]);var p=a.load(m);p.onFail=function(a){f(a,!1)};p.onNext=function(c){goog.isDefAndNotNull(c)?
(c=a.isIndexIterator()?a.isKeyIterator()?c:p.getPrimaryKey():a.isKeyIterator()?c:p.getValue(),b(c),p.advance(1)):(f(void 0),b=null)}},d,ydn.db.base.TransactionMode.READ_ONLY);return e};
ydn.db.core.DbOperator.prototype.reduce=function(a,b,c){for(var d=this,e=a.stores(),f,g=0;f=e[g];g++)if(!f)throw new ydn.debug.error.ArgumentException('Store "'+f+'" not found.');f=this.tx_thread.request(ydn.db.Request.Method.REDUCE,e);var h=goog.isObject(c)?ydn.object.clone(c):c;goog.log.finer(this.logger,"reduce:"+a);this.tx_thread.exec(f,function(c,e,f){for(var g=a.stores(),p=[],q=0;q<g.length;q++)p[q]=d.getIndexExecutor().getCursor(c,e,g[q]);var r=a.load(p);r.onFail=function(a){f(a,!0)};var s=
0;r.onNext=function(c){goog.isDefAndNotNull(c)?(c=a.isIndexIterator()?a.isKeyIterator()?c:r.getPrimaryKey():a.isKeyIterator()?c:r.getValue(),h=b(h,c,s++),r.advance(1)):f(h)}},e,ydn.db.base.TransactionMode.READ_ONLY);return f};
ydn.db.core.DbOperator.prototype.listIter=function(a,b,c,d){var e=d||0,f=b.getStoreName(),g=b.getIndexName()||null,h=c||ydn.db.base.DEFAULT_RESULT_LIMIT;goog.log.finer(this.logger,"listIter:"+a+" "+b+(c?" limit="+h:"")+(d?" offset="+e:""));var k=this.tx_thread.request(ydn.db.Request.Method.VALUES_INDEX,[f]),l=b.getState()==ydn.db.Iterator.State.COMPLETED||b.getState()==ydn.db.Iterator.State.INITIAL?[]:[b.getKey(),b.getPrimaryKey()];k.addTxback(function(){b.getKey();this.getCrudExecutor().list(k,a,
f,g,b.getKeyRange(),h,e,b.isReversed(),b.isUnique(),l)},this);k.addCallback(function(){goog.isDefAndNotNull(l[0])?b.reset(ydn.db.Iterator.State.RESTING,l[0],l[1]):b.reset()});return k};
ydn.db.core.DbOperator.prototype.iterate=function(a,b,c,d,e){var f=[],g=b.getTx(),h=b.getLabel(),k=h+" "+a+"ByIterator "+c;0<d&&(k+=" limit "+d);var l=this;goog.log.finer(this.logger,k);for(var m=this.getIndexExecutor(),n=[],p=c.stores(),q=0;q<p.length;q++)n[q]=m.getCursor(g,h,p[q]);var r=c.load(n);r.onFail=function(a){r.exit();b.setDbValue(a,!0)};var s=0,t=!1,v=!1;r.onNext=function(c){v||(goog.log.finest(l.logger,k+" starting"),v=!0);goog.isDefAndNotNull(c)?(r.getPrimaryKey(),!t&&0<e?(r.advance(e),
t=!0):(s++,a==ydn.db.base.QueryMethod.LIST_KEY?f.push(c):a==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY?f.push(r.getPrimaryKey()):a==ydn.db.base.QueryMethod.LIST_KEYS?f.push([c,r.getPrimaryKey()]):a!=ydn.db.base.QueryMethod.COUNT&&f.push(r.getValue()),a==ydn.db.base.QueryMethod.GET?(r.exit(),b.setDbValue(f[0])):a==ydn.db.base.QueryMethod.COUNT||!goog.isDef(d)||s<d?r.continueEffectiveKey():(goog.log.finer(l.logger,"success:"+k+" yields "+f.length+" records"),r.exit(),b.setDbValue(f)))):(goog.log.finer(l.logger,
"success:"+k+" yields "+f.length+" records"),r.exit(),b.setDbValue(a==ydn.db.base.QueryMethod.GET?f[0]:a==ydn.db.base.QueryMethod.COUNT?s:f))}};goog.events={};goog.events.EventId=function(a){this.id=a};goog.events.EventId.prototype.toString=function(){return this.id};goog.events.Event=function(a,b){this.type=a instanceof goog.events.EventId?String(a):a;this.currentTarget=this.target=b;this.defaultPrevented=this.propagationStopped_=!1;this.returnValue_=!0};
goog.events.Event.prototype.disposeInternal=function(){};goog.events.Event.prototype.dispose=function(){};goog.events.Event.prototype.stopPropagation=function(){this.propagationStopped_=!0};goog.events.Event.prototype.preventDefault=function(){this.defaultPrevented=!0;this.returnValue_=!1};goog.events.Event.stopPropagation=function(a){a.stopPropagation()};goog.events.Event.preventDefault=function(a){a.preventDefault()};ydn.db.events={};
ydn.db.events.Types={READY:"ready",ERROR:"error",FAIL:"fail",CREATED:"created",DELETED:"deleted",UPDATED:"updated"};ydn.db.events.Event=function(a,b){goog.events.Event.call(this,a,b)};goog.inherits(ydn.db.events.Event,goog.events.Event);ydn.db.events.Event.prototype.getStoreName=function(){return this.store_name};ydn.db.events.StorageEvent=function(a,b,c,d,e){ydn.db.events.Event.call(this,a,b);this.version=c;this.oldVersion=d;this.old_schema_=e};goog.inherits(ydn.db.events.StorageEvent,ydn.db.events.Event);
ydn.db.events.StorageEvent.prototype.name="ReadyEvent";ydn.db.events.StorageEvent.prototype.version=NaN;ydn.db.events.StorageEvent.prototype.oldVersion=NaN;ydn.db.events.StorageEvent.prototype.old_schema_=null;ydn.db.events.StorageEvent.prototype.getVersion=function(){return this.version};ydn.db.events.StorageEvent.prototype.getOldVersion=function(){return this.oldVersion};ydn.db.events.StorageEvent.prototype.getOldSchema=function(){return this.old_schema_};
ydn.db.events.StorageErrorEvent=function(a,b,c){ydn.db.events.Event.call(this,c||ydn.db.events.Types.ERROR,a);this.error=b};goog.inherits(ydn.db.events.StorageErrorEvent,ydn.db.events.Event);ydn.db.events.StorageErrorEvent.prototype.toString=function(){return this.name+":"+(this.error?this.error:"")};ydn.db.events.StorageErrorEvent.prototype.name="ErrorEvent";ydn.db.events.StorageErrorEvent.prototype.error=null;ydn.db.events.StorageErrorEvent.prototype.getError=function(){return this.error};
ydn.db.events.StorageFailEvent=function(a,b){ydn.db.events.StorageErrorEvent.call(this,a,b,ydn.db.events.Types.FAIL)};goog.inherits(ydn.db.events.StorageFailEvent,ydn.db.events.StorageErrorEvent);ydn.db.events.StorageFailEvent.prototype.name="FailEvent";ydn.db.events.RecordEvent=function(a,b,c,d,e){ydn.db.events.Event.call(this,a,b);this.store_name=c;this.key=d;this.value=e};goog.inherits(ydn.db.events.RecordEvent,ydn.db.events.Event);ydn.db.events.RecordEvent.prototype.name="RecordEvent";
ydn.db.events.RecordEvent.prototype.getKey=function(){return this.key};ydn.db.events.RecordEvent.prototype.getValue=function(){return this.value};ydn.db.events.StoreEvent=function(a,b,c,d,e){ydn.db.events.Event.call(this,a,b);this.store_name=c;this.keys=d;this.values=e};goog.inherits(ydn.db.events.StoreEvent,ydn.db.events.Event);ydn.db.events.StoreEvent.prototype.name="StoreEvent";ydn.db.events.StoreEvent.prototype.getKeys=function(){return this.keys};
ydn.db.events.StoreEvent.prototype.getValues=function(){return this.values};ydn.db.con.IDatabase=function(){};ydn.db.con.IDatabase.prototype.close=function(){};ydn.db.con.IDatabase.prototype.getType=function(){};ydn.db.con.IDatabase.prototype.isReady=function(){};ydn.db.con.IDatabase.prototype.connect=function(a,b){};ydn.db.con.IDatabase.prototype.getDbInstance=function(){};ydn.db.schema={};
ydn.db.schema.Index=function(a,b,c,d,e,f){goog.isDef(e)||(e=goog.isArray(a)?a.join(", "):a);if(goog.isDefAndNotNull(a)&&!goog.isString(a)&&!goog.isArrayLike(a))throw new ydn.debug.error.ArgumentException("index keyPath for "+e+" must be a string or array, but "+a+" is "+typeof a);goog.DEBUG&&(goog.isArray(a)&&Object.freeze)&&Object.freeze(a);!goog.isDef(a)&&goog.isDef(e)&&(a=e);this.keyPath=a;this.is_composite_=goog.isArrayLike(this.keyPath);this.index_name_=e;this.type=ydn.db.schema.Index.toType(b);
if(goog.isDef(b)){if(!goog.isDef(this.type))throw new ydn.debug.error.ArgumentException("type invalid in index: "+this.index_name_);if(goog.isArray(this.keyPath))throw new ydn.debug.error.ArgumentException('composite key for store "'+this.index_name_+'" must not specified type');}this.unique=!!c;this.multiEntry=!!d;this.keyColumnType_=goog.isString(this.type)?this.type:ydn.db.schema.DataType.TEXT;this.index_column_name_=goog.isString(e)?e:goog.isArray(a)?this.keyPath.join(","):a;this.index_column_name_quoted_=
goog.string.quote(this.index_column_name_);this.key_paths_=this.is_composite_?null:this.keyPath.split(".");goog.asserts.assert(!goog.isDefAndNotNull(f)||goog.isFunction(f),"index generator must be a function, , but "+typeof f+" found.");this.index_generator_=f||null};
ydn.db.schema.Index.prototype.extractKey=function(a){if(goog.isDefAndNotNull(a)){if(goog.isArrayLike(this.keyPath)){for(var b=[],c=0,d=this.keyPath.length;c<d;c++){var e=ydn.db.utils.getValueByKeys(a,this.keyPath[c]);goog.asserts.assert(goog.isDefAndNotNull(e),ydn.json.toShortString(a)+" does not issue require composite key value "+c+" of "+d+' on index "'+this.index_name_+'"');b[c]=e}return b}return ydn.db.utils.getValueByKeys(a,this.keyPath)}};
ydn.db.schema.Index.prototype.applyValue=function(a,b){for(var c=0;c<this.key_paths_.length;c++)c==this.key_paths_.length-1?a[this.key_paths_[c]]=b:goog.isObject(a[this.key_paths_[c]])||(a[this.key_paths_[c]]={})};ydn.db.schema.DataType={BLOB:"BLOB",DATE:"DATE",INTEGER:"INTEGER",NUMERIC:"NUMERIC",TEXT:"TEXT"};ydn.db.DataTypeAbbr={DATE:"d",NUMERIC:"n",TEXT:"t",BLOB:"b"};ydn.db.schema.Index.ARRAY_SEP=String.fromCharCode(31);
ydn.db.schema.Index.js2sql=function(a,b){if(b==ydn.db.schema.DataType.DATE){if(a instanceof Date)return+a}else return goog.isDefAndNotNull(b)?a:ydn.db.utils.encodeKey(a)};ydn.db.schema.Index.sql2js=function(a,b){return b==ydn.db.schema.DataType.DATE?new Date(a):goog.isDef(b)?a:ydn.db.utils.decodeKey(a)};ydn.db.schema.Index.TYPES=[ydn.db.schema.DataType.BLOB,ydn.db.schema.DataType.DATE,ydn.db.schema.DataType.INTEGER,ydn.db.schema.DataType.NUMERIC,ydn.db.schema.DataType.TEXT];
ydn.db.schema.Index.toType=function(a){if(goog.isString(a))return a=goog.array.indexOf(ydn.db.schema.Index.TYPES,a),ydn.db.schema.Index.TYPES[a]};ydn.db.schema.Index.toAbbrType=function(a){return a instanceof Date?ydn.db.DataTypeAbbr.DATE:goog.isNumber(a)?ydn.db.DataTypeAbbr.NUMERIC:goog.isString(a)?ydn.db.DataTypeAbbr.TEXT:ydn.db.DataTypeAbbr.BLOB};
ydn.db.schema.Index.type2AbbrType=function(a){return a===ydn.db.schema.DataType.DATE?ydn.db.DataTypeAbbr.DATE:a===ydn.db.schema.DataType.NUMERIC?ydn.db.DataTypeAbbr.NUMERIC:a===ydn.db.schema.DataType.TEXT?ydn.db.DataTypeAbbr.TEXT:ydn.db.DataTypeAbbr.BLOB};ydn.db.schema.Index.prototype.getType=function(){return this.type};ydn.db.schema.Index.prototype.getSqlType=function(){return this.keyColumnType_};ydn.db.schema.Index.prototype.getName=function(){return this.index_name_};
ydn.db.schema.Index.prototype.isMultiEntry=function(){return this.multiEntry};ydn.db.schema.Index.prototype.isComposite=function(){return this.is_composite_};ydn.db.schema.Index.prototype.isUnique=function(){return this.unique};ydn.db.schema.Index.prototype.toJSON=function(){return{name:this.index_name_,keyPath:this.keyPath,type:this.type,unique:this.unique,multiEntry:this.multiEntry}};
ydn.db.schema.Index.prototype.clone=function(){var a=goog.isArray(this.keyPath)?goog.array.clone(this.keyPath):this.keyPath;return new ydn.db.schema.Index(a,this.type,this.unique,this.multiEntry,this.index_name_,this.index_generator_)};
ydn.db.schema.Index.compareKeyPath=function(a,b){return goog.isDefAndNotNull(a)||goog.isDefAndNotNull(b)?goog.isDefAndNotNull(a)?goog.isDefAndNotNull(b)?goog.isArrayLike(a)&&goog.isArrayLike(b)?goog.array.equals(a,b)?null:"expect: "+a+", but: "+b:ydn.object.equals(a,b)?null:"expect: "+a+", but: "+b:"keyPath: "+a+" no longer defined":"newly define "+b:null};ydn.db.schema.Index.prototype.equalsKeyPath=function(a){return!ydn.db.schema.Index.compareKeyPath(this.keyPath,a)};
ydn.db.schema.Index.prototype.difference=function(a){if(!a)return"no index for "+this.index_name_;if(this.index_name_!=a.index_name_)return"name, expect: "+this.index_name_+", but: "+a.index_name_;var b=ydn.db.schema.Index.compareKeyPath(this.keyPath,a.keyPath);return b?"keyPath, "+b:goog.isDefAndNotNull(this.unique)&&goog.isDefAndNotNull(a.unique)&&this.unique!=a.unique?"unique, expect: "+this.unique+", but: "+a.unique:goog.isDefAndNotNull(this.multiEntry)&&goog.isDefAndNotNull(a.multiEntry)&&this.multiEntry!=
a.multiEntry?"multiEntry, expect: "+this.multiEntry+", but: "+a.multiEntry:goog.isDef(this.type)&&goog.isDef(a.type)&&(goog.isArrayLike(this.type)?!goog.array.equals(this.type,a.type):this.type!=a.type)?"data type, expect: "+this.type+", but: "+a.type:""};
ydn.db.schema.Index.prototype.hint=function(a){if(!a)return this;goog.asserts.assert(this.index_name_==a.index_name_,"index name: "+this.index_name_+" != "+a.index_name_);var b=goog.isArray(this.keyPath)?goog.array.clone(this.keyPath):this.keyPath,c=this.type;goog.isDef(a.type)||"TEXT"!=c||(c=void 0);return new ydn.db.schema.Index(b,c,this.unique,this.multiEntry,a.index_name_)};ydn.db.schema.Index.toDir=function(a){a=goog.array.indexOf(ydn.db.base.DIRECTIONS,a);return ydn.db.base.DIRECTIONS[a]};
ydn.db.schema.Index.prototype.getKeyPath=function(){return this.keyPath};ydn.db.schema.Index.prototype.getSQLIndexColumnName=function(){return this.index_column_name_};ydn.db.schema.Index.prototype.getSQLIndexColumnNameQuoted=function(){return this.index_column_name_quoted_};ydn.db.schema.Index.prototype.setGenerator=function(a){goog.asserts.assert(!this.index_generator_,"index "+this.index_name_+" already has a generator");this.index_generator_=a};
ydn.db.schema.Index.prototype.generateIndex=function(a){if(this.index_generator_){var b=this.index_generator_(a),c=typeof b;if("string"==c||"number"==c||b instanceof Date||goog.isArray(b)){for(c=0;c<this.key_paths_.length-1;c++)goog.isObject(a[this.key_paths_[c]])||(a[this.key_paths_[c]]={});a[this.key_paths_[this.key_paths_.length-1]]=b}}};ydn.db.schema.Index.prototype.isGeneratorIndex=function(){return!!this.index_generator_};
ydn.db.schema.Index.fromJSON=function(a){if(goog.DEBUG){var b="name unique type keyPath multiEntry generator".split(" "),c;for(c in a)if(a.hasOwnProperty(c)&&-1==goog.array.indexOf(b,c))throw new ydn.debug.error.ArgumentException("Unknown field: "+c+" in "+ydn.json.stringify(a));}return new ydn.db.schema.Index(a.keyPath,a.type,a.unique,a.multiEntry,a.name,a.generator)};
goog.DEBUG&&(ydn.db.schema.Index.prototype.toString=function(){var a=this.multiEntry?"MultiEntry":"";this.key_paths_&&1<this.key_paths_.length&&(a+="Compound");return a+"Index:"+this.index_name_});
ydn.db.schema.Store=function(a,b,c,d,e,f,g,h){if(!goog.isString(a))throw new ydn.debug.error.ArgumentException("store name must be a string");this.name_=a;this.keyPath=goog.isDef(b)?b:null;this.isComposite=goog.isArrayLike(this.keyPath);if(!goog.isNull(this.keyPath)&&!goog.isString(this.keyPath)&&!this.isComposite)throw new ydn.debug.error.ArgumentException("keyPath must be a string or array");if(goog.DEBUG&&goog.isDefAndNotNull(c)&&!goog.isBoolean(c))throw new ydn.debug.error.ArgumentException('invalid autoIncrement value in store "'+
a+'"');this.autoIncrement=!!c;var k;if(goog.isDefAndNotNull(d)){k=ydn.db.schema.Index.toType(d);if(!goog.isDef(k))throw new ydn.debug.error.ArgumentException('type "'+d+'" for primary key in store "'+this.name_+'" is invalid.');if(this.isComposite)throw new ydn.debug.error.ArgumentException('composite key for store "'+this.name_+'" must not specified type');}this.type=goog.isDefAndNotNull(k)?k:this.autoIncrement?ydn.db.schema.DataType.INTEGER:void 0;this.keyPaths=goog.isString(this.keyPath)?this.keyPath.split("."):
[];this.indexes=e||[];this.dispatch_events=!!f;this.fixed=!!g;this.keyColumnType_=goog.isString(this.type)?this.type:ydn.db.schema.DataType.TEXT;this.primary_column_name_=goog.isArray(this.keyPath)?this.keyPath.join(","):goog.isString(this.keyPath)?this.keyPath:ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME;this.primary_column_name_quoted_=goog.string.quote(this.primary_column_name_);this.is_encrypted_=!!h;if(goog.DEBUG&&this.is_encrypted_){if(this.keyPath)throw new ydn.debug.error.ArgumentException('encrypted store "'+
this.name_+'" must not use inline key');if(this.isAutoIncrement())throw new ydn.debug.error.ArgumentException('encrypted store "'+this.name_+'" must not use key generator');}this.hooks_=[]};ydn.db.schema.Store.FetchStrategy={LAST_UPDATED:"last-updated",ASCENDING_KEY:"ascending-key",DESCENDING_KEY:"descending-key"};ydn.db.schema.Store.FetchStrategies=[ydn.db.schema.Store.FetchStrategy.LAST_UPDATED,ydn.db.schema.Store.FetchStrategy.ASCENDING_KEY,ydn.db.schema.Store.FetchStrategy.DESCENDING_KEY];
ydn.db.schema.Store.prototype.dispatch_events=!1;ydn.db.schema.Store.prototype.fixed=!1;ydn.db.schema.Store.prototype.toJSON=function(){for(var a=[],b=0;b<this.indexes.length;b++)a.push(this.indexes[b].toJSON());return{name:this.name_,keyPath:this.keyPath,autoIncrement:this.autoIncrement,type:this.type,indexes:a}};
ydn.db.schema.Store.fromJSON=function(a){if(goog.DEBUG){var b="name keyPath autoIncrement type indexes dispatchEvents fixed Sync encrypted".split(" "),c;for(c in a)if(a.hasOwnProperty(c)&&-1==goog.array.indexOf(b,c))throw new ydn.debug.error.ArgumentException('Unknown attribute "'+c+'"');}b=[];c=a.indexes||[];if(goog.isArray(c))for(var d=0;d<c.length;d++){var e=ydn.db.schema.Index.fromJSON(c[d]);goog.isDef(e.keyPath)&&e.keyPath===a.keyPath||b.push(e)}return new ydn.db.schema.Store(a.name,a.keyPath,
a.autoIncrement,"undefined"===a.type||"null"===a.type?void 0:a.type,b,a.dispatchEvents,a.fixed,a.encrypted)};ydn.db.schema.Store.prototype.toSql=function(a,b,c,d,e,f){a=this.inSql(a,b,c,d,e,f);c="";b!=ydn.db.base.QueryMethod.NONE&&(c+="SELECT "+a.select);c+=" FROM "+a.from;a.where&&(c+=" WHERE "+a.where);a.group&&(c+=" GROUP BY "+a.group);a.order&&(c+=" ORDER BY "+a.order);return c};
ydn.db.schema.Store.prototype.inSql=function(a,b,c,d,e,f){var g={select:"",from:"",where:"",group:"",order:""},h=this.primary_column_name_,k=this.primary_column_name_quoted_,l=null;c!==h&&goog.isString(c)&&(l=this.getIndex(c));var m=!!l,n=c||h,p=goog.string.quote(n);m?l.getKeyPath():this.getKeyPath();var q=m?l.getType():this.getType(),r=m&&l.isMultiEntry();g.from=this.getQuotedName();b===ydn.db.base.QueryMethod.COUNT?g.select="COUNT("+k+")":b===ydn.db.base.QueryMethod.LIST_KEYS||b===ydn.db.base.QueryMethod.LIST_KEY||
b===ydn.db.base.QueryMethod.LIST_PRIMARY_KEY?(g.select=k,goog.isDefAndNotNull(c)&&c!=h&&(g.select+=", "+p)):g.select="*";h=f?"DISTINCT ":"";c=[];r?(r=goog.string.quote(ydn.db.base.PREFIX_MULTIENTRY+this.getName()+":"+l.getName()),g.select=b===ydn.db.base.QueryMethod.COUNT?"COUNT("+h+r+"."+p+")":b===ydn.db.base.QueryMethod.LIST_KEYS||b===ydn.db.base.QueryMethod.LIST_KEY||b===ydn.db.base.QueryMethod.LIST_PRIMARY_KEY?"DISTINCT "+this.getQuotedName()+"."+k+", "+r+"."+p+" AS "+n:"DISTINCT "+this.getQuotedName()+
".*, "+r+"."+p+" AS "+n,g.from=r+" INNER JOIN "+this.getQuotedName()+" USING ("+k+")",b=r+"."+p,goog.isDefAndNotNull(d)&&(ydn.db.KeyRange.toSql(b,q,d,c,a),0<c.length&&(g.where=g.where?g.where+(" AND "+c.join(" AND ")):c.join(" AND ")))):goog.isDefAndNotNull(d)&&(ydn.db.KeyRange.toSql(p,q,d,c,a),0<c.length&&(g.where=g.where?g.where+(" AND "+c.join(" AND ")):c.join(" AND ")));m&&(!l.isUnique()&&f)&&(g.group=p);a=e?"DESC":"ASC";g.order=p+" "+a;m&&(g.order+=", "+k+" "+a);return g};
ydn.db.schema.Store.prototype.sqlContinueEffectiveKey=function(a,b,c,d,e,f,g,h){var k,l,m,n;goog.isDefAndNotNull(d)?(k=d.lower,l=d.upper,m=d.lowerOpen,n=d.upperOpen,e?goog.isDefAndNotNull(l)?(d=ydn.db.cmp(g,l),-1==d?(l=g,n=h):0==d&&(n=h||n)):(l=g,n=h):goog.isDefAndNotNull(k)?(d=ydn.db.cmp(g,k),1==d?(k=g,m=h):0==d&&(m=h||m)):(k=g,m=h)):e?(l=g,n=h):(k=g,m=h);d=new ydn.db.KeyRange(k,l,!!m,!!n);g=(c=c?this.getIndex(c):null)?c.getSQLIndexColumnName():this.getSQLKeyColumnName();a=this.inSql(b,a,g,d,e,f);
a="SELECT "+a.select+" FROM "+a.from+(a.where?" WHERE "+a.where:"")+(a.group?" GROUP BY "+a.group:"")+" ORDER BY "+a.order;c&&(e=e?"DESC":"ASC",a+=", "+this.getSQLKeyColumnNameQuoted()+e);return a};
ydn.db.schema.Store.prototype.sqlContinueIndexEffectiveKey=function(a,b,c,d,e,f,g,h,k){var l=this.getIndex(c),m=l.getSQLIndexColumnName();c=l.getSQLIndexColumnNameQuoted();this.getSQLKeyColumnName();var n=this.getSQLKeyColumnNameQuoted(),p=h?" <":" >",p=f?p+" ":p+"= ";f=ydn.db.schema.Index.js2sql(e,l.getType());g=ydn.db.schema.Index.js2sql(g,this.getType());l="";d?(a=this.inSql(b,a,m,d,h,k),a.where+=" AND ",l=c+p+"?",b.push(f)):(d=h?ydn.db.KeyRange.upperBound(e,!0):ydn.db.KeyRange.lowerBound(e,!0),
a=this.inSql(b,a,m,d,h,k),l=a.where,a.where="");a.where+="("+l+" OR ("+c+" = ? AND "+n+p+"?))";b.push(f);b.push(g);return"SELECT "+a.select+" FROM "+a.from+" WHERE "+a.where+(a.group?" GROUP BY "+a.group:"")+" ORDER BY "+a.order};ydn.db.schema.Store.prototype.clone=function(){return ydn.db.schema.Store.fromJSON(this.toJSON())};ydn.db.schema.Store.prototype.countIndex=function(){return this.indexes.length};ydn.db.schema.Store.prototype.index=function(a){return this.indexes[a]||null};
ydn.db.schema.Store.prototype.getIndex=function(a){return goog.array.find(this.indexes,function(b){return b.getName()==a})};ydn.db.schema.Store.prototype.getIndexByKeyPath=function(a){for(var b=0;b<this.indexes.length;b++)if(this.indexes[b].equalsKeyPath(a))return this.indexes[b];return null};ydn.db.schema.Store.prototype.isFixed=function(){return this.fixed};ydn.db.schema.Store.prototype.isEncrypted=function(){return this.is_encrypted_};
ydn.db.schema.Store.prototype.hasIndex=function(a){return a===this.keyPath?!0:goog.array.some(this.indexes,function(b){return b.getName()==a})};ydn.db.schema.Store.prototype.isKeyPath=function(a){return goog.isDef(this.keyPath)?1==this.keyPaths.length?this.keyPath===a:goog.isArrayLike(a)?goog.array.equals(this.keyPaths,a):!1:!1};
ydn.db.schema.Store.prototype.hasIndexByKeyPath=function(a){return this.keyPath&&goog.isNull(ydn.db.schema.Index.compareKeyPath(this.keyPath,a))?!0:goog.array.some(this.indexes,function(b){return goog.isDefAndNotNull(b.keyPath)&&goog.isNull(ydn.db.schema.Index.compareKeyPath(b.keyPath,a))})};ydn.db.schema.Store.prototype.getSQLKeyColumnNameQuoted=function(){return this.primary_column_name_quoted_};ydn.db.schema.Store.prototype.getSQLKeyColumnName=function(){return this.primary_column_name_};
ydn.db.schema.Store.prototype.getQuotedName=function(){return goog.string.quote(this.name_)};ydn.db.schema.Store.prototype.getColumns=function(){if(this.columns_&&this.columns_.length!=this.indexes.length){this.columns_=[];for(var a=0;a<this.indexes.length;a++)this.columns_.push(this.indexes[a].getName())}return this.columns_};
ydn.db.schema.Store.prototype.hintForIdb=function(a){for(var b=0;b<a.indexes.length;b++){var c=a.indexes[b];this.hasIndex(c.getName())||c.getType()!=ydn.db.schema.DataType.BLOB||(c=new ydn.db.schema.Index(c.getKeyPath(),c.getType(),c.isUnique(),c.isMultiEntry(),c.getName()),this.indexes.push(c))}};
ydn.db.schema.Store.prototype.hintForWebSql=function(a){if(!a)return this;goog.asserts.assert(this.name_==a.name_,"store name: "+this.name_+" != "+a.name_);var b=this.autoIncrement,c=goog.isArray(this.keyPath)?goog.array.clone(this.keyPath):this.keyPath,d=this.type,e=goog.array.map(this.indexes,function(a){return a.clone()});goog.isDef(a.type)||"TEXT"!=d||(d=void 0);goog.isArray(a.keyPath)&&(goog.isString(c)&&c==a.keyPath.join(","))&&(c=goog.array.clone(a.keyPath));for(var f=0,g=a.indexes.length;f<
g;f++)if(a.indexes[f].isComposite())for(var h=a.indexes[f].getName(),k=e.length-1;0<=k;k--)if(0<=h.indexOf(e[k].getName())){e[k]=a.indexes[f].clone();break}for(f=0;f<e.length;f++)(g=a.getIndex(e[f].getName()))&&(e[f]=e[f].hint(g));return new ydn.db.schema.Store(a.name_,c,b,d,e)};ydn.db.schema.Store.prototype.getName=function(){return this.name_};ydn.db.schema.Store.prototype.isAutoIncrement=function(){return this.autoIncrement};ydn.db.schema.Store.prototype.getKeyPath=function(){return this.keyPath};
ydn.db.schema.Store.prototype.usedInlineKey=function(){return!!this.keyPath};ydn.db.schema.Store.prototype.getIndexNames=function(){return this.indexes.map(function(a){return a.getName()})};ydn.db.schema.Store.prototype.getType=function(){return this.type};ydn.db.schema.Store.prototype.getSqlType=function(){return this.keyColumnType_};ydn.db.schema.Store.prototype.getIndexKeyPaths=function(){return this.indexes.map(function(a){return a.keyPath})};
ydn.db.schema.Store.prototype.addIndex=function(a,b,c,d){this.indexes.push(new ydn.db.schema.Index(a,b,c,d))};ydn.db.schema.Store.prototype.extractKey=function(a,b){if(a){if(!this.usedInlineKey()&&goog.isDefAndNotNull(b))return b;if(this.isComposite){for(var c=[],d=0;d<this.keyPath.length;d++)c.push(ydn.db.utils.getValueByKeys(a,this.keyPath[d]));return c}if(this.keyPath)return goog.object.getValueByKeys(a,this.keyPaths)}};
ydn.db.schema.Store.prototype.getRowValue=function(a){if(goog.isDefAndNotNull(this.keyPath))return a=a[this.keyPath],this.type==ydn.db.schema.DataType.DATE?a=Date.parse(a):this.type==ydn.db.schema.DataType.NUMERIC?a=parseFloat(a):this.type==ydn.db.schema.DataType.INTEGER&&(a=parseInt(a,10)),a};ydn.db.schema.Store.prototype.generateKey=function(){goog.isDef(this.current_key_)||(this.current_key_=0);return this.current_key_++};
ydn.db.schema.Store.prototype.setKeyValue=function(a,b){for(var c=0;c<this.keyPaths.length;c++){var d=this.keyPaths[c];if(c==this.keyPaths.length-1){a[d]=b;break}goog.isDef(a[d])||(a[d]={});a=a[d]}};
ydn.db.schema.Store.prototype.sqlNamesValues=function(a,b,c){var d=[],e=[];b=goog.isDef(b)?b:this.extractKey(a);goog.isDef(b)&&(e.push(this.getSQLKeyColumnNameQuoted()),d.push(ydn.db.schema.Index.js2sql(b,this.getType())));for(var f=0;f<this.indexes.length;f++){var g=this.indexes[f];if(!(g.isMultiEntry()||g.getName()===this.keyPath||g.getName()==ydn.db.base.DEFAULT_BLOB_COLUMN||c&&g.isUnique())){var h=g.extractKey(a);goog.isDefAndNotNull(h)&&(d.push(ydn.db.schema.Index.js2sql(h,g.getType())),e.push(g.getSQLIndexColumnNameQuoted()))}}this.fixed?
this.isFixed()&&(!this.usedInlineKey()&&0==this.countIndex())&&(goog.isString(a)&&-1==a.indexOf(";base64,")?d.push(a):d.push(ydn.json.stringify(a)),e.push(ydn.db.base.DEFAULT_BLOB_COLUMN)):(d.push(ydn.json.stringify(a)),e.push(ydn.db.base.DEFAULT_BLOB_COLUMN));a=[];for(f=d.length-1;0<=f;f--)a[f]="?";return{columns:e,slots:a,values:d,key:b}};ydn.db.schema.Store.prototype.equals=function(a){return this.name_===a.name_&&ydn.object.equals(this.toJSON(),a.toJSON())};
ydn.db.schema.Store.prototype.difference=function(a){if(!a)return"missing store: "+this.name_;if(this.name_!=a.name_)return"store name, expect: "+this.name_+", but: "+a.name_;var b=ydn.db.schema.Index.compareKeyPath(this.keyPath,a.keyPath);if(b)return"keyPath, "+b;if(goog.isDef(this.autoIncrement)&&goog.isDef(a.autoIncrement)&&this.autoIncrement!=a.autoIncrement)return"autoIncrement, expect:  "+this.autoIncrement+", but: "+a.autoIncrement;if(this.indexes.length!=a.indexes.length)return"indexes length, expect:  "+
this.indexes.length+", but: "+a.indexes.length;if(goog.isDef(this.type)&&goog.isDef(a.type)&&(goog.isArrayLike(this.type)?!goog.array.equals(this.type,a.type):this.type!=a.type))return"data type, expect:  "+this.type+", but: "+a.type;for(b=0;b<this.indexes.length;b++){var c=a.getIndex(this.indexes[b].getName()),c=this.indexes[b].difference(c);if(0<c.length)return'index "'+this.indexes[b].getName()+'" '+c}return""};ydn.db.schema.Store.prototype.similar=function(a){return 0==this.difference(a).length};
ydn.db.schema.Store.prototype.generateIndex=function(a){if(a)for(var b=0;b<this.indexes.length;b++)this.indexes[b].generateIndex(a)};ydn.db.schema.Store.prototype.addHook=function(a){this.hooks_.push(a);return this.hooks_.length-1};ydn.db.schema.Store.prototype.hook=function(a,b,c,d){for(var e=0;e<this.hooks_.length;e++)c!==e&&this.hooks_[e].call(d,a,b)};
ydn.db.schema.Store.prototype.getIndexName=function(a){var b,c=a;goog.isArray(a)?(b=this.getIndexByKeyPath(a),c=a.join(", ")):b=this.getIndex(a);if(goog.DEBUG&&!b)throw new ydn.debug.error.ArgumentException('require index "'+c+'" not found in store "'+this.getName()+'"');return b.getName()};goog.DEBUG&&(ydn.db.schema.Store.prototype.toString=function(){return"Store:"+this.name_+"["+this.countIndex()+"index]"});ydn.db.schema.fulltext={};ydn.db.schema.fulltext.Entry=function(){};
ydn.db.schema.fulltext.ResultSet=function(){};ydn.db.schema.fulltext.ResultSet.prototype.getStoreList=function(){};ydn.db.schema.fulltext.ResultSet.prototype.nextLookup=function(a){};ydn.db.schema.fulltext.ResultSet.prototype.addResult=function(a,b){};ydn.db.schema.fulltext.ResultSet.prototype.collect=function(){};ydn.db.schema.fulltext.Engine=function(){};ydn.db.schema.fulltext.Engine.prototype.query=function(a,b,c,d){};ydn.db.schema.fulltext.Engine.prototype.analyze=function(a,b,c){};
goog.json={};goog.json.USE_NATIVE_JSON=!1;goog.json.isValid=function(a){return/^\s*$/.test(a)?!1:/^[\],:{}\s\u2028\u2029]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,""))};
goog.json.parse=goog.json.USE_NATIVE_JSON?goog.global.JSON.parse:function(a){a=String(a);if(goog.json.isValid(a))try{return eval("("+a+")")}catch(b){}throw Error("Invalid JSON string: "+a);};goog.json.unsafeParse=goog.json.USE_NATIVE_JSON?goog.global.JSON.parse:function(a){return eval("("+a+")")};goog.json.serialize=goog.json.USE_NATIVE_JSON?goog.global.JSON.stringify:function(a,b){return(new goog.json.Serializer(b)).serialize(a)};goog.json.Serializer=function(a){this.replacer_=a};
goog.json.Serializer.prototype.serialize=function(a){var b=[];this.serializeInternal(a,b);return b.join("")};
goog.json.Serializer.prototype.serializeInternal=function(a,b){switch(typeof a){case "string":this.serializeString_(a,b);break;case "number":this.serializeNumber_(a,b);break;case "boolean":b.push(a);break;case "undefined":b.push("null");break;case "object":if(null==a){b.push("null");break}if(goog.isArray(a)){this.serializeArray(a,b);break}this.serializeObject_(a,b);break;case "function":break;default:throw Error("Unknown type: "+typeof a);}};
goog.json.Serializer.charToJsonCharCache_={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\x0B":"\\u000b"};goog.json.Serializer.charsToReplace_=/\uffff/.test("\uffff")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g;
goog.json.Serializer.prototype.serializeString_=function(a,b){b.push('"',a.replace(goog.json.Serializer.charsToReplace_,function(a){if(a in goog.json.Serializer.charToJsonCharCache_)return goog.json.Serializer.charToJsonCharCache_[a];var b=a.charCodeAt(0),e="\\u";16>b?e+="000":256>b?e+="00":4096>b&&(e+="0");return goog.json.Serializer.charToJsonCharCache_[a]=e+b.toString(16)}),'"')};goog.json.Serializer.prototype.serializeNumber_=function(a,b){b.push(isFinite(a)&&!isNaN(a)?a:"null")};
goog.json.Serializer.prototype.serializeArray=function(a,b){var c=a.length;b.push("[");for(var d="",e=0;e<c;e++)b.push(d),d=a[e],this.serializeInternal(this.replacer_?this.replacer_.call(a,String(e),d):d,b),d=",";b.push("]")};
goog.json.Serializer.prototype.serializeObject_=function(a,b){b.push("{");var c="",d;for(d in a)if(Object.prototype.hasOwnProperty.call(a,d)){var e=a[d];"function"!=typeof e&&(b.push(c),this.serializeString_(d,b),b.push(":"),this.serializeInternal(this.replacer_?this.replacer_.call(a,d,e):e,b),c=",")}b.push("}")};ydn.json={};ydn.json.DEBUG=!1;ydn.json.POLY_FILL=!1;ydn.json.logger=goog.log.getLogger("ydn");
ydn.json.parse=function(a){return!goog.isString(a)||goog.string.isEmpty(a)?{}:ydn.json.POLY_FILL&&"undefined"==typeof goog.global.JSON?goog.json.unsafeParse(a):JSON.parse(a)};ydn.json.toShortString=function(a){var b;try{b=ydn.json.stringify(a)}catch(c){b=""}return b?b.substr(0,70)+(70<b.length?"...":""):""};ydn.json.stringify=function(a,b,c){return ydn.json.POLY_FILL&&"undefined"==typeof goog.global.JSON?goog.json.serialize(a,b):JSON.stringify(a,b,c)};
ydn.db.schema.fulltext.InvIndex=function(a,b,c){if(goog.DEBUG){if(!a||goog.string.isEmpty(a))throw new ydn.debug.error.ArgumentException("store_name must be provided for primary full text index");if(!b||goog.string.isEmpty(b))throw new ydn.debug.error.ArgumentException("index_name must be provided for primary full text index");}this.store_name=a;this.key_path=b;this.weight=c||1};ydn.db.schema.fulltext.InvIndex.prototype.getStoreName=function(){return this.store_name};
ydn.db.schema.fulltext.InvIndex.prototype.getWeight=function(){return this.weight};ydn.db.schema.fulltext.InvIndex.prototype.getKeyPath=function(){return this.key_path};
ydn.db.schema.fulltext.InvIndex.fromJson=function(a){if(goog.DEBUG){var b=["storeName","keyPath","weight"],c;for(c in a)if(a.hasOwnProperty(c)&&-1==goog.array.indexOf(b,c))throw new ydn.debug.error.ArgumentException("Unknown field: "+c+" in "+ydn.json.toShortString(a));}return new ydn.db.schema.fulltext.InvIndex(a.storeName,a.keyPath,a.weight)};
ydn.db.schema.fulltext.Catalog=function(a,b,c,d){this.name=a;this.indexes=b;this.lang=c||"";if(goog.DEBUG&&-1==["","en","fr"].indexOf(this.lang))throw new ydn.debug.error.ArgumentException('Unsupported lang "'+c+" for full text search index "+a);this.normalizers=d||null;this.engine=null};ydn.db.schema.fulltext.Catalog.prototype.getSourceNames=function(){for(var a=[],b=0;b<this.indexes.length;b++){var c=this.indexes[b].getStoreName();-1==a.indexOf(c)&&a.push(c)}return a};
ydn.db.schema.fulltext.Catalog.prototype.getName=function(){return this.name};ydn.db.schema.fulltext.Catalog.prototype.count=function(){return this.indexes.length};ydn.db.schema.fulltext.Catalog.prototype.index=function(a){return this.indexes[a]};ydn.db.schema.fulltext.Catalog.prototype.getSource=function(a,b){return goog.array.find(this.indexes,function(c){return c.getStoreName()==a&&c.getKeyPath()==b})};
ydn.db.schema.fulltext.Catalog.fromJson=function(a){if(goog.DEBUG){var b=["name","sources","lang"],c;for(c in a)if(a.hasOwnProperty(c)&&-1==goog.array.indexOf(b,c))throw new ydn.debug.error.ArgumentException("Unknown field: "+c+" in "+ydn.json.stringify(a));}if(!goog.isArray(a.sources))throw new ydn.debug.error.ArgumentException("indexes require for full text search index "+a.name+", but "+a.sources+" of type "+typeof a.sources+" found.");b=a.sources.map(function(a){return ydn.db.schema.fulltext.InvIndex.fromJson(a)});
return new ydn.db.schema.fulltext.Catalog(a.name,b,a.lang)};
ydn.db.schema.Database=function(a,b){var c,d,e=b;if(goog.isObject(a)){d=a;if(goog.DEBUG){c=["version","stores","fullTextCatalogs"];for(var f in d)if(d.hasOwnProperty(f)&&-1==goog.array.indexOf(c,f))throw new ydn.debug.error.ArgumentException("Unknown field: "+f+" in schema.");}c=d.version;var e=[],g=d.stores||[];if(goog.DEBUG&&!goog.isArray(g))throw new ydn.debug.error.ArgumentException("stores must be array");this.default_text_store_name_=d.defaultTextStoreName;for(f=0;f<g.length;f++){var h=ydn.db.schema.Store.fromJSON(g[f]);
if(goog.DEBUG&&-1!=goog.array.findIndex(e,function(a){return a.name==h.getName()}))throw new ydn.debug.error.ArgumentException('duplicate store name "'+h.getName()+'".');e.push(h)}}else goog.isString(a)?c=0==a.length?void 0:parseFloat(a):goog.isNumber(a)&&(c=a);if(goog.isDef(c)){if(!goog.isNumber(c)||0>c)throw new ydn.debug.error.ArgumentException("Invalid version: "+c+" ("+a+")");isNaN(c)&&(c=void 0)}if(goog.isDef(b)&&(!goog.isArray(b)||0<b.length&&!(b[0]instanceof ydn.db.schema.Store)))throw new ydn.debug.error.ArgumentException("stores");
this.version=c;this.is_auto_version_=!goog.isDef(this.version);this.stores=e||[];c=[];if(d&&d.fullTextCatalogs)for(goog.asserts.assertArray(d.fullTextCatalogs,"fullTextCatalogs"),f=0;f<d.fullTextCatalogs.length;f++)e=ydn.db.schema.fulltext.Catalog.fromJson(d.fullTextCatalogs[f]),c[f]=e,this.getStore(e.getName())||(g=[new ydn.db.schema.Index("k",ydn.db.schema.DataType.TEXT),new ydn.db.schema.Index("v",ydn.db.schema.DataType.TEXT)],e=new ydn.db.schema.Store(e.getName(),"id",!1,void 0,g,!1,!1,!1),this.stores.push(e));
this.full_text_schema_=c};ydn.db.schema.Database.prototype.countFullTextIndex=function(){return this.full_text_schema_.length};ydn.db.schema.Database.prototype.fullTextIndex=function(a){return this.full_text_schema_[a]};ydn.db.schema.Database.prototype.getFullTextIndex=function(a){return goog.array.find(this.full_text_schema_,function(b){return b.getName()==a})};
ydn.db.schema.Database.prototype.getDefaultTextStoreName=function(){goog.asserts.assertString(this.default_text_store_name_,"defaultTextStoreName is not defined in the database schema");return this.default_text_store_name_};ydn.db.schema.Database.prototype.toJSON=function(){var a=goog.array.map(this.stores,function(a){return a.toJSON()}),b={};b.stores=a;goog.isDef(this.version)&&(b.version=this.version);return b};ydn.db.schema.Database.prototype.is_auto_version_=!1;
ydn.db.schema.Database.prototype.getVersion=function(){return this.version};ydn.db.schema.Database.prototype.setVersion=function(a){goog.asserts.assert(this.is_auto_version_,"autoversion schema cannot set a version");goog.asserts.assertNumber(a,"version must be a number");this.version=a};ydn.db.schema.Database.prototype.isAutoVersion=function(){return this.is_auto_version_};ydn.db.schema.Database.prototype.isAutoSchema=function(){return!1};
ydn.db.schema.Database.prototype.getStoreNames=function(){return goog.array.map(this.stores,function(a){return a.getName()})};ydn.db.schema.Database.prototype.store=function(a){return this.stores[a]||null};ydn.db.schema.Database.prototype.count=function(){return this.stores.length};ydn.db.schema.Database.prototype.getStore=function(a){return goog.array.find(this.stores,function(b){return b.getName()==a})};
ydn.db.schema.Database.prototype.getIndexOf=function(a){return goog.array.indexOf(this.stores,function(b){return b.name==a})};ydn.db.schema.Database.prototype.hasStore=function(a){return goog.array.some(this.stores,function(b){return b.getName()==a})};
ydn.db.schema.Database.prototype.difference=function(a,b,c){if(!a||this.stores.length!=a.stores.length)return"Number of store: "+this.stores.length+" vs "+a.stores.length;for(var d=0;d<this.stores.length;d++){var e=a.getStore(this.stores[d].getName());if(e){if(b&&(e=e.hintForWebSql(this.stores[d])),c&&e.hintForIdb(this.stores[d]),e=this.stores[d].difference(e),0<e.length)return'store: "'+this.stores[d].getName()+'" '+e}else return'missing object store "'+this.stores[d].getName()+'"'}return""};
ydn.db.schema.Database.prototype.similar=function(a){return 0==this.difference(a,!1,!1).length};ydn.db.schema.Database.prototype.getFullTextSchema=function(a){return goog.array.find(this.full_text_schema_,function(b){return b.getName()==a})};ydn.db.schema.Database.prototype.listStores=function(){this.store_names||(this.store_names=goog.array.map(this.stores,function(a){return a.getName()}));return this.store_names};ydn.db.schema.EditableDatabase=function(a,b){ydn.db.schema.Database.call(this,a,b)};
goog.inherits(ydn.db.schema.EditableDatabase,ydn.db.schema.Database);ydn.db.schema.EditableDatabase.prototype.isAutoSchema=function(){return!0};ydn.db.schema.EditableDatabase.prototype.addStore=function(a){this.stores.push(a)};ydn.error={};ydn.error.ArgumentException=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.ArgumentException):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.ArgumentException"};
goog.inherits(ydn.error.ArgumentException,Error);ydn.error.NotSupportedException=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.NotSupportedException):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.NotSupportedException"};goog.inherits(ydn.error.ArgumentException,Error);ydn.error.NotSupportedException.prototype.name="ydn.error.NotSupportedException";
ydn.error.NotImplementedException=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.NotImplementedException):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.NotImplementedException"};goog.inherits(ydn.error.NotImplementedException,Error);ydn.error.InternalError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.InternalError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InternalError"};
goog.inherits(ydn.error.InternalError,Error);ydn.error.InternalError.prototype.name="ydn.InternalError";ydn.error.ConstraintError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.ConstraintError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.ConstraintError"};goog.inherits(ydn.error.ConstraintError,Error);ydn.error.ConstraintError.prototype.name="ydn.error.ConstraintError";
ydn.error.InvalidOperationException=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.InvalidOperationException):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InvalidOperationException"};goog.inherits(ydn.error.ArgumentException,Error);ydn.error.InvalidOperationError=function(a){Error.captureStackTrace?Error.captureStackTrace(this,ydn.error.InvalidOperationError):this.stack=Error().stack||"";a&&(this.message=String(a));this.name="ydn.error.InvalidOperationError"};
goog.inherits(ydn.error.InvalidOperationError,Error);ydn.object={};ydn.object.DEBUG=!1;ydn.object.clone=function(a){return ydn.json.parse(ydn.json.stringify(a))};
ydn.object.equals=function(a,b,c){c=c||{};if(goog.isDefAndNotNull(a)&&goog.isDefAndNotNull(b)){if(goog.isArrayLike(a)&&goog.isArrayLike(b)){if(a.length!=b.length)return ydn.object.DEBUG&&goog.global.console.log("different array length "+a.length+" vs "+b.length),!1;for(var d=0;d<a.length;d++)if(-1==goog.array.find(b,function(b){return ydn.object.equals(b,a[d])}))return ydn.object.DEBUG&&goog.global.console.log("obj2 do not have "+a[d]),!1;return!0}if(goog.isArrayLike(a))return 1==a.length&&ydn.object.equals(a[0],
b);if(goog.isArrayLike(b))return 1==b.length&&ydn.object.equals(b[0],a);if(goog.isObject(a)&&goog.isObject(a)){for(var e in a)if(a.hasOwnProperty(e)&&!c[e]){var f=ydn.object.equals(a[e],b[e]);if(!f)return ydn.object.DEBUG&&goog.global.console.log("value for "+e),!1}for(e in b)if(b.hasOwnProperty(e)&&!c[e]&&(f=ydn.object.equals(a[e],b[e]),!f))return ydn.object.DEBUG&&goog.global.console.log("value for "+e),!1;return!0}return a===b}ydn.object.DEBUG&&(goog.isDefAndNotNull(a)||goog.global.console.log("obj1 is not defined."),
goog.isDefAndNotNull(b)||goog.global.console.log("obj2 is not defined."));return!1};ydn.object.length=function(a){if(a&&a.length&&goog.isNumber(a.length))return a.length;var b=0,c;for(c in a)a.hasOwnProperty(c)&&b++;return b};ydn.object.extend=function(a,b){var c=ydn.object.clone(a),d;for(d in b)b.hasOwnProperty(d)&&(c[d]=b[d]);return c};ydn.object.reparr=function(a,b){for(var c=[],d=0;d<b;d++)c[d]=a;return c};ydn.object.takeFirst=function(a){if(a)for(var b in a)if(a.hasOwnProperty(b))return a[b]};
ydn.db.con.Storage=function(a,b,c){c=c||{};if(goog.DEBUG){var d="autoSchema connectionTimeout size mechanisms policy isSerial Encryption".split(" "),e;for(e in c)if(c.hasOwnProperty(e)&&-1==goog.array.indexOf(d,e))throw new ydn.debug.error.ArgumentException('Unknown attribute "'+e+'" in options.');if(c.mechanisms){if(!goog.isArray(c.mechanisms))throw new ydn.debug.error.ArgumentException("mechanisms attribute must be an array but "+goog.typeOf(c.mechanisms)+" found.");for(e=0;e<c.mechanisms.length;e++)if(!goog.array.contains(ydn.db.con.Storage.PREFERENCE,
c.mechanisms[e]))throw new ydn.debug.error.ArgumentException('Invalid mechanism "'+c.mechanisms[e]+'"');}}this.mechanisms=c.mechanisms||ydn.db.con.Storage.PREFERENCE;this.size=c.size;this.connectionTimeout=goog.isDef(c.connectionTimeout)?c.connectionTimeout:ydn.db.con.Storage.DEBUG?1E3:goog.DEBUG?3E3:6E4;this.db_=null;this.txQueue_=[];this.in_version_change_tx_=!1;if(b instanceof ydn.db.schema.Database)d=b;else if(goog.isObject(b)){var d=c.autoSchema||!goog.isDef(b.stores)?new ydn.db.schema.EditableDatabase(b):
new ydn.db.schema.Database(b),f=b.stores?b.stores.length:0;for(e=0;e<f;e++){var g=d.getStore(b.stores[e].name);b.stores[e].Sync&&this.addSynchronizer(g,b.stores[e].Sync)}}else d=new ydn.db.schema.EditableDatabase;b=this.setEncryption(c.Encryption);this.schema=d;for(e=0;e<this.schema.count();e++)if(this.schema.store(e).isEncrypted()){if(goog.DEBUG&&!b)throw Error("encryption option must be defined");this.addEncryption(this.schema.store(e))}goog.isDef(a)&&this.setName(a);this.event_target=null;this.df_on_ready_=
new goog.async.Deferred};ydn.db.con.Storage.DEBUG=!1;ydn.db.con.Storage.prototype.logger=goog.log.getLogger("ydn.db.con.Storage");ydn.db.con.Storage.prototype.hasStore=function(a){return this.schema.hasStore(a)};ydn.db.con.Storage.prototype.hasIndex=function(a,b){var c=this.schema.getStore(a);return c?c.hasIndex(b):!1};
ydn.db.con.Storage.prototype.getSchema=function(a){if(goog.isDef(a)){var b=function(b){a(b.toJSON());a=void 0};if(this.db_)this.db_.getSchema(b);else{var c=this;goog.asserts.assertFunction(b,"schema");this.transaction(function(a){c.db_.getSchema(b,a)},null,ydn.db.base.TransactionMode.READ_ONLY)}}return this.schema?this.schema.toJSON():null};
ydn.db.con.Storage.prototype.addStoreSchema=function(a){var b=a instanceof ydn.db.schema.Store?a:ydn.db.schema.Store.fromJSON(a);a=a.name;var c=this.schema.getStore(a);if(b.similar(c))return goog.async.Deferred.succeed(!1);c=c?"update":"add";if(this.schema instanceof ydn.db.schema.EditableDatabase)return this.schema.addStore(b),this.db_?(this.db_.close(),this.db_=null,this.connectDatabase()):goog.async.Deferred.succeed(!1);throw new ydn.error.ConstraintError(goog.DEBUG?"Cannot "+c+" store: "+a+". Not auto schema generation mode.":
"");};ydn.db.con.Storage.prototype.setName=function(a){if(this.db_)throw new ydn.debug.error.InvalidOperationException("Already connected with "+this.db_name);goog.asserts.assertString(a,"database name must be a string but found "+a+" of type "+typeof a);this.db_name=a;this.connectDatabase()};ydn.db.con.Storage.prototype.getName=function(){return this.db_name};
ydn.db.con.Storage.PREFERENCE=[ydn.db.base.Mechanisms.IDB,ydn.db.base.Mechanisms.SQLITE,ydn.db.base.Mechanisms.WEBSQL,ydn.db.base.Mechanisms.LOCAL_STORAGE,ydn.db.base.Mechanisms.SESSION_STORAGE,ydn.db.base.Mechanisms.USER_DATA,ydn.db.base.Mechanisms.MEMORY_STORAGE];ydn.db.con.Storage.prototype.createDbInstance=function(a){return null};
ydn.db.con.Storage.prototype.connectDatabase=function(){for(var a=this,b=new goog.async.Deferred,c=function(c,e){c?(goog.log.finest(a.logger,a+": ready."),a.last_queue_checkin_=NaN,d.onError=function(b){b=new ydn.db.events.StorageErrorEvent(a,b);a.dispatchDbEvent(b)},d.onFail=function(b){b=new ydn.db.events.StorageFailEvent(a,b);a.dispatchDbEvent(b);a.db_=null},d.onVersionChange=function(b){a.dispatchDbEvent(b)},setTimeout(function(){a.dispatchReady(e);a.popTxQueue_()},10),b.callback(e)):(goog.log.warning(a.logger,
a+": database connection fail "+e.name),setTimeout(function(){var b=new ydn.db.events.StorageFailEvent(a,e);a.dispatchReady(b);a.purgeTxQueue_(e)},10),b.errback(e))},d=null,e=this.mechanisms,f=0;f<e.length;f++){var g=e[f].toLowerCase();if(d=this.createDbInstance(g)){d=this.createDbInstance(g);break}}goog.isNull(d)?(e=new ydn.error.ConstraintError("No storage mechanism found."),e=new ydn.db.events.StorageFailEvent(this,e),c(!1,e)):(this.init(),d.connect(this.db_name,this.schema).addCallbacks(function(a){this.db_=
d;a=new ydn.db.events.StorageEvent(ydn.db.events.Types.READY,this,parseFloat(d.getVersion()),parseFloat(a),null);c(!0,a)},function(a){goog.log.warning(this.logger,this+": opening fail");c(!1,a)},this));return b};ydn.db.con.Storage.prototype.getType=function(){if(this.db_)return this.db_.getType()};ydn.db.con.Storage.prototype.onReady=function(a,b){this.df_on_ready_.addBoth(a,b)};
ydn.db.con.Storage.prototype.dispatchReady=function(a){var b=this;setTimeout(function(){b.schema.isAutoVersion()&&b.df_on_ready_.hasFired()||(a instanceof ydn.db.events.StorageErrorEvent?b.df_on_ready_.errback(a.error):b.df_on_ready_.callback(),b.dispatchDbEvent(a))},4)};ydn.db.con.Storage.prototype.isReady=function(){return!!this.db_&&this.db_.isReady()};ydn.db.con.Storage.prototype.init=function(){};
ydn.db.con.Storage.prototype.close=function(){this.db_&&(this.db_.close(),this.db_=null,goog.log.finest(this.logger,this+" closed"))};ydn.db.con.Storage.prototype.getDbInstance=function(){return this.db_?this.db_.getDbInstance():null};ydn.db.con.Storage.prototype.last_queue_checkin_=NaN;ydn.db.con.Storage.QUEUE_LIMIT=100;ydn.db.con.Storage.prototype.countTxQueue=function(){return this.txQueue_.length};
ydn.db.con.Storage.prototype.popTxQueue_=function(){var a=this.txQueue_.shift();a&&(goog.log.finest(this.logger,"pop tx queue["+(this.txQueue_.length+1)+"]"),this.transaction(a.fnc,a.scopes,a.mode,a.oncompleted));this.last_queue_checkin_=goog.now()};
ydn.db.con.Storage.prototype.pushTxQueue_=function(a,b,c,d){goog.log.finest(this.logger,"push tx queue["+this.txQueue_.length+"]");this.txQueue_.push({fnc:a,scopes:b,mode:c,oncompleted:d});goog.DEBUG&&(this.txQueue_.length>ydn.db.con.Storage.QUEUE_LIMIT&&0==this.txQueue_.length%ydn.db.con.Storage.QUEUE_LIMIT)&&goog.log.warning(this.logger,"Transaction queue stack size is "+this.txQueue_.length+". It is too large, possibility due to incorrect usage.")};
ydn.db.con.Storage.prototype.purgeTxQueue_=function(a){if(this.txQueue_){goog.log.info(this.logger,"Purging "+this.txQueue_.length+" transactions request.");for(var b;b=this.txQueue_.shift();)if(b.oncompleted)b.oncompleted(ydn.db.base.TxEventTypes.ERROR,a)}};ydn.db.con.Storage.prototype.in_version_change_tx_=!1;
ydn.db.con.Storage.prototype.transaction=function(a,b,c,d){var e=b;if(goog.isString(b))e=[b];else if(!goog.isDefAndNotNull(b))e=null;else if(goog.DEBUG)if(goog.isArrayLike(b)){if(0==b.length)throw new ydn.debug.error.ArgumentException("number of store names must more than 0");for(var f=0;f<b.length;f++)if(!goog.isString(b[f]))throw new ydn.debug.error.ArgumentException("store name at "+f+" must be string but found "+typeof b[f]);}else throw new ydn.debug.error.ArgumentException("store names must be an array");
if(this.db_&&this.db_.isReady()&&!this.in_version_change_tx_){var g=this,h=goog.isDef(c)?c:ydn.db.base.TransactionMode.READ_ONLY;h==ydn.db.base.TransactionMode.VERSION_CHANGE&&(this.in_version_change_tx_=!0);this.db_.doTransaction(function(b){a(b);a=null},e,h,function(a,b){goog.isFunction(d)&&(d(a,b),d=void 0);h==ydn.db.base.TransactionMode.VERSION_CHANGE&&(g.in_version_change_tx_=!1);g.popTxQueue_()})}else this.pushTxQueue_(a,e,c,d)};ydn.db.con.Storage.prototype.isAutoVersion=function(){return this.schema.isAutoVersion()};
ydn.db.con.Storage.prototype.isAutoSchema=function(){return this.schema.isAutoSchema()};ydn.db.con.Storage.prototype.addSynchronizer=function(a,b){goog.log.warning(this.logger,"Synchronization option for "+a.getName()+" ignored.")};ydn.db.con.Storage.prototype.addEncryption=function(a){goog.log.warning(this.logger,"Encryption option for "+a.getName()+" ignored.")};ydn.db.con.Storage.prototype.setEncryption=function(a){return!1};
ydn.db.con.Storage.prototype.addFullTextIndexer=function(a,b){goog.log.warning(this.logger,"Full text indexer option for "+a.getName()+" ignored.")};ydn.db.con.Storage.prototype.getEventTypes=function(){return"created error fail ready deleted updated versionchange".split(" ")};ydn.db.con.Storage.prototype.dispatchDbEvent=function(a){};goog.DEBUG&&(ydn.db.con.Storage.prototype.toString=function(){return"Storage:"+this.db_});
ydn.db.tr.ParallelTxExecutor=function(a,b,c,d){this.tx_=a;this.tx_no_=b;this.scopes_=goog.array.clone(c);this.mode_=d;this.oncompleted_handlers=[]};ydn.db.tr.ParallelTxExecutor.prototype.tx_=null;ydn.db.tr.ParallelTxExecutor.prototype.isActive=function(){return!!this.tx_};ydn.db.tr.ParallelTxExecutor.prototype.getTx=function(){return this.tx_};ydn.db.tr.ParallelTxExecutor.prototype.getTxNo=function(){return this.tx_no_};
ydn.db.tr.ParallelTxExecutor.prototype.onCompleted=function(a,b){goog.asserts.assert(this.isActive(),this.tx_no_+" already completed?");for(var c=0;c<this.oncompleted_handlers.length;c++)this.oncompleted_handlers[c](a,b);this.oncompleted_handlers.length=0;this.oncompleted_handlers=this.scopes_=this.tx_=null};
ydn.db.tr.ParallelTxExecutor.prototype.executeTx=function(a,b){if(this.tx_)b&&this.oncompleted_handlers.push(b),a(this.tx_);else throw new ydn.debug.error.InternalError("tx committed on ParallelTxExecutor");};ydn.db.tr.ParallelTxExecutor.prototype.sameScope=function(a,b){if(!this.scopes_||!this.mode_||b!=this.mode_||this.scopes_.length!=a.length)return!1;for(var c=0;c<a.length;c++)if(-1==this.scopes_.indexOf(a[c]))return!1;return!0};
ydn.db.tr.ParallelTxExecutor.prototype.subScope=function(a,b){if(!this.scopes_||!this.mode_||b!=this.mode_&&(this.mode_!=ydn.db.base.TransactionMode.READ_WRITE||b!=ydn.db.base.TransactionMode.READ_ONLY)||a.length>this.scopes_.length)return!1;for(var c=0;c<a.length;c++)if(-1==this.scopes_.indexOf(a[c]))return!1;return!0};goog.DEBUG&&(ydn.db.tr.ParallelTxExecutor.prototype.toString=function(){return"ParallelTxExecutor: txNo:"+this.tx_no_+" mode:"+this.mode_+" scopes:"+ydn.json.stringify(this.scopes_)});
ydn.db.tr.Parallel=function(a,b,c,d,e,f){ydn.db.tr.Thread.call(this,a,b,c,d,e,f);this.p_request_tx=this.pl_tx_ex_=null};goog.inherits(ydn.db.tr.Parallel,ydn.db.tr.Thread);ydn.db.tr.Parallel.DEBUG=!1;ydn.db.tr.Parallel.prototype.logger=goog.log.getLogger("ydn.db.tr.Parallel");ydn.db.tr.Parallel.prototype.getPlTx=function(){return this.pl_tx_ex_};ydn.db.tr.Parallel.prototype.isActive=function(){return!!this.pl_tx_ex_&&this.pl_tx_ex_.isActive()};
ydn.db.tr.Parallel.prototype.sameScope=function(a,b){return this.pl_tx_ex_.sameScope(a,b)};ydn.db.tr.Parallel.prototype.subScope=function(a,b){return this.pl_tx_ex_.subScope(a,b)};ydn.db.tr.Parallel.prototype.abort=function(){goog.log.finer(this.logger,this+": aborting");ydn.db.tr.Thread.abort(this.p_request_tx)};
ydn.db.tr.Parallel.prototype.reusedTx=function(a,b){return this.policy==ydn.db.tr.Thread.Policy.MULTI?this.pl_tx_ex_.subScope(a,b):this.policy==ydn.db.tr.Thread.Policy.REPEAT?this.pl_tx_ex_.sameScope(a,b):this.policy==ydn.db.tr.Thread.Policy.ALL?!0:!1};
ydn.db.tr.Parallel.prototype.processTx=function(a,b,c,d){var e;this.scope_store_names&&(b=this.scope_store_names);this.scope_mode&&(c=this.scope_mode);var f=goog.isDef(c)?c:ydn.db.base.TransactionMode.READ_ONLY,g=this,h;c=function(a,b){goog.log.fine(g.logger,e+" "+a);if(h)h.onCompleted(a,b);g.r_no_=0};var k=function(c){g.tx_no_++;h=new ydn.db.tr.ParallelTxExecutor(c,g.tx_no_,b,f);e=g.getLabel();goog.log.fine(g.logger,e+" BEGIN "+ydn.json.stringify(b)+" "+f);g.pl_tx_ex_=h;g.pl_tx_ex_.executeTx(a,d)},
l=this.isActive()&&this.reusedTx(b,f);if(ydn.db.tr.Parallel.DEBUG){var m=this.isActive()?"active":"inactive";goog.global.console.log(this+" "+this.pl_tx_ex_+(l?" reusing "+m+" transaction":" opening "+m+" transaction ")+" for mode:"+f+" scopes:"+ydn.json.stringify(b))}if(l)this.pl_tx_ex_.executeTx(a,d);else{if(this.max_tx_no&&this.tx_no_>=this.max_tx_no)throw new ydn.debug.error.InvalidOperationException("Exceed maximum number of transactions of "+this.max_tx_no);this.getStorage().transaction(k,b,
f,c)}};ydn.db.tr.Parallel.prototype.request=function(a,b,c,d){var e=new ydn.db.Request(a);a=c||ydn.db.base.TransactionMode.READ_ONLY;var f=this;if(ydn.db.tr.Parallel.DEBUG){var g="SN"+Math.random(),g=g.replace(".","");goog.global.console.log(this+" scheduling to execute "+b+" "+a+" "+g)}this.processTx(function(a){ydn.db.tr.Parallel.DEBUG&&goog.global.console.log(f+" executing "+g);f.r_no_++;var b=f.getLabel()+"R"+f.r_no_;e.setTx(a,b)},b,a,function(a,b){e.removeTx();d&&d(a,b)});return e};
ydn.db.tr.Parallel.prototype.exec=function(a,b,c,d,e){var f=this,g;if(ydn.db.tr.Parallel.DEBUG){var h="SN"+Math.random(),h=h.replace(".","");goog.global.console.log(this+" scheduling to execute "+c+" "+d+" "+h)}this.processTx(function(c){ydn.db.tr.Parallel.DEBUG&&goog.global.console.log(this+" executing "+h);f.r_no_++;g=f.getLabel()+"R"+f.r_no_;goog.log.finer(f.logger,g+" BEGIN");b(c,g,function(b,d){f.p_request_tx=c;g=f.getLabel()+"R"+f.r_no_;d?(goog.log.finer(f.logger,g+" ERROR"),a.errback(b)):(goog.log.finer(f.logger,
g+" SUCCESS"),a.callback(b));f.p_request_tx=null});b=null;goog.log.finer(f.logger,g+" END")},c,d,e)};goog.DEBUG&&(ydn.db.tr.Parallel.prototype.toString=function(){var a=this.p_request_tx?"*":"";return"Parallel:"+this.policy+":"+this.getLabel()+a});ydn.db.tr.AtomicParallel=function(a,b){ydn.db.tr.Parallel.call(this,a,b,ydn.db.tr.Thread.Policy.SINGLE)};goog.inherits(ydn.db.tr.AtomicParallel,ydn.db.tr.Parallel);ydn.db.tr.AtomicParallel.DEBUG=!1;ydn.db.tr.AtomicParallel.prototype.logger=goog.log.getLogger("ydn.db.tr.AtomicParallel");
ydn.db.tr.AtomicParallel.prototype.reusedTx=function(a,b){return!1};ydn.db.tr.AtomicParallel.prototype.request=function(a,b,c){var d,e,f,g=this,h=ydn.db.tr.AtomicParallel.superClass_.request.call(this,a,b,c,function(a,b){h.removeTx();goog.log.finer(g.logger,"transaction "+a);if(d)a!=ydn.db.base.TxEventTypes.COMPLETE&&(f=!0,e=b),d(e,f);else{var c=new ydn.db.TimeoutError;h.setDbValue(c,!0)}});h.await(function(a,b,c){f=b;e=a;d=c});return h};
ydn.db.tr.AtomicParallel.prototype.exec=function(a,b,c,d,e){var f,g,h=new goog.async.Deferred;h.addCallbacks(function(a){g=!1;f=a},function(a){g=!0;f=a});ydn.db.tr.AtomicParallel.superClass_.exec.call(this,h,b,c,d,function(b,c){if(b!=ydn.db.base.TxEventTypes.COMPLETE)a.errback(c);else if(!0===g)a.errback(f);else if(!1===g)a.callback(f);else{var d=new ydn.db.TimeoutError;a.errback(d)}e&&(e(b,c),e=void 0)})};goog.DEBUG&&(ydn.db.tr.AtomicParallel.prototype.toString=function(){return"Atomic"+ydn.db.tr.AtomicParallel.superClass_.toString.call(this)});
ydn.db.tr.Storage=function(a,b,c){ydn.db.con.Storage.call(this,a,b,c);this.ptx_no=0;a=!0;b=ydn.db.tr.Thread.Policy.SINGLE;c&&(goog.isDef(c.isSerial)&&(a=!!c.isSerial),c.policy&&(b=c.policy));c=this.newTxQueue(b,a);this.sync_thread=this.newTxQueue(ydn.db.tr.Thread.Policy.ATOMIC,!1);this.db_operator=this.newOperator(c,this.sync_thread)};goog.inherits(ydn.db.tr.Storage,ydn.db.con.Storage);ydn.db.tr.Storage.prototype.ptx_no=0;
ydn.db.tr.Storage.prototype.branch=function(a,b,c,d,e,f){a=a||ydn.db.tr.Thread.Policy.SINGLE;var g;d==ydn.db.base.StandardTransactionMode.READ_ONLY?g=ydn.db.base.TransactionMode.READ_ONLY:d==ydn.db.base.StandardTransactionMode.READ_WRITE&&(g=ydn.db.base.TransactionMode.READ_WRITE);a=this.newTxQueue(a,b,c,g,e);return this.newOperator(a,f?null:this.sync_thread)};ydn.db.tr.Storage.prototype.newOperator=function(a,b){return new ydn.db.tr.DbOperator(this,this.schema,a,b)};
ydn.db.tr.Storage.prototype.newTxQueue=function(a,b,c,d,e){if(b){if(a==ydn.db.tr.Thread.Policy.MULTI||a==ydn.db.tr.Thread.Policy.REPEAT||a==ydn.db.tr.Thread.Policy.ALL||a==ydn.db.tr.Thread.Policy.SINGLE)return new ydn.db.tr.Serial(this,this.ptx_no++,a,c,d,e);if(a==ydn.db.tr.Thread.Policy.ATOMIC)return new ydn.db.tr.AtomicSerial(this,this.ptx_no++);throw new ydn.debug.error.ArgumentException('Invalid requestType "'+a+'"');}if(a==ydn.db.tr.Thread.Policy.MULTI||a==ydn.db.tr.Thread.Policy.REPEAT||a==
ydn.db.tr.Thread.Policy.ALL||a==ydn.db.tr.Thread.Policy.SINGLE)return new ydn.db.tr.Parallel(this,this.ptx_no++,a,c,d,e);if(a==ydn.db.tr.Thread.Policy.ATOMIC)return new ydn.db.tr.AtomicParallel(this,this.ptx_no++);throw new ydn.debug.error.ArgumentException('Invalid requestType "'+a+'"');};
ydn.db.tr.Storage.prototype.run=function(a,b,c){if(goog.DEBUG&&3<arguments.length)throw new ydn.debug.error.ArgumentException("too many input arguments, run accept not more than 3 input arguments, but "+arguments.length+" found.");this.ptx_no++;var d=b||this.schema.getStoreNames(),e=ydn.db.base.TransactionMode.READ_ONLY;if(c)if(c==ydn.db.base.StandardTransactionMode.READ_WRITE)e=ydn.db.base.TransactionMode.READ_WRITE;else if(c!=ydn.db.base.StandardTransactionMode.READ_ONLY)throw new ydn.debug.error.ArgumentException('Invalid transaction mode "'+
c+'"');var f=this.newTxQueue(ydn.db.tr.Thread.Policy.ALL,!1,d,e,1),g=this.newOperator(f,this.sync_thread),h=new ydn.db.Request(ydn.db.Request.Method.RUN),k=this;f.processTx(function(b){goog.log.finest(k.logger,"executing run in transaction on "+f);h.setTx(b,f.getLabel()+"R0");a(g)},d,e,function(a,b){h.removeTx();var c=a===ydn.db.base.TxEventTypes.COMPLETE;h.setDbValue(f.getTxNo(),!c)});return h};ydn.db.tr.Storage.prototype.getTxNo=function(){return this.db_operator?this.db_operator.getTxNo():NaN};
ydn.db.crud.Storage=function(a,b,c){ydn.db.tr.Storage.call(this,a,b,c);a=this.schema;for(b=0;b<a.countFullTextIndex();b++){c=a.fullTextIndex(b);var d=a.getStore(c.getName());if(d){if(!d.hasIndex("k"))throw new ydn.debug.error.ArgumentException('full text index store "'+d.getName()+'" must have "keyword" index');if(!d.hasIndex("v"))throw new ydn.debug.error.ArgumentException('full text index store "'+d.getName()+'" must have "keyword" index');if("id"!=d.getKeyPath())throw new ydn.debug.error.ArgumentException('full text index store "'+
d.getName()+'" must use "id" as key path.');}else throw new ydn.debug.error.ArgumentException('full text index store "'+c.getName()+'" required.');for(d=0;d<c.count();d++){var e=c.index(d),f=a.getStore(e.getStoreName());if(f)this.addFullTextIndexer(f,c);else throw new ydn.debug.error.ArgumentException('full text source store "'+e.getStoreName()+'" does not exist for full text index "'+c.getName()+'"');}}};goog.inherits(ydn.db.crud.Storage,ydn.db.tr.Storage);ydn.db.crud.Storage.prototype.init=function(){ydn.db.crud.Storage.superClass_.init.call(this)};
ydn.db.crud.Storage.prototype.newOperator=function(a,b){return new ydn.db.crud.DbOperator(this,this.schema,a,b)};ydn.db.crud.Storage.prototype.getCoreOperator=function(){return this.db_operator};ydn.db.crud.Storage.prototype.add=function(a,b,c){return this.getCoreOperator().add(a,b,c)};ydn.db.crud.Storage.prototype.count=function(a,b,c,d){return this.getCoreOperator().count(a,b,c,d)};ydn.db.crud.Storage.prototype.get=function(a,b){return this.getCoreOperator().get(a,b)};
ydn.db.crud.Storage.prototype.keys=function(a,b,c,d,e,f,g){return this.getCoreOperator().keys(a,b,c,d,e,f,g)};ydn.db.crud.Storage.prototype.values=function(a,b,c,d,e,f){return this.getCoreOperator().values(a,b,c,d,e,f)};ydn.db.crud.Storage.prototype.list=function(a,b,c,d,e,f,g,h,k){return this.getCoreOperator().list(a,b,c,d,e,f,g,h,k)};ydn.db.crud.Storage.prototype.load=function(a,b,c){return this.getCoreOperator().load(a,b,c)};
ydn.db.crud.Storage.prototype.put=function(a,b,c){return this.getCoreOperator().put(a,b,c)};ydn.db.crud.Storage.prototype.clear=function(a,b,c){return this.getCoreOperator().clear(a,b,c)};ydn.db.crud.Storage.prototype.remove=function(a,b,c){return this.getCoreOperator().remove(a,b,c)};goog.DEBUG&&(ydn.db.crud.Storage.prototype.toString=function(){var a="Storage:"+this.getName();this.isReady()&&(a+=" ["+this.getType()+"]");return a});
ydn.db.core.Storage=function(a,b,c){ydn.db.crud.Storage.call(this,a,b,c)};goog.inherits(ydn.db.core.Storage,ydn.db.crud.Storage);ydn.db.core.Storage.prototype.newOperator=function(a,b){return new ydn.db.core.DbOperator(this,this.schema,a,b)};ydn.db.core.Storage.prototype.getIndexOperator=function(){return this.db_operator};ydn.db.core.Storage.prototype.open=function(a,b,c,d){return this.getIndexOperator().open(a,b,c,d)};
ydn.db.core.Storage.prototype.listIter=function(a,b,c,d){return this.getIndexOperator().listIter(a,b,c,d)};ydn.db.core.Storage.prototype.scan=function(a,b){return this.getIndexOperator().scan(a,b)};ydn.db.core.Storage.prototype.map=function(a,b){return this.getIndexOperator().map(a,b)};ydn.db.core.Storage.prototype.reduce=function(a,b,c){return this.getIndexOperator().reduce(a,b,c)};ydn.db.core.req.IDBCursor=function(a,b,c,d){ydn.db.core.req.AbstractCursor.call(this,a,b,c,d);this.request_=null};
goog.inherits(ydn.db.core.req.IDBCursor,ydn.db.core.req.AbstractCursor);ydn.db.core.req.IDBCursor.DEBUG=!1;ydn.db.core.req.IDBCursor.prototype.logger=goog.log.getLogger("ydn.db.core.req.IDBCursor");ydn.db.core.req.IDBCursor.prototype.defaultOnSuccess=function(a){a=a.target.result;ydn.db.core.req.IDBCursor.DEBUG&&goog.global.console.log(this+" onSuccess "+(a?a.key+", "+a.primaryKey:""));if(a)this.onSuccess(a.key,a.primaryKey,a.value);else this.onSuccess()};
ydn.db.core.req.IDBCursor.prototype.openCursor=function(a,b){var c=this+" opening ";goog.isDefAndNotNull(a)&&(c+="{"+a,c=goog.isDefAndNotNull(b)?c+(";"+b+"}"):c+"}");goog.log.finest(this.logger,c);var d=this.key_range,c=this.tx.objectStore(this.store_name),e=goog.isString(this.index_name)?c.index(this.index_name):null;if(goog.isDef(a))var f=e?!goog.isDef(b):!0,g=d?d.lower:void 0,h=d?d.upper:void 0,k=d?!!d.lowerOpen:!1,d=d?!!d.upperOpen:!1,d=(this.reverse?new ydn.db.KeyRange(g,a,k,f):new ydn.db.KeyRange(a,
h,f,d)).toIDBKeyRange();var l;l=this.isValueCursor()?e?goog.isDefAndNotNull(this.dir)?e.openCursor(d,this.dir):goog.isDefAndNotNull(d)?e.openCursor(d):e.openCursor():goog.isDefAndNotNull(this.dir)?c.openCursor(d,this.dir):goog.isDefAndNotNull(d)?c.openCursor(d):c.openCursor():e?goog.isDefAndNotNull(this.dir)?e.openKeyCursor(d,this.dir):goog.isDefAndNotNull(d)?e.openKeyCursor(d):e.openKeyCursor():goog.isDefAndNotNull(this.dir)?c.openCursor(d,this.dir):goog.isDefAndNotNull(d)?c.openCursor(d):c.openCursor();
var m=this;l.onerror=function(a){var b=l.error;a.preventDefault();m.onError(b)};var n=function(a,b,c){ydn.db.core.req.IDBCursor.DEBUG&&goog.global.console.log(m+" requestReady "+a);m.request_=l;m.request_.onsuccess=goog.bind(m.defaultOnSuccess,m);b=m.isIndexCursor()?b:void 0;m.onSuccess(a,b,c);l=null};goog.isDefAndNotNull(a)?(ydn.db.core.req.IDBCursor.DEBUG&&goog.global.console.log(m+" seeking start position, now "+a),l.onsuccess=function(c){if(c=c.target.result){var d=ydn.db.base.indexedDb.cmp(c.key,
a),e=m.reverse?-1:1;if(d==e)n(c.key,c.primaryKey,c.value);else if(d==-e)c["continue"](a);else if(goog.isDefAndNotNull(b))if(ydn.db.base.indexedDb.cmp(c.primaryKey,b)==e)n(c.key,c.primaryKey,c.value);else c["continue"]();else c["continue"]()}else n()}):(m.request_=l,ydn.db.core.req.IDBCursor.DEBUG&&goog.global.console.log(m+" ready ",m.request_),m.request_.onsuccess=goog.bind(m.defaultOnSuccess,m))};ydn.db.core.req.IDBCursor.prototype.hasCursor=function(){return!!this.request_};
ydn.db.core.req.IDBCursor.prototype.update=function(a){var b=this.request_.result;if(b){var c=new goog.async.Deferred;a=b.update(a);a.onsuccess=function(a){c.callback(a.target.result)};a.onerror=function(a){a.preventDefault();c.errback(a)};return c}throw new ydn.db.InvalidAccessError("cursor gone");};
ydn.db.core.req.IDBCursor.prototype.clear=function(){var a=this.request_.result;if(a){var b=new goog.async.Deferred,a=a["delete"]();a.onsuccess=function(a){b.callback(1)};a.onerror=function(a){a.preventDefault();b.errback(a)};return b}throw new ydn.db.InvalidAccessError("cursor gone");};ydn.db.core.req.IDBCursor.prototype.advance=function(a){var b=this.request_.result;if(1==a)b["continue"]();else b.advance(a)};
ydn.db.core.req.IDBCursor.prototype.continuePrimaryKey=function(a){var b=this.request_.result;if(goog.DEBUG){var c=ydn.db.base.indexedDb.cmp(a,b.primaryKey);if(c!=(this.reverse?-1:1))throw new ydn.debug.error.InternalError('continuing primary key "'+a+'" must '+(this.reverse?"lower":"higher")+' than current primary key "'+b.primaryKey+'"');}var d=this;this.request_.onsuccess=function(e){if(b=e.target.result)if(c=ydn.db.base.indexedDb.cmp(b.primaryKey,a),0==c||1==c&&!d.reverse||-1==c&&d.reverse)d.request_.onsuccess=
goog.bind(d.defaultOnSuccess,d),e=d.isIndexCursor()?b.primaryKey:void 0,d.onSuccess(b.key,e,b.value);else b["continue"]();else d.request_.onsuccess=goog.bind(d.defaultOnSuccess,d),d.onSuccess()};b["continue"]()};ydn.db.core.req.IDBCursor.prototype.continueEffectiveKey=function(a){var b=this.request_.result;if(goog.isDefAndNotNull(a))b["continue"](a);else b["continue"]()};
ydn.db.core.req.IDBCursor.prototype.disposeInternal=function(){ydn.db.core.req.IDBCursor.superClass_.disposeInternal.call(this);this.request_=null};goog.DEBUG&&(ydn.db.core.req.IDBCursor.prototype.toString=function(){return"IDB"+ydn.db.core.req.IDBCursor.superClass_.toString.call(this)});
goog.async.DeferredList=function(a,b,c,d,e,f){goog.async.DeferredList.base(this,"constructor",e,f);this.list_=a;this.deferredResults_=[];this.fireOnOneCallback_=!!b;this.fireOnOneErrback_=!!c;this.consumeErrors_=!!d;for(b=this.numFinished_=0;b<a.length;b++)a[b].addCallbacks(goog.bind(this.handleCallback_,this,b,!0),goog.bind(this.handleCallback_,this,b,!1));0!=a.length||this.fireOnOneCallback_||this.callback(this.deferredResults_)};goog.inherits(goog.async.DeferredList,goog.async.Deferred);
goog.async.DeferredList.prototype.handleCallback_=function(a,b,c){this.numFinished_++;this.deferredResults_[a]=[b,c];this.hasFired()||(this.fireOnOneCallback_&&b?this.callback([a,c]):this.fireOnOneErrback_&&!b?this.errback(c):this.numFinished_==this.list_.length&&this.callback(this.deferredResults_));this.consumeErrors_&&!b&&(c=null);return c};goog.async.DeferredList.prototype.errback=function(a){goog.async.DeferredList.base(this,"errback",a);for(a=0;a<this.list_.length;a++)this.list_[a].cancel()};
goog.async.DeferredList.gatherResults=function(a){return(new goog.async.DeferredList(a,!1,!0)).addCallback(function(a){for(var c=[],d=0;d<a.length;d++)c[d]=a[d][1];return c})};ydn.db.crud.req.IndexedDb=function(a,b){ydn.db.crud.req.RequestExecutor.call(this,a,b)};goog.inherits(ydn.db.crud.req.IndexedDb,ydn.db.crud.req.RequestExecutor);ydn.db.crud.req.IndexedDb.prototype.logger=goog.log.getLogger("ydn.db.crud.req.IndexedDb");ydn.db.crud.req.IndexedDb.DEBUG=!1;ydn.db.crud.req.IndexedDb.REQ_PER_TX=10;
ydn.db.crud.req.IndexedDb.prototype.countStores=function(a,b){var c=[],d=function(e){var f=b[e],g=a.getTx().objectStore(f).count();g.onsuccess=function(f){ydn.db.crud.req.IndexedDb.DEBUG&&goog.global.console.log(f);c[e]=f.target.result;e++;e==b.length?a.setDbValue(c):d(e)};g.onerror=function(b){ydn.db.crud.req.IndexedDb.DEBUG&&goog.global.console.log(b);b.preventDefault();a.setDbValue(g.error,!0)}};0==b.length?a.setDbValue([]):d(0)};
ydn.db.crud.req.IndexedDb.prototype.insertObjects=function(a,b,c,d,e,f){var g=[],h=0,k=!1,l=this,m=b?"put":"add",n=a.getTx().objectStore(d),p=a.getLabel()+" "+m+" "+e.length+' objects to store "'+d+'"';goog.log.finest(this.logger,p);var q=function(p){if(!goog.isDefAndNotNull(e[p]))if(goog.log.finest(l.logger,"empty object at "+p+" of "+e.length),h++,h==e.length)a.setDbValue(g,k);else{var s=p+ydn.db.crud.req.IndexedDb.REQ_PER_TX;s<e.length&&q(s)}var t,s=e[p];t=f&&goog.isDefAndNotNull(f[p])?b?n.put(s,
f[p]):n.add(s,f[p]):b?n.put(s):n.add(s);t.onsuccess=function(b){h++;ydn.db.crud.req.IndexedDb.DEBUG&&goog.global.console.log([d,b,p]);g[p]=b.target.result;h==e.length?a.setDbValue(c?g[0]:g,k):(b=p+ydn.db.crud.req.IndexedDb.REQ_PER_TX,b<e.length&&q(b))};t.onerror=function(b){h++;ydn.db.crud.req.IndexedDb.DEBUG&&goog.global.console.log([d,b,p]);var f=t.error;goog.log.finest(l.logger,a.getLabel()+m+' request to "'+d+'" cause '+f.name+' for object "'+ydn.json.toShortString(e[p])+'" at index '+p+" of "+
e.length+" objects.");g[p]=f;k=!0;b.preventDefault();h==e.length?a.setDbValue(c?g[0]:g,k):(b=p+ydn.db.crud.req.IndexedDb.REQ_PER_TX,b<e.length&&q(b))}};if(0<e.length)for(p=0;p<ydn.db.crud.req.IndexedDb.REQ_PER_TX&&p<e.length;p++)q(p);else a.setDbValue([])};
ydn.db.crud.req.IndexedDb.prototype.putByKeys=function(a,b,c){var d=[],e=0,f=!1,g=this,h=a.getLabel()+" putByKeys: of "+b.length+" objects";goog.log.finest(this.logger,h);var k=function(h){var m=c[h],n=m.getStoreName(),p=a.getTx().objectStore(n),q;q=goog.isNull(p.keyPath)?p.put(b[h],m.getId()):p.put(b[h]);q.onsuccess=function(c){e++;d[h]=c.target.result;e==b.length?a.setDbValue(d,f):(c=h+ydn.db.crud.req.IndexedDb.REQ_PER_TX,c<b.length&&k(c))};q.onerror=function(c){e++;ydn.db.crud.req.IndexedDb.DEBUG&&
goog.global.console.log([n,c]);var m=c.name;goog.DEBUG&&goog.log.warning(g.logger,"request result "+m+' error when put keys to "'+n+'" for object "'+ydn.json.toShortString(b[h])+'" at index '+h+" of "+b.length+" objects.");d[h]=q.error;f=!0;c.preventDefault();e==b.length?a.setDbValue(d,f):(c=h+ydn.db.crud.req.IndexedDb.REQ_PER_TX,c<b.length&&k(c))}};if(0<b.length)for(h=0;h<ydn.db.crud.req.IndexedDb.REQ_PER_TX&&h<b.length;h++)k(h);else a.setDbValue(d,f)};
ydn.db.crud.req.IndexedDb.prototype.putData=function(a,b,c,d,e,f){var g=this.schema.getStore(d),h=a.objectStore(d),k=[],l=e.indexOf("\n"),m=e.substr(0,l).split(f),n=[];for(a=0;a<m.length;a++){var p=g.getIndex(m[a]);p?n[a]=p.getType():m[a]==g.getKeyPath()&&(n[a]=g.getType())}l++;goog.log.finest(this.logger,b+" Loading data  of "+m.length+"-fields record to "+d);var q=function(){var a={},b=e.indexOf("\n",l),p=!1,v;-1==b?(p=!0,v=e.substring(l)):(v=e.substring(l,b),l=b+1);for(var b=v.split(f),w=0;w<m.length;w++){var x=
b[w];n[w]&&(n[w]==ydn.db.schema.DataType.TEXT?x=goog.string.stripQuotes(x,'"'):n[w]==ydn.db.schema.DataType.INTEGER?x=parseInt(x,10):n[w]==ydn.db.schema.DataType.NUMERIC&&(x=parseFloat(x)));a[m[w]]=x}var z=h.put(a);z.onsuccess=function(a){k.push(a.target.result);p?c(k):q()};z.onerror=function(a){ydn.db.crud.req.IndexedDb.DEBUG&&goog.global.console.log([d,a]);goog.DEBUG&&"DataError"==a.name&&(a=new ydn.db.InvalidKeyException(g+": "+v.substring(0,70)));a.preventDefault();c(z.error,!0)}};q()};
ydn.db.crud.req.IndexedDb.prototype.removeById=function(a,b,c){var d=a.getTx().objectStore(b),e=a.getLabel()+" clearById: "+b+" "+c;goog.log.finest(this.logger,e);var f=d.openCursor(ydn.db.IDBKeyRange.only(c));f.onsuccess=function(d){ydn.db.crud.req.IndexedDb.DEBUG&&goog.global.console.log([b,c,d]);if(d=d.target.result){var e=d["delete"]();e.onsuccess=function(b){a.setDbValue(1)};e.onerror=function(b){a.setDbValue(e.error,!0)}}else a.setDbValue(0)};f.onerror=function(d){ydn.db.crud.req.IndexedDb.DEBUG&&
goog.global.console.log([b,c,d]);d.preventDefault();a.setDbValue(f.error,!0)}};
ydn.db.crud.req.IndexedDb.prototype.removeByKeys=function(a,b){var c=0,d,e,f=a.getLabel()+" removeByKeys: "+b.length+" keys";goog.log.finest(this.logger,f);var g=[],h=function(f){f++;if(f>=b.length)0<g.length?a.setDbValue(g,!0):a.setDbValue(c);else{b[f].getStoreName()!=d&&(d=b[f].getStoreName(),e=a.getTx().objectStore(d));var l=e["delete"](b[f].getId());l.onsuccess=function(a){c++;h(f)};l.onerror=function(a){ydn.db.crud.req.IndexedDb.DEBUG&&goog.global.console.log([d,void 0,a]);a.preventDefault();
g[f]=l.error;h(f)}}};h(-1)};ydn.db.crud.req.IndexedDb.prototype.removeByKeyRange=function(a,b,c){var d=a.getTx().objectStore(b),e=d.count(c),f=a.getLabel()+" clearByKeyRange: "+b+" "+c;goog.log.finest(this.logger,f);e.onsuccess=function(b){var e=b.target.result,f=d["delete"](c);f.onsuccess=function(){a.setDbValue(e)};f.onerror=function(b){a.setDbValue(f.error,!0)}};e.onerror=function(d){ydn.db.crud.req.IndexedDb.DEBUG&&goog.global.console.log([b,c,d]);d.preventDefault();a.setDbValue(e.error,!0)}};
ydn.db.crud.req.IndexedDb.prototype.clearByKeyRange=function(a,b,c){var d=a.getTx().objectStore(b);b=a.getLabel()+" "+b+" "+c;goog.log.finest(this.logger,b);var e=d["delete"](c);e.onsuccess=function(b){a.setDbValue(void 0)};e.onerror=function(b){b.preventDefault();a.setDbValue(e.error,!0)}};
ydn.db.crud.req.IndexedDb.prototype.removeByIndexKeyRange=function(a,b,c,d){var e=a.getTx().objectStore(b).index(c);b=a.getLabel()+" clearByIndexKeyRange: "+b+":"+c+" "+d;goog.log.finest(this.logger,b);var f=[],g=e.openCursor(d),h=0;g.onsuccess=function(b){var c=b.target.result;if(c){var d=c["delete"]();d.onsuccess=function(){h++;c["continue"]()};d.onerror=function(a){f.push(d.error);a.preventDefault();c["continue"]()}}else 0<f.length?a.setDbValue(f,!0):a.setDbValue(h)};g.onerror=function(b){b.preventDefault();
a.setDbValue(g.error,!0)}};ydn.db.crud.req.IndexedDb.prototype.clearByStores=function(a,b){var c=b.length,d=0,e=a.getLabel()+" clearByStores: "+b;goog.log.finest(this.logger,e);for(e=0;e<c;e++){var f=b[e],g=a.getTx().objectStore(f).clear();g.onsuccess=function(b){d++;d==c&&a.setDbValue(d)};g.onerror=function(b){d++;ydn.db.crud.req.IndexedDb.DEBUG&&goog.global.console.log([d,b]);b.preventDefault();d==c&&a.setDbValue(g.error,!0)}}};
ydn.db.crud.req.IndexedDb.prototype.getById=function(a,b,c){var d=this,e=a.getLabel()+b+":"+c;goog.log.finest(this.logger,e);var f=a.getTx().objectStore(b),g=f.get(c);g.onsuccess=function(e){ydn.db.crud.req.IndexedDb.DEBUG&&goog.global.console.log([b,c,e]);goog.log.finest(d.logger,a.getLabel()+" record "+c+(goog.isDefAndNotNull(e.target.result)?" ":" not ")+" exists.");var g=e.target.result;if(!f.keyPath&&0==f.indexNames.length&&goog.userAgent.WEBKIT&&goog.isString(g)&&0<=g.indexOf(";base64,")){'"'==
g.charAt(0)&&'"'==g.charAt(g.length-1)&&(g=g.substr(1,g.length-2));g=g.split(";base64,");e=g[0].split(":")[1];for(var g=window.atob(g[1]),l=g.length,m=new Uint8Array(l),n=0;n<l;++n)m[n]=g.charCodeAt(n);e=new Blob([m.buffer],{type:e});a.setDbValue(e)}else a.setDbValue(e.target.result)};g.onerror=function(d){ydn.db.crud.req.IndexedDb.DEBUG&&goog.global.console.log([b,c,d]);d.preventDefault();a.setDbValue(g.error,!0)}};
ydn.db.crud.req.IndexedDb.prototype.listByIds=function(a,b,c){var d=[];d.length=c.length;var e=0,f=a.getTx().objectStore(b),g=c.length,h=a.getLabel()+" "+b+":"+g+" ids";goog.log.finest(this.logger,h);var k=function(h){if(!goog.isDefAndNotNull(c[h]))if(e++,d[h]=void 0,e==g)a.setDbValue(d);else{var m=h+ydn.db.crud.req.IndexedDb.REQ_PER_TX;m<g&&k(m)}var n;n=f.get(c[h]);n.onsuccess=function(f){e++;ydn.db.crud.req.IndexedDb.DEBUG&&goog.global.console.log([b,c,h,f]);d[h]=f.target.result;e==g?a.setDbValue(d):
(f=h+ydn.db.crud.req.IndexedDb.REQ_PER_TX,f<g&&k(f))};n.onerror=function(d){e++;ydn.db.crud.req.IndexedDb.DEBUG&&goog.global.console.log([b,c,h,d]);d.preventDefault();a.setDbValue(n.error,!0)}};if(0<g)for(h=0;h<ydn.db.crud.req.IndexedDb.REQ_PER_TX&&h<g;h++)k(h);else a.setDbValue([])};
ydn.db.crud.req.IndexedDb.prototype.listByKeys=function(a,b){var c=[];c.length=b.length;var d=0,e=a.getLabel()+" "+b.length+" ids";goog.log.finest(this.logger,e);var f=function(e){var h=b[e],k=a.getTx().objectStore(h.getStoreName()).get(h.getId());k.onsuccess=function(h){d++;ydn.db.crud.req.IndexedDb.DEBUG&&goog.global.console.log(h);c[e]=h.target.result;d==b.length?a.setDbValue(c):(h=e+ydn.db.crud.req.IndexedDb.REQ_PER_TX,h<b.length&&f(h))};k.onerror=function(c){d++;ydn.db.crud.req.IndexedDb.DEBUG&&
goog.global.console.log([b,c]);c.preventDefault();a.setDbValue(k.error,!0)}};if(0<b.length)for(e=0;e<ydn.db.crud.req.IndexedDb.REQ_PER_TX&&e<b.length;e++)f(e);else a.setDbValue([])};
ydn.db.crud.req.IndexedDb.prototype.countKeyRange=function(a,b,c,d,e){if(goog.DEBUG&&d&&e)throw new ydn.debug.error.InvalidOperationException("unique count not available in IndexedDB");e=a.getTx().objectStore(b);b=a.getLabel()+" "+b+(d?":"+d:"")+(c?":"+ydn.json.stringify(c):"");goog.log.finest(this.logger,b);var f;goog.isDefAndNotNull(d)?(d=e.index(d),f=goog.isDefAndNotNull(c)?d.count(c):d.count()):f=goog.isDefAndNotNull(c)?e.count(c):e.count();f.onsuccess=function(b){ydn.db.crud.req.IndexedDb.DEBUG&&
goog.global.console.log(b);a.setDbValue(b.target.result)};f.onerror=function(b){ydn.db.crud.req.IndexedDb.DEBUG&&goog.global.console.log(b);b.preventDefault();a.setDbValue(f.error,!0)}};
ydn.db.crud.req.IndexedDb.prototype.list=function(a,b,c,d,e,f,g,h,k,l){var m=[],n=a.getTx().objectStore(c),p=ydn.db.base.getDirection(h,k),q=a.getLabel()+" "+b+" "+c+(d?":"+d:"")+(e?ydn.json.stringify(e):"");h&&(q+=" reverse");k&&(q+=" unique");if(l&&goog.isDef(l[0])){k=d?!goog.isDef(l[1]):!0;var r=l[0],s=e?e.lower:void 0,t=e?e.upper:void 0,v=e?!!e.lowerOpen:!1;e=e?!!e.upperOpen:!1;e=(h?new ydn.db.KeyRange(s,r,v,k):new ydn.db.KeyRange(r,t,k,e)).toIDBKeyRange();q+=" starting from "+ydn.json.stringify(l[0]);
goog.isDef(l[1])&&(q+=", "+ydn.json.stringify(l[1]))}goog.log.finest(this.logger,q);var w;w=b==ydn.db.base.QueryMethod.LIST_KEY||b==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY||b==ydn.db.base.QueryMethod.LIST_KEYS?d?n.index(d).openKeyCursor(e,p):n.openCursor(e,p):d?n.index(d).openCursor(e,p):n.openCursor(e,p);var x=!1;w.onsuccess=function(c){if(c=c.target.result){if(!x){if(0<g){x=!0;c.advance(g);return}if(l&&d&&goog.isDef(l[0]))if(goog.isDef(l[1])){var e=ydn.db.base.indexedDb.cmp(c.key,l[0]),k=h?-1:
1;if(0==e){e=ydn.db.base.indexedDb.cmp(c.primaryKey,l[1]);if(0==e){x=!0;c["continue"]();return}if(e==k)x=!0;else{c["continue"]();return}}else x=!0}else x=!0;else x=!0}b==ydn.db.base.QueryMethod.LIST_KEY?m.push(c.key):b==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY?m.push(c.primaryKey):b==ydn.db.base.QueryMethod.LIST_KEYS?(k={},d&&(k[d]=c.key),n.keyPath?k[n.keyPath]=c.primaryKey:k[ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME]=c.primaryKey,m.push(k)):b==ydn.db.base.QueryMethod.LIST_VALUE?m.push(c.value):m.push([c.key,
c.primaryKey,c.value]);if(m.length<f)c["continue"]();else l&&(l[0]=ydn.db.Key.clone(c.key),l[1]=ydn.db.Key.clone(c.primaryKey)),a.setDbValue(m)}else l&&(l[0]=void 0,l[1]=void 0),a.setDbValue(m)};w.onerror=function(b){ydn.db.crud.req.IndexedDb.DEBUG&&goog.global.console.log([c,b]);b.preventDefault();a.setDbValue(w.error,!0)}};ydn.db.core.req.IndexedDb=function(a,b){ydn.db.crud.req.IndexedDb.call(this,a,b)};goog.inherits(ydn.db.core.req.IndexedDb,ydn.db.crud.req.IndexedDb);
ydn.db.core.req.IndexedDb.DEBUG=!1;ydn.db.core.req.IndexedDb.prototype.logger=goog.log.getLogger("ydn.db.core.req.IndexedDb");ydn.db.core.req.IndexedDb.prototype.getCursor=function(a,b,c,d){var e=this.schema.getStore(c);goog.asserts.assertObject(e,'store "'+c+'" not found.');return new ydn.db.core.req.IDBCursor(a,b,e,d)};ydn.db.core.req.IndexedDb.prototype.getStreamer=function(a,b,c,d){return new ydn.db.Streamer(a,c,d)};ydn.db.base.Mutex=function(){this.state_=!1};
ydn.db.base.Mutex.prototype.state_=!1;ydn.db.base.Mutex.prototype.up=function(){goog.asserts.assert(!this.state_,"Mutex already up.");this.state_=!0};ydn.db.base.Mutex.prototype.down=function(){goog.asserts.assert(this.state_,"Mutex already down.");this.state_=!1};ydn.db.base.Mutex.prototype.state=function(){return this.state_};
ydn.db.core.req.SimpleCursor=function(a,b,c,d){ydn.db.core.req.AbstractCursor.call(this,a,b,c,d);goog.asserts.assert(c);this.value_=this.primary_key_=this.key_=void 0;this.onCursorComplete_=this.current_=null;this.result_ready_=new ydn.db.base.Mutex;this.store_=this.buffer_=null};goog.inherits(ydn.db.core.req.SimpleCursor,ydn.db.core.req.AbstractCursor);ydn.db.core.req.SimpleCursor.DEBUG=!1;ydn.db.core.req.SimpleCursor.prototype.logger=goog.log.getLogger("ydn.db.core.req.SimpleCursor");
ydn.db.core.req.SimpleCursor.prototype.hasCursor=function(){return this.isActive()};ydn.db.core.req.SimpleCursor.prototype.update=function(a){this.store_.addRecord(this.getPrimaryKey(),a);return goog.async.Deferred.succeed()};
ydn.db.core.req.SimpleCursor.prototype.advance=function(a){var b=this,c=this.current_?-1:0;ydn.db.core.req.SimpleCursor.DEBUG&&goog.global.console.log(this+(this.current_?" advancing ":" starting ")+a+" step");var d=function(d){c++;if(!d||c>=a)return ydn.db.core.req.SimpleCursor.DEBUG&&goog.global.console.log("advance to "+(d?d.value:"null")),b.defaultOnSuccess_(d)};this.reverse?this.buffer_.reverseTraverse(d,this.current_):this.buffer_.traverse(d,this.current_)};
ydn.db.core.req.SimpleCursor.prototype.continueEffectiveKey=function(a){if(goog.isDefAndNotNull(a)){var b=this,c=new ydn.db.con.simple.Node(a),d=function(c){b.current_=c;if(!c)return b.defaultOnSuccess_(c);var d=c.value.getKey(),d=ydn.db.cmp(d,a);if(b.reverse){if(1!=d)return b.defaultOnSuccess_(c)}else if(-1!=d)return b.defaultOnSuccess_(c)};this.reverse?this.buffer_.reverseTraverse(d,c):this.buffer_.traverse(d,c)}else this.advance(1)};
ydn.db.core.req.SimpleCursor.prototype.dispatchOnSuccess_=function(){var a=this;setTimeout(function(){a.result_ready_.state()?(ydn.db.core.req.SimpleCursor.DEBUG&&goog.global.console.log(this+" invoke success "+a.key_),a.result_ready_.down(),a.onSuccess(a.key_,a.primary_key_,a.value_),a.dispatchOnSuccess_()):(ydn.db.core.req.SimpleCursor.DEBUG&&goog.global.console.log(this+" complete"),a.onCursorComplete_(),a.onCursorComplete_=null)},4)};
ydn.db.core.req.SimpleCursor.prototype.defaultOnSuccess_=function(a){if(this.current_=a){a=a.value;if(this.key_range)if(!this.reverse&&goog.isDefAndNotNull(this.key_range.upper)){var b=ydn.db.cmp(a.getKey(),this.key_range.upper);if(1==b||0==b&&this.key_range.upperOpen)this.current_=null}else this.reverse&&goog.isDefAndNotNull(this.key_range.lower)&&(b=ydn.db.cmp(a.getKey(),this.key_range.lower),-1==b||0==b&&this.key_range.lowerOpen)&&(this.current_=null);if(this.current_){if(this.unique&&(goog.isDefAndNotNull(this.key_)&&
goog.isDefAndNotNull(a.getKey()))&&0==ydn.db.cmp(this.key_,a.getKey()))return;this.key_=a.getKey();this.primary_key_=this.is_index?a.getPrimaryKey():this.key_;this.query_method==ydn.db.base.QueryMethod.LIST_VALUE&&(this.isValueCursor()?(goog.asserts.assert(goog.isDefAndNotNull(this.primary_key_)),this.value_=this.store_.getRecord(null,this.primary_key_)):this.value_=this.primary_key_)}}this.current_||(this.value_=this.primary_key_=this.key_=void 0);this.result_ready_.up();ydn.db.core.req.SimpleCursor.DEBUG&&
goog.global.console.log(this+" new position "+(this.key_+(this.is_index?", "+this.primary_key_:""))+" "+this.result_ready_);return!0};
ydn.db.core.req.SimpleCursor.prototype.openCursor=function(a,b){var c=null;if(this.key_range)if(this.reverse){var d=this.is_index?"\uffff":void 0;goog.isDefAndNotNull(this.key_range.upper)&&(c=new ydn.db.con.simple.Node(this.key_range.upper,d))}else goog.isDefAndNotNull(this.key_range.lower)&&(c=new ydn.db.con.simple.Node(this.key_range.lower));goog.isDefAndNotNull(a)&&(c=this.isIndexCursor()?new ydn.db.con.simple.Node(a,b):new ydn.db.con.simple.Node(a));this.onCursorComplete_=this.tx.getStorage(function(b){var d=
function(b){var d=b.value,e=d.getKey();if(b&&goog.isDefAndNotNull(e))if(goog.isDefAndNotNull(a)){if(0==ydn.db.con.simple.Node.cmp(c,d))return}else if(this.key_range&&(!this.reverse&&(this.key_range.lowerOpen&&goog.isDefAndNotNull(this.key_range.lower))&&(d=ydn.db.cmp(e,this.key_range.lower),0==d)||this.reverse&&(this.key_range.upperOpen&&goog.isDefAndNotNull(this.key_range.upper))&&(d=ydn.db.cmp(e,this.key_range.upper),0==d)))return;return this.defaultOnSuccess_(b)};this.store_=b.getSimpleStore(this.store_name);
this.buffer_=this.store_.getIndexCache(this.index_name);this.reverse?this.buffer_.reverseTraverse(goog.bind(d,this),c):this.buffer_.traverse(goog.bind(d,this),c);this.dispatchOnSuccess_()},this)};ydn.db.core.req.SimpleCursor.prototype.clear=function(){throw new ydn.debug.error.NotImplementedException;};ydn.db.core.req.SimpleCursor.prototype.continuePrimaryKey=function(a){throw new ydn.debug.error.NotImplementedException;};
goog.DEBUG&&(ydn.db.core.req.SimpleCursor.prototype.toString=function(){return"Simple"+ydn.db.core.req.SimpleCursor.superClass_.toString.call(this)});ydn.db.con.simple={};ydn.db.con.simple.NAMESPACE="ydn.db";ydn.db.con.simple.SEP="^|";ydn.db.con.simple.makeKey=function(a,b,c,d){a=[ydn.db.con.simple.NAMESPACE,a];goog.isDef(b)&&(a.push(b),goog.isDef(c)&&(a.push(c),goog.isDef(d)&&a.push(ydn.db.utils.encodeKey(d))));return a.join(ydn.db.con.simple.SEP)};
ydn.db.con.simple.Node=function(a,b){this.key=a;this.primary_key=b};ydn.db.con.simple.Node.prototype.getKey=function(){return this.key};ydn.db.con.simple.Node.prototype.getPrimaryKey=function(){return this.primary_key};goog.DEBUG&&(ydn.db.con.simple.Node.prototype.toString=function(){return"ydn.db.con.simple.Node("+this.key+(goog.isDefAndNotNull(this.primary_key)?", "+this.primary_key+")":")")});
ydn.db.con.simple.Node.cmp=function(a,b){var c=ydn.db.cmp(a.key,b.key);return 0===c?goog.isDefAndNotNull(a.primary_key)?goog.isDefAndNotNull(b.primary_key)?ydn.db.cmp(a.primary_key,b.primary_key):1:goog.isDefAndNotNull(b.primary_key)?-1:0:c};goog.structs.AvlTree=function(a){this.comparator_=a||goog.structs.AvlTree.DEFAULT_COMPARATOR_};goog.structs.AvlTree.DEFAULT_COMPARATOR_=function(a,b){return String(a)<String(b)?-1:String(a)>String(b)?1:0};goog.structs.AvlTree.prototype.root_=null;
goog.structs.AvlTree.prototype.comparator_=null;goog.structs.AvlTree.prototype.minNode_=null;goog.structs.AvlTree.prototype.maxNode_=null;
goog.structs.AvlTree.prototype.add=function(a){if(null==this.root_)return this.maxNode_=this.minNode_=this.root_=new goog.structs.AvlTree.Node(a),!0;var b=null;this.traverse_(function(c){var d=null,e=this.comparator_(c.value,a);0<e?(d=c.left,null==c.left&&(b=new goog.structs.AvlTree.Node(a,c),c.left=b,c==this.minNode_&&(this.minNode_=b))):0>e&&(d=c.right,null==c.right&&(b=new goog.structs.AvlTree.Node(a,c),c.right=b,c==this.maxNode_&&(this.maxNode_=b)));return d});b&&(this.traverse_(function(a){a.count++;
return a.parent},b.parent),this.balance_(b.parent));return!!b};goog.structs.AvlTree.prototype.remove=function(a){var b=null;this.traverse_(function(c){var d=null,e=this.comparator_(c.value,a);0<e?d=c.left:0>e?d=c.right:(b=c.value,this.removeNode_(c));return d});return b};goog.structs.AvlTree.prototype.clear=function(){this.maxNode_=this.minNode_=this.root_=null};
goog.structs.AvlTree.prototype.contains=function(a){var b=!1;this.traverse_(function(c){var d=null,e=this.comparator_(c.value,a);0<e?d=c.left:0>e?d=c.right:b=!0;return d});return b};goog.structs.AvlTree.prototype.indexOf=function(a){var b=-1,c=0;this.traverse_(function(d){var e=this.comparator_(d.value,a);if(0<e)return d.left;d.left&&(c+=d.left.count);if(0>e)return c++,d.right;b=c;return null});return b};goog.structs.AvlTree.prototype.getCount=function(){return this.root_?this.root_.count:0};
goog.structs.AvlTree.prototype.getKthValue=function(a){return 0>a||a>=this.getCount()?null:this.getKthNode_(a).value};goog.structs.AvlTree.prototype.getMinimum=function(){return this.getMinNode_().value};goog.structs.AvlTree.prototype.getMaximum=function(){return this.getMaxNode_().value};goog.structs.AvlTree.prototype.getHeight=function(){return this.root_?this.root_.height:0};goog.structs.AvlTree.prototype.getValues=function(){var a=[];this.inOrderTraverse(function(b){a.push(b)});return a};
goog.structs.AvlTree.prototype.inOrderTraverse=function(a,b){if(this.root_){var c;if(b){if(this.traverse_(function(a){var d=null,e=this.comparator_(a.value,b);0<e?(d=a.left,c=a):0>e?d=a.right:c=a;return d}),!c)return}else c=this.getMinNode_();for(var d=c,e=c.left?c.left:c;null!=d;)if(null!=d.left&&d.left!=e&&d.right!=e)d=d.left;else{if(d.right!=e&&a(d.value))break;var f=d,d=null!=d.right&&d.right!=e?d.right:d.parent,e=f}}};
goog.structs.AvlTree.prototype.reverseOrderTraverse=function(a,b){if(this.root_){var c;if(b){if(this.traverse_(goog.bind(function(a){var d=null,e=this.comparator_(a.value,b);0<e?d=a.left:(0>e&&(d=a.right),c=a);return d},this)),!c)return}else c=this.getMaxNode_();for(var d=c,e=c.right?c.right:c;null!=d;)if(null!=d.right&&d.right!=e&&d.left!=e)d=d.right;else{if(d.left!=e&&a(d.value))break;var f=d,d=null!=d.left&&d.left!=e?d.left:d.parent,e=f}}};
goog.structs.AvlTree.prototype.traverse_=function(a,b,c){b=b?b:this.root_;for(c=c?c:null;b&&b!=c;)b=a.call(this,b)};
goog.structs.AvlTree.prototype.balance_=function(a){this.traverse_(function(a){var c=a.left?a.left.height:0,d=a.right?a.right.height:0;1<c-d?(a.left.right&&(!a.left.left||a.left.left.height<a.left.right.height)&&this.leftRotate_(a.left),this.rightRotate_(a)):1<d-c&&(a.right.left&&(!a.right.right||a.right.right.height<a.right.left.height)&&this.rightRotate_(a.right),this.leftRotate_(a));c=a.left?a.left.height:0;d=a.right?a.right.height:0;a.height=Math.max(c,d)+1;return a.parent},a)};
goog.structs.AvlTree.prototype.leftRotate_=function(a){a.isLeftChild()?(a.parent.left=a.right,a.right.parent=a.parent):a.isRightChild()?(a.parent.right=a.right,a.right.parent=a.parent):(this.root_=a.right,this.root_.parent=null);var b=a.right;a.right=a.right.left;null!=a.right&&(a.right.parent=a);b.left=a;a.parent=b;b.count=a.count;a.count-=(b.right?b.right.count:0)+1};
goog.structs.AvlTree.prototype.rightRotate_=function(a){a.isLeftChild()?(a.parent.left=a.left,a.left.parent=a.parent):a.isRightChild()?(a.parent.right=a.left,a.left.parent=a.parent):(this.root_=a.left,this.root_.parent=null);var b=a.left;a.left=a.left.right;null!=a.left&&(a.left.parent=a);b.right=a;a.parent=b;b.count=a.count;a.count-=(b.left?b.left.count:0)+1};
goog.structs.AvlTree.prototype.removeNode_=function(a){if(null!=a.left||null!=a.right){var b=null,c;if(null!=a.left){c=this.getMaxNode_(a.left);this.traverse_(function(a){a.count--;return a.parent},c);if(c!=a.left){if(c.parent.right=c.left)c.left.parent=c.parent;c.left=a.left;c.left.parent=c;b=c.parent}c.parent=a.parent;c.right=a.right;c.right&&(c.right.parent=c);a==this.maxNode_&&(this.maxNode_=c)}else{c=this.getMinNode_(a.right);this.traverse_(function(a){a.count--;return a.parent},c);if(c!=a.right){if(c.parent.left=
c.right)c.right.parent=c.parent;c.right=a.right;c.right.parent=c;b=c.parent}c.parent=a.parent;c.left=a.left;c.left&&(c.left.parent=c);a==this.minNode_&&(this.minNode_=c)}c.count=a.count;a.isLeftChild()?a.parent.left=c:a.isRightChild()?a.parent.right=c:this.root_=c;this.balance_(b?b:c)}else this.traverse_(function(a){a.count--;return a.parent},a.parent),a.isLeftChild()?(this.special=1,a.parent.left=null,a==this.minNode_&&(this.minNode_=a.parent),this.balance_(a.parent)):a.isRightChild()?(a.parent.right=
null,a==this.maxNode_&&(this.maxNode_=a.parent),this.balance_(a.parent)):this.clear()};goog.structs.AvlTree.prototype.getKthNode_=function(a,b){var c=b||this.root_,d=c.left?c.left.count:0;return a<d?this.getKthNode_(a,c.left):a==d?c:this.getKthNode_(a-d-1,c.right)};goog.structs.AvlTree.prototype.getMinNode_=function(a){if(!a)return this.minNode_;var b=a;this.traverse_(function(a){var d=null;a.left&&(d=b=a.left);return d},a);return b};
goog.structs.AvlTree.prototype.getMaxNode_=function(a){if(!a)return this.maxNode_;var b=a;this.traverse_(function(a){var d=null;a.right&&(d=b=a.right);return d},a);return b};goog.structs.AvlTree.Node=function(a,b){this.value=a;this.parent=b?b:null;this.count=1};goog.structs.AvlTree.Node.prototype.left=null;goog.structs.AvlTree.Node.prototype.right=null;goog.structs.AvlTree.Node.prototype.height=1;goog.structs.AvlTree.Node.prototype.isRightChild=function(){return!!this.parent&&this.parent.right==this};
goog.structs.AvlTree.Node.prototype.isLeftChild=function(){return!!this.parent&&this.parent.left==this};ydn.structs={};ydn.structs.Buffer=function(a){goog.structs.AvlTree.call(this,a)};goog.inherits(ydn.structs.Buffer,goog.structs.AvlTree);
ydn.structs.Buffer.prototype.traverse=function(a,b){if(this.root_){var c;if(b instanceof goog.structs.AvlTree.Node)c=b;else if(b){if(this.traverse_(function(a){var d=null;0<this.comparator_(a.value,b)?(d=a.left,c=a):0>this.comparator_(a.value,b)?d=a.right:c=a;return d}),!c)return}else c=this.getMinNode_();for(var d=c,e=c.left?c.left:c;null!=d;)if(null!=d.left&&d.left!=e&&d.right!=e)d=d.left;else{if(d.right!=e&&a(d))return;var f=d,d=null!=d.right&&d.right!=e?d.right:d.parent,e=f}a(null)}};
ydn.structs.Buffer.prototype.reverseTraverse=function(a,b){if(this.root_){var c;if(b instanceof goog.structs.AvlTree.Node)c=b;else if(b){if(this.traverse_(goog.bind(function(a){var d=null;0<this.comparator_(a.value,b)?d=a.left:(0>this.comparator_(a.value,b)&&(d=a.right),c=a);return d},this)),!c)return}else c=this.getMaxNode_();for(var d=c,e=c.right?c.right:c;null!=d;)if(null!=d.right&&d.right!=e&&d.left!=e)d=d.right;else{if(d.left!=e&&a(d))return;var f=d,d=null!=d.left&&d.left!=e?d.left:d.parent,
e=f}a(null)}};ydn.structs.Buffer.prototype.iter=function(a,b,c){return new ydn.structs.Buffer.Iterator(a,b,c)};
ydn.structs.Buffer.prototype.scan=function(a,b){var c=b instanceof ydn.structs.Buffer.Iterator?b:this.iter(b);if(this.root_){var d,e=!1;if(c.current_)d=c.current_;else if(c.key_range_){var f;c.reverse_&&goog.isDefAndNotNull(c.key_range_.upper)?(f=c.key_range_.upper,e=!!c.key_range_.upperOpen):goog.isDefAndNotNull(c.key_range_.lower)&&(f=c.key_range_.lower,e=!!c.key_range_.lowerOpen);this.traverse_(goog.bind(function(a){var b=null;0<this.comparator_(a.value,f)?b=a.left:(0>this.comparator_(a.value,
f)&&(b=a.right),d=a);return b},this))}else d||(d=this.getMaxNode_());if(d){var g=d,h;if(c.reverse_){for(h=d.right?d.right:d;null!=g;)if(null!=g.right&&g.right!=h&&g.left!=h)g=g.right;else{if(g.left!=h){c.current_=g;if(e){e=!1;continue}if(a(g.value))return}var k=g,g=null!=g.left&&g.left!=h?g.left:g.parent;h=k}c.current_=null;a()}else for(h=d.left?d.left:d;null!=g;)if(null!=g.left&&g.left!=h&&g.right!=h)g=g.left;else{if(g.right!=h){c.current_=g;if(e){e=!1;continue}if(a(g.value))break}k=g;g=null!=g.right&&
g.right!=h?g.right:g.parent;h=k}}else c.current_=null,a()}else a()};ydn.structs.Buffer.prototype.union=function(a){this.getMinNode_();for(a=a.getMinNode_();a;);};ydn.structs.Buffer.Iterator=function(a,b,c){this.key_range_=a||null;this.reverse_=!!b;this.unique_=!!c;this.current_=null};ydn.structs.Buffer.Iterator.prototype.key_range_=null;ydn.structs.Buffer.Iterator.prototype.reverse_=!1;ydn.structs.Buffer.Iterator.prototype.unique_=!1;ydn.structs.Buffer.Iterator.prototype.current_=null;
ydn.db.con.simple.Store=function(a,b,c){this.db_name=a;this.storage=b;this.schema=c;this.key_indexes={};a=this.schema.getKeyPath();this.primary_index=goog.isArray(a)?a.join(","):a||ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME;this.key_indexes[this.primary_index]=null;this.key_prefix=ydn.db.con.simple.makeKey(this.db_name,this.schema.getName(),this.primary_index)+ydn.db.con.simple.SEP};ydn.db.con.simple.Store.DEBUG=!1;ydn.db.con.simple.Store.prototype.makeKey=function(a){return this.key_prefix+ydn.db.utils.encodeKey(a)};
ydn.db.con.simple.Store.prototype.extractKey=function(a){return ydn.db.utils.decodeKey(a.substr(this.key_prefix.length))};ydn.db.con.simple.Store.prototype.generateKey=function(){var a=this.makeKey(),b=ydn.json.parse(this.storage.getItem(a));b.key_count||(b.key_count=0);b.key_count++;this.storage.setItem(a,ydn.json.stringify(b));return b.key_count};
ydn.db.con.simple.Store.prototype.getIndexCache=function(a){a=a||this.primary_index;if(!this.key_indexes[a]){this.key_indexes[a]=new ydn.structs.Buffer(ydn.db.con.simple.Node.cmp);for(var b=this.storage.length,c=0;c<b;c++){var d=this.storage.key(c);if(!goog.isNull(d)&&goog.string.startsWith(d,this.key_prefix)){var e=this.extractKey(d);if(a==this.primary_index)e=new ydn.db.con.simple.Node(e),this.key_indexes[a].add(e);else{var f=this.storage.getItem(d);if(!goog.isNull(f))if(d=this.schema.getIndex(a),
f=ydn.json.parse(f),f=d.extractKey(f),d.isMultiEntry()){if(goog.isArray(f))for(d=0;d<f.length;d++){var g=new ydn.db.con.simple.Node(f[d],e);this.key_indexes[a].add(g)}}else e=new ydn.db.con.simple.Node(f,e),this.key_indexes[a].add(e)}}}ydn.db.con.simple.Store.DEBUG&&goog.global.console.log("index "+a+" of "+this.schema.getName()+" for "+this.key_indexes[a].getCount()+" records.")}return this.key_indexes[a]};
ydn.db.con.simple.Store.prototype.updateIndex=function(a,b){for(var c in this.key_indexes){var d=this.key_indexes[c];if(d)if(ydn.db.con.simple.Store.DEBUG&&goog.global.console.log("updating "+a+" in index "+c+" of "+this.schema.getName()),c==this.primary_index)d.add(new ydn.db.con.simple.Node(a));else{var e=this.schema.getIndex(c),e=ydn.db.utils.getValueByKeys(b,e.getKeyPath());goog.isDefAndNotNull(e)&&(e=new ydn.db.con.simple.Node(a,e),d.add(e))}}};
ydn.db.con.simple.Store.prototype.removeIndex=function(a,b){for(var c in this.key_indexes){var d=this.key_indexes[c];if(d)if(ydn.db.con.simple.Store.DEBUG&&goog.global.console.log("removing "+a+" in index "+c+" of "+this.schema.getName()),c==this.primary_index)d.remove(new ydn.db.con.simple.Node(a));else{var e=this.schema.getIndex(c),e=ydn.db.utils.getValueByKeys(b,e.getKeyPath()),e=new ydn.db.con.simple.Node(a,e);d.remove(e)}}};
ydn.db.con.simple.Store.prototype.clearIndexCache=function(){for(var a in this.key_indexes){var b=this.key_indexes[a];b&&(b.clear(),ydn.db.con.simple.Store.DEBUG&&goog.global.console.log("index "+a+" of "+this.schema.getName()+" cleared."))}this.key_indexes={}};
ydn.db.con.simple.Store.prototype.addRecord=function(a,b,c){goog.isDefAndNotNull(a)||(this.schema.usedInlineKey()&&(a=this.schema.extractKey(b)),this.schema.isAutoIncrement()&&!goog.isDefAndNotNull(a)&&(a=this.generateKey()));goog.asserts.assert(goog.isDefAndNotNull(a),this+"primary key not provided in "+ydn.json.toShortString(b));ydn.db.con.simple.Store.DEBUG&&goog.global.console.log("add "+a);if(c&&!goog.isNull(this.storage.getItem(this.makeKey(a))))return null;this.storage.setItem(this.makeKey(a),
ydn.json.stringify(b));this.updateIndex(a,b);return a};ydn.db.con.simple.Store.prototype.removeRecord=function(a){var b=this.makeKey(a),c=this.storage.getItem(b);if(goog.isNull(c))return 0;this.storage.removeItem(b);b=ydn.json.parse(c);this.removeIndex(a,b);return 1};ydn.db.con.simple.Store.prototype.clear=function(){this.clearIndexCache();this.removeRecords()};
ydn.db.con.simple.Store.prototype.getRecord=function(a,b){if(a&&a!=this.primary_index)throw goog.asserts.assert(this.schema.hasIndex(a),'index "'+a+'" not found in '+this),"impl";var c=this.storage.getItem(this.makeKey(b)),d=void 0;if(!goog.isNull(c))for(var d=ydn.json.parse(c),c=0,e=this.schema.countIndex();c<e;c++){var f=this.schema.index(c);if(f.getType()==ydn.db.schema.DataType.DATE){var g=f.extractKey(d);g&&f.applyValue(d,new Date(g))}}return d};ydn.db.con.simple.Store.prototype.getName=function(){return this.schema.getName()};
ydn.db.con.simple.Store.prototype.countRecords=function(a,b){a=a||this.primary_index;var c=this.getIndexCache(a),d=null,e=null,f=0,g=!1,h=!1;goog.isDefAndNotNull(b)&&(goog.isDefAndNotNull(b.lower)&&(d=new ydn.db.con.simple.Node(b.lower)),goog.isDefAndNotNull(b.upper)&&(e=new ydn.db.con.simple.Node(b.upper)),g=b.lowerOpen,h=b.upperOpen);c.traverse(function(a){if(goog.isDefAndNotNull(a)&&(a=a.value,!g||!goog.isDefAndNotNull(d)||0!=ydn.db.cmp(a.getKey(),d.getKey()))){if(goog.isDefAndNotNull(e)&&(a=ydn.db.cmp(a.getKey(),
e.getKey()),1===a||0===a&&h))return!0;f++}},d);return f};
ydn.db.con.simple.Store.prototype.removeRecords=function(a){var b=this,c=this.getIndexCache(this.primary_index),d=null,e=null,f=0,g=[],h=[],k=!1,l=!1;goog.isDefAndNotNull(a)&&(goog.isDefAndNotNull(a.lower)&&(d=new ydn.db.con.simple.Node(a.lower)),goog.isDefAndNotNull(a.upper)&&(e=new ydn.db.con.simple.Node(a.upper)),k=a.lowerOpen,l=a.upperOpen);c.traverse(function(a){if(goog.isDefAndNotNull(a)&&(a=a.value,!k||!goog.isDefAndNotNull(d)||0!=ydn.db.con.simple.Node.cmp(a,d))){if(goog.isDefAndNotNull(e)){var c=
ydn.db.con.simple.Node.cmp(a,e);if(1===c||0===c&&l)return!0}var c=b.makeKey(a.getKey()),p=b.storage.getItem(c);goog.isNull(p)||(b.storage.removeItem(c),f++,ydn.db.con.simple.Store.DEBUG&&goog.global.console.log(f+". remove "+a.getKey()+" "+c),10>g.length&&(g.push(a.getKey()),h.push(ydn.json.parse(p))))}},d);if(10>g.length)for(a=0;a<g.length;a++)this.removeIndex(g[a],h[a]);else this.clearIndexCache();return f};
ydn.db.con.simple.Store.prototype.getItems=function(a,b,c,d,e,f,g,h){var k=[],l,m=!!h&&goog.isDefAndNotNull(h[0]);b=b||this.primary_index;var n=b!=this.primary_index;b=this.getIndexCache(b);var p=null,q=null;goog.isDef(f)||(f=0);var r=-1,s=!1,t=!1;goog.isDefAndNotNull(c)&&(goog.isDefAndNotNull(c.lower)&&(p=n&&d?new ydn.db.con.simple.Node(c.lower,"\uffff"):new ydn.db.con.simple.Node(c.lower)),goog.isDefAndNotNull(c.upper)&&(q=n&&!d?new ydn.db.con.simple.Node(c.upper,"\uffff"):new ydn.db.con.simple.Node(c.upper)),
s=!!c.lowerOpen,t=!!c.upperOpen);if(m){d?t=!0:s=!0;c=h[0];var v=goog.isDef(h[1])?h[1]:"\uffff";d?q=n?new ydn.db.con.simple.Node(c,v):new ydn.db.con.simple.Node(c):p=n?new ydn.db.con.simple.Node(c,v):new ydn.db.con.simple.Node(c)}ydn.db.con.simple.Store.DEBUG&&goog.global.console.log(this+" "+(d?" rev":"")+" from "+p+" to "+q);var w=this;c=function(b){if(b&&(r++,!(r<f))){var c=b.value;if(d){if(t&&goog.isDefAndNotNull(q)&&(b=m?ydn.db.con.simple.Node.cmp(c,q):ydn.db.cmp(c.getKey(),q.getKey()),0==b))return;
if(goog.isDefAndNotNull(p)&&(b=m?ydn.db.con.simple.Node.cmp(c,p):ydn.db.cmp(c.getKey(),p.getKey()),-1==b||0==b&&s))return h&&(h[0]=void 0,h[1]=void 0),!0}else{if(s&&goog.isDefAndNotNull(p)&&(b=m?ydn.db.con.simple.Node.cmp(c,p):ydn.db.cmp(c.getKey(),p.getKey()),0==b))return;if(goog.isDefAndNotNull(q)&&(b=m?ydn.db.con.simple.Node.cmp(c,q):ydn.db.cmp(c.getKey(),q.getKey()),1==b||0==b&&t))return h&&(h[0]=void 0,h[1]=void 0),!0}b=c.getKey();if(!g||!n||!goog.isDefAndNotNull(l)||0!=ydn.db.cmp(l,b)){c=n?
c.getPrimaryKey():b;if(a==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY)k.push(c);else if(a==ydn.db.base.QueryMethod.LIST_KEY)k.push(b);else if(a==ydn.db.base.QueryMethod.LIST_KEYS)k.push([b,c]);else if(a==ydn.db.base.QueryMethod.LIST_VALUE){var y=w.getRecord(null,c);k.push(y)}else k.push([b,c,w.getRecord(null,c)]);h&&(h[0]=b,h[1]=c)}l=b;if(goog.isDef(e)&&k.length>=e)return!0}};d?b.reverseTraverse(c,q):b.traverse(c,p);return k};
ydn.db.con.simple.Store.prototype.getRecords=function(a,b,c,d,e){return this.getItems(ydn.db.base.QueryMethod.LIST_VALUE,a,b,c,d,e)};ydn.db.con.simple.Store.prototype.getKeys=function(a,b,c,d,e){return this.getItems(ydn.db.base.QueryMethod.LIST_PRIMARY_KEY,a,b,c,d,e)};goog.DEBUG&&(ydn.db.con.simple.Store.prototype.toString=function(){return"ydn.db.con.simple.Store:"+this.db_name+":"+this.schema.getName()});ydn.db.con.simple.IStorageProvider=function(){};
ydn.db.con.simple.IStorageProvider.prototype.connectDb=function(a){};ydn.db.req={};ydn.db.req.InMemoryStorage=function(){this.clear()};ydn.db.req.InMemoryStorage.prototype.connectDb=function(a){return this};ydn.db.req.InMemoryStorage.prototype.setItem=function(a,b){goog.isDef(this.memoryStorage[a])||(this.keys.push(a.toString()),this.length=this.keys.length);this.memoryStorage[a]=b};
ydn.db.req.InMemoryStorage.prototype.getItem=function(a){return goog.isDef(this.memoryStorage[a])?this.memoryStorage[a]:null};ydn.db.req.InMemoryStorage.prototype.removeItem=function(a){delete this.memoryStorage[a];goog.array.remove(this.keys,a.toString());this.length=this.keys.length};ydn.db.req.InMemoryStorage.prototype.length=0;ydn.db.req.InMemoryStorage.prototype.key=function(a){a=this.keys[a];return goog.isDef(a)?this.memoryStorage[a]:null};
ydn.db.req.InMemoryStorage.prototype.clear=function(){this.memoryStorage={};this.keys=[];this.length=0};ydn.db.con.SimpleStorageService=function(a){this.provider_=a||new ydn.db.req.InMemoryStorage;this.simple_stores_={}};ydn.db.con.SimpleStorageService.DEFAULT_KEY_PATH="_id_";
ydn.db.con.SimpleStorageService.prototype.getSimpleStore=function(a){var b=this.schema.getStore(a);if(b)this.simple_stores_[a]||(this.simple_stores_[a]=new ydn.db.con.simple.Store(this.dbname,this.storage_,b));else throw new ydn.debug.error.InternalError('store name "'+a+'" not found.');return this.simple_stores_[a]};
ydn.db.con.SimpleStorageService.prototype.getSchema=function(a){var b=this;setTimeout(function(){var c=ydn.db.con.simple.makeKey(b.dbname),c=b.storage_.getItem(c),c=new ydn.db.schema.Database(c);a(c)},10)};ydn.db.con.simple.TxStorage=function(a,b){this.storage_=a;this.on_completed_=b};
ydn.db.con.simple.TxStorage.prototype.getStorage=function(a,b){var c=this.storage_;goog.asserts.assertObject(c,"transaction already committed");setTimeout(function(){a.call(b,c)},4);var d=this;return function(){d.on_completed_(ydn.db.base.TxEventTypes.COMPLETE,null);d.on_completed_=null;d.storage_=null}};ydn.db.crud.req.SimpleStore=function(a,b){ydn.db.crud.req.RequestExecutor.call(this,a,b)};goog.inherits(ydn.db.crud.req.SimpleStore,ydn.db.crud.req.RequestExecutor);
ydn.db.crud.req.SimpleStore.prototype.logger=goog.log.getLogger("ydn.db.crud.req.SimpleStore");ydn.db.crud.req.SimpleStore.SYNC=!0;ydn.db.crud.req.SimpleStore.DEBUG=!1;ydn.db.crud.req.SimpleStore.prototype.putByKeys=function(a,b,c){this.insertObjects(a,!0,!1,null,b,c)};
ydn.db.crud.req.SimpleStore.prototype.insertObjects=function(a,b,c,d,e,f){var g=a.getLabel()+" "+(b?"put":"add")+"Object"+(c?"":"s "+e.length+" objects");goog.log.finest(this.logger,g);var h=a.getTx().getStorage(function(g){var l;if(c)goog.asserts.assertString(d,"store name must be provided"),l=g.getSimpleStore(d),g=f?f[0]:void 0,g=l.addRecord(g,e[0],!b),goog.isDefAndNotNull(g)?a.setDbValue(g):(l=goog.DEBUG?ydn.json.toShortString(g):"",l=new ydn.db.ConstraintError(l),a.setDbValue(l,!0));else{for(var m=
d,n=[],p=!1,q=f||{},r=0;r<e.length;r++){var s;d?s=q[r]:(m=f[r],s=m.getId(),m=m.getStoreName());l&&l.getName()==m||(goog.asserts.assertString(m,"store name a string, but "+m),l=g.getSimpleStore(m));s=l.addRecord(s,e[r],!b);goog.isDefAndNotNull(s)?n.push(s):(p=!0,n.push(new ydn.db.ConstraintError))}a.setDbValue(n,p)}h();h=null},this)};ydn.db.crud.req.SimpleStore.prototype.putData=function(a,b,c,d,e,f){throw new ydn.debug.error.NotImplementedException("putData");};
ydn.db.crud.req.SimpleStore.prototype.getById=function(a,b,c){var d=a.getTx().getStorage(function(e){e=e.getSimpleStore(b).getRecord(null,c);a.setDbValue(e);d();d=null},this)};ydn.db.crud.req.SimpleStore.prototype.listByIds_=function(a,b,c){var d=a.getTx().getStorage(function(e){for(var f=[],g=b,h,k=0;k<c.length;k++){var l=c[k];l instanceof ydn.db.Key&&(g=l,l=g.getId(),g=g.getStoreName());h&&h.getName()==g||(h=e.getSimpleStore(g));l=h.getRecord(null,l);f[k]=l}a.setDbValue(f,!1);d();d=null},this)};
ydn.db.crud.req.SimpleStore.prototype.listByIds=function(a,b,c){this.listByIds_(a,b,c)};ydn.db.crud.req.SimpleStore.prototype.listByKeys=function(a,b){this.listByIds_(a,null,b)};ydn.db.crud.req.SimpleStore.prototype.removeById=function(a,b,c){var d=a.getLabel()+" removeById "+b+" "+c;goog.log.finest(this.logger,d);var e=this,f=a.getTx().getStorage(function(g){g=g.getSimpleStore(b).removeRecord(c);goog.log.finer(e.logger,"success "+d+(0==g?" [not found]":""));a.setDbValue(g);f();f=null},this)};
ydn.db.crud.req.SimpleStore.prototype.removeByKeys=function(a,b){var c=a.getLabel()+" removeByKeys "+b.length+" keys";goog.log.finest(this.logger,c);var d,e=0,f=a.getTx().getStorage(function(c){for(var h=0;h<b.length;h++){var k=b[h].getStoreName(),l=b[h].getId();d&&d.getName()==k||(d=c.getSimpleStore(k));e+=d.removeRecord(l)}a.setDbValue(e);f();f=null},this)};ydn.db.crud.req.SimpleStore.prototype.clearByKeyRange=function(a,b,c){this.removeByKeyRange(a,b,c)};
ydn.db.crud.req.SimpleStore.prototype.removeByKeyRange=function(a,b,c){var d=a.getLabel()+" removeByKeyRange "+(c?ydn.json.stringify(c):"");goog.log.finest(this.logger,d);var e=this,f=a.getTx().getStorage(function(g){g=g.getSimpleStore(b).removeRecords(c);goog.log.finer(e.logger,d+" deleted "+g+" records.");a.setDbValue(g);f();f=null},this)};
ydn.db.crud.req.SimpleStore.prototype.removeByIndexKeyRange=function(a,b,c,d){var e=a.getLabel()+" removeByIndexKeyRange "+(d?ydn.json.stringify(d):"");goog.log.finest(this.logger,e);var f=a.getTx().getStorage(function(e){e=e.getSimpleStore(b);for(var h=e.getKeys(c,d),k=h.length,l=0;l<k;l++)e.removeRecord(h[l]);a.setDbValue(k);f();f=null},this)};
ydn.db.crud.req.SimpleStore.prototype.clearByStores=function(a,b){var c=a.getLabel()+" clearByStores";goog.log.finest(this.logger,c);var d=a.getTx().getStorage(function(e){for(var f=0;f<b.length;f++)e.getSimpleStore(b[f]).clear();goog.log.finer(this.logger,"success "+c);a.setDbValue(b.length);d();d=null},this)};
ydn.db.crud.req.SimpleStore.prototype.countStores=function(a,b){var c=a.getTx().getStorage(function(d){for(var e=[],f=0;f<b.length;f++){var g=d.getSimpleStore(b[f]);e.push(g.countRecords())}a.setDbValue(e);c();c=null},this)};
ydn.db.crud.req.SimpleStore.prototype.countKeyRange=function(a,b,c,d){var e=a.getLabel()+" count"+(goog.isDefAndNotNull(d)?"Index":"")+(goog.isDefAndNotNull(c)?"KeyRange":"Store");goog.log.finest(this.logger,e);var f=a.getTx().getStorage(function(g){g=g.getSimpleStore(b).countRecords(d,c);goog.log.finer(this.logger,"success "+e);a.setDbValue(g);f();f=null},this)};
ydn.db.crud.req.SimpleStore.prototype.list=function(a,b,c,d,e,f,g,h,k,l){var m=a.getLabel()+" "+c+" "+(e?ydn.json.toShortString(e):"");goog.log.finest(this.logger,m);var n=a.getTx().getStorage(function(p){p=p.getSimpleStore(c).getItems(b,d,e,h,f,g,k,l);goog.log.finer(this.logger,m+" "+p.length+" records found.");a.setDbValue(p);n();n=null},this)};ydn.db.core.req.SimpleStore=function(a,b){ydn.db.crud.req.SimpleStore.call(this,a,b)};goog.inherits(ydn.db.core.req.SimpleStore,ydn.db.crud.req.SimpleStore);
ydn.db.core.req.SimpleStore.DEBUG=!1;ydn.db.core.req.SimpleStore.prototype.getCursor=function(a,b,c,d){var e=this.schema.getStore(c);goog.asserts.assertObject(e,'store "'+c+'" not found.');return new ydn.db.core.req.SimpleCursor(a,b,e,d)};ydn.db.core.req.SimpleStore.prototype.getStreamer=function(a,b,c,d){throw"not yet";};
ydn.db.core.req.CachedWebsqlCursor=function(a,b,c,d){ydn.db.core.req.AbstractCursor.call(this,a,b,c,d);goog.asserts.assert(c);this.store_schema_=c;this.cursor_=null;this.current_cursor_index_=NaN;this.has_pending_request=!1};goog.inherits(ydn.db.core.req.CachedWebsqlCursor,ydn.db.core.req.AbstractCursor);ydn.db.core.req.CachedWebsqlCursor.DEBUG=!1;ydn.db.core.req.CachedWebsqlCursor.prototype.logger=goog.log.getLogger("ydn.db.core.req.CachedWebsqlCursor");
ydn.db.core.req.CachedWebsqlCursor.prototype.current_key_=null;ydn.db.core.req.CachedWebsqlCursor.prototype.current_primary_key_=null;ydn.db.core.req.CachedWebsqlCursor.prototype.current_value_=null;ydn.db.core.req.CachedWebsqlCursor.prototype.cursor_=null;ydn.db.core.req.CachedWebsqlCursor.prototype.current_cursor_index_=NaN;ydn.db.core.req.CachedWebsqlCursor.prototype.moveNext_=function(){this.current_cursor_index_++;return[this.getPrimaryKey(),this.getIndexKey(),this.getValue()]};
ydn.db.core.req.CachedWebsqlCursor.prototype.invokeNextSuccess_=function(){var a=this.moveNext_();ydn.db.core.req.CachedWebsqlCursor.DEBUG&&goog.global.console.log(["onSuccess",this.current_cursor_index_].concat(a));this.onSuccess(a[0],a[1],a[2])};
ydn.db.core.req.CachedWebsqlCursor.prototype.openCursor=function(a,b,c){var d=this,e=["SELECT"],f=[],g=this.store_schema_.getSQLKeyColumnName(),h=goog.string.quote(g),k=this.index_name?this.store_schema_.getIndex(this.index_name):null,l=k?k.getType():this.store_schema_.getType(),m=k?k.getSQLIndexColumnName():g,g=goog.string.quote(m),n=" ORDER BY ";this.isValueCursor()?(e.push("*"),k?(goog.asserts.assertString(m),n+=this.reverse?goog.string.quote(m)+" DESC, "+h+" DESC ":goog.string.quote(m)+" ASC, "+
h+" ASC "):n=n+h+(this.reverse?" DESC":" ASC")):k?(goog.asserts.assertString(m),e.push(goog.string.quote(m)+", "+h),n+=this.reverse?goog.string.quote(m)+" DESC, "+h+" DESC ":goog.string.quote(m)+" ASC, "+h+" ASC "):(e.push(h),n+=h,n+=this.reverse?" DESC":" ASC");e.push("FROM "+goog.string.quote(this.store_name));m=[];k&&k.isMultiEntry();k=this.key_range;if(goog.isDefAndNotNull(a))if(this.index_name){goog.asserts.assert(goog.isDefAndNotNull(b));if(goog.isDefAndNotNull(this.key_range)){h=ydn.db.base.indexedDb.cmp(b,
this.key_range.upper);if(1==h||0==h&&!this.key_range.upperOpen){this.onSuccess(void 0,void 0,void 0);return}k=ydn.db.IDBKeyRange.bound(b,this.key_range.upper,!1,this.key_range.upperOpen)}else k=ydn.db.IDBKeyRange.lowerBound(b);ydn.db.KeyRange.toSql(g,l,k,m,f)}else k=this.reverse?ydn.db.IDBKeyRange.upperBound(a,!!c):ydn.db.IDBKeyRange.lowerBound(a,!!c),ydn.db.KeyRange.toSql(h,this.store_schema_.getType(),k,m,f);else this.index_name?ydn.db.KeyRange.toSql(g,l,k,m,f):ydn.db.KeyRange.toSql(h,this.store_schema_.getType(),
k,m,f);0<m.length&&e.push("WHERE "+m.join(" AND "));e.push(n);var p=e.join(" ");goog.log.finest(d.logger,this+": opened: "+("{"+(b?b+"-":"")+(a?a:"")+"}")+" SQL: "+p+" : "+ydn.json.stringify(f));this.tx.executeSql(p,f,function(b,e){ydn.db.core.req.CachedWebsqlCursor.DEBUG&&goog.global.console.log([p,e]);d.has_pending_request=!1;d.cursor_=e;d.current_cursor_index_=0;if(d.index_name&&goog.isDefAndNotNull(a))for(var f=ydn.db.cmp(d.getPrimaryKey(),a);-1==f||0==f&&c;)d.current_cursor_index_++,f=ydn.db.cmp(d.getPrimaryKey(),
a);d.onSuccess(d.getPrimaryKey(),d.getIndexKey(),d.getValue())},function(a,b){ydn.db.core.req.CachedWebsqlCursor.DEBUG&&goog.global.console.log([p,a,b]);d.has_pending_request=!1;goog.log.warning(d.logger,"get error: "+b.message);d.onError(b);return!0})};ydn.db.core.req.CachedWebsqlCursor.prototype.hasCursor=function(){return!!this.cursor_&&this.current_cursor_index_<this.cursor_.rows.length};
ydn.db.core.req.CachedWebsqlCursor.prototype.getIndexKey=function(){if(this.isIndexCursor()&&this.current_cursor_index_<this.cursor_.rows.length){var a=this.cursor_.rows.item(this.current_cursor_index_),b=this.store_schema_.getIndex(this.index_name),c=b.getType();return ydn.db.schema.Index.sql2js(a[b.getSQLIndexColumnName()],c)}};
ydn.db.core.req.CachedWebsqlCursor.prototype.getPrimaryKey=function(){if(this.current_cursor_index_<this.cursor_.rows.length){var a=this.store_schema_.getSQLKeyColumnName(),b=this.cursor_.rows.item(this.current_cursor_index_);return ydn.db.schema.Index.sql2js(b[a],this.store_schema_.getType())}};ydn.db.core.req.CachedWebsqlCursor.prototype.getEffectiveKey=function(){return this.isIndexCursor()?this.getIndexKey():this.getPrimaryKey()};
ydn.db.core.req.CachedWebsqlCursor.prototype.getValue=function(){this.index_name||this.store_schema_.getSQLKeyColumnName();if(this.current_cursor_index_<this.cursor_.rows.length){if(this.isValueCursor()){var a=this.cursor_.rows.item(this.current_cursor_index_);return ydn.db.crud.req.WebSql.parseRow(a,this.store_schema_)}return this.getPrimaryKey()}};
ydn.db.core.req.CachedWebsqlCursor.prototype.clear=function(){if(!this.hasCursor())throw new ydn.db.InvalidAccessError;var a=new goog.async.Deferred,b=this;this.has_pending_request=!0;var c=this.store_schema_.getSQLKeyColumnName(),d="DELETE FROM "+this.store_schema_.getQuotedName()+" WHERE "+c+" = ?",c=[this.getPrimaryKey()];goog.log.finest(b.logger,this+': clear "'+d+'" : '+ydn.json.stringify(c));this.tx.executeSql(d,c,function(c,f){ydn.db.core.req.CachedWebsqlCursor.DEBUG&&goog.global.console.log([d,
f]);b.has_pending_request=!1;a.callback(f.rowsAffected)},function(c,f){ydn.db.core.req.CachedWebsqlCursor.DEBUG&&goog.global.console.log([d,c,f]);b.has_pending_request=!1;goog.log.warning(b.logger,"get error: "+f.message);a.errback(f);return!0});return a};
ydn.db.core.req.CachedWebsqlCursor.prototype.update=function(a){if(!this.hasCursor())throw new ydn.db.InvalidAccessError;var b=new goog.async.Deferred,c=this;this.has_pending_request=!0;var d=this.getPrimaryKey();goog.asserts.assertObject(a);a=c.store_schema_.sqlNamesValues(a,d);var e="REPLACE INTO "+this.store_schema_.getQuotedName()+" ("+a.columns.join(", ")+") VALUES ("+a.slots.join(", ")+") ON CONFLICT FAIL";goog.log.finest(c.logger,this+': clear "'+e+'" : '+ydn.json.stringify(a.values));this.tx.executeSql(e,
a.values,function(a,g){ydn.db.core.req.CachedWebsqlCursor.DEBUG&&goog.global.console.log([e,g]);c.has_pending_request=!1;b.callback(d)},function(a,d){ydn.db.core.req.CachedWebsqlCursor.DEBUG&&goog.global.console.log([e,a,d]);c.has_pending_request=!1;goog.log.warning(c.logger,"get error: "+d.message);b.errback(d);return!0});return b};
ydn.db.core.req.CachedWebsqlCursor.prototype.advance=function(a){if(!this.hasCursor())throw new ydn.error.InvalidOperationError(this+" cursor gone.");this.current_cursor_index_+=a;var b=this.getPrimaryKey(),c=this.getIndexKey(),d=this.getValue(),e=this;setTimeout(function(){e.onSuccess(b,c,d)},4)};
ydn.db.core.req.CachedWebsqlCursor.prototype.continuePrimaryKey=function(a){if(!this.hasCursor())throw new ydn.error.InvalidOperationError(this+" cursor gone.");var b=ydn.db.cmp(a,this.getPrimaryKey());if(0==b||1==b&&this.reverse||-1==b&&!this.reverse)throw new ydn.error.InvalidOperationError(this+" wrong direction.");for(var c=this.getIndexKey(),d=this.cursor_.rows.length,e=0;e<d;e++){if(0==b||1==b&&this.reverse||-1==b&&!this.reverse){this.onSuccess(this.getPrimaryKey(),this.getIndexKey(),this.getValue());
return}this.current_cursor_index_++;if(c&&c!=this.getIndexKey()){this.onSuccess(this.getPrimaryKey(),this.getIndexKey(),this.getValue());return}b=this.getPrimaryKey();b=goog.isDefAndNotNull(b)?ydn.db.cmp(a,b):1}this.onSuccess(void 0,void 0,void 0)};
ydn.db.core.req.CachedWebsqlCursor.prototype.continueEffectiveKey=function(a){if(!this.hasCursor())throw new ydn.error.InvalidOperationError(this+" cursor gone.");if(goog.isDefAndNotNull(a)){var b=ydn.db.cmp(a,this.getEffectiveKey());if(0==b||1==b&&this.reverse||-1==b&&!this.reverse)throw new ydn.error.InvalidOperationError(this+" wrong direction.");for(var c=this.cursor_.rows.length,d=0;d<c;d++){if(0==b||1==b&&this.reverse||-1==b&&!this.reverse){this.onSuccess(this.getPrimaryKey(),this.getIndexKey(),
this.getValue());return}this.current_cursor_index_++;b=this.getEffectiveKey();b=goog.isDefAndNotNull(b)?ydn.db.cmp(a,b):1}this.onSuccess(void 0,void 0,void 0)}else this.advance(1)};ydn.db.core.req.WebsqlCursor=function(a,b,c,d){ydn.db.core.req.AbstractCursor.call(this,a,b,c,d);goog.asserts.assert(c);this.store_schema_=c;this.index_=null;this.current_primary_key_=this.current_key_=void 0};goog.inherits(ydn.db.core.req.WebsqlCursor,ydn.db.core.req.AbstractCursor);
ydn.db.core.req.WebsqlCursor.DEBUG=!1;ydn.db.core.req.WebsqlCursor.prototype.logger=goog.log.getLogger("ydn.db.core.req.WebsqlCursor");ydn.db.core.req.WebsqlCursor.prototype.getIndexKey=function(){return this.current_key_};ydn.db.core.req.WebsqlCursor.prototype.getPrimaryKey=function(){return this.current_primary_key_};
ydn.db.core.req.WebsqlCursor.prototype.init=function(a,b,c,d,e){ydn.db.core.req.WebsqlCursor.superClass_.init.call(this,a,b,c,d,e);this.index_=goog.isString(b)?this.store_schema.getIndex(b):null};ydn.db.core.req.WebsqlCursor.prototype.getValue=function(){return this.current_value_};
ydn.db.core.req.WebsqlCursor.prototype.collect=function(a){this.current_value_=this.current_primary_key_=this.current_key_=void 0;ydn.db.core.req.WebsqlCursor.DEBUG&&goog.global.console.log(a);if(goog.isDef(a))if(goog.isObject(a)){var b=this.store_schema.getSQLKeyColumnName();this.current_primary_key_=b=ydn.db.schema.Index.sql2js(a[b],this.store_schema.getType());if(this.isIndexCursor()){goog.asserts.assertString(this.index_name);var c=this.store_schema.getIndex(this.index_name).getType();this.current_key_=
ydn.db.schema.Index.sql2js(a[this.index_name],c)}else this.current_key_=b;this.current_value_=this.isValueCursor()?ydn.db.crud.req.WebSql.parseRow(a,this.store_schema):b}else this.current_value_=a};
ydn.db.core.req.WebsqlCursor.prototype.continuePrimaryKey_=function(a,b,c,d){goog.asserts.assertString(this.index_name);goog.asserts.assert(goog.isDefAndNotNull(this.current_key_));this.store_schema.getIndex(this.index_name);var e=[],f=this.index_name,g=this.key_range,h=this.current_key_;if(goog.isDefAndNotNull(g)){var k=g.lower,l=g.upper,m=g.lowerOpen,g=g.upperOpen;this.reverse?l=goog.isDefAndNotNull(l)&&-1==ydn.db.cmp(l,h)?l:h:k=goog.isDefAndNotNull(k)&&1==ydn.db.cmp(k,h)?k:h;g=goog.isDefAndNotNull(k)&&
goog.isDefAndNotNull(l)?ydn.db.KeyRange.bound(k,l,!!m,!!g):goog.isDefAndNotNull(k)?ydn.db.IDBKeyRange.lowerBound(k,!!m):ydn.db.IDBKeyRange.upperBound(l,!!g)}else g=this.reverse?ydn.db.IDBKeyRange.upperBound(h):ydn.db.IDBKeyRange.lowerBound(h);f=this.store_schema.inSql(e,this.query_method,f,g,this.reverse,this.unique);b=this.reverse?ydn.db.IDBKeyRange.upperBound(b,!c):ydn.db.IDBKeyRange.lowerBound(b,!c);b=this.store_schema.inSql(e,this.query_method,this.store_schema.getSQLKeyColumnName(),b,this.reverse,
this.unique);f.where=f.where?f.where+(" AND "+b.where):b.where;var n="SELECT "+f.select+" FROM "+f.from+(f.where?" WHERE "+f.where:"")+(f.group?" GROUP BY "+f.group:"")+" ORDER BY "+f.order,n=n+" LIMIT 1";0<d&&(n+=" OFFSET "+d);var p=this;goog.log.finest(this.logger,this+": continuePrimary:  SQL: "+n+" : "+ydn.json.stringify(e));this.tx.executeSql(n,e,function(b,c){ydn.db.core.req.WebsqlCursor.DEBUG&&goog.global.console.log([n,c]);0<c.rows.length?p.collect(c.rows.item(0)):p.collect();a.call(p,p.current_key_,
p.current_primary_key_,p.current_value_);a=null},function(b,c){ydn.db.core.req.WebsqlCursor.DEBUG&&goog.global.console.log([n,c]);goog.log.warning(p.logger,"get error: "+c.message);p.onError(c);p.collect();a.call(p,p.current_primary_key_,p.current_key_,p.current_value_);a=null;return!1})};
ydn.db.core.req.WebsqlCursor.prototype.continueEffectiveKey_=function(a,b,c,d,e){var f=!c;c=[];var g;this.is_index&&goog.isDefAndNotNull(e)&&goog.isDefAndNotNull(b)?g=this.store_schema.sqlContinueIndexEffectiveKey(this.query_method,c,this.index_.getName(),this.key_range,b,f,e,this.reverse,this.unique):goog.isDefAndNotNull(b)?(e=this.index_?this.index_.getName():null,g=this.store_schema.sqlContinueEffectiveKey(this.query_method,c,e,this.key_range,this.reverse,this.unique,b,f)):(b=this.isPrimaryCursor()?
this.store_schema.getSQLKeyColumnName():this.index_.getSQLIndexColumnName(),g=this.store_schema.toSql(c,this.query_method,b,this.key_range,this.reverse,this.unique),this.isIndexCursor()&&(g+=", "+this.store_schema.getSQLKeyColumnNameQuoted()+" ASC"));g+=" LIMIT 1";0<d&&(g+=" OFFSET "+d);var h=this;goog.log.finest(this.logger,this+": continue:  SQL: "+g+" : "+ydn.json.stringify(c));this.tx.executeSql(g,c,function(b,c){0<c.rows.length?h.collect(c.rows.item(0)):h.collect();a.call(h,h.current_key_,h.current_primary_key_,
h.current_value_);a=null},function(b,c){ydn.db.core.req.WebsqlCursor.DEBUG&&goog.global.console.log([g,b,c]);goog.log.warning(h.logger,"get error: "+c.message);h.onError(c);h.collect();a.call(h,h.current_primary_key_,h.current_key_,h.current_value_);a=null;return!1})};ydn.db.core.req.WebsqlCursor.prototype.hasCursor=function(){return this.isActive()};
ydn.db.core.req.WebsqlCursor.prototype.update=function(a){if(!this.hasCursor())throw new ydn.db.InvalidAccessError;var b=new goog.async.Deferred,c=this.getPrimaryKey();goog.asserts.assertObject(a);a=this.store_schema.sqlNamesValues(a,c);var d="REPLACE INTO "+this.store_schema.getQuotedName()+" ("+a.columns.join(", ")+") VALUES ("+a.slots.join(", ")+")";goog.log.finest(this.logger,this+': update "'+d+'" : '+ydn.json.stringify(a.values));this.tx.executeSql(d,a.values,function(a,f){ydn.db.core.req.WebsqlCursor.DEBUG&&
goog.global.console.log([d,f]);b.callback(c)},function(a,c){ydn.db.core.req.WebsqlCursor.DEBUG&&goog.global.console.log([d,a,c]);b.errback(c);return!1});return b};ydn.db.core.req.WebsqlCursor.MONITOR=!0;
ydn.db.core.req.WebsqlCursor.prototype.advance=function(a){var b=this.current_key_,c=this.current_primary_key_,d=function(a,d,e){var k=goog.isDefAndNotNull(b)&&goog.isDefAndNotNull(a)&&0==ydn.db.cmp(b,a);if(this.isPrimaryCursor()){if(k)throw new ydn.debug.error.InternalError("current: "+b+" next: "+a);}else{var l=goog.isDefAndNotNull(d)&&goog.isDefAndNotNull(c)&&0==ydn.db.cmp(d,c);if(k&&l)throw new ydn.debug.error.InternalError("current: "+b+";"+c+" next: "+a+";"+d);}this.onSuccess(a,d,e)};goog.asserts.assert(0<
a);var e=!0;goog.isDefAndNotNull(this.current_key_)&&(this.isPrimaryCursor()||goog.isDefAndNotNull(this.current_primary_key_))&&(a-=1,e=!1);this.continueEffectiveKey_(ydn.db.core.req.WebsqlCursor.MONITOR?d:this.onSuccess,this.current_key_,e,a,this.current_primary_key_)};ydn.db.core.req.WebsqlCursor.prototype.continueEffectiveKey=function(a){goog.isDefAndNotNull(a)?this.continueEffectiveKey_(this.onSuccess,a,!0):this.advance(1)};
ydn.db.core.req.WebsqlCursor.prototype.prepareBaseSql=function(a){var b=this.index_?this.index_.getSQLIndexColumnName():this.store_schema.getSQLKeyColumnName();return this.store_schema.inSql(a,this.query_method,b,this.key_range,this.reverse,this.unique)};ydn.db.core.req.WebsqlCursor.prototype.openCursor=function(a,b){this.continueEffectiveKey_(this.onSuccess,a,!1,0,b)};
ydn.db.core.req.WebsqlCursor.prototype.clear=function(){if(!this.hasCursor())throw new ydn.db.InvalidAccessError;var a=new goog.async.Deferred,b=this.store_schema.getSQLKeyColumnName(),c="DELETE FROM "+this.store_schema.getQuotedName()+" WHERE "+b+" = ?",b=[this.getPrimaryKey()];goog.log.finest(this.logger,this+': clear "'+c+'" : '+ydn.json.stringify(b));this.tx.executeSql(c,b,function(b,e){ydn.db.core.req.WebsqlCursor.DEBUG&&goog.global.console.log([c,e]);a.callback(e.rowsAffected)},function(b,e){ydn.db.core.req.WebsqlCursor.DEBUG&&
goog.global.console.log([c,b,e]);a.errback(e);return!1});return a};
ydn.db.core.req.WebsqlCursor.prototype.continuePrimaryKey=function(a){goog.asserts.assert(this.isIndexCursor());goog.asserts.assert(goog.isDefAndNotNull(this.current_key_));goog.asserts.assert(goog.isDefAndNotNull(this.current_primary_key_));var b=ydn.db.cmp(a,this.current_primary_key_);if(0==b||1==b&&this.reverse||-1==b&&!this.reverse)throw new ydn.error.InvalidOperationError(this+" to continuePrimaryKey  from "+this.current_primary_key_+" to "+a+" on "+this.dir+" direction is wrong");this.continuePrimaryKey_(this.onSuccess,
a,!0)};goog.DEBUG&&(ydn.db.core.req.WebsqlCursor.prototype.toString=function(){return"WebSql"+ydn.db.core.req.WebsqlCursor.superClass_.toString.call(this)});ydn.db.crud.req.WebSql=function(a,b){ydn.db.crud.req.RequestExecutor.call(this,a,b)};goog.inherits(ydn.db.crud.req.WebSql,ydn.db.crud.req.RequestExecutor);ydn.db.crud.req.WebSql.DEBUG=!1;ydn.db.crud.req.WebSql.REQ_PER_TX=10;ydn.db.crud.req.WebSql.RW_REQ_PER_TX=2;ydn.db.crud.req.WebSql.prototype.logger=goog.log.getLogger("ydn.db.crud.req.WebSql");
ydn.db.crud.req.WebSql.parseRow=function(a,b){if(b.isFixed()&&!b.usedInlineKey()&&0==b.countIndex()&&a[ydn.db.base.DEFAULT_BLOB_COLUMN]){var c=a[ydn.db.base.DEFAULT_BLOB_COLUMN];if(-1==c.indexOf(";base64,"))return ydn.json.parse(c);'"'==c.charAt(0)&&'"'==c.charAt(c.length-1)&&(c=c.substr(1,c.length-2));for(var d=c.split(";base64,"),c=d[0].split(":")[1],d=window.atob(d[1]),e=d.length,f=new Uint8Array(e),g=0;g<e;++g)f[g]=d.charCodeAt(g);return new Blob([f.buffer],{type:c})}c=a[ydn.db.base.DEFAULT_BLOB_COLUMN]?
ydn.json.parse(a[ydn.db.base.DEFAULT_BLOB_COLUMN]):{};goog.isDefAndNotNull(b.keyPath)&&(d=ydn.db.schema.Index.sql2js(a[b.keyPath],b.getType()),goog.isDefAndNotNull(d)&&b.setKeyValue(c,d));for(d=0;d<b.countIndex();d++)e=b.index(d),f=e.getSQLIndexColumnName(),f==ydn.db.base.DEFAULT_BLOB_COLUMN||(e.isComposite()||e.isMultiEntry())||e.getType()!=ydn.db.schema.DataType.DATE&&!b.isFixed()||(f=ydn.db.schema.Index.sql2js(a[f],e.getType()),goog.isDef(f)&&e.applyValue(c,f));return c};
ydn.db.crud.req.WebSql.prototype.getKeyFromRow=function(a,b){return b[a.keyPath||ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME]};ydn.db.crud.req.WebSql.prototype.putData=function(a,b,c,d,e,f){throw new ydn.debug.error.NotImplementedException("putData");};
ydn.db.crud.req.WebSql.prototype.insertObjects=function(a,b,c,d,e,f){b=!b;var g=this.schema.getStore(d),h=b?"INSERT INTO ":"INSERT OR REPLACE INTO ";d=a.getTx();var k=this,l=[],m=0,n=a.getLabel()+" inserting "+e.length+" objects.",p=!1,q=function(b,d){if(!goog.isDefAndNotNull(e[b]))if(goog.log.finest(k.logger,"empty object at "+b+" of "+e.length),m++,m==e.length)goog.log.finer(k.logger,n+" success "+n),a.setDbValue(l,p);else{var t=b+ydn.db.crud.req.WebSql.RW_REQ_PER_TX;t<e.length&&q(t,d)}var v;v=
goog.isDef(f)?g.sqlNamesValues(e[b],f[b]):g.sqlNamesValues(e[b]);var w=h+g.getQuotedName()+" ("+v.columns.join(", ")+") VALUES ("+v.slots.join(", ")+");",t=a.getLabel()+" SQL: "+w+" PARAMS: "+v.values+" REQ: "+b+" of "+e.length;goog.log.finest(k.logger,t);ydn.db.crud.req.WebSql.DEBUG&&goog.global.console.log(w,v.values);d.executeSql(w,v.values,function(f,n){m++;var t=goog.isDef(v.key)?v.key:n.insertId;1>n.rowsAffected&&(p=!0,t=new ydn.db.ConstraintError(t+" no-op"));for(var w=function(b,c){var e=
ydn.db.base.PREFIX_MULTIENTRY+g.getName()+":"+b.getName(),e=h+goog.string.quote(e)+" ("+g.getSQLKeyColumnNameQuoted()+", "+b.getSQLIndexColumnNameQuoted()+") VALUES (?, ?)",f=[ydn.db.schema.Index.js2sql(t,g.getType()),ydn.db.schema.Index.js2sql(c,b.getType())];goog.log.finest(k.logger,a.getLabel()+" multiEntry "+e+" "+f);d.executeSql(e,f,function(a,b){},function(a,b){goog.log.warning(k.logger,"multiEntry index insert error: "+b.message);return!1})},D=0,E=g.countIndex();D<E;D++){var C=g.index(D);if(C.isMultiEntry())for(var F=
ydn.db.utils.getValueByKeys(e[b],C.getKeyPath()),J=(F?F.length:0)||0,G=0;G<J;G++)w(C,F[G])}c?a.setDbValue(t):(l[b]=t,m==e.length?a.setDbValue(l,p):(w=b+ydn.db.crud.req.WebSql.RW_REQ_PER_TX,w<e.length&&q(w,f)))},function(d,f){ydn.db.crud.req.WebSql.DEBUG&&goog.global.console.log([w,v,d,f]);m++;p=!0;6==f.code?f.name="ConstraintError":goog.log.warning(k.logger,"error: "+f.message+" "+n);if(c)a.setDbValue(f,!0);else if(l[b]=f,m==e.length)goog.log.finest(k.logger,"success "+n),a.setDbValue(l,p);else{var g=
b+ydn.db.crud.req.WebSql.RW_REQ_PER_TX;g<e.length&&q(g,d)}return!1})};if(0<e.length)for(b=0;b<ydn.db.crud.req.WebSql.RW_REQ_PER_TX&&b<e.length;b++)q(b,d);else goog.log.finer(this.logger,"success"),a.setDbValue([])};
ydn.db.crud.req.WebSql.prototype.putByKeys=function(a,b,c){if(0==c.length)a.setDbValue([]);else{a.getTx();for(var d=[],e=0,f=0,g=this,h=function(h,k){var l=[];goog.log.finest(g.logger,"put "+k.length+" objects to "+h);for(var m=g.schema.getStore(h).usedInlineKey(),n=m?void 0:[],p=0;p<k.length;p++)l.push(b[k[p]]),m||n.push(c[k[p]].getId());m=a.copy();m.addCallbacks(function(b){for(var c=0;c<k.length;c++)d[k[c]]=b[c];e++;e==f&&a.setDbValue(d)},function(b){e++;e==f&&a.setDbValue(d,!0)});g.insertObjects(m,
!1,!1,h,l,n)},k="",l=[],m=[],n=0;n<c.length;n++){var p=c[n].getStoreName(),q=c[n].getId();p!=k?(f++,0<l.length&&h(k,l),l=[n],m=[q],k=p):(l.push(n),m.push(q))}0<l.length&&h(k,l)}};
ydn.db.crud.req.WebSql.prototype.getById=function(a,b,c){var d=a.getTx(),e=this.schema.getStore(b);goog.asserts.assertInstanceof(e,ydn.db.schema.Store,b+" not found.");var f=this;b=e.getSQLKeyColumnNameQuoted();c=[ydn.db.schema.Index.js2sql(c,e.getType())];b="SELECT * FROM "+e.getQuotedName()+" WHERE "+b+" = ?";var g=a.getLabel()+" SQL: "+b+" PARAMS: "+c;goog.log.finest(this.logger,g);d.executeSql(b,c,function(b,c){if(0<c.rows.length){var d=c.rows.item(0);goog.isDefAndNotNull(d)?(d=ydn.db.crud.req.WebSql.parseRow(d,
e),a.setDbValue(d)):(goog.log.finer(f.logger,"success no result: "+g),a.setDbValue(void 0))}else goog.log.finer(f.logger,"success no result: "+g),a.setDbValue(void 0)},function(b,c){ydn.db.crud.req.WebSql.DEBUG&&goog.global.console.log([b,c]);goog.log.warning(f.logger,"error: "+g+" "+c.message);a.setDbValue(c,!0);return!1})};
ydn.db.crud.req.WebSql.prototype.listByIds=function(a,b,c){var d=a.getTx(),e=this,f=[],g=0,h=this.schema.getStore(b),k=function(b,d){var n=c[b],p=h.getSQLKeyColumnNameQuoted(),n=[ydn.db.schema.Index.js2sql(n,h.getType())],q="SELECT * FROM "+h.getQuotedName()+" WHERE "+p+" = ?";goog.log.finest(e.logger,"SQL: "+q+" PARAMS: "+n);d.executeSql(q,n,function(d,e){g++;if(0<e.rows.length){var m=e.rows.item(0);goog.isDefAndNotNull(m)&&(f[b]=ydn.db.crud.req.WebSql.parseRow(m,h))}else f[b]=void 0;g==c.length?
a.setDbValue(f):(m=b+ydn.db.crud.req.WebSql.REQ_PER_TX,m<c.length&&k(m,d))},function(d,h){g++;ydn.db.crud.req.WebSql.DEBUG&&goog.global.console.log([d,h]);goog.log.warning(e.logger,"error: "+q+" "+h.message);if(g==c.length)a.setDbValue(f);else{var m=b+ydn.db.crud.req.WebSql.REQ_PER_TX;m<c.length&&k(m,d)}return!1})};if(0<c.length)for(b=0;b<ydn.db.crud.req.WebSql.REQ_PER_TX&&b<c.length;b++)k(b,d);else goog.log.finer(e.logger,"success"),a.setDbValue([])};
ydn.db.crud.req.WebSql.prototype.listByKeys=function(a,b){var c=a.getTx(),d=this,e=[],f=0,g=function(c,h){var m=b[c],n=m.getStoreName(),p=d.schema.getStore(n),n=m.getNormalizedId(),m=p.getSQLKeyColumnNameQuoted(),n=[ydn.db.schema.Index.js2sql(n,p.getType())],q="SELECT * FROM "+p.getQuotedName()+" WHERE "+m+" = ?";goog.log.finest(d.logger,"SQL: "+q+" PARAMS: "+n);h.executeSql(q,n,function(h,l){f++;if(0<l.rows.length){var m=l.rows.item(0);goog.isDefAndNotNull(m)&&(e[c]=ydn.db.crud.req.WebSql.parseRow(m,
p))}else e[c]=void 0;f==b.length?(goog.log.finest(d.logger,"success "+q),a.setDbValue(e)):(m=c+ydn.db.crud.req.WebSql.REQ_PER_TX,m<b.length&&g(m,h))},function(b,c){ydn.db.crud.req.WebSql.DEBUG&&goog.global.console.log([b,c]);a.setDbValue(c,!0);return!1})};if(0<b.length)for(var h=0;h<ydn.db.crud.req.WebSql.REQ_PER_TX&&h<b.length;h++)g(h,c);else goog.log.finest(this.logger,"success"),a.setDbValue([])};
ydn.db.crud.req.WebSql.prototype.clearByStores=function(a,b){var c=a.getTx(),d=this,e=function(c,g){var h=d.schema.getStore(b[c]),k="DELETE FROM  "+h.getQuotedName();goog.log.finest(d.logger,"SQL: "+k+" PARAMS: []");g.executeSql(k,[],function(g,h){c==b.length-1?(goog.log.finest(d.logger,"success "+k),a.setDbValue(b.length)):e(c+1,g)},function(b,c){ydn.db.crud.req.WebSql.DEBUG&&goog.global.console.log([b,c]);a.setDbValue(c,!0);return!1});for(var l=function(a){a=ydn.db.base.PREFIX_MULTIENTRY+h.getName()+
":"+a.getName();a="DELETE FROM  "+goog.string.quote(a);goog.log.finest(d.logger,"SQL: "+a);g.executeSql(a,[])},m=0,n=h.countIndex();m<n;m++){var p=h.index(m);p.isMultiEntry()&&l(p)}};0<b.length?e(0,c):(goog.log.finest(this.logger,"success"),a.setDbValue(0))};
ydn.db.crud.req.WebSql.prototype.removeByKeys=function(a,b){var c=a.getTx(),d=this,e=0,f=!1,g=a.getLabel()+" removeByKeys: "+b.length+" keys";goog.log.finest(this.logger,g);var h=function(g){if(g>=b.length)a.setDbValue(e,f);else{var l=d.schema.getStore(b[g].getStoreName()),m=ydn.db.schema.Index.js2sql(b[g].getId(),l.getType()),n=" WHERE "+l.getSQLKeyColumnNameQuoted()+" = ?",p="DELETE FROM "+l.getQuotedName()+n,q=a.getLabel()+" SQL: "+p+" PARAMS: "+[m];ydn.db.crud.req.WebSql.DEBUG&&goog.global.console.log(q);
c.executeSql(p,[m],function(a,b){ydn.db.crud.req.WebSql.DEBUG&&goog.global.console.log(b);e++;h(g)},function(a,b){ydn.db.crud.req.WebSql.DEBUG&&goog.global.console.log([a,b]);goog.log.warning(d.logger,"error: "+q+b.message);f=!0;h(g);return!1});g++;for(var p=function(b){b=ydn.db.base.PREFIX_MULTIENTRY+l.getName()+":"+b.getName();b="DELETE FROM  "+goog.string.quote(b)+n;goog.log.finest(d.logger,a.getLabel()+NaN+b);c.executeSql(b,[m])},r=0,s=l.countIndex();r<s;r++){var t=l.index(r);t.isMultiEntry()&&
p(t)}}};h(0)};
ydn.db.crud.req.WebSql.prototype.removeById=function(a,b,c){var d=a.getTx(),e=this.schema.getStore(b),f=ydn.db.schema.Index.js2sql(c,e.getType()),g=this,h=" WHERE "+e.getSQLKeyColumnNameQuoted()+" = ?";b="DELETE FROM "+e.getQuotedName()+h;c=a.getLabel()+" SQL: "+b+" PARAMS: "+[f];goog.log.finest(this.logger,c);d.executeSql(b,[f],function(b,c){ydn.db.crud.req.WebSql.DEBUG&&goog.global.console.log(c);a.setDbValue(c.rowsAffected)},function(b,c){ydn.db.crud.req.WebSql.DEBUG&&goog.global.console.log([b,c]);
a.setDbValue(c,!0);return!1});b=function(b){b=ydn.db.base.PREFIX_MULTIENTRY+e.getName()+":"+b.getName();b="DELETE FROM  "+goog.string.quote(b)+h;goog.log.finest(g.logger,a.getLabel()+NaN+b);d.executeSql(b,[f])};c=0;for(var k=e.countIndex();c<k;c++){var l=e.index(c);l.isMultiEntry()&&b(l)}};ydn.db.crud.req.WebSql.prototype.clearByKeyRange=function(a,b,c){this.clear_by_key_range_(a,b,void 0,c)};ydn.db.crud.req.WebSql.prototype.removeByKeyRange=function(a,b,c){this.clear_by_key_range_(a,b,void 0,c)};
ydn.db.crud.req.WebSql.prototype.removeByIndexKeyRange=function(a,b,c,d){this.clear_by_key_range_(a,b,c,d)};
ydn.db.crud.req.WebSql.prototype.clear_by_key_range_=function(a,b,c,d){var e=a.getTx(),f=this,g=this.schema.getStore(b);b="DELETE FROM "+g.getQuotedName();var h=[],k=[],l="";goog.isDefAndNotNull(d)&&(goog.isDef(c)?(c=g.getIndex(c),ydn.db.KeyRange.toSql(c.getSQLIndexColumnNameQuoted(),c.getType(),d,k,h)):ydn.db.KeyRange.toSql(g.getSQLKeyColumnNameQuoted(),g.getType(),d,k,h),l=" WHERE "+k.join(" AND "));b+=l;var m=a.getLabel()+" SQL: "+b+" PARAMS: "+h;goog.log.finest(this.logger,m);e.executeSql(b,h,
function(b,c){goog.log.finest(f.logger,"success "+m);a.setDbValue(c.rowsAffected)},function(b,c){ydn.db.crud.req.WebSql.DEBUG&&goog.global.console.log([b,c]);goog.log.warning(f.logger,"error: "+m+c.message);a.setDbValue(c,!0);return!1});d=function(b){b=ydn.db.base.PREFIX_MULTIENTRY+g.getName()+":"+b.getName();b="DELETE FROM  "+goog.string.quote(b)+l;goog.log.finest(f.logger,a.getLabel()+NaN+b);e.executeSql(b,k)};c=0;for(b=g.countIndex();c<b;c++)h=g.index(c),h.isMultiEntry()&&d(h)};
ydn.db.crud.req.WebSql.prototype.countStores=function(a,b){var c=a.getTx(),d=this,e=[],f=function(g){var h="SELECT COUNT(*) FROM "+goog.string.quote(b[g]);goog.log.finest(d.logger,"SQL: "+h+" PARAMS: []");c.executeSql(h,[],function(c,d){var h=d.rows.item(0);e[g]=parseInt(h["COUNT(*)"],10);g++;g==b.length?a.setDbValue(e):f(g)},function(b,c){ydn.db.crud.req.WebSql.DEBUG&&goog.global.console.log([b,c]);a.setDbValue(c,!0);return!1})};0==b.length?(goog.log.finest(this.logger,"success"),a.setDbValue(0)):
f(0)};ydn.db.crud.req.WebSql.prototype.countKeyRange=function(a,b,c,d,e){var f=[],g=this.schema.getStore(b).toSql(f,ydn.db.base.QueryMethod.COUNT,d,c,!1,e);b=a.getLabel()+" SQL: "+g+" PARAMS: "+f;goog.log.finest(this.logger,b);a.getTx().executeSql(g,f,function(b,c){ydn.db.crud.req.WebSql.DEBUG&&goog.global.console.log([g,c]);var d=c.rows.item(0);a.setDbValue(ydn.object.takeFirst(d))},function(b,c){ydn.db.crud.req.WebSql.DEBUG&&goog.global.console.log([g,c]);a.setDbValue(c,!0);return!1})};
ydn.db.crud.req.WebSql.prototype.list=function(a,b,c,d,e,f,g,h,k,l){var m=this,n=[],p=this.schema.getStore(c),q=p.getSQLKeyColumnName(),r=p.getType(),s=r,t=goog.isDefAndNotNull(d)&&d!==q?p.getIndex(d):null,v=d||q;t&&(s=t.getType());c=[];if(l&&goog.isDef(l[0])){var w=l[0];t&&goog.isDef(l[1])?(d=l[1],e=p.sqlContinueIndexEffectiveKey(b,c,t.getName(),e,w,!0,d,h,k)):e=p.sqlContinueEffectiveKey(b,c,d,e,h,k,w,!0)}else e=p.toSql(c,b,v,e,h,k);goog.isNumber(f)&&(e+=" LIMIT "+f);goog.isNumber(g)&&(e+=" OFFSET "+
g);var x=a+" SQL: "+e+" ;params= "+ydn.json.stringify(c);goog.log.finest(this.logger,x);a.getTx().executeSql(e,c,function(c,d){var e=d.rows.length;ydn.db.crud.req.WebSql.DEBUG&&goog.global.console.log(d);for(var f,g=0;g<e;g++)f=d.rows.item(g),ydn.db.crud.req.WebSql.DEBUG&&goog.global.console.log(f),b==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY?n[g]=ydn.db.schema.Index.sql2js(f[q],r):b==ydn.db.base.QueryMethod.LIST_KEY?n[g]=ydn.db.schema.Index.sql2js(f[v],s):b==ydn.db.base.QueryMethod.LIST_KEYS?n[g]=
[ydn.db.schema.Index.sql2js(f[v],s),ydn.db.schema.Index.sql2js(f[q],r)]:goog.isDefAndNotNull(f)&&(n[g]=ydn.db.crud.req.WebSql.parseRow(f,p));goog.log.finer(m.logger,"success "+a);l&&f&&(l[0]=ydn.db.schema.Index.sql2js(f[v],s),l[1]=ydn.db.schema.Index.sql2js(f[q],r));a.setDbValue(n)},function(b,c){ydn.db.crud.req.WebSql.DEBUG&&goog.global.console.log([b,c]);goog.log.warning(m.logger,"error: "+x+c.message);a.setDbValue(c,!0);return!1})};
ydn.db.core.req.WebSql=function(a,b){ydn.db.crud.req.WebSql.call(this,a,b)};goog.inherits(ydn.db.core.req.WebSql,ydn.db.crud.req.WebSql);ydn.db.core.req.WebSql.DEBUG=!1;ydn.db.core.req.WebSql.prototype.logger=goog.log.getLogger("ydn.db.core.req.WebSql");ydn.db.core.req.WebSql.prototype.getCursor=function(a,b,c,d){var e=this.schema.getStore(c);goog.asserts.assertObject(e,'store "'+c+'" not found.');return new ydn.db.core.req.WebsqlCursor(a,b,e,d)};
ydn.db.core.req.WebSql.prototype.getStreamer=function(a,b,c,d){throw"not yet";};ydn.db.core.Storage.inject_executor={};
ydn.db.core.Storage.prototype.newExecutor=function(){var a=this.getType();if(a==ydn.db.base.Mechanisms.IDB)return new ydn.db.core.req.IndexedDb(this.db_name,this.schema);if(a==ydn.db.base.Mechanisms.WEBSQL||a==ydn.db.base.Mechanisms.SQLITE)return new ydn.db.core.req.WebSql(this.db_name,this.schema);if(a==ydn.db.base.Mechanisms.MEMORY_STORAGE||a==ydn.db.base.Mechanisms.LOCAL_STORAGE||a==ydn.db.base.Mechanisms.USER_DATA||a==ydn.db.base.Mechanisms.SESSION_STORAGE)return new ydn.db.core.req.SimpleStore(this.db_name,
this.schema);throw new ydn.debug.error.InternalError("No executor for "+a);};ydn.db.sql={};ydn.db.sql.req={};ydn.db.sql.req.IterableQuery=function(a,b,c,d,e,f,g,h){ydn.db.Iterator.call(this,a,b,c,d,e,f);this.finalize=this.reduce=this.map=this.initial=null;this.filter_fn=g||null;this.continued=h||null};goog.inherits(ydn.db.sql.req.IterableQuery,ydn.db.Iterator);
ydn.db.sql.req.IterableQuery.prototype.toJSON=function(){var a=ydn.db.sql.req.IterableQuery.superClass_.toJSON.call(this);a.initial=this.initial?this.initial.toString():null;a.map=this.map?this.map.toString():null;a.reduce=this.reduce?this.reduce.toString():null;a.finalize=this.finalize?this.finalize.toString():null;return a};ydn.db.sql.req.IterableQuery.prototype.initial=null;ydn.db.sql.req.IterableQuery.prototype.map=null;ydn.db.sql.req.IterableQuery.prototype.reduce=null;
ydn.db.sql.req.IterableQuery.prototype.finalize=null;ydn.db.sql.req.IterableQuery.prototype.toString=function(){var a=goog.isDef(this.getIndexName())?":"+this.getIndexName():"";return"Cursor:"+this.getStoreName()+a};
ydn.db.sql.req.IterableQuery.prototype.processWhereAsFilter=function(a){var b=goog.functions.TRUE;goog.isFunction(this.filter_fn)&&(b=this.filter_fn);this.filter_fn=function(c){var d=c[a.getField()],e=!0,f=a.getKeyRange();if(f){goog.isDefAndNotNull(f.lower)&&(e=f.lowerOpen?d<f.lower:d<=f.lower);var g=!0;goog.isDefAndNotNull(f.upper)&&(g=f.upperOpen?d>f.upper:d>=f.upper)}return b(c)&&e&&g}};ydn.db.sql.req.IdbQuery=function(a,b,c,d,e,f,g,h){ydn.db.sql.req.IterableQuery.call(this,a,b,c,d,e,f,g,h)};
goog.inherits(ydn.db.sql.req.IdbQuery,ydn.db.sql.req.IterableQuery);ydn.db.sql.req.IdbQuery.Methods={OPEN:"op",COUNT:"cn"};ydn.db.sql.req.IdbQuery.prototype.method=ydn.db.sql.req.IdbQuery.Methods.OPEN;ydn.string={};ydn.string.split_comma_seperated=function(a){return a.match(/(?:"[^"]*"|[^,])+/g)};ydn.string.split_space_seperated=function(a){return a.match(/\w+|"[^"]+"/g)};ydn.string.split_space=function(a){return a.match(/[^\s"']+|"[^"]*"|'[^']*'/g)};
ydn.string.normalizePhone=function(a){return goog.isString(a)?a.replace(/\D/g,"").replace(/^0+/,""):null};ydn.string.normalizeEmail=function(a){if(!goog.isString(a)||!/[\w\+]+@\w+\.\w+/.test(a))return null;a=a.replace(/.*</,"").replace(/>.*/,"");a=a.toLowerCase();a=a.replace(/\+\w*?@/,"@");for(var b=a.indexOf("@");0<=b;b--)"."==a.charAt(b)&&a.slice(b,1);return a};
ydn.string.joinWithCommaAnd=function(a){var b=a.length;return 0==b?"":1==b?a[0]:2==b?a[0]+" and "+a[1]:a.slice(0,b-2).join(", ")+", "+a[b-2]+" and "+a[b-1]};
ydn.string.encodeArrayBuffer2base64=function(a){var b="";a=new Uint8Array(a);for(var c=a.byteLength,d=c%3,c=c-d,e,f,g,h,k=0;k<c;k+=3)h=a[k]<<16|a[k+1]<<8|a[k+2],e=(h&16515072)>>18,f=(h&258048)>>12,g=(h&4032)>>6,h&=63,b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[e]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[f]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[g]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[h];1==
d?(h=a[c],b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(h&252)>>2]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(h&3)<<4]+"=="):2==d&&(h=a[c]<<8|a[c+1],b+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(h&64512)>>10]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(h&1008)>>4]+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(h&15)<<2]+"=");return b};ydn.math={};
ydn.math.Expression=function(a){this.tokens=a};ydn.math.Expression.prototype.tokens=[];
ydn.math.Expression.prototype.evaluate=function(a,b){for(var c=[],d=0;d<this.tokens.length;d++){var e=this.tokens[d],f="'"===e[0]&&"'"===e[e.length-1];if('"'===e[0]&&'"'===e[e.length-1])e=goog.string.stripQuotes(e,'"').split("."),goog.asserts.assertObject(a),e=goog.object.getValueByKeys(a,e),c.push(e);else if(f)c.push(goog.string.stripQuotes(e,"'"));else if(goog.isString(e))if("true"===e)c.push(!0);else if("false"===e)c.push(!1);else if("Date"===e)c.push(new Date(parseInt(c.pop(),10)));else if("now"===
e)c.push(new Date);else if("!"===e)c[c.length-1]=!c[c.length-1];else if("=="===e)c.push(c.pop()==c.pop());else if("==="===e)c.push(c.pop()===c.pop());else if("!="===e)c.push(c.pop()!=c.pop());else if("!=="===e)c.push(c.pop()!==c.pop());else if("<="===e)c.push(c.pop()<=c.pop());else if("<"===e)c.push(c.pop()<c.pop());else if(">="===e)c.push(c.pop()>=c.pop());else if(">"===e)c.push(c.pop()>c.pop());else if("&"===e)c.push(c.pop()&c.pop());else if("|"===e)c.push(c.pop()|c.pop());else if("?"===e){var e=
!!c.pop(),f=c.pop(),g=c.pop(),e=e?f:g;c.push(e)}else"+"===e?c.push(c.pop()+c.pop()):"-"===e?c.push(c.pop()-c.pop()):"*"===e?c.push(c.pop()*c.pop()):"/"===e?c.push(c.pop()/c.pop()):"%"===e?c.push(c.pop()%c.pop()):"at"===e?(f=c.pop(),e=c.pop(),c.push(e[f])):"of"===e?(f=c.pop(),e=c.pop(),e=goog.isArray(e)?e.indexOf(f):-1,c.push(e)):"in"===e?(f=c.pop(),e=c.pop(),e=goog.isArray(e)?0<=e.indexOf(f):!1,c.push(e)):"abs"===e?c[c.length-1]=Math.abs(c[c.length-1]):"$"==e[0]&&/^\$\d$/.test(e)?(e=parseInt(e.match(/^\$(\d)$/)[1],
10),c.push(arguments[e])):c.push(parseFloat(e));else c.push(e)}return c[0]};ydn.math.Expression.prototype.compile=function(){return function(){var a=2<arguments.length?Array.prototype.slice(arguments,2):void 0;return ydn.math.Expression.prototype.evaluate.apply(null,a)}};ydn.math.Expression.prototype.toJSON=function(){return{Tokens:ydn.object.clone(this.tokens)}};ydn.math.Expression.parseRpn=function(a){return new ydn.math.Expression(ydn.string.split_space(a))};
ydn.math.Expression.parseInfix=function(a){throw new ydn.error.NotImplementedException("Too lazy to learn Dutch in Shunting Yard station, we speak Polish here.");};ydn.db.Sql=function(a){if(!goog.isString(a))throw new ydn.error.ArgumentException;this.sql_=a;this.mode_=ydn.db.base.TransactionMode.READ_WRITE;this.store_names_=[];this.parseBasic_(a);this.last_error_="";this.has_parsed_=!1};ydn.db.Sql.prototype.sql_="";ydn.db.Sql.prototype.limit_=NaN;ydn.db.Sql.prototype.offset_=NaN;
ydn.db.Sql.prototype.reverse_=!1;ydn.db.Sql.prototype.last_error_="";ydn.db.Sql.prototype.has_parsed_=!1;
ydn.db.Sql.prototype.parseBasic_=function(a){var b=a.split(/\sFROM\s/i);if(2==b.length&&(a=b[1],b=b[0].match(/\s*?(SELECT|INSERT|UPDATE|DELETE)\s+(.*)/i),3==b.length)){this.action_=b[1].toUpperCase();if("SELECT"==this.action_)this.mode_=ydn.db.base.TransactionMode.READ_ONLY;else if("INSERT"==this.action_)this.mode_=ydn.db.base.TransactionMode.READ_WRITE;else if("UPDATE"==this.action_)this.mode_=ydn.db.base.TransactionMode.READ_WRITE;else if("DELETE"==this.action_)this.mode_=ydn.db.base.TransactionMode.READ_WRITE;
else return;var b=b[2].trim(),c=b.match(/^(MIN|MAX|COUNT|AVG|SUM)/i);c?(this.aggregate_=c[0].toUpperCase(),b=b.replace(/^(MIN|MAX|COUNT|AVG|SUM)/i,"").trim()):this.aggregate_=void 0;"("==b.charAt(0)&&(")"==b.charAt(b.length-1)?b=b.substring(1,b.length-1):new ydn.db.SqlParseError("missing closing parentheses"));this.selList_=b;b=a.search(/(ORDER BY|LIMIT|OFFSET)/i);0<b?(this.modifier_=a.substring(b),a=a.substring(0,b)):this.modifier_="";b=a.search(/WHERE/i);0<b?(this.condition_=a.substring(b+6).trim(),
a=a.substring(0,b)):this.condition_="";this.store_names_=a.trim().split(",").map(function(a){a=goog.string.stripQuotes(a,'"');a=goog.string.stripQuotes(a,"'");return a.trim()});this.has_parsed_=!0}};
ydn.db.Sql.prototype.parse=function(a){if(a){for(var b=0;b<a.length;b++)this.sql_=this.sql_.replace("?",a[b]);this.parseBasic_(this.sql_)}this.wheres_=this.parseConditions();if(!this.wheres_)return this.last_error_;a=this.modifier_.length;if(b=/OFFSET\s+(\d+)/i.exec(this.modifier_))this.offset_=parseInt(b[1],10),a=this.modifier_.search(/OFFSET/i);if(b=/LIMIT\s+(\d+)/i.exec(this.modifier_))this.limit_=parseInt(b[1],10),b=this.modifier_.search(/LIMIT/i),b<a&&(a=b);a=this.modifier_.substr(0,a);(a=/ORDER BY\s+(.+)/i.exec(a))?
(a=a[1].trim(),(b=a.match(/(ASC|DESC)/i))?(this.reverse_="DESC"==b[0].toUpperCase(),a=a.replace(/\s+(ASC|DESC)/i,"")):this.reverse_=!1,this.order_=goog.string.stripQuotes(goog.string.stripQuotes(a,'"'),"'"),goog.asserts.assert(0<this.order_.length,"Invalid order by field")):this.order_=void 0;this.has_parsed_=!0;return""};ydn.db.Sql.prototype.getSelList=function(){if("*"==this.selList_)return null;var a=this.selList_.split(",");return a=a.map(function(a){return goog.string.stripQuotes(a.trim(),'"')})};
ydn.db.Sql.prototype.getSql=function(){return this.sql_};ydn.db.Sql.prototype.toJSON=function(){return{sql:this.sql_}};ydn.db.Sql.prototype.getStoreNames=function(){return goog.array.clone(this.store_names_)};ydn.db.Sql.prototype.getMode=function(){return this.mode_};ydn.db.Sql.prototype.getLimit=function(){return this.limit_};ydn.db.Sql.prototype.getOffset=function(){return this.offset_};ydn.db.Sql.prototype.getOrderBy=function(){return this.order_};ydn.db.Sql.prototype.isReversed=function(){return this.reverse_};
ydn.db.Sql.prototype.getConditions=function(){return this.wheres_};
ydn.db.Sql.prototype.parseConditions=function(){var a=[],b=/(.+?)(<=|>=|=|>|<)(.+)/i,c=function(b){return goog.array.findIndex(a,function(a){return a.getField()==b})};if(0<this.condition_.length)for(var d=this.condition_.split("AND"),e=0;e<d.length;e++){var f=d[e],g=b.exec(f);if(g){var h=g[1].trim(),h=goog.string.stripQuotes(h,'"'),h=goog.string.stripQuotes(h,"'");if(0<h.length){var k=g[3].trim(),k=goog.string.startsWith(k,'"')?goog.string.stripQuotes(k,'"'):goog.string.startsWith(k,"'")?goog.string.stripQuotes(k,
"'"):parseFloat(k),g=new ydn.db.Where(h,g[2],k),h=c(h);if(0<=h){if(a[h]=a[h].and(g),!a[h])return this.last_error_='where clause "'+f+'" conflict',null}else a.push(g)}else return this.last_error_='Invalid clause "'+f+'"',null}else return this.last_error_='Invalid clause "'+f+'"',null}return a};ydn.db.Sql.prototype.getAction=function(){return this.action_};ydn.db.Sql.prototype.toString=function(){return goog.DEBUG?"query:"+this.sql_:ydn.db.Sql.superClass_.toString.call(this)};
ydn.db.Sql.prototype.getAggregate=function(){return this.aggregate_};ydn.db.sql.req.IRequestExecutor=function(){};ydn.db.sql.IStorage=function(){};ydn.db.sql.req.nosql={};ydn.db.sql.req.nosql.Node=function(a,b){this.sql=b;this.store_schema=a};ydn.db.sql.req.nosql.Node.prototype.logger=goog.log.getLogger("ydn.db.sql.req.nosql.Node");ydn.db.sql.req.nosql.Node.prototype.toJSON=function(){return{sql:this.sql}};ydn.db.sql.req.nosql.Node.prototype.toString=function(){return"idb.Node:"};
ydn.db.sql.req.nosql.Node.prototype.execute=function(a,b){var c=this.sql.getStoreNames()[0],d=this.sql.getConditions(),e=this.sql.getLimit(),e=isNaN(e)?ydn.db.base.DEFAULT_RESULT_LIMIT:e,f=this.sql.getOffset(),f=isNaN(f)?0:f,g=this.sql.getOrderBy(),h=this.sql.getSelList(),k=null,l=this.sql.isReversed();if(0==d.length)k=null;else if(1==d.length)k=ydn.db.KeyRange.parseIDBKeyRange(d[0].getKeyRange());else throw new ydn.debug.error.NotSupportedException("too many conditions.");goog.isNull(h)||a.await(function(a,
b,c){var d=a;b||(d=a.map(function(a){var b=h.length;if(1==b)return ydn.db.utils.getValueByKeys(a,h[0]);for(var c={},d=0;d<b;d++)c[h[d]]=ydn.db.utils.getValueByKeys(a,h[d]);return c}));c(d,b)});var d=0<d.length?d[0].getField():void 0,m=a.getLabel()+" executing on"+c;d&&(m+=":"+d);m+=" "+ydn.db.KeyRange.toString(k);goog.log.finer(this.logger,m);g&&g!=this.store_schema.getKeyPath()?b.list(a,ydn.db.base.QueryMethod.LIST_VALUE,c,g,k,e,f,l,!1):goog.isDef(d)&&d!=this.store_schema.getKeyPath()?b.list(a,ydn.db.base.QueryMethod.LIST_VALUE,
c,d,k,e,f,l,!1):b.list(a,ydn.db.base.QueryMethod.LIST_VALUE,c,null,k,e,f,l,!1)};ydn.db.sql.req.nosql.ReduceNode=function(a,b){ydn.db.sql.req.nosql.Node.call(this,a,b)};goog.inherits(ydn.db.sql.req.nosql.ReduceNode,ydn.db.sql.req.nosql.Node);
ydn.db.sql.req.nosql.ReduceNode.prototype.execute=function(a,b){var c,d=this.sql.getStoreNames()[0],e=this.sql.getConditions(),f=null;this.sql.isReversed();if(0==e.length)f=null;else if(1==e.length)f=ydn.db.KeyRange.parseIDBKeyRange(e[0].getKeyRange());else throw new ydn.debug.error.NotSupportedException("too many conditions.");var g=this.sql.getAggregate(),e=0<e.length?e[0].getField():void 0,h=a.getLabel()+" executing "+g+" on "+d;e&&(h+=":"+e);h+=" "+ydn.db.KeyRange.toString(f);goog.log.finer(this.logger,
h);if("COUNT"==g)f?b.countKeyRange(a,d,f,e,!1):b.countKeyRange(a,d,null,void 0,!1);else{var k,h=this.sql.getSelList();if(!h||0==h.length)throw new ydn.error.InvalidOperationError("field name require for reduce operation: "+g);h=h[0];if("MIN"==g)k=ydn.db.sql.req.nosql.ReduceNode.reduceMin(h);else if("MAX"==g)k=ydn.db.sql.req.nosql.ReduceNode.reduceMax(h);else if("AVG"==g)c=0,k=ydn.db.sql.req.nosql.ReduceNode.reduceAverage(h);else if("SUM"==g)c=0,k=ydn.db.sql.req.nosql.ReduceNode.reduceSum(h);else throw new ydn.error.NotSupportedException(g);
var l;l=goog.isDef(e)?new ydn.db.IndexValueIterator(d,e,f):new ydn.db.ValueIterator(d,f);var d=b.getCursor(a.getTx(),a.getLabel(),d,ydn.db.base.QueryMethod.LIST_VALUE),m=l.load([d]);m.onFail=function(b){a.setDbValue(b,!0)};var n=0;m.onNext=function(b){goog.isDefAndNotNull(b)?(b=l.isKeyIterator()?m.getPrimaryKey():m.getValue(),c=k(b,c,n),m.advance(1),n++):a.setDbValue(c)}}};ydn.db.sql.req.nosql.ReduceNode.reduceAverage=function(a){return function(b,c,d){goog.isDef(c)||(c=0);return(c*d+b[a])/(d+1)}};
ydn.db.sql.req.nosql.ReduceNode.reduceSum=function(a){return function(b,c,d){return c+b[a]}};ydn.db.sql.req.nosql.ReduceNode.reduceMin=function(a){return function(b,c,d){b=b[a];return goog.isDef(c)?c<b?c:b:b}};ydn.db.sql.req.nosql.ReduceNode.reduceMax=function(a){return function(b,c,d){b=b[a];return goog.isDef(c)?c>b?c:b:b}};ydn.db.sql.req.IndexedDb=function(a,b){ydn.db.core.req.IndexedDb.call(this,a,b)};goog.inherits(ydn.db.sql.req.IndexedDb,ydn.db.core.req.IndexedDb);
ydn.db.sql.req.IndexedDb.DEBUG=!1;ydn.db.sql.req.IndexedDb.prototype.logger=goog.log.getLogger("ydn.db.sql.req.IndexedDb");
ydn.db.sql.req.IndexedDb.prototype.executeSql=function(a,b,c){if(c=b.parse(c))throw new ydn.db.SqlParseError(c);c=b.getStoreNames();if(1==c.length){var d=this.schema.getStore(c[0]);if(!d)throw new ydn.db.NotFoundError(c[0]);var e=b.getSelList();if(e)for(var f=0;f<e.length;f++)if(!d.hasIndex(e[f]))throw new ydn.db.NotFoundError('Index "'+e[f]+'" not found in '+c[0]);(b.getAggregate()?new ydn.db.sql.req.nosql.ReduceNode(d,b):new ydn.db.sql.req.nosql.Node(d,b)).execute(a,this)}else throw new ydn.error.NotSupportedException(b.getSql());
};ydn.db.sql.req.SqlQuery=function(a,b,c,d,e,f,g,h){ydn.db.sql.req.IterableQuery.call(this,a,b,c,d,e,f,g,h);this.parseRow=ydn.db.sql.req.SqlQuery.prototype.parseRow;this.sql="";this.params=[]};goog.inherits(ydn.db.sql.req.SqlQuery,ydn.db.sql.req.IterableQuery);ydn.db.sql.req.SqlQuery.prototype.toJSON=function(){var a=ydn.db.sql.req.SqlQuery.superClass_.toJSON.call(this);a.sql=this.sql;a.params=ydn.object.clone(this.params);return a};ydn.db.sql.req.SqlQuery.prototype.sql="";
ydn.db.sql.req.SqlQuery.prototype.params=[];ydn.db.sql.req.SqlQuery.prototype.toString=function(){var a=goog.isDef(this.getIndexName())?":"+this.getIndexName():"";return"Cursor:"+this.getStoreName()+a};ydn.db.sql.req.SqlQuery.prototype.parseRow=function(a,b){return ydn.db.crud.req.WebSql.parseRow(a,b)};ydn.db.sql.req.SqlQuery.parseRowIdentity=function(a,b){return a};ydn.db.sql.req.websql={};ydn.db.sql.req.websql.Node=function(a,b){this.sql=b;this.store_schema_=a;this.sel_fields_=b.getSelList()};
ydn.db.sql.req.websql.Node.prototype.logger=goog.log.getLogger("ydn.db.sql.req.websql.Node");ydn.db.sql.req.websql.Node.prototype.toJSON=function(){return{sql:this.sql.getSql()}};ydn.db.sql.req.websql.Node.prototype.toString=function(){return"websql.Node:"};
ydn.db.sql.req.websql.Node.prototype.parseRow=function(a){if(this.sel_fields_){if(1==this.sel_fields_.length){if(goog.isObject(a))return goog.object.getValueByKeys(a,this.sel_fields_[0]);return}for(var b={},c=0;c<this.sel_fields_.length;c++)b[this.sel_fields_[c]]=goog.object.getValueByKeys(a,this.sel_fields_[c]);return b}return ydn.db.crud.req.WebSql.parseRow(a,this.store_schema_)};
ydn.db.sql.req.websql.Node.prototype.execute=function(a,b,c){var d=this.sql.getSql(),e=this,f=[];ydn.db.sql.req.WebSql.DEBUG&&goog.global.console.log(this+" open SQL: "+d+" PARAMS:"+ydn.json.stringify(c));b.executeSql(d,c,function(b,c){for(var d=c.rows.length,l=0;l<d;l++){var m=c.rows.item(l);if(goog.isObject(m))var n=e.parseRow(m);f.push(n)}a(f)},function(b,c){ydn.db.sql.req.WebSql.DEBUG&&goog.global.console.log([d,b,c]);goog.log.warning(e.logger,"Sqlite error: "+c.message);a(c,!0);return!0})};
ydn.db.sql.req.websql.ReduceNode=function(a,b){ydn.db.sql.req.websql.Node.call(this,a,b)};goog.inherits(ydn.db.sql.req.websql.ReduceNode,ydn.db.sql.req.websql.Node);
ydn.db.sql.req.websql.ReduceNode.prototype.execute=function(a,b,c){var d=this.sql.getSql(),e=this;ydn.db.sql.req.WebSql.DEBUG&&goog.global.console.log(this+" open SQL: "+d+" PARAMS:"+ydn.json.stringify(c));b.executeSql(d,c,function(b,c){var d=c.rows.length;if(1==d)d=ydn.object.takeFirst(c.rows.item(0)),a(d);else if(0==d)a(void 0);else throw new ydn.db.InternalError;},function(b,c){ydn.db.sql.req.WebSql.DEBUG&&goog.global.console.log([d,b,c]);goog.log.warning(e.logger,"Sqlite error: "+c.message);a(c,
!0);return!0})};ydn.db.sql.req.WebSql=function(a,b){ydn.db.core.req.WebSql.call(this,a,b)};goog.inherits(ydn.db.sql.req.WebSql,ydn.db.core.req.WebSql);ydn.db.sql.req.WebSql.DEBUG=!1;ydn.db.sql.req.WebSql.prototype.logger=goog.log.getLogger("ydn.db.sql.req.WebSql");
ydn.db.sql.req.WebSql.prototype.executeSql=function(a,b,c){var d=b.getStoreNames();if(1==d.length){var e=this.schema.getStore(d[0]);if(!e)throw new ydn.db.NotFoundError(d[0]);var f=b.getSelList();if(f)for(var g=0;g<f.length;g++)if(!e.hasIndex(f[g]))throw new ydn.db.NotFoundError('Index "'+f[g]+'" not found in '+d[0]);(b.getAggregate()?new ydn.db.sql.req.websql.ReduceNode(e,b):new ydn.db.sql.req.websql.Node(e,b)).execute(function(b,c){a.setDbValue(b,c)},a.getTx(),c)}else throw new ydn.error.NotSupportedException(b.getSql());
};
ydn.db.sql.req.WebSql.prototype.planQuery=function(a){var b=this.schema.getStore(a.getStoreName());if(!b)throw new ydn.db.SqlParseError("TABLE: "+a.getStoreName()+" not found.");var c=a.getKeyRange(),d=new ydn.db.sql.req.SqlQuery(a.getStoreName(),a.getIndexName(),c,a.isReversed(),a.isUnique(),a.isKeyIterator()),e=d.getIndexName(),e=(e=goog.isDef(e)?b.getIndex(e):null)?e.getKeyPath():goog.isDefAndNotNull(b.keyPath)?b.keyPath:ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME;goog.asserts.assertString(e);var e=goog.string.quote(e),
b=(a.isKeyIterator()?e:"*")+" FROM "+b.getQuotedName(),f="";c&&(ydn.db.Where.resolvedStartsWith(c)?(f=e+" LIKE ?",d.params.push(c.lower+"%")):(goog.isDefAndNotNull(c.lower)&&(f+=" "+e+(c.lowerOpen?" > ":" >= ")+"?",d.params.push(c.lower)),goog.isDefAndNotNull(c.upper)&&(f+=(0<f.length?" AND ":" ")+e+(c.upperOpen?" < ":" <= ")+"?",d.params.push(c.upper))),f=" WHERE ("+f+")");c="ASC";a.isReversed()&&(c="DESC");d.sql=["SELECT",b,f,"ORDER BY "+e,c].join(" ");return d};
ydn.db.sql.req.SimpleStore=function(a,b){ydn.db.core.req.SimpleStore.call(this,a,b)};goog.inherits(ydn.db.sql.req.SimpleStore,ydn.db.core.req.SimpleStore);ydn.db.sql.req.SimpleStore.DEBUG=!1;ydn.db.sql.req.SimpleStore.prototype.logger=goog.log.getLogger("ydn.db.sql.req.SimpleStore");
ydn.db.sql.req.SimpleStore.prototype.executeSql=function(a,b,c){if(c=b.parse(c))throw new ydn.db.SqlParseError(c);c=b.getStoreNames();if(1==c.length){var d=this.schema.getStore(c[0]);if(!d)throw new ydn.db.NotFoundError(c[0]);var e=b.getSelList();if(e)for(var f=0;f<e.length;f++)if(!d.hasIndex(e[f]))throw new ydn.debug.error.ArgumentException('Index "'+e[f]+'" not found in '+c[0]);(b.getAggregate()?new ydn.db.sql.req.nosql.ReduceNode(d,b):new ydn.db.sql.req.nosql.Node(d,b)).execute(a,this)}else throw new ydn.debug.error.NotSupportedException(b.getSql());
};ydn.db.sql.DbOperator=function(a,b,c,d){ydn.db.core.DbOperator.call(this,a,b,c,d)};goog.inherits(ydn.db.sql.DbOperator,ydn.db.core.DbOperator);
ydn.db.sql.DbOperator.prototype.executeSql=function(a,b){for(var c=new ydn.db.Sql(a),d=c.getStoreNames(),e=0;e<d.length;e++){var f=this.schema.getStore(d[e]);if(!f)throw new ydn.debug.error.ArgumentException("store: "+f+" not exists.");}goog.log.finer(this.logger,"executeSql: "+a+" params: "+b);var g=this.tx_thread.request(ydn.db.Request.Method.SQL,c.getStoreNames(),c.getMode());g.addTxback(function(){this.getExecutor().executeSql(g,c,b||[])},this);return g};
ydn.db.sql.Storage=function(a,b,c){ydn.db.core.Storage.call(this,a,b,c)};goog.inherits(ydn.db.sql.Storage,ydn.db.core.Storage);ydn.db.sql.Storage.prototype.newOperator=function(a,b){return new ydn.db.sql.DbOperator(this,this.schema,a,b)};ydn.db.sql.Storage.prototype.getSqlOperator=function(){return this.db_operator};ydn.db.sql.Storage.prototype.executeSql=function(a,b){return this.getSqlOperator().executeSql(a,b)};ydn.db.sql.Storage.inject={};
ydn.db.sql.Storage.prototype.newExecutor=function(){var a=this.getType();if(a==ydn.db.base.Mechanisms.IDB)return new ydn.db.sql.req.IndexedDb(this.db_name,this.schema);if(a==ydn.db.base.Mechanisms.WEBSQL||a==ydn.db.base.Mechanisms.SQLITE)return new ydn.db.sql.req.WebSql(this.db_name,this.schema);if(a==ydn.db.base.Mechanisms.MEMORY_STORAGE||a==ydn.db.base.Mechanisms.LOCAL_STORAGE||a==ydn.db.base.Mechanisms.SESSION_STORAGE)return new ydn.db.sql.req.SimpleStore(this.db_name,this.schema);throw new ydn.debug.error.InternalError("No executor for "+
a);};goog.userAgent.product={};goog.userAgent.product.ASSUME_FIREFOX=!1;goog.userAgent.product.ASSUME_CAMINO=!1;goog.userAgent.product.ASSUME_IPHONE=!1;goog.userAgent.product.ASSUME_IPAD=!1;goog.userAgent.product.ASSUME_ANDROID=!1;goog.userAgent.product.ASSUME_CHROME=!1;goog.userAgent.product.ASSUME_SAFARI=!1;
goog.userAgent.product.PRODUCT_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_OPERA||goog.userAgent.product.ASSUME_FIREFOX||goog.userAgent.product.ASSUME_CAMINO||goog.userAgent.product.ASSUME_IPHONE||goog.userAgent.product.ASSUME_IPAD||goog.userAgent.product.ASSUME_ANDROID||goog.userAgent.product.ASSUME_CHROME||goog.userAgent.product.ASSUME_SAFARI;
goog.userAgent.product.init_=function(){goog.userAgent.product.detectedFirefox_=!1;goog.userAgent.product.detectedCamino_=!1;goog.userAgent.product.detectedIphone_=!1;goog.userAgent.product.detectedIpad_=!1;goog.userAgent.product.detectedAndroid_=!1;goog.userAgent.product.detectedChrome_=!1;goog.userAgent.product.detectedSafari_=!1;var a=goog.userAgent.getUserAgentString();a&&(-1!=a.indexOf("Firefox")?goog.userAgent.product.detectedFirefox_=!0:-1!=a.indexOf("Camino")?goog.userAgent.product.detectedCamino_=
!0:-1!=a.indexOf("iPad")?goog.userAgent.product.detectedIpad_=!0:-1!=a.indexOf("iPhone")||-1!=a.indexOf("iPod")?goog.userAgent.product.detectedIphone_=!0:-1!=a.indexOf("Chrome")?goog.userAgent.product.detectedChrome_=!0:-1!=a.indexOf("Android")?goog.userAgent.product.detectedAndroid_=!0:-1!=a.indexOf("Safari")&&(goog.userAgent.product.detectedSafari_=!0))};goog.userAgent.product.PRODUCT_KNOWN_||goog.userAgent.product.init_();goog.userAgent.product.OPERA=goog.userAgent.OPERA;
goog.userAgent.product.IE=goog.userAgent.IE;goog.userAgent.product.FIREFOX=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_FIREFOX:goog.userAgent.product.detectedFirefox_;goog.userAgent.product.CAMINO=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_CAMINO:goog.userAgent.product.detectedCamino_;goog.userAgent.product.IPHONE=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_IPHONE:goog.userAgent.product.detectedIphone_;
goog.userAgent.product.IPAD=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_IPAD:goog.userAgent.product.detectedIpad_;goog.userAgent.product.ANDROID=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_ANDROID:goog.userAgent.product.detectedAndroid_;goog.userAgent.product.CHROME=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_CHROME:goog.userAgent.product.detectedChrome_;
goog.userAgent.product.SAFARI=goog.userAgent.product.PRODUCT_KNOWN_?goog.userAgent.product.ASSUME_SAFARI:goog.userAgent.product.detectedSafari_;ydn.db.con.IndexedDb=function(a,b){goog.isDef(a)&&5242880<a&&goog.log.log(this.logger,goog.log.Level.WARNING,"storage size request ignored, use Quota Management API instead");this.idx_db_=null;this.time_out_=b||NaN};
ydn.db.con.IndexedDb.prototype.connect=function(a,b){var c=this,d=new goog.async.Deferred,e=void 0,f=function(a,b){d.hasFired()?goog.log.warning(c.logger,"database already set."):goog.isDef(b)?(goog.log.warning(c.logger,b?b.message:"Error received."),c.idx_db_=null,d.errback(b)):(goog.asserts.assertObject(a,"db"),c.idx_db_=a,c.idx_db_.onabort=function(a){goog.log.finest(c.logger,c+": abort");c.onError(a.target.error)},c.idx_db_.onerror=function(a){ydn.db.con.IndexedDb.DEBUG&&goog.global.console.log(a);
goog.log.finest(c.logger,c+": error");c.onError(a.target.error)},c.idx_db_.onversionchange=function(a){ydn.db.con.IndexedDb.DEBUG&&goog.global.console.log([this,a]);goog.log.finest(c.logger,c+" closing connection for onversionchange to: "+a.version);if(c.idx_db_&&(c.idx_db_.onabort=null,c.idx_db_.onblocked=null,c.idx_db_.onerror=null,c.idx_db_.onversionchange=null,c.onVersionChange(a),!a.defaultPrevented)){c.idx_db_.close();c.idx_db_=null;var b=Error();b.name=a.type;c.onFail(b)}},d.callback(parseFloat(e)))},
g=function(a,d,f){goog.log.finer(c.logger,(f?"changing":"upgrading")+" version to "+a.version+" from "+e);for(f=0;f<b.stores.length;f++)c.update_store_(a,d,b.stores[f]);d=a.objectStoreNames;var g=d.length;for(f=0;f<g;f++)b.hasStore(d[f])||(a.deleteObjectStore(d[f]),goog.log.finer(c.logger,"store: "+d[f]+" deleted."))},h=b.getVersion();goog.log.log(this.logger,goog.log.Level.FINER,"Opening database: "+a+" ver: "+(b.isAutoVersion()?"auto":h));var k;k=goog.isDef(h)?ydn.db.base.indexedDb.open(a,h):ydn.db.base.indexedDb.open(a);
k.onsuccess=function(d){var h=d.target.result;goog.isDef(e)||(e=h.version);goog.log.log(c.logger,goog.log.Level.FINER,"Database: "+h.name+", ver: "+h.version+" opened.");if(b.isAutoVersion())c.getSchema(function(d){if(b instanceof ydn.db.schema.EditableDatabase)for(var e=0;e<d.stores.length;e++)b.hasStore(d.stores[e].getName())||b.addStore(d.stores[e].clone());d=b.difference(d,!1,!0);if(0<d.length){goog.log.log(c.logger,goog.log.Level.FINER,"Schema change require for difference in "+d);var k=goog.isNumber(h.version)?
h.version+1:1;if("IDBOpenDBRequest"in goog.global){h.close();var l=ydn.db.base.indexedDb.open(a,k);l.onupgradeneeded=function(a){a=a.target.result;goog.log.log(c.logger,goog.log.Level.FINER,"re-open for version "+a.version);g(a,l.transaction,!1)};l.onsuccess=function(a){f(a.target.result)};l.onerror=function(a){goog.log.log(c.logger,goog.log.Level.FINER,c+": fail.");f(null)}}else{var n=h.setVersion(k+"");n.onfailure=function(a){goog.log.warning(c.logger,"migrating from "+h.version+" to "+k+" failed.");
f(null,a)};n.onsuccess=function(a){n.transaction.oncomplete=v;g(h,n.transaction,!0)};var v=function(b){b=ydn.db.base.indexedDb.open(a);b.onsuccess=function(a){a=a.target.result;goog.log.log(c.logger,goog.log.Level.FINER,c+": OK.");f(a)};b.onerror=function(a){goog.log.log(c.logger,goog.log.Level.FINER,c+": fail.");f(null)}};goog.isDefAndNotNull(n.transaction)&&(n.transaction.oncomplete=v)}}else f(h)},void 0,h);else if(b.getVersion()>h.version){goog.asserts.assertFunction(h.setVersion,"Expecting IDBDatabase in old format");
d=b.getVersion();var k=h.setVersion(d);k.onfailure=function(a){goog.log.warning(c.logger,"migrating from "+h.version+" to "+b.getVersion()+" failed.");f(null,a)};k.onsuccess=function(a){g(h,k.transaction,!0)}}else b.getVersion()==h.version?goog.log.log(c.logger,goog.log.Level.FINER,"database version "+h.version+" ready to go"):goog.log.warning(c.logger,"connected database version "+h.version+" is higher than requested version."),c.getSchema(function(a){a=b.difference(a,!1,!0);0<a.length?(goog.log.log(c.logger,
goog.log.Level.FINER,a),f(null,new ydn.error.ConstraintError("different schema: "+a))):f(h)},void 0,h)};k.onupgradeneeded=function(a){a=a.target.result;e=NaN;goog.log.log(this.logger,goog.log.Level.FINER,"upgrade needed for version "+a.version);g(a,k.transaction,!1)};k.onerror=function(d){var e=goog.isDef(b.version)?" with version "+b.version:"",e='open request to database "'+a+'" '+e+" cause error of "+k.error.name;ydn.db.con.IndexedDb.DEBUG&&goog.global.console.log([d,k]);goog.log.error(c.logger,
e);f(null,d)};k.onblocked=function(d){ydn.db.con.IndexedDb.DEBUG&&goog.global.console.log([d,k]);goog.log.error(c.logger,"database "+a+" "+b.version+" block, close other connections.");f(null,d)};goog.isNumber(this.time_out_)&&!isNaN(this.time_out_)&&setTimeout(function(){"done"!=k.readyState&&(goog.log.error(c.logger,c+": database state is still "+k.readyState),f(null,new ydn.db.TimeoutError("connection timeout after "+c.time_out_)))},this.time_out_);return d};ydn.db.con.IndexedDb.DEBUG=!1;
ydn.db.con.IndexedDb.isSupported=function(){return!ydn.db.base.indexedDb||goog.userAgent.product.SAFARI?!1:!!ydn.db.base.indexedDb};ydn.db.con.IndexedDb.prototype.time_out_=18E4;ydn.db.con.IndexedDb.prototype.onFail=function(a){};ydn.db.con.IndexedDb.prototype.onError=function(a){};ydn.db.con.IndexedDb.prototype.onVersionChange=function(a){};ydn.db.con.IndexedDb.prototype.getType=function(){return ydn.db.base.Mechanisms.IDB};
ydn.db.con.IndexedDb.prototype.getDbInstance=function(){return this.idx_db_||null};ydn.db.con.IndexedDb.prototype.isReady=function(){return!!this.idx_db_};ydn.db.con.IndexedDb.prototype.logger=goog.log.getLogger("ydn.db.con.IndexedDb");ydn.db.con.IndexedDb.prototype.idx_db_=null;ydn.db.con.IndexedDb.prototype.getVersion=function(){return this.idx_db_?parseFloat(this.idx_db_.version):void 0};
ydn.db.con.IndexedDb.prototype.getSchema=function(a,b,c){c=c||this.idx_db_;var d=ydn.db.base.TransactionMode.READ_ONLY;if(goog.isDef(b)){if(goog.isNull(b)){if(0==c.objectStoreNames.length){a(new ydn.db.schema.Database(c.version));return}throw new ydn.error.InternalError;}c=b.db}else{b=[];for(var e=c.objectStoreNames.length-1;0<=e;e--)b[e]=c.objectStoreNames[e];if(0==b.length){a(new ydn.db.schema.Database(c.version));return}b=c.transaction(b,d)}for(var d=c.objectStoreNames,f=[],g=d.length,e=0;e<g;e++){for(var h=
b.objectStore(d[e]),k=[],l=0,m=h.indexNames.length;l<m;l++){var n=h.index(h.indexNames[l]);k[l]=new ydn.db.schema.Index(n.keyPath,void 0,n.unique,n.multiEntry,n.name)}f[e]=new ydn.db.schema.Store(h.name,h.keyPath,h.autoIncrement,void 0,k)}b=new ydn.db.schema.Database(c.version,f);a(b)};
ydn.db.con.IndexedDb.prototype.update_store_=function(a,b,c){goog.log.log(this.logger,goog.log.Level.FINEST,"Creating Object Store for "+c.getName()+" keyPath: "+c.getKeyPath());var d=function(){var b={autoIncrement:!!c.isAutoIncrement()};goog.isDefAndNotNull(c.getKeyPath())&&(b.keyPath=c.getKeyPath());return a.createObjectStore(c.getName(),b)};if(a.objectStoreNames.contains(c.getName())){b=b.objectStore(c.getName());var e=c.getKeyPath()||"";ydn.db.schema.Index.compareKeyPath(e,b.keyPath||"")?(a.deleteObjectStore(c.getName()),
goog.log.log(this.logger,goog.log.Level.WARNING,"store: "+c.getName()+" deleted due to keyPath change."),b=d()):goog.isBoolean(b.autoIncrement)&&(goog.isBoolean(c.isAutoIncrement())&&b.autoIncrement!=c.isAutoIncrement())&&(a.deleteObjectStore(c.getName()),goog.log.log(this.logger,goog.log.Level.WARNING,"store: "+c.getName()+" deleted due to autoIncrement change."),b=d());d=b.indexNames;for(e=0;e<c.countIndex();e++){var f=c.index(e);!d.contains(f.getName())&&f.isGeneratorIndex()&&(b.clear(),goog.log.log(this.logger,
goog.log.Level.WARNING,"store: "+c.getName()+" cleared since generator index need re-indexing."))}for(var g=0,h=0,k=0,e=0;e<c.countIndex();e++){var f=c.index(e),l=!1;if(d.contains(f.getName())){var m=b.index(f.getName()),n=goog.isDefAndNotNull(m.unique)&&goog.isDefAndNotNull(f.unique)&&m.unique!=f.unique,p=goog.isDefAndNotNull(m.multiEntry)&&goog.isDefAndNotNull(f.multiEntry)&&m.multiEntry!=f.multiEntry,m=goog.isDefAndNotNull(m.keyPath)&&goog.isDefAndNotNull(f.keyPath)&&!!ydn.db.schema.Index.compareKeyPath(m.keyPath,
f.keyPath);if(n||p||m)b.deleteIndex(f.getName()),l=!0,g--,k++}else f.getType()!=ydn.db.schema.DataType.BLOB&&(l=!0);l&&(f.unique||f.multiEntry?(l={unique:f.unique,multiEntry:f.multiEntry},b.createIndex(f.getName(),f.keyPath,l)):b.createIndex(f.getName(),f.keyPath),g++)}for(e=0;e<d.length;e++)c.hasIndex(d[e])||(b.deleteIndex(d[e]),h++);goog.log.log(this.logger,goog.log.Level.FINEST,"Updated store: "+b.name+", "+g+" index created, "+h+" index deleted, "+k+" modified.")}else{b=d();for(e=0;e<c.countIndex();e++)f=
c.index(e),f.getType()==ydn.db.schema.DataType.BLOB?goog.log.log(this.logger,goog.log.Level.INFO,"Index "+f+" of blob data type ignored."):(goog.log.log(this.logger,goog.log.Level.FINEST,"Creating index: "+f),f.unique||f.multiEntry?(l={unique:f.unique,multiEntry:f.multiEntry},b.createIndex(f.getName(),f.keyPath,l)):b.createIndex(f.getName(),f.keyPath));goog.log.log(this.logger,goog.log.Level.FINEST,"Created store: "+b)}};
ydn.db.con.IndexedDb.prototype.doTransaction=function(a,b,c,d){var e=this.idx_db_;if(!b){b=[];for(var f=e.objectStoreNames.length-1;0<=f;f--)b[f]=e.objectStoreNames[f]}0==b.length?a(null):(b=e.transaction(b,c),b.oncomplete=function(a){d(ydn.db.base.TxEventTypes.COMPLETE,a)},b.onabort=function(a){d(ydn.db.base.TxEventTypes.ABORT,a)},a(b),a=null)};ydn.db.con.IndexedDb.prototype.close=function(){goog.log.log(this.logger,goog.log.Level.FINEST,this+" closing connection");this.idx_db_.close()};
goog.DEBUG&&(ydn.db.con.IndexedDb.prototype.toString=function(){return"IndexedDB:"+(this.idx_db_?this.idx_db_.name+":"+this.idx_db_.version:"")},ydn.db.con.IndexedDb.deleteAllDatabases=function(){window.indexedDB.webkitGetDatabaseNames().onsuccess=function(a){a=a.target.result;for(var b=0;b<a.length;b++)window.console.info("deleting "+a[b]),window.indexedDB.deleteDatabase(a[b])}});
ydn.db.con.IndexedDb.deleteDatabase=function(a,b){if(!ydn.db.base.indexedDb||b&&b!=ydn.db.base.Mechanisms.IDB)return null;var c=ydn.db.base.indexedDb.deleteDatabase(a),d=new ydn.db.Request(ydn.db.Request.Method.VERSION_CHANGE);c.onblocked=function(a){d.notify(a)};c.onerror=function(a){d.errback(a)};c.onsuccess=function(a){d.callback(a)};return d};ydn.db.databaseDeletors.push(ydn.db.con.IndexedDb.deleteDatabase);
ydn.db.con.SimpleStorage=function(a){ydn.db.con.SimpleStorageService.call(this,a);this.version_=NaN};goog.inherits(ydn.db.con.SimpleStorage,ydn.db.con.SimpleStorageService);ydn.db.con.SimpleStorage.prototype.logger=goog.log.getLogger("ydn.db.con.SimpleStorage");ydn.db.con.SimpleStorage.isSupported=function(){return!0};ydn.db.con.SimpleStorage.DEBUG=!1;ydn.db.con.SimpleStorage.prototype.getVersion=function(){return this.version_};
ydn.db.con.SimpleStorage.prototype.connect=function(a,b){var c=this,d=new goog.async.Deferred,e=function(a,b){setTimeout(function(){b?(goog.log.finer(c.logger,c+" opening fail"),d.errback(b)):(goog.log.finer(c.logger,c+" version "+c.getVersion()+" open"),d.callback(a))},10)};this.storage_=this.provider_.connectDb(a);this.dbname=a;this.schema=b;var f=ydn.db.con.simple.makeKey(this.dbname);this.version_=NaN;var g=ydn.json.parse(this.storage_.getItem(f));goog.isDef(g.version)&&!goog.isNumber(g.version)&&
(g.version=NaN);if(g)if(g=new ydn.db.schema.Database(g),this.schema.difference(g,!1,!1))if(!this.schema.isAutoVersion()&&!isNaN(g.getVersion())&&this.schema.getVersion()>g.getVersion())f=goog.DEBUG?"existing version "+g.getVersion()+" is larger than "+this.schema.getVersion():"",e(NaN,new ydn.db.VersionError(f));else{var h=this.schema.getVersion();this.version_=goog.isDef(h)?h:g.getVersion()+1;for(h=0;h<this.schema.count();h++)var k=this.schema.store(h);if(this.schema instanceof ydn.db.schema.EditableDatabase)for(h=
0;h<g.count();h++)k=g.store(h),goog.asserts.assert(!goog.isNull(k),"store at "+h+" is null"),this.schema.addStore(k);h=this.schema.toJSON();h.version=this.version_||NaN;this.storage_.setItem(f,ydn.json.stringify(h));e(g.getVersion()||NaN)}else{for(h=0;h<this.schema.count();h++)k=this.schema.store(h);this.version_=g.getVersion()||NaN;e(this.version_)}else g=b.toJSON(),this.version_=1,g.version=this.version_,this.storage_.setItem(f,ydn.json.stringify(g)),e(NaN);return d};
ydn.db.con.SimpleStorage.prototype.isReady=function(){return!!this.dbname};ydn.db.con.SimpleStorage.prototype.getDbInstance=function(){return this.storage_||null};ydn.db.con.SimpleStorage.prototype.onFail=function(a){};ydn.db.con.SimpleStorage.prototype.onError=function(a){};ydn.db.con.SimpleStorage.prototype.onVersionChange=function(a){};ydn.db.con.SimpleStorage.prototype.getType=function(){return"memory"};ydn.db.con.SimpleStorage.prototype.close=function(){};
ydn.db.con.SimpleStorage.prototype.doTransaction=function(a,b,c,d){b=new ydn.db.con.simple.TxStorage(this,function(a,b){d(a,b)});a(b)};goog.DEBUG&&(ydn.db.con.SimpleStorage.prototype.toString=function(){var a=this.dbname+":"+this.version_;return"SimpleStorage:"+this.getType()+":"+a});ydn.db.con.LocalStorage=function(){ydn.db.con.SimpleStorage.call(this,this)};goog.inherits(ydn.db.con.LocalStorage,ydn.db.con.SimpleStorage);
ydn.db.con.LocalStorage.prototype.connectDb=function(a){goog.asserts.assertObject(window.localStorage);return window.localStorage};ydn.db.con.LocalStorage.isSupported=function(){return!!window.localStorage};ydn.db.con.LocalStorage.prototype.getType=function(){return ydn.db.base.Mechanisms.LOCAL_STORAGE};
ydn.db.con.LocalStorage.deleteDatabase=function(a,b){if(!b||b==ydn.db.base.Mechanisms.LOCAL_STORAGE){var c=new ydn.db.con.LocalStorage,d=new ydn.db.schema.EditableDatabase;c.connect(a,d);c.getSchema(function(a){for(var b=0;b<a.stores.length;b++)c.getSimpleStore(a.stores[b].getName()).clear()})}};ydn.db.databaseDeletors.push(ydn.db.con.LocalStorage.deleteDatabase);ydn.db.con.SessionStorage=function(){ydn.db.con.SimpleStorage.call(this,this)};goog.inherits(ydn.db.con.SessionStorage,ydn.db.con.SimpleStorage);
ydn.db.con.SessionStorage.prototype.connectDb=function(a){goog.asserts.assertObject(window.sessionStorage);return window.sessionStorage};ydn.db.con.SessionStorage.isSupported=function(){return!!window.sessionStorage};ydn.db.con.SessionStorage.prototype.getType=function(){return ydn.db.base.Mechanisms.SESSION_STORAGE};
ydn.db.con.SessionStorage.deleteDatabase=function(a,b){if(!b||b==ydn.db.base.Mechanisms.SESSION_STORAGE){var c=new ydn.db.con.SessionStorage,d=new ydn.db.schema.EditableDatabase;c.connect(a,d);c.getSchema(function(a){for(var b=0;b<a.stores.length;b++)c.getSimpleStore(a.stores[b].getName()).clear()})}};ydn.db.databaseDeletors.push(ydn.db.con.SessionStorage.deleteDatabase);ydn.db.con.WebSql=function(a,b){this.size_=goog.isDef(a)?a:4194304;this.type_=b||ydn.db.base.Mechanisms.WEBSQL};
ydn.db.con.WebSql.prototype.connect=function(a,b){var c=this,d=NaN,e=new goog.async.Deferred,f=function(a,b){goog.isDef(b)?(c.sql_db_=null,e.errback(b)):(c.sql_db_=a,e.callback(parseFloat(d)))},g=function(b,d,e){var g=e?"changing version":"setting version",h=b.version?parseInt(b.version,10):0,k=d.isAutoVersion()?e?isNaN(h)?1:h+1:h:d.version;goog.log.fine(c.logger,a+": "+g+" from "+b.version+" to "+k);var l=!1,v=0;b.changeVersion(b.version,k+"",function(a){c.getSchema(function(b){l=!0;for(var e=0;e<
d.count();e++){var f=b.getStore(d.store(e).getName()),f=f?f.hintForWebSql(d.store(e)):null;c.update_store_with_info_(a,d.store(e),function(a){a&&v++},f)}for(e=0;e<b.count();e++)f=b.store(e),d.hasStore(f.getName())||(d instanceof ydn.db.schema.EditableDatabase?d.addStore(f):(f="DROP TABLE "+f.getQuotedName(),goog.log.finer(c.logger,f),a.executeSql(f,[],function(a){},function(a,b){throw b;})))},a,b)},function(d){goog.log.error(c.logger,"SQLError "+d+" "+d.code+"("+d.message+") while changing version from "+
b.version+" to "+k+" on "+a);ydn.db.con.WebSql.DEBUG&&goog.global.console.log(d);throw d;},function(){if(l){var e=".";v!=d.stores.length&&(e=" but unexpected stores exists.");goog.log.finest(c.logger,a+":"+b.version+" ready"+e);f(b)}else goog.log.warning(c.logger,a+": "+g+" voided.")})},h=null;try{b.isAutoVersion(),this.type_==ydn.db.base.Mechanisms.SQLITE?goog.global.sqlitePlugin?(h=goog.global.sqlitePlugin.openDatabase(a,"",a,this.size_),h.readTransaction||(h.readTransaction=h.transaction),h.changeVersion=
function(a,b,c,d,e){h.transaction(c,d,e)}):(goog.log.warning(this.logger,"sqlitePlugin not found."),h=null,this.last_error_=Error("sqlitePlugin not found.")):h=goog.global.openDatabase(a,"",a,this.size_)}catch(k){if("SECURITY_ERR"==k.name)goog.log.warning(this.logger,"SECURITY_ERR for opening "+a),h=null,this.last_error_=new ydn.db.SecurityError(k);else throw k;}if(h){var d=h.version||"",l="database "+a+(0==d.length?"":" version "+h.version);goog.isDefAndNotNull(b.version)&&b.version==h.version?(goog.log.fine(c.logger,
"Existing "+l+" opened as requested."),f(h)):this.getSchema(function(a){(a=b.difference(a,!0,!1))?(0==d?goog.log.fine(c.logger,"New "+l+" created."):b.isAutoVersion()?goog.log.fine(c.logger,"Existing "+l+" opened and schema change for "+a):goog.log.fine(c.logger,"Existing "+l+" opened and  schema change to version "+b.version+" for "+a),g(h,b,!0)):(goog.log.fine(c.logger,"Existing "+l+" with same schema opened."),f(h))},null,h)}else f(null,this.last_error_);return e};
ydn.db.con.WebSql.prototype.getType=function(){return this.type_};ydn.db.con.WebSql.prototype.last_error_=null;ydn.db.con.WebSql.prototype.sql_db_=null;ydn.db.con.WebSql.prototype.getDbInstance=function(){return this.sql_db_||null};ydn.db.con.WebSql.isSupported=function(){return goog.isFunction(goog.global.openDatabase)};ydn.db.con.WebSql.isSqliteSupported=function(){return!!goog.global.sqlitePlugin};ydn.db.con.WebSql.DEBUG=!1;ydn.db.con.WebSql.prototype.logger=goog.log.getLogger("ydn.db.con.WebSql");
ydn.db.con.WebSql.prototype.onFail=function(a){};ydn.db.con.WebSql.prototype.onError=function(a){};ydn.db.con.WebSql.CREATE_INDEX=!1;
ydn.db.con.WebSql.prototype.prepareCreateTable_=function(a){var b=a.getSqlType(),c="CREATE TABLE IF NOT EXISTS "+a.getQuotedName()+" (",d=a.getSQLKeyColumnNameQuoted(),c=c+(d+" "+b+" PRIMARY KEY ");a.autoIncrement&&(c+=" AUTOINCREMENT ");if(!a.isFixed()||!a.usedInlineKey()&&0==a.countIndex())c+=" ,"+ydn.db.base.DEFAULT_BLOB_COLUMN+" "+ydn.db.schema.DataType.BLOB;for(var e=[],f=[d],g=0,h=a.countIndex();g<h;g++){var k=a.index(g),l="";if(k.isMultiEntry()){var l=ydn.db.base.PREFIX_MULTIENTRY+a.getName()+
":"+k.getName(),m=k.isUnique()?" UNIQUE ":"",k="CREATE TABLE IF NOT EXISTS "+goog.string.quote(l)+" ("+d+" "+b+", "+k.getSQLIndexColumnNameQuoted()+" "+k.getSqlType()+m+")";e.push(k)}else k.isUnique()&&(l=" UNIQUE "),m=k.getKeyPath(),ydn.db.con.WebSql.CREATE_INDEX&&(k.type!=ydn.db.schema.DataType.BLOB&&goog.isString(m))&&(m="CREATE "+l+" INDEX IF NOT EXISTS "+goog.string.quote(a.getName()+"-"+k.getName())+" ON "+a.getQuotedName()+" ("+k.getSQLIndexColumnNameQuoted()+")",e.push(m)),m=k.getSQLIndexColumnNameQuoted(),
-1==f.indexOf(m)&&(c+=", "+m+" "+k.getSqlType()+l,f.push(m))}e.unshift(c+")");return e};ydn.db.con.WebSql.prototype.getVersion=function(){return this.sql_db_?parseFloat(this.sql_db_.version):void 0};
ydn.db.con.WebSql.prototype.getSchema=function(a,b,c){var d=this,e=(c=c||this.sql_db_)&&c.version?parseFloat(c.version):void 0,e=isNaN(e)?void 0:e,f=[],g=function(b,c){if(c&&c.rows){for(var g=0;g<c.rows.length;g++){var h=c.rows.item(g);if("__WebKitDatabaseInfoTable__"!=h.name&&"sqlite_sequence"!=h.name&&"table"==h.type){var p=goog.object.get(h,"sql");goog.log.finest(d.logger,"Parsing table schema from SQL: "+p);for(var p=p.substr(p.indexOf("("),p.lastIndexOf(")")),q=ydn.string.split_comma_seperated(p),
r=void 0,s,p=[],t=!1,v=!1,w=0;w<q.length;w++){var x=ydn.string.split_space_seperated(q[w]),z=goog.array.map(x,function(a){return a.toUpperCase()}),y=goog.string.stripQuotes(x[0],'"'),x=ydn.db.schema.Index.toType(z[1]);if(-1!=z.indexOf("PRIMARY")&&-1!=z.indexOf("KEY")){s=x;if(goog.isString(y)&&!goog.string.isEmpty(y)&&y!=ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME){var I=y.split(","),r=y;1<I.length&&(r=I,s=void 0)}-1!=z.indexOf("AUTOINCREMENT")&&(t=!0)}else if(y!=ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME)if(y==
ydn.db.base.DEFAULT_BLOB_COLUMN)v=!0;else{var D="UNIQUE"==z[2];goog.string.startsWith(y,h.tbl_name+"-")&&(y=y.substr(h.tbl_name.length+1));z=new ydn.db.schema.Index(y,x,D);p.push(z)}}if(goog.string.startsWith(h.name,ydn.db.base.PREFIX_MULTIENTRY)){var E=h.name.split(":");if(3<=E.length){var C=E[1],r=new ydn.db.schema.Index(E[2],x,D,!0),q=goog.array.findIndex(p,function(a){return a.getName()==E[2]});0<=q?p[q]=r:p.push(r);q=goog.array.findIndex(f,function(a){return a.getName()===C});0<=q?(w=f[q],f[q]=
new ydn.db.schema.Store(w.getName(),w.getKeyPath(),t,s,p,void 0,!v)):f.push(new ydn.db.schema.Store(C,void 0,!1,void 0,[r]));goog.log.finest(d.logger,'multi entry index "'+r.getName()+'" found in '+C+(-1==q?"*":""))}else goog.log.warning(d.logger,'Invalid multiEntry store name "'+h.name+'"')}else w=goog.array.findIndex(f,function(a){return a.getName()===h.name}),0<=w?(q=f[w].index(0),goog.asserts.assertInstanceof(q,ydn.db.schema.Index),p.push(q),f[w]=new ydn.db.schema.Store(h.name,r,t,s,p,void 0,
!v)):(p=new ydn.db.schema.Store(h.name,r,t,s,p,void 0,!v),f.push(p))}}g=new ydn.db.schema.Database(e,f);a(g)}},h=function(a,b){ydn.db.con.WebSql.DEBUG&&goog.global.console.log([a,b]);throw b;};b?b.executeSql("SELECT * FROM sqlite_master",[],g,h):c.readTransaction(function(b){d.getSchema(a,b,c)},function(a){goog.log.error(d.logger,"opening tx: "+a.message);throw a;},g)};
ydn.db.con.WebSql.prototype.update_store_=function(a,b,c){var d=this;this.getSchema(function(e){e=e.getStore(b.getName());d.update_store_with_info_(a,b,c,e)},a)};
ydn.db.con.WebSql.prototype.update_store_with_info_=function(a,b,c,d){var e=0,f=function(d){a.executeSql(d,[],function(a,b){e++;e==g.length&&(c(!0),c=null)},function(a,f){ydn.db.con.WebSql.DEBUG&&goog.global.console.log([a,f]);e++;e==g.length&&(c(!1),c=null);var h=goog.DEBUG?"SQLError creating table: "+b.getName()+" "+f.message+' for executing "'+d:'"';throw new ydn.db.SQLError(f,h);})},g=this.prepareCreateTable_(b),h="Create";if(d){var k=b.difference(d);if(0==k.length){goog.log.finest(this.logger,
"same table "+b.getName()+" exists.");c(!0);c=null;return}h="Modify";goog.log.warning(this.logger,"table: "+b.getName()+" has changed by "+k+" ALTER TABLE cannot run in WebSql, dropping old table.");g.unshift("DROP TABLE IF EXISTS "+goog.string.quote(b.getName()))}ydn.db.con.WebSql.DEBUG&&goog.global.console.log([g,d]);goog.log.finest(this.logger,h+" table: "+b.getName()+": "+g.join(";"));for(d=0;d<g.length;d++)f(g[d])};ydn.db.con.WebSql.prototype.isReady=function(){return!!this.sql_db_};
ydn.db.con.WebSql.prototype.close=function(){this.sql_db_=null};
ydn.db.con.WebSql.prototype.doTransaction=function(a,b,c,d){var e=this;b=function(b){a(b)};var f=function(){d(ydn.db.base.TxEventTypes.COMPLETE,{type:ydn.db.base.TxEventTypes.COMPLETE})},g=function(a){goog.log.finest(e.logger,e+": Tx "+c+" request cause error.");d(ydn.db.base.TxEventTypes.ABORT,a)};goog.isNull(this.sql_db_)&&(a(null),d(ydn.db.base.TxEventTypes.ABORT,this.last_error_));c==ydn.db.base.TransactionMode.READ_ONLY?this.sql_db_.readTransaction(b,g,f):c==ydn.db.base.TransactionMode.VERSION_CHANGE?
this.sql_db_.changeVersion(this.sql_db_.version,this.sql_db_.version+1+"",b,g,f):this.sql_db_.transaction(b,g,f)};
ydn.db.con.WebSql.deleteDatabase=function(a,b){if(ydn.db.con.WebSql.isSupported()&&(!b||b==ydn.db.base.Mechanisms.WEBSQL)){var c=new ydn.db.con.WebSql,d=new ydn.db.schema.EditableDatabase;goog.log.finer(c.logger,"deleting websql database: "+a);var d=c.connect(a,d),e=function(b,d){goog.log.info(c.logger,"all tables in "+a+" deleted.")};d.addCallback(function(){c.doTransaction(function(b){b.executeSql('SELECT * FROM sqlite_master WHERE type = "table"',[],function(d,e){if(e&&e.rows){for(var k=e.rows.length,
l=0,m=0;m<k;m++){var n=e.rows.item(m);"__WebKitDatabaseInfoTable__"!=n.name&&"sqlite_sequence"!=n.name&&(l++,goog.log.finest(c.logger,"deleting table: "+n.name),b.executeSql("DROP TABLE "+n.name))}goog.log.finer(c.logger,l+' tables deleted from "'+a+'"')}},function(a,b){ydn.db.con.WebSql.DEBUG&&goog.global.console.log([a,b]);throw b;})},[],ydn.db.base.TransactionMode.READ_WRITE,e)});d.addErrback(function(){goog.log.warning(c.logger,"Connecting "+a+" failed.")})}};ydn.db.databaseDeletors.push(ydn.db.con.WebSql.deleteDatabase);
ydn.db.con.WebSql.prototype.onVersionChange=function(a){};goog.DEBUG&&(ydn.db.con.WebSql.prototype.toString=function(){return"WebSql:"+(this.sql_db_?":"+this.sql_db_.version:"")});ydn.db.tr.Storage.inject_db={};
ydn.db.tr.Storage.prototype.createDbInstance=function(a){return a==ydn.db.base.Mechanisms.IDB&&ydn.db.con.IndexedDb.isSupported()?new ydn.db.con.IndexedDb(this.size,this.connectionTimeout):a==ydn.db.base.Mechanisms.SQLITE&&ydn.db.con.WebSql.isSqliteSupported()?new ydn.db.con.WebSql(this.size,ydn.db.base.Mechanisms.SQLITE):a==ydn.db.base.Mechanisms.WEBSQL&&ydn.db.con.WebSql.isSupported()?new ydn.db.con.WebSql(this.size):a==ydn.db.base.Mechanisms.LOCAL_STORAGE&&ydn.db.con.LocalStorage.isSupported()?
new ydn.db.con.LocalStorage:a==ydn.db.base.Mechanisms.SESSION_STORAGE&&ydn.db.con.SessionStorage.isSupported()?new ydn.db.con.SessionStorage:a==ydn.db.base.Mechanisms.MEMORY_STORAGE?new ydn.db.con.SimpleStorage:null};goog.structs.SimplePool=function(a,b){goog.Disposable.call(this);this.disposeObjectFn_=this.createObjectFn_=null;this.maxCount_=b;this.freeQueue_=[];this.createInitial_(a)};goog.inherits(goog.structs.SimplePool,goog.Disposable);
goog.structs.SimplePool.prototype.setCreateObjectFn=function(a){this.createObjectFn_=a};goog.structs.SimplePool.prototype.setDisposeObjectFn=function(a){this.disposeObjectFn_=a};goog.structs.SimplePool.prototype.getObject=function(){return this.freeQueue_.length?this.freeQueue_.pop():this.createObject()};goog.structs.SimplePool.prototype.releaseObject=function(a){this.freeQueue_.length<this.maxCount_?this.freeQueue_.push(a):this.disposeObject(a)};
goog.structs.SimplePool.prototype.createInitial_=function(a){if(a>this.maxCount_)throw Error("[goog.structs.SimplePool] Initial cannot be greater than max");for(var b=0;b<a;b++)this.freeQueue_.push(this.createObject())};goog.structs.SimplePool.prototype.createObject=function(){return this.createObjectFn_?this.createObjectFn_():{}};
goog.structs.SimplePool.prototype.disposeObject=function(a){if(this.disposeObjectFn_)this.disposeObjectFn_(a);else if(goog.isObject(a))if(goog.isFunction(a.dispose))a.dispose();else for(var b in a)delete a[b]};goog.structs.SimplePool.prototype.disposeInternal=function(){goog.structs.SimplePool.superClass_.disposeInternal.call(this);for(var a=this.freeQueue_;a.length;)this.disposeObject(a.pop());delete this.freeQueue_};
goog.debug.Trace_=function(){this.events_=[];this.outstandingEvents_=new goog.structs.Map;this.tracerOverheadComment_=this.tracerOverheadEnd_=this.tracerOverheadStart_=this.startTime_=0;this.stats_=new goog.structs.Map;this.commentCount_=this.tracerCount_=0;this.nextId_=1;this.eventPool_=new goog.structs.SimplePool(0,4E3);this.eventPool_.createObject=function(){return new goog.debug.Trace_.Event_};this.statPool_=new goog.structs.SimplePool(0,50);this.statPool_.createObject=function(){return new goog.debug.Trace_.Stat_};
var a=this;this.idPool_=new goog.structs.SimplePool(0,2E3);this.idPool_.createObject=function(){return String(a.nextId_++)};this.idPool_.disposeObject=function(a){};this.defaultThreshold_=3};goog.debug.Trace_.prototype.logger_=goog.log.getLogger("goog.debug.Trace");goog.debug.Trace_.prototype.MAX_TRACE_SIZE=1E3;goog.debug.Trace_.EventType={START:0,STOP:1,COMMENT:2};goog.debug.Trace_.Stat_=function(){this.varAlloc=this.time=this.count=0};
goog.debug.Trace_.Stat_.prototype.toString=function(){var a=[];a.push(this.type," ",this.count," (",Math.round(10*this.time)/10," ms)");this.varAlloc&&a.push(" [VarAlloc = ",this.varAlloc,"]");return a.join("")};goog.debug.Trace_.Event_=function(){};
goog.debug.Trace_.Event_.prototype.toTraceString=function(a,b,c){var d=[];-1==b?d.push("    "):d.push(goog.debug.Trace_.longToPaddedString_(this.eventTime-b));d.push(" ",goog.debug.Trace_.formatTime_(this.eventTime-a));this.eventType==goog.debug.Trace_.EventType.START?d.push(" Start        "):this.eventType==goog.debug.Trace_.EventType.STOP?(d.push(" Done "),d.push(goog.debug.Trace_.longToPaddedString_(this.stopTime-this.startTime)," ms ")):d.push(" Comment      ");d.push(c,this);0<this.totalVarAlloc&&
d.push("[VarAlloc ",this.totalVarAlloc,"] ");return d.join("")};goog.debug.Trace_.Event_.prototype.toString=function(){return null==this.type?this.comment:"["+this.type+"] "+this.comment};goog.debug.Trace_.prototype.setStartTime=function(a){this.startTime_=a};goog.debug.Trace_.prototype.initCurrentTrace=function(a){this.reset(a)};goog.debug.Trace_.prototype.clearCurrentTrace=function(){this.reset(0)};
goog.debug.Trace_.prototype.reset=function(a){this.defaultThreshold_=a;for(a=0;a<this.events_.length;a++){var b=this.eventPool_.id;b&&this.idPool_.releaseObject(b);this.eventPool_.releaseObject(this.events_[a])}this.events_.length=0;this.outstandingEvents_.clear();this.startTime_=goog.debug.Trace_.now();this.commentCount_=this.tracerCount_=this.tracerOverheadComment_=this.tracerOverheadEnd_=this.tracerOverheadStart_=0;b=this.stats_.getKeys();for(a=0;a<b.length;a++){var c=this.stats_.get(b[a]);c.count=
0;c.time=0;c.varAlloc=0;this.statPool_.releaseObject(c)}this.stats_.clear()};
goog.debug.Trace_.prototype.startTracer=function(a,b){var c=goog.debug.Trace_.now(),d=this.getTotalVarAlloc(),e=this.outstandingEvents_.getCount();if(this.events_.length+e>this.MAX_TRACE_SIZE){goog.log.warning(this.logger_,"Giant thread trace. Clearing to avoid memory leak.");if(this.events_.length>this.MAX_TRACE_SIZE/2){for(var f=0;f<this.events_.length;f++){var g=this.events_[f];g.id&&this.idPool_.releaseObject(g.id);this.eventPool_.releaseObject(g)}this.events_.length=0}e>this.MAX_TRACE_SIZE/2&&
this.outstandingEvents_.clear()}goog.debug.Logger.logToProfilers("Start : "+a);g=this.eventPool_.getObject();g.totalVarAlloc=d;g.eventType=goog.debug.Trace_.EventType.START;g.id=Number(this.idPool_.getObject());g.comment=a;g.type=b;this.events_.push(g);this.outstandingEvents_.set(String(g.id),g);this.tracerCount_++;d=goog.debug.Trace_.now();g.startTime=g.eventTime=d;this.tracerOverheadStart_+=d-c;return g.id};
goog.debug.Trace_.prototype.stopTracer=function(a,b){var c=goog.debug.Trace_.now(),d;d=0===b?0:b?b:this.defaultThreshold_;var e=this.outstandingEvents_.get(String(a));if(null==e)return null;this.outstandingEvents_.remove(String(a));var f,g=c-e.startTime;if(g<d)for(d=this.events_.length-1;0<=d;d--){if(this.events_[d]==e){this.events_.splice(d,1);this.idPool_.releaseObject(e.id);this.eventPool_.releaseObject(e);break}}else f=this.eventPool_.getObject(),f.eventType=goog.debug.Trace_.EventType.STOP,f.startTime=
e.startTime,f.comment=e.comment,f.type=e.type,f.stopTime=f.eventTime=c,this.events_.push(f);d=e.type;var h=null;d&&(h=this.getStat_(d),h.count++,h.time+=g);f&&(goog.debug.Logger.logToProfilers("Stop : "+f.comment),f.totalVarAlloc=this.getTotalVarAlloc(),h&&(h.varAlloc+=f.totalVarAlloc-e.totalVarAlloc));e=goog.debug.Trace_.now();this.tracerOverheadEnd_+=e-c;return g};goog.debug.Trace_.prototype.setGcTracer=function(a){this.gcTracer_=a};
goog.debug.Trace_.prototype.getTotalVarAlloc=function(){var a=this.gcTracer_;return a&&a.isTracing()?a.totalVarAlloc:-1};
goog.debug.Trace_.prototype.addComment=function(a,b,c){var d=goog.debug.Trace_.now(),e=c?c:d,f=this.eventPool_.getObject();f.eventType=goog.debug.Trace_.EventType.COMMENT;f.eventTime=e;f.type=b;f.comment=a;f.totalVarAlloc=this.getTotalVarAlloc();this.commentCount_++;if(c){a=this.events_.length;for(b=0;b<a;b++)if(this.events_[b].eventTime>e){goog.array.insertAt(this.events_,f,b);break}b==a&&this.events_.push(f)}else this.events_.push(f);(e=f.type)&&this.getStat_(e).count++;this.tracerOverheadComment_+=
goog.debug.Trace_.now()-d};goog.debug.Trace_.prototype.getStat_=function(a){var b=this.stats_.get(a);b||(b=this.statPool_.getObject(),b.type=a,this.stats_.set(a,b));return b};goog.debug.Trace_.prototype.getFormattedTrace=function(){return this.toString()};
goog.debug.Trace_.prototype.toString=function(){for(var a=[],b=-1,c=[],d=0;d<this.events_.length;d++){var e=this.events_[d];e.eventType==goog.debug.Trace_.EventType.STOP&&c.pop();a.push(" ",e.toTraceString(this.startTime_,b,c.join("")));b=e.eventTime;a.push("\n");e.eventType==goog.debug.Trace_.EventType.START&&c.push("|  ")}if(0!=this.outstandingEvents_.getCount()){var f=goog.debug.Trace_.now();a.push(" Unstopped timers:\n");goog.iter.forEach(this.outstandingEvents_,function(b){a.push("  ",b," (",
f-b.startTime," ms, started at ",goog.debug.Trace_.formatTime_(b.startTime),")\n")})}b=this.stats_.getKeys();for(d=0;d<b.length;d++)c=this.stats_.get(b[d]),1<c.count&&a.push(" TOTAL ",c,"\n");a.push("Total tracers created ",this.tracerCount_,"\n","Total comments created ",this.commentCount_,"\n","Overhead start: ",this.tracerOverheadStart_," ms\n","Overhead end: ",this.tracerOverheadEnd_," ms\n","Overhead comment: ",this.tracerOverheadComment_," ms\n");return a.join("")};
goog.debug.Trace_.longToPaddedString_=function(a){a=Math.round(a);var b="";1E3>a&&(b=" ");100>a&&(b="  ");10>a&&(b="   ");return b+a};goog.debug.Trace_.formatTime_=function(a){a=Math.round(a);var b=a%1E3;return String(100+a/1E3%60).substring(1,3)+"."+String(1E3+b).substring(1,4)};goog.debug.Trace_.now=function(){return goog.now()};goog.debug.Trace=new goog.debug.Trace_;
goog.debug.ErrorHandler=function(a){goog.debug.ErrorHandler.base(this,"constructor");this.errorHandlerFn_=a;this.wrapErrors_=!0;this.prefixErrorMessages_=!1};goog.inherits(goog.debug.ErrorHandler,goog.Disposable);goog.debug.ErrorHandler.prototype.addTracersToProtectedFunctions_=!1;goog.debug.ErrorHandler.prototype.setAddTracersToProtectedFunctions=function(a){this.addTracersToProtectedFunctions_=a};goog.debug.ErrorHandler.prototype.wrap=function(a){return this.protectEntryPoint(goog.asserts.assertFunction(a))};
goog.debug.ErrorHandler.prototype.unwrap=function(a){goog.asserts.assertFunction(a);return a[this.getFunctionIndex_(!1)]||a};goog.debug.ErrorHandler.prototype.getStackTraceHolder_=function(a){var b=[];b.push("##PE_STACK_START##");b.push(a.replace(/(\r\n|\r|\n)/g,"##STACK_BR##"));b.push("##PE_STACK_END##");return b.join("")};goog.debug.ErrorHandler.prototype.getFunctionIndex_=function(a){return(a?"__wrapper_":"__protected_")+goog.getUid(this)+"__"};
goog.debug.ErrorHandler.prototype.protectEntryPoint=function(a){var b=this.getFunctionIndex_(!0);a[b]||((a[b]=this.getProtectedFunction(a))[this.getFunctionIndex_(!1)]=a);return a[b]};
goog.debug.ErrorHandler.prototype.getProtectedFunction=function(a){var b=this,c=this.addTracersToProtectedFunctions_;if(c)var d=goog.debug.getStacktraceSimple(15);var e=function(){if(b.isDisposed())return a.apply(this,arguments);if(c)var e=goog.debug.Trace.startTracer("protectedEntryPoint: "+b.getStackTraceHolder_(d));try{return a.apply(this,arguments)}catch(g){b.errorHandlerFn_(g);if(!b.wrapErrors_)throw b.prefixErrorMessages_&&("object"===typeof g?g.message=goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX+
g.message:g=goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX+g),goog.DEBUG&&(g&&g.stack&&Error.captureStackTrace&&goog.global.console)&&goog.global.console.error(g.message,g.stack),g;throw new goog.debug.ErrorHandler.ProtectedFunctionError(g);}finally{c&&goog.debug.Trace.stopTracer(e)}};e[this.getFunctionIndex_(!1)]=a;return e};goog.debug.ErrorHandler.prototype.protectWindowSetTimeout=function(){this.protectWindowFunctionsHelper_("setTimeout")};
goog.debug.ErrorHandler.prototype.protectWindowSetInterval=function(){this.protectWindowFunctionsHelper_("setInterval")};goog.debug.ErrorHandler.prototype.protectWindowRequestAnimationFrame=function(){for(var a=goog.getObjectByName("window"),b=["requestAnimationFrame","mozRequestAnimationFrame","webkitAnimationFrame","msRequestAnimationFrame"],c=0;c<b.length;c++){var d=b[c];b[c]in a&&this.protectWindowFunctionsHelper_(d)}};
goog.debug.ErrorHandler.prototype.protectWindowFunctionsHelper_=function(a){var b=goog.getObjectByName("window"),c=b[a],d=this;b[a]=function(a,b){goog.isString(a)&&(a=goog.partial(goog.globalEval,a));a=d.protectEntryPoint(a);return c.call?c.call(this,a,b):c(a,b)};b[a][this.getFunctionIndex_(!1)]=c};goog.debug.ErrorHandler.prototype.setWrapErrors=function(a){this.wrapErrors_=a};goog.debug.ErrorHandler.prototype.setPrefixErrorMessages=function(a){this.prefixErrorMessages_=a};
goog.debug.ErrorHandler.prototype.disposeInternal=function(){var a=goog.getObjectByName("window");a.setTimeout=this.unwrap(a.setTimeout);a.setInterval=this.unwrap(a.setInterval);goog.debug.ErrorHandler.base(this,"disposeInternal")};
goog.debug.ErrorHandler.ProtectedFunctionError=function(a){goog.debug.ErrorHandler.ProtectedFunctionError.base(this,"constructor",goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX+(a&&a.message?String(a.message):String(a)));(a=(this.cause=a)&&a.stack)&&goog.isString(a)&&(this.stack=a)};goog.inherits(goog.debug.ErrorHandler.ProtectedFunctionError,goog.debug.Error);goog.debug.ErrorHandler.ProtectedFunctionError.MESSAGE_PREFIX="Error in protected function: ";
goog.events.BrowserFeature={HAS_W3C_BUTTON:!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9),HAS_W3C_EVENT_SUPPORT:!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9),SET_KEY_CODE_TO_PREVENT_DEFAULT:goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),HAS_NAVIGATOR_ONLINE_PROPERTY:!goog.userAgent.WEBKIT||goog.userAgent.isVersionOrHigher("528"),HAS_HTML5_NETWORK_EVENT_SUPPORT:goog.userAgent.GECKO&&goog.userAgent.isVersionOrHigher("1.9b")||goog.userAgent.IE&&goog.userAgent.isVersionOrHigher("8")||
goog.userAgent.OPERA&&goog.userAgent.isVersionOrHigher("9.5")||goog.userAgent.WEBKIT&&goog.userAgent.isVersionOrHigher("528"),HTML5_NETWORK_EVENTS_FIRE_ON_BODY:goog.userAgent.GECKO&&!goog.userAgent.isVersionOrHigher("8")||goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),TOUCH_ENABLED:"ontouchstart"in goog.global||!!(goog.global.document&&document.documentElement&&"ontouchstart"in document.documentElement)||!(!goog.global.navigator||!goog.global.navigator.msMaxTouchPoints)};
goog.events.getVendorPrefixedName_=function(a){return goog.userAgent.WEBKIT?"webkit"+a:goog.userAgent.OPERA?"o"+a.toLowerCase():a.toLowerCase()};
goog.events.EventType={CLICK:"click",RIGHTCLICK:"rightclick",DBLCLICK:"dblclick",MOUSEDOWN:"mousedown",MOUSEUP:"mouseup",MOUSEOVER:"mouseover",MOUSEOUT:"mouseout",MOUSEMOVE:"mousemove",MOUSEENTER:"mouseenter",MOUSELEAVE:"mouseleave",SELECTSTART:"selectstart",WHEEL:"wheel",KEYPRESS:"keypress",KEYDOWN:"keydown",KEYUP:"keyup",BLUR:"blur",FOCUS:"focus",DEACTIVATE:"deactivate",FOCUSIN:goog.userAgent.IE?"focusin":"DOMFocusIn",FOCUSOUT:goog.userAgent.IE?"focusout":"DOMFocusOut",CHANGE:"change",SELECT:"select",
SUBMIT:"submit",INPUT:"input",PROPERTYCHANGE:"propertychange",DRAGSTART:"dragstart",DRAG:"drag",DRAGENTER:"dragenter",DRAGOVER:"dragover",DRAGLEAVE:"dragleave",DROP:"drop",DRAGEND:"dragend",TOUCHSTART:"touchstart",TOUCHMOVE:"touchmove",TOUCHEND:"touchend",TOUCHCANCEL:"touchcancel",BEFOREUNLOAD:"beforeunload",CONSOLEMESSAGE:"consolemessage",CONTEXTMENU:"contextmenu",DOMCONTENTLOADED:"DOMContentLoaded",ERROR:"error",HELP:"help",LOAD:"load",LOSECAPTURE:"losecapture",ORIENTATIONCHANGE:"orientationchange",
READYSTATECHANGE:"readystatechange",RESIZE:"resize",SCROLL:"scroll",UNLOAD:"unload",HASHCHANGE:"hashchange",PAGEHIDE:"pagehide",PAGESHOW:"pageshow",POPSTATE:"popstate",COPY:"copy",PASTE:"paste",CUT:"cut",BEFORECOPY:"beforecopy",BEFORECUT:"beforecut",BEFOREPASTE:"beforepaste",ONLINE:"online",OFFLINE:"offline",MESSAGE:"message",CONNECT:"connect",ANIMATIONSTART:goog.events.getVendorPrefixedName_("AnimationStart"),ANIMATIONEND:goog.events.getVendorPrefixedName_("AnimationEnd"),ANIMATIONITERATION:goog.events.getVendorPrefixedName_("AnimationIteration"),
TRANSITIONEND:goog.events.getVendorPrefixedName_("TransitionEnd"),POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTERCANCEL:"pointercancel",POINTERMOVE:"pointermove",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",GOTPOINTERCAPTURE:"gotpointercapture",LOSTPOINTERCAPTURE:"lostpointercapture",MSGESTURECHANGE:"MSGestureChange",MSGESTUREEND:"MSGestureEnd",MSGESTUREHOLD:"MSGestureHold",MSGESTURESTART:"MSGestureStart",MSGESTURETAP:"MSGestureTap",
MSGOTPOINTERCAPTURE:"MSGotPointerCapture",MSINERTIASTART:"MSInertiaStart",MSLOSTPOINTERCAPTURE:"MSLostPointerCapture",MSPOINTERCANCEL:"MSPointerCancel",MSPOINTERDOWN:"MSPointerDown",MSPOINTERENTER:"MSPointerEnter",MSPOINTERHOVER:"MSPointerHover",MSPOINTERLEAVE:"MSPointerLeave",MSPOINTERMOVE:"MSPointerMove",MSPOINTEROUT:"MSPointerOut",MSPOINTEROVER:"MSPointerOver",MSPOINTERUP:"MSPointerUp",TEXT:"text",TEXTINPUT:"textInput",COMPOSITIONSTART:"compositionstart",COMPOSITIONUPDATE:"compositionupdate",COMPOSITIONEND:"compositionend",
EXIT:"exit",LOADABORT:"loadabort",LOADCOMMIT:"loadcommit",LOADREDIRECT:"loadredirect",LOADSTART:"loadstart",LOADSTOP:"loadstop",RESPONSIVE:"responsive",SIZECHANGED:"sizechanged",UNRESPONSIVE:"unresponsive",VISIBILITYCHANGE:"visibilitychange",STORAGE:"storage",DOMSUBTREEMODIFIED:"DOMSubtreeModified",DOMNODEINSERTED:"DOMNodeInserted",DOMNODEREMOVED:"DOMNodeRemoved",DOMNODEREMOVEDFROMDOCUMENT:"DOMNodeRemovedFromDocument",DOMNODEINSERTEDINTODOCUMENT:"DOMNodeInsertedIntoDocument",DOMATTRMODIFIED:"DOMAttrModified",
DOMCHARACTERDATAMODIFIED:"DOMCharacterDataModified"};goog.reflect={};goog.reflect.object=function(a,b){return b};goog.reflect.sinkValue=function(a){goog.reflect.sinkValue[" "](a);return a};goog.reflect.sinkValue[" "]=goog.nullFunction;goog.reflect.canAccessProperty=function(a,b){try{return goog.reflect.sinkValue(a[b]),!0}catch(c){}return!1};
goog.events.BrowserEvent=function(a,b){goog.events.BrowserEvent.base(this,"constructor",a?a.type:"");this.relatedTarget=this.currentTarget=this.target=null;this.charCode=this.keyCode=this.button=this.screenY=this.screenX=this.clientY=this.clientX=this.offsetY=this.offsetX=0;this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1;this.state=null;this.platformModifierKey=!1;this.event_=null;a&&this.init(a,b)};goog.inherits(goog.events.BrowserEvent,goog.events.Event);
goog.events.BrowserEvent.MouseButton={LEFT:0,MIDDLE:1,RIGHT:2};goog.events.BrowserEvent.IEButtonMap=[1,4,2];
goog.events.BrowserEvent.prototype.init=function(a,b){var c=this.type=a.type;this.target=a.target||a.srcElement;this.currentTarget=b;var d=a.relatedTarget;d?goog.userAgent.GECKO&&(goog.reflect.canAccessProperty(d,"nodeName")||(d=null)):c==goog.events.EventType.MOUSEOVER?d=a.fromElement:c==goog.events.EventType.MOUSEOUT&&(d=a.toElement);this.relatedTarget=d;this.offsetX=goog.userAgent.WEBKIT||void 0!==a.offsetX?a.offsetX:a.layerX;this.offsetY=goog.userAgent.WEBKIT||void 0!==a.offsetY?a.offsetY:a.layerY;
this.clientX=void 0!==a.clientX?a.clientX:a.pageX;this.clientY=void 0!==a.clientY?a.clientY:a.pageY;this.screenX=a.screenX||0;this.screenY=a.screenY||0;this.button=a.button;this.keyCode=a.keyCode||0;this.charCode=a.charCode||("keypress"==c?a.keyCode:0);this.ctrlKey=a.ctrlKey;this.altKey=a.altKey;this.shiftKey=a.shiftKey;this.metaKey=a.metaKey;this.platformModifierKey=goog.userAgent.MAC?a.metaKey:a.ctrlKey;this.state=a.state;this.event_=a;a.defaultPrevented&&this.preventDefault()};
goog.events.BrowserEvent.prototype.isButton=function(a){return goog.events.BrowserFeature.HAS_W3C_BUTTON?this.event_.button==a:"click"==this.type?a==goog.events.BrowserEvent.MouseButton.LEFT:!!(this.event_.button&goog.events.BrowserEvent.IEButtonMap[a])};goog.events.BrowserEvent.prototype.isMouseActionButton=function(){return this.isButton(goog.events.BrowserEvent.MouseButton.LEFT)&&!(goog.userAgent.WEBKIT&&goog.userAgent.MAC&&this.ctrlKey)};
goog.events.BrowserEvent.prototype.stopPropagation=function(){goog.events.BrowserEvent.superClass_.stopPropagation.call(this);this.event_.stopPropagation?this.event_.stopPropagation():this.event_.cancelBubble=!0};
goog.events.BrowserEvent.prototype.preventDefault=function(){goog.events.BrowserEvent.superClass_.preventDefault.call(this);var a=this.event_;if(a.preventDefault)a.preventDefault();else if(a.returnValue=!1,goog.events.BrowserFeature.SET_KEY_CODE_TO_PREVENT_DEFAULT)try{if(a.ctrlKey||112<=a.keyCode&&123>=a.keyCode)a.keyCode=-1}catch(b){}};goog.events.BrowserEvent.prototype.getBrowserEvent=function(){return this.event_};goog.events.BrowserEvent.prototype.disposeInternal=function(){};
goog.events.Listenable=function(){};goog.events.Listenable.IMPLEMENTED_BY_PROP="closure_listenable_"+(1E6*Math.random()|0);goog.events.Listenable.addImplementation=function(a){a.prototype[goog.events.Listenable.IMPLEMENTED_BY_PROP]=!0};goog.events.Listenable.isImplementedBy=function(a){return!(!a||!a[goog.events.Listenable.IMPLEMENTED_BY_PROP])};goog.events.ListenableKey=function(){};goog.events.ListenableKey.counter_=0;goog.events.ListenableKey.reserveKey=function(){return++goog.events.ListenableKey.counter_};
goog.events.Listener=function(a,b,c,d,e,f){goog.events.Listener.ENABLE_MONITORING&&(this.creationStack=Error().stack);this.listener=a;this.proxy=b;this.src=c;this.type=d;this.capture=!!e;this.handler=f;this.key=goog.events.ListenableKey.reserveKey();this.removed=this.callOnce=!1};goog.events.Listener.ENABLE_MONITORING=!1;goog.events.Listener.prototype.markAsRemoved=function(){this.removed=!0;this.handler=this.src=this.proxy=this.listener=null};
goog.events.ListenerMap=function(a){this.src=a;this.listeners={};this.typeCount_=0};goog.events.ListenerMap.prototype.getTypeCount=function(){return this.typeCount_};goog.events.ListenerMap.prototype.getListenerCount=function(){var a=0,b;for(b in this.listeners)a+=this.listeners[b].length;return a};
goog.events.ListenerMap.prototype.add=function(a,b,c,d,e){var f=a.toString();a=this.listeners[f];a||(a=this.listeners[f]=[],this.typeCount_++);var g=goog.events.ListenerMap.findListenerIndex_(a,b,d,e);-1<g?(b=a[g],c||(b.callOnce=!1)):(b=new goog.events.Listener(b,null,this.src,f,!!d,e),b.callOnce=c,a.push(b));return b};
goog.events.ListenerMap.prototype.remove=function(a,b,c,d){a=a.toString();if(!(a in this.listeners))return!1;var e=this.listeners[a];b=goog.events.ListenerMap.findListenerIndex_(e,b,c,d);return-1<b?(e[b].markAsRemoved(),goog.array.removeAt(e,b),0==e.length&&(delete this.listeners[a],this.typeCount_--),!0):!1};
goog.events.ListenerMap.prototype.removeByKey=function(a){var b=a.type;if(!(b in this.listeners))return!1;var c=goog.array.remove(this.listeners[b],a);c&&(a.markAsRemoved(),0==this.listeners[b].length&&(delete this.listeners[b],this.typeCount_--));return c};goog.events.ListenerMap.prototype.removeAll=function(a){a=a&&a.toString();var b=0,c;for(c in this.listeners)if(!a||c==a){for(var d=this.listeners[c],e=0;e<d.length;e++)++b,d[e].markAsRemoved();delete this.listeners[c];this.typeCount_--}return b};
goog.events.ListenerMap.prototype.getListeners=function(a,b){var c=this.listeners[a.toString()],d=[];if(c)for(var e=0;e<c.length;++e){var f=c[e];f.capture==b&&d.push(f)}return d};goog.events.ListenerMap.prototype.getListener=function(a,b,c,d){a=this.listeners[a.toString()];var e=-1;a&&(e=goog.events.ListenerMap.findListenerIndex_(a,b,c,d));return-1<e?a[e]:null};
goog.events.ListenerMap.prototype.hasListener=function(a,b){var c=goog.isDef(a),d=c?a.toString():"",e=goog.isDef(b);return goog.object.some(this.listeners,function(a,g){for(var h=0;h<a.length;++h)if(!(c&&a[h].type!=d||e&&a[h].capture!=b))return!0;return!1})};goog.events.ListenerMap.findListenerIndex_=function(a,b,c,d){for(var e=0;e<a.length;++e){var f=a[e];if(!f.removed&&f.listener==b&&f.capture==!!c&&f.handler==d)return e}return-1};goog.forwardDeclare("goog.debug.ErrorHandler");goog.forwardDeclare("goog.events.EventWrapper");
goog.events.LISTENER_MAP_PROP_="closure_lm_"+(1E6*Math.random()|0);goog.events.onString_="on";goog.events.onStringMap_={};goog.events.CaptureSimulationMode={OFF_AND_FAIL:0,OFF_AND_SILENT:1,ON:2};goog.events.CAPTURE_SIMULATION_MODE=2;goog.events.listenerCountEstimate_=0;
goog.events.listen=function(a,b,c,d,e){if(goog.isArray(b)){for(var f=0;f<b.length;f++)goog.events.listen(a,b[f],c,d,e);return null}c=goog.events.wrapListener(c);return goog.events.Listenable.isImplementedBy(a)?a.listen(b,c,d,e):goog.events.listen_(a,b,c,!1,d,e)};
goog.events.listen_=function(a,b,c,d,e,f){if(!b)throw Error("Invalid event type");var g=!!e;if(g&&!goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT){if(goog.events.CAPTURE_SIMULATION_MODE==goog.events.CaptureSimulationMode.OFF_AND_FAIL)return goog.asserts.fail("Can not register capture listener in IE8-."),null;if(goog.events.CAPTURE_SIMULATION_MODE==goog.events.CaptureSimulationMode.OFF_AND_SILENT)return null}var h=goog.events.getListenerMap_(a);h||(a[goog.events.LISTENER_MAP_PROP_]=h=new goog.events.ListenerMap(a));
c=h.add(b,c,d,e,f);if(c.proxy)return c;d=goog.events.getProxy();c.proxy=d;d.src=a;d.listener=c;a.addEventListener?a.addEventListener(b.toString(),d,g):a.attachEvent(goog.events.getOnString_(b.toString()),d);goog.events.listenerCountEstimate_++;return c};goog.events.getProxy=function(){var a=goog.events.handleBrowserEvent_,b=goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT?function(c){return a.call(b.src,b.listener,c)}:function(c){c=a.call(b.src,b.listener,c);if(!c)return c};return b};
goog.events.listenOnce=function(a,b,c,d,e){if(goog.isArray(b)){for(var f=0;f<b.length;f++)goog.events.listenOnce(a,b[f],c,d,e);return null}c=goog.events.wrapListener(c);return goog.events.Listenable.isImplementedBy(a)?a.listenOnce(b,c,d,e):goog.events.listen_(a,b,c,!0,d,e)};goog.events.listenWithWrapper=function(a,b,c,d,e){b.listen(a,c,d,e)};
goog.events.unlisten=function(a,b,c,d,e){if(goog.isArray(b)){for(var f=0;f<b.length;f++)goog.events.unlisten(a,b[f],c,d,e);return null}c=goog.events.wrapListener(c);if(goog.events.Listenable.isImplementedBy(a))return a.unlisten(b,c,d,e);if(!a)return!1;d=!!d;if(a=goog.events.getListenerMap_(a))if(b=a.getListener(b,c,d,e))return goog.events.unlistenByKey(b);return!1};
goog.events.unlistenByKey=function(a){if(goog.isNumber(a)||!a||a.removed)return!1;var b=a.src;if(goog.events.Listenable.isImplementedBy(b))return b.unlistenByKey(a);var c=a.type,d=a.proxy;b.removeEventListener?b.removeEventListener(c,d,a.capture):b.detachEvent&&b.detachEvent(goog.events.getOnString_(c),d);goog.events.listenerCountEstimate_--;(c=goog.events.getListenerMap_(b))?(c.removeByKey(a),0==c.getTypeCount()&&(c.src=null,b[goog.events.LISTENER_MAP_PROP_]=null)):a.markAsRemoved();return!0};
goog.events.unlistenWithWrapper=function(a,b,c,d,e){b.unlisten(a,c,d,e)};goog.events.removeAll=function(a,b){if(!a)return 0;if(goog.events.Listenable.isImplementedBy(a))return a.removeAllListeners(b);var c=goog.events.getListenerMap_(a);if(!c)return 0;var d=0,e=b&&b.toString(),f;for(f in c.listeners)if(!e||f==e)for(var g=c.listeners[f].concat(),h=0;h<g.length;++h)goog.events.unlistenByKey(g[h])&&++d;return d};
goog.events.getListeners=function(a,b,c){return goog.events.Listenable.isImplementedBy(a)?a.getListeners(b,c):a?(a=goog.events.getListenerMap_(a))?a.getListeners(b,c):[]:[]};goog.events.getListener=function(a,b,c,d,e){c=goog.events.wrapListener(c);d=!!d;return goog.events.Listenable.isImplementedBy(a)?a.getListener(b,c,d,e):a?(a=goog.events.getListenerMap_(a))?a.getListener(b,c,d,e):null:null};
goog.events.hasListener=function(a,b,c){if(goog.events.Listenable.isImplementedBy(a))return a.hasListener(b,c);a=goog.events.getListenerMap_(a);return!!a&&a.hasListener(b,c)};goog.events.expose=function(a){var b=[],c;for(c in a)a[c]&&a[c].id?b.push(c+" = "+a[c]+" ("+a[c].id+")"):b.push(c+" = "+a[c]);return b.join("\n")};goog.events.getOnString_=function(a){return a in goog.events.onStringMap_?goog.events.onStringMap_[a]:goog.events.onStringMap_[a]=goog.events.onString_+a};
goog.events.fireListeners=function(a,b,c,d){return goog.events.Listenable.isImplementedBy(a)?a.fireListeners(b,c,d):goog.events.fireListeners_(a,b,c,d)};goog.events.fireListeners_=function(a,b,c,d){var e=1;if(a=goog.events.getListenerMap_(a))if(b=a.listeners[b.toString()])for(b=b.concat(),a=0;a<b.length;a++){var f=b[a];f&&(f.capture==c&&!f.removed)&&(e&=!1!==goog.events.fireListener(f,d))}return Boolean(e)};
goog.events.fireListener=function(a,b){var c=a.listener,d=a.handler||a.src;a.callOnce&&goog.events.unlistenByKey(a);return c.call(d,b)};goog.events.getTotalListenerCount=function(){return goog.events.listenerCountEstimate_};goog.events.dispatchEvent=function(a,b){goog.asserts.assert(goog.events.Listenable.isImplementedBy(a),"Can not use goog.events.dispatchEvent with non-goog.events.Listenable instance.");return a.dispatchEvent(b)};
goog.events.protectBrowserEventEntryPoint=function(a){goog.events.handleBrowserEvent_=a.protectEntryPoint(goog.events.handleBrowserEvent_)};
goog.events.handleBrowserEvent_=function(a,b){if(a.removed)return!0;if(!goog.events.BrowserFeature.HAS_W3C_EVENT_SUPPORT){var c=b||goog.getObjectByName("window.event"),d=new goog.events.BrowserEvent(c,this),e=!0;if(goog.events.CAPTURE_SIMULATION_MODE==goog.events.CaptureSimulationMode.ON){if(!goog.events.isMarkedIeEvent_(c)){goog.events.markIeEvent_(c);for(var c=[],f=d.currentTarget;f;f=f.parentNode)c.push(f);for(var f=a.type,g=c.length-1;!d.propagationStopped_&&0<=g;g--)d.currentTarget=c[g],e&=goog.events.fireListeners_(c[g],
f,!0,d);for(g=0;!d.propagationStopped_&&g<c.length;g++)d.currentTarget=c[g],e&=goog.events.fireListeners_(c[g],f,!1,d)}}else e=goog.events.fireListener(a,d);return e}return goog.events.fireListener(a,new goog.events.BrowserEvent(b,this))};goog.events.markIeEvent_=function(a){var b=!1;if(0==a.keyCode)try{a.keyCode=-1;return}catch(c){b=!0}if(b||void 0==a.returnValue)a.returnValue=!0};goog.events.isMarkedIeEvent_=function(a){return 0>a.keyCode||void 0!=a.returnValue};goog.events.uniqueIdCounter_=0;
goog.events.getUniqueId=function(a){return a+"_"+goog.events.uniqueIdCounter_++};goog.events.getListenerMap_=function(a){a=a[goog.events.LISTENER_MAP_PROP_];return a instanceof goog.events.ListenerMap?a:null};goog.events.LISTENER_WRAPPER_PROP_="__closure_events_fn_"+(1E9*Math.random()>>>0);
goog.events.wrapListener=function(a){goog.asserts.assert(a,"Listener can not be null.");if(goog.isFunction(a))return a;goog.asserts.assert(a.handleEvent,"An object listener must have handleEvent method.");a[goog.events.LISTENER_WRAPPER_PROP_]||(a[goog.events.LISTENER_WRAPPER_PROP_]=function(b){return a.handleEvent(b)});return a[goog.events.LISTENER_WRAPPER_PROP_]};goog.debug.entryPointRegistry.register(function(a){goog.events.handleBrowserEvent_=a(goog.events.handleBrowserEvent_)});goog.forwardDeclare("goog.events.EventWrapper");
goog.events.EventHandler=function(a){goog.Disposable.call(this);this.handler_=a;this.keys_={}};goog.inherits(goog.events.EventHandler,goog.Disposable);goog.events.EventHandler.typeArray_=[];goog.events.EventHandler.prototype.listen=function(a,b,c,d){return this.listen_(a,b,c,d)};goog.events.EventHandler.prototype.listenWithScope=function(a,b,c,d,e){return this.listen_(a,b,c,d,e)};
goog.events.EventHandler.prototype.listen_=function(a,b,c,d,e){goog.isArray(b)||(b&&(goog.events.EventHandler.typeArray_[0]=b.toString()),b=goog.events.EventHandler.typeArray_);for(var f=0;f<b.length;f++){var g=goog.events.listen(a,b[f],c||this.handleEvent,d||!1,e||this.handler_||this);if(!g)break;this.keys_[g.key]=g}return this};goog.events.EventHandler.prototype.listenOnce=function(a,b,c,d){return this.listenOnce_(a,b,c,d)};
goog.events.EventHandler.prototype.listenOnceWithScope=function(a,b,c,d,e){return this.listenOnce_(a,b,c,d,e)};goog.events.EventHandler.prototype.listenOnce_=function(a,b,c,d,e){if(goog.isArray(b))for(var f=0;f<b.length;f++)this.listenOnce_(a,b[f],c,d,e);else{a=goog.events.listenOnce(a,b,c||this.handleEvent,d,e||this.handler_||this);if(!a)return this;this.keys_[a.key]=a}return this};goog.events.EventHandler.prototype.listenWithWrapper=function(a,b,c,d){return this.listenWithWrapper_(a,b,c,d)};
goog.events.EventHandler.prototype.listenWithWrapperAndScope=function(a,b,c,d,e){return this.listenWithWrapper_(a,b,c,d,e)};goog.events.EventHandler.prototype.listenWithWrapper_=function(a,b,c,d,e){b.listen(a,c,d,e||this.handler_||this,this);return this};goog.events.EventHandler.prototype.getListenerCount=function(){var a=0,b;for(b in this.keys_)Object.prototype.hasOwnProperty.call(this.keys_,b)&&a++;return a};
goog.events.EventHandler.prototype.unlisten=function(a,b,c,d,e){if(goog.isArray(b))for(var f=0;f<b.length;f++)this.unlisten(a,b[f],c,d,e);else if(a=goog.events.getListener(a,b,c||this.handleEvent,d,e||this.handler_||this))goog.events.unlistenByKey(a),delete this.keys_[a.key];return this};goog.events.EventHandler.prototype.unlistenWithWrapper=function(a,b,c,d,e){b.unlisten(a,c,d,e||this.handler_||this,this);return this};
goog.events.EventHandler.prototype.removeAll=function(){goog.object.forEach(this.keys_,goog.events.unlistenByKey);this.keys_={}};goog.events.EventHandler.prototype.disposeInternal=function(){goog.events.EventHandler.superClass_.disposeInternal.call(this);this.removeAll()};goog.events.EventHandler.prototype.handleEvent=function(a){throw Error("EventHandler.handleEvent not implemented");};
goog.events.EventTarget=function(){goog.Disposable.call(this);this.eventTargetListeners_=new goog.events.ListenerMap(this);this.actualEventTarget_=this;this.parentEventTarget_=null};goog.inherits(goog.events.EventTarget,goog.Disposable);goog.events.Listenable.addImplementation(goog.events.EventTarget);goog.events.EventTarget.MAX_ANCESTORS_=1E3;goog.events.EventTarget.prototype.getParentEventTarget=function(){return this.parentEventTarget_};
goog.events.EventTarget.prototype.setParentEventTarget=function(a){this.parentEventTarget_=a};goog.events.EventTarget.prototype.addEventListener=function(a,b,c,d){goog.events.listen(this,a,b,c,d)};goog.events.EventTarget.prototype.removeEventListener=function(a,b,c,d){goog.events.unlisten(this,a,b,c,d)};
goog.events.EventTarget.prototype.dispatchEvent=function(a){this.assertInitialized_();var b,c=this.getParentEventTarget();if(c){b=[];for(var d=1;c;c=c.getParentEventTarget())b.push(c),goog.asserts.assert(++d<goog.events.EventTarget.MAX_ANCESTORS_,"infinite loop")}return goog.events.EventTarget.dispatchEventInternal_(this.actualEventTarget_,a,b)};
goog.events.EventTarget.prototype.disposeInternal=function(){goog.events.EventTarget.superClass_.disposeInternal.call(this);this.removeAllListeners();this.parentEventTarget_=null};goog.events.EventTarget.prototype.listen=function(a,b,c,d){this.assertInitialized_();return this.eventTargetListeners_.add(String(a),b,!1,c,d)};goog.events.EventTarget.prototype.listenOnce=function(a,b,c,d){return this.eventTargetListeners_.add(String(a),b,!0,c,d)};
goog.events.EventTarget.prototype.unlisten=function(a,b,c,d){return this.eventTargetListeners_.remove(String(a),b,c,d)};goog.events.EventTarget.prototype.unlistenByKey=function(a){return this.eventTargetListeners_.removeByKey(a)};goog.events.EventTarget.prototype.removeAllListeners=function(a){return this.eventTargetListeners_?this.eventTargetListeners_.removeAll(a):0};
goog.events.EventTarget.prototype.fireListeners=function(a,b,c){a=this.eventTargetListeners_.listeners[String(a)];if(!a)return!0;a=a.concat();for(var d=!0,e=0;e<a.length;++e){var f=a[e];if(f&&!f.removed&&f.capture==b){var g=f.listener,h=f.handler||f.src;f.callOnce&&this.unlistenByKey(f);d=!1!==g.call(h,c)&&d}}return d&&!1!=c.returnValue_};goog.events.EventTarget.prototype.getListeners=function(a,b){return this.eventTargetListeners_.getListeners(String(a),b)};
goog.events.EventTarget.prototype.getListener=function(a,b,c,d){return this.eventTargetListeners_.getListener(String(a),b,c,d)};goog.events.EventTarget.prototype.hasListener=function(a,b){var c=goog.isDef(a)?String(a):void 0;return this.eventTargetListeners_.hasListener(c,b)};goog.events.EventTarget.prototype.setTargetForTesting=function(a){this.actualEventTarget_=a};goog.events.EventTarget.prototype.assertInitialized_=function(){goog.asserts.assert(this.eventTargetListeners_,"Event target is not initialized. Did you call the superclass (goog.events.EventTarget) constructor?")};
goog.events.EventTarget.dispatchEventInternal_=function(a,b,c){var d=b.type||b;if(goog.isString(b))b=new goog.events.Event(b,a);else if(b instanceof goog.events.Event)b.target=b.target||a;else{var e=b;b=new goog.events.Event(d,a);goog.object.extend(b,e)}var e=!0,f;if(c)for(var g=c.length-1;!b.propagationStopped_&&0<=g;g--)f=b.currentTarget=c[g],e=f.fireListeners(d,!0,b)&&e;b.propagationStopped_||(f=b.currentTarget=a,e=f.fireListeners(d,!0,b)&&e,b.propagationStopped_||(e=f.fireListeners(d,!1,b)&&e));
if(c)for(g=0;!b.propagationStopped_&&g<c.length;g++)f=b.currentTarget=c[g],e=f.fireListeners(d,!1,b)&&e;return e};goog.events.EventWrapper=function(){};goog.events.EventWrapper.prototype.listen=function(a,b,c,d,e){};goog.events.EventWrapper.prototype.unlisten=function(a,b,c,d,e){};ydn.db.tr.events={};ydn.db.tr.Storage.prototype.getEventTarget=function(){this.event_target||(this.event_target=new goog.events.EventTarget);return this.event_target};
ydn.db.tr.Storage.prototype.addEventListener=function(a,b,c,d){if("ready"==a)goog.events.listenOnce(this.getEventTarget(),a,b,c,d);else{if(goog.DEBUG){var e=this.getEventTypes(),f=function(a){if(!goog.array.contains(e,a))throw new ydn.debug.error.ArgumentException('Invalid event type "'+a+'"');};if(goog.isArrayLike(a))for(var g=0;g<a.length;g++)f(a[g]);else f(a)}goog.events.listen(this.getEventTarget(),a,b,c,d)}};
ydn.db.tr.Storage.prototype.removeEventListener=function(a,b,c,d){goog.events.unlisten(this.getEventTarget(),a,b,c,d)};ydn.db.tr.Storage.prototype.dispatchDbEvent=function(a){this.getEventTarget().dispatchEvent(a)};ydn.db.Storage=function(a,b,c){ydn.db.sql.Storage.call(this,a,b,c)};goog.inherits(ydn.db.Storage,ydn.db.sql.Storage);ydn.db.algo.NestedLoop=function(a,b){ydn.db.algo.AbstractSolver.call(this,a,b)};goog.inherits(ydn.db.algo.NestedLoop,ydn.db.algo.AbstractSolver);
ydn.db.algo.NestedLoop.DEBUG=!1;ydn.db.algo.NestedLoop.prototype.current_loop=-1;ydn.db.algo.NestedLoop.prototype.begin=function(a,b){this.current_loop=a.length-1;return!1};ydn.db.algo.NestedLoop.prototype.solver=function(a,b){var c=[],d=!0,e=function(b){goog.isDef(a[b])?(d=!1,c[b]=!0):(c[b]=!1,0<=b-1&&e(b-1))};e(a.length-1);ydn.db.algo.NestedLoop.DEBUG&&goog.global.console.log([a,b,c]);d&&(c=[]);return this.pusher(c,a,b)};
ydn.db.algo.SortedMerge=function(a,b){ydn.db.algo.AbstractSolver.call(this,a,b)};goog.inherits(ydn.db.algo.SortedMerge,ydn.db.algo.AbstractSolver);ydn.db.algo.SortedMerge.DEBUG=!1;
ydn.db.algo.SortedMerge.prototype.solver=function(a,b){var c=[],d=b[0];if(!goog.isDefAndNotNull(d))return ydn.db.algo.SortedMerge.DEBUG&&goog.global.console.log("SortedMerge: done."),[];for(var e=!0,f=!1,g=d,h=[],k=1;k<a.length;k++)if(goog.isDefAndNotNull(b[k])){var l=ydn.db.cmp(d,b[k]);h[k]=l;this.is_reverse?-1==l?e=!1:1==l&&(e=!1,f=!0,-1==ydn.db.cmp(b[k],g)&&(g=b[k])):1==l?e=!1:-1==l&&(e=!1,f=!0,1==ydn.db.cmp(b[k],g)&&(g=b[k]))}else e=!1,f=!0;if(e)for(k=0;k<a.length;k++)goog.isDefAndNotNull(b[k])&&
(c[k]=!0);else if(f)for(k=0;k<a.length;k++)goog.isDefAndNotNull(b[k])&&(this.is_reverse?-1==ydn.db.cmp(g,b[k])&&(c[k]=g):1==ydn.db.cmp(g,b[k])&&(c[k]=g));else for(l=this.is_reverse?-1:1,k=1;k<a.length;k++)h[k]===l&&(c[k]=d);ydn.db.algo.SortedMerge.DEBUG&&goog.global.console.log("SortedMerge: match: "+e+", skip: "+f+", highest_key: "+JSON.stringify(g)+", keys: "+JSON.stringify(a)+", cmps: "+JSON.stringify(h)+", advancement: "+JSON.stringify(c));return e?(this.match_count++,this.out&&this.out.push(g),
c):{continuePrimary:c}};ydn.db.algo.ZigzagMerge=function(a,b){ydn.db.algo.AbstractSolver.call(this,a,b)};goog.inherits(ydn.db.algo.ZigzagMerge,ydn.db.algo.AbstractSolver);ydn.db.algo.ZigzagMerge.DEBUG=!1;ydn.db.algo.ZigzagMerge.prototype.logger=goog.log.getLogger("ydn.db.algo.ZigzagMerge");
ydn.db.algo.ZigzagMerge.prototype.solver=function(a,b){var c=[];if(0==a.length||!goog.isDefAndNotNull(a[0]))return[];var d=function(a,b){var c=a.slice(0,a.length-1);c.push(b);return c};if(!goog.isDefAndNotNull(a[0]))return ydn.db.algo.SortedMerge.DEBUG&&goog.global.console.log("SortedMerge: done."),[];var e=!0;goog.asserts.assertArray(a[0]);for(var f=0,g=a[f][a[f].length-1],h=[],k=1;k<a.length;k++)if(goog.isDefAndNotNull(a[k])){var l=a[k][a[k].length-1],m=ydn.db.cmp(g,l);h[k]=m;this.is_reverse?-1==
m?e=!1:1==m&&(e=!1,g=l,f=1):1==m?e=!1:-1==m&&(e=!1,g=l,f=1)}else return ydn.db.algo.ZigzagMerge.DEBUG&&goog.global.console.log(this+": iterator "+k+" reach the end"),[];ydn.db.algo.ZigzagMerge.DEBUG&&goog.global.console.log("ZigzagMerge: match: "+e+", highest_key: "+JSON.stringify(g)+", keys: "+JSON.stringify(a)+", cmps: "+JSON.stringify(h)+", advancement: "+JSON.stringify(c));k=this.is_reverse?-1:1;if(e){for(e=0;e<a.length;e++)goog.isDefAndNotNull(a[e])&&(c[e]=!0);this.out&&(this.is_duplex_output?
this.out.push(b[0],g):this.out.push(b[0]));return c}if(0==f)for(e=1;e<a.length;e++)h[e]==k&&(c[e]=d(a[e],g));else for(e=0;e<a.length;e++)e!=f&&goog.isDefAndNotNull(a[e])&&(goog.asserts.assertArray(a[e]),ydn.db.cmp(g,a[e][a[e].length-1])===k&&(c[e]=d(a[e],g)));return{"continue":c}};ydn.db.algo.exports={};goog.exportSymbol("ydn.db.algo.NestedLoop",ydn.db.algo.NestedLoop);goog.exportSymbol("ydn.db.algo.ZigzagMerge",ydn.db.algo.ZigzagMerge);goog.exportSymbol("ydn.db.algo.SortedMerge",ydn.db.algo.SortedMerge);
ydn.db.con.exports={};goog.exportProperty(ydn.db.con.Storage.prototype,"close",ydn.db.con.Storage.prototype.close);goog.exportProperty(ydn.db.con.Storage.prototype,"getType",ydn.db.con.Storage.prototype.getType);goog.exportProperty(ydn.db.con.Storage.prototype,"getName",ydn.db.con.Storage.prototype.getName);goog.exportProperty(ydn.db.con.Storage.prototype,"getSchema",ydn.db.con.Storage.prototype.getSchema);goog.exportProperty(ydn.db.con.Storage.prototype,"onReady",ydn.db.con.Storage.prototype.onReady);
goog.exportProperty(ydn.db.con.Storage.prototype,"setName",ydn.db.con.Storage.prototype.setName);goog.exportProperty(ydn.db.con.Storage.prototype,"transaction",ydn.db.con.Storage.prototype.transaction);goog.exportProperty(ydn.db.con.Storage.prototype,"db",ydn.db.con.Storage.prototype.getDbInstance);goog.exportSymbol("ydn.db.version",ydn.db.version);goog.exportSymbol("ydn.db.cmp",ydn.db.cmp);goog.exportSymbol("ydn.db.deleteDatabase",ydn.db.deleteDatabase);
goog.exportProperty(ydn.db.events.StorageEvent.prototype,"name",ydn.db.events.StorageEvent.prototype.name);goog.exportProperty(ydn.db.events.StorageEvent.prototype,"getVersion",ydn.db.events.StorageEvent.prototype.getVersion);goog.exportProperty(ydn.db.events.StorageEvent.prototype,"getOldVersion",ydn.db.events.StorageEvent.prototype.getOldVersion);goog.exportProperty(ydn.db.events.StorageEvent.prototype,"getOldSchema",ydn.db.events.StorageEvent.prototype.getOldSchema);
goog.exportProperty(ydn.db.events.StorageErrorEvent.prototype,"getError",ydn.db.events.StorageErrorEvent.prototype.getError);goog.exportProperty(ydn.db.Request.prototype,"abort",ydn.db.Request.prototype.abort);goog.exportProperty(ydn.db.Request.prototype,"canAbort",ydn.db.Request.prototype.canAbort);goog.exportProperty(ydn.async.Deferred.prototype,"progress",ydn.async.Deferred.prototype.addProgback);goog.exportProperty(ydn.async.Deferred.prototype,"promise",ydn.async.Deferred.prototype.promise);
ydn.db.core.exports={};goog.exportProperty(ydn.db.core.Storage.prototype,"scan",ydn.db.core.Storage.prototype.scan);goog.exportProperty(ydn.db.core.Storage.prototype,"map",ydn.db.core.Storage.prototype.map);goog.exportProperty(ydn.db.core.Storage.prototype,"reduce",ydn.db.core.Storage.prototype.reduce);goog.exportProperty(ydn.db.core.Storage.prototype,"open",ydn.db.core.Storage.prototype.open);goog.exportProperty(ydn.db.core.DbOperator.prototype,"scan",ydn.db.core.DbOperator.prototype.scan);
goog.exportProperty(ydn.db.core.DbOperator.prototype,"map",ydn.db.core.DbOperator.prototype.map);goog.exportProperty(ydn.db.core.DbOperator.prototype,"reduce",ydn.db.core.DbOperator.prototype.reduce);goog.exportProperty(ydn.db.core.DbOperator.prototype,"open",ydn.db.core.DbOperator.prototype.open);goog.exportProperty(ydn.db.core.req.AbstractCursor.prototype,"getKey",ydn.db.core.req.AbstractCursor.prototype.getKey);goog.exportProperty(ydn.db.core.req.AbstractCursor.prototype,"getPrimaryKey",ydn.db.core.req.AbstractCursor.prototype.getPrimaryKey);
goog.exportProperty(ydn.db.core.req.AbstractCursor.prototype,"getValue",ydn.db.core.req.AbstractCursor.prototype.getValue);goog.exportProperty(ydn.db.core.req.AbstractCursor.prototype,"update",ydn.db.core.req.AbstractCursor.prototype.update);goog.exportProperty(ydn.db.core.req.AbstractCursor.prototype,"clear",ydn.db.core.req.AbstractCursor.prototype.clear);goog.exportSymbol("ydn.db.Iterator",ydn.db.Iterator);goog.exportSymbol("ydn.db.KeyIterator",ydn.db.KeyIterator);
goog.exportSymbol("ydn.db.ValueIterator",ydn.db.ValueIterator);goog.exportSymbol("ydn.db.IndexIterator",ydn.db.IndexIterator);goog.exportSymbol("ydn.db.IndexValueIterator",ydn.db.IndexValueIterator);goog.exportProperty(ydn.db.Iterator.prototype,"getState",ydn.db.Iterator.prototype.getState);goog.exportProperty(ydn.db.Iterator.prototype,"getKeyRange",ydn.db.Iterator.prototype.getKeyRange);goog.exportProperty(ydn.db.Iterator.prototype,"getIndexName",ydn.db.Iterator.prototype.getIndexName);
goog.exportProperty(ydn.db.Iterator.prototype,"getStoreName",ydn.db.Iterator.prototype.getStoreName);goog.exportProperty(ydn.db.Iterator.prototype,"isReversed",ydn.db.Iterator.prototype.isReversed);goog.exportProperty(ydn.db.Iterator.prototype,"isUnique",ydn.db.Iterator.prototype.isUnique);goog.exportProperty(ydn.db.Iterator.prototype,"isKeyIterator",ydn.db.Iterator.prototype.isKeyIterator);goog.exportProperty(ydn.db.Iterator.prototype,"isIndexIterator",ydn.db.Iterator.prototype.isIndexIterator);
goog.exportProperty(ydn.db.Iterator.prototype,"getPrimaryKey",ydn.db.Iterator.prototype.getPrimaryKey);goog.exportProperty(ydn.db.Iterator.prototype,"getKey",ydn.db.Iterator.prototype.getKey);goog.exportProperty(ydn.db.Iterator.prototype,"resume",ydn.db.Iterator.prototype.resume);goog.exportProperty(ydn.db.Iterator.prototype,"reset",ydn.db.Iterator.prototype.reset);goog.exportProperty(ydn.db.Iterator.prototype,"reverse",ydn.db.Iterator.prototype.reverse);
goog.exportProperty(ydn.db.KeyIterator,"where",ydn.db.KeyIterator.where);goog.exportProperty(ydn.db.ValueIterator,"where",ydn.db.ValueIterator.where);goog.exportProperty(ydn.db.IndexIterator,"where",ydn.db.IndexIterator.where);goog.exportProperty(ydn.db.IndexValueIterator,"where",ydn.db.IndexValueIterator.where);goog.exportSymbol("ydn.db.Streamer",ydn.db.Streamer);goog.exportProperty(ydn.db.Streamer.prototype,"push",ydn.db.Streamer.prototype.push);
goog.exportProperty(ydn.db.Streamer.prototype,"collect",ydn.db.Streamer.prototype.collect);goog.exportProperty(ydn.db.Streamer.prototype,"setSink",ydn.db.Streamer.prototype.setSink);ydn.db.tr.exports={};goog.exportProperty(ydn.db.tr.Storage.prototype,"branch",ydn.db.tr.Storage.prototype.branch);goog.exportProperty(ydn.db.tr.Storage.prototype,"getTxNo",ydn.db.tr.Storage.prototype.getTxNo);goog.exportProperty(ydn.db.tr.DbOperator.prototype,"getTxNo",ydn.db.tr.DbOperator.prototype.getTxNo);
goog.exportProperty(ydn.db.tr.Storage.prototype,"run",ydn.db.tr.Storage.prototype.run);ydn.db.crud.exports={};goog.exportProperty(ydn.db.crud.Storage.prototype,"branch",ydn.db.crud.Storage.prototype.branch);goog.exportProperty(ydn.db.crud.Storage.prototype,"add",ydn.db.crud.Storage.prototype.add);goog.exportProperty(ydn.db.crud.Storage.prototype,"get",ydn.db.crud.Storage.prototype.get);goog.exportProperty(ydn.db.crud.Storage.prototype,"keys",ydn.db.crud.Storage.prototype.keys);
goog.exportProperty(ydn.db.crud.Storage.prototype,"values",ydn.db.crud.Storage.prototype.values);goog.exportProperty(ydn.db.crud.Storage.prototype,"put",ydn.db.crud.Storage.prototype.put);goog.exportProperty(ydn.db.crud.Storage.prototype,"clear",ydn.db.crud.Storage.prototype.clear);goog.exportProperty(ydn.db.crud.Storage.prototype,"remove",ydn.db.crud.Storage.prototype.remove);goog.exportProperty(ydn.db.crud.Storage.prototype,"count",ydn.db.crud.Storage.prototype.count);
goog.exportProperty(ydn.db.crud.DbOperator.prototype,"add",ydn.db.crud.DbOperator.prototype.add);goog.exportProperty(ydn.db.crud.DbOperator.prototype,"get",ydn.db.crud.DbOperator.prototype.get);goog.exportProperty(ydn.db.crud.DbOperator.prototype,"keys",ydn.db.crud.DbOperator.prototype.keys);goog.exportProperty(ydn.db.crud.DbOperator.prototype,"values",ydn.db.crud.DbOperator.prototype.values);goog.exportProperty(ydn.db.crud.DbOperator.prototype,"put",ydn.db.crud.DbOperator.prototype.put);
goog.exportProperty(ydn.db.crud.DbOperator.prototype,"clear",ydn.db.crud.DbOperator.prototype.clear);goog.exportProperty(ydn.db.crud.DbOperator.prototype,"remove",ydn.db.crud.DbOperator.prototype.remove);goog.exportProperty(ydn.db.crud.DbOperator.prototype,"count",ydn.db.crud.DbOperator.prototype.count);goog.exportSymbol("ydn.db.Key",ydn.db.Key);goog.exportProperty(ydn.db.Key.prototype,"id",ydn.db.Key.prototype.getId);goog.exportProperty(ydn.db.Key.prototype,"parent",ydn.db.Key.prototype.getParent);
goog.exportProperty(ydn.db.Key.prototype,"storeName",ydn.db.Key.prototype.getStoreName);goog.exportSymbol("ydn.db.KeyRange",ydn.db.KeyRange);goog.exportProperty(ydn.db.KeyRange,"upperBound",ydn.db.KeyRange.upperBound);goog.exportProperty(ydn.db.KeyRange,"lowerBound",ydn.db.KeyRange.lowerBound);goog.exportProperty(ydn.db.KeyRange,"bound",ydn.db.KeyRange.bound);goog.exportProperty(ydn.db.KeyRange,"only",ydn.db.KeyRange.only);goog.exportProperty(ydn.db.KeyRange,"starts",ydn.db.KeyRange.starts);
goog.exportProperty(ydn.db.events.Event.prototype,"store_name",ydn.db.events.Event.prototype.store_name);goog.exportProperty(ydn.db.events.Event.prototype,"getStoreName",ydn.db.events.Event.prototype.getStoreName);goog.exportProperty(ydn.db.events.RecordEvent.prototype,"name",ydn.db.events.RecordEvent.prototype.name);goog.exportProperty(ydn.db.events.RecordEvent.prototype,"getKey",ydn.db.events.RecordEvent.prototype.getKey);goog.exportProperty(ydn.db.events.RecordEvent.prototype,"getValue",ydn.db.events.RecordEvent.prototype.getValue);
goog.exportProperty(ydn.db.events.StoreEvent.prototype,"name",ydn.db.events.StoreEvent.prototype.name);goog.exportProperty(ydn.db.events.StoreEvent.prototype,"getKeys",ydn.db.events.StoreEvent.prototype.getKeys);goog.exportProperty(ydn.db.events.StoreEvent.prototype,"getValues",ydn.db.events.StoreEvent.prototype.getValues);ydn.db.query={};ydn.db.query.Base=function(a,b,c){this.db=a;this.schema=b;this.type=c||ydn.db.base.QueryMethod.NONE;this.orders=[];this.marker=null};
ydn.db.query.Iterator=function(a,b,c,d){this.store=a;this.key_range=b||null;this.is_reverse=!!c;this.is_unique=!!d;this.prefix=[];this.postfix=[]};ydn.db.query.Iterator.prototype.setPrefix=function(a){this.prefix=a;return null};ydn.db.query.Iterator.prototype.setOrder=function(a){for(var b=a.length-1;0<=b;b--)if(a[b]==this.prefix[this.prefix.length-1])a=a.slice(0,b);else break;this.postfix=a;return null};
ydn.db.query.Iterator.prototype.getIterator=function(a){if(!this.hasValidIndex())throw new ydn.db.ConstraintError('Require index "'+this.prefix.concat(this.postfix).join(", ")+'" not found in store "'+this.store.getName()+'"');a=new ydn.db.Iterator(this.store.getName(),this.getIndexName(),this.key_range,this.is_reverse,this.is_unique,!!a);a.prefix_index=this.prefix.length;return a};ydn.db.query.Iterator.prototype.getStoreName=function(){return this.store.getName()};
ydn.db.query.Iterator.prototype.hasPrefix=function(){return 0<this.prefix.length};ydn.db.query.Iterator.prototype.clone=function(){var a=new ydn.db.query.Iterator(this.store,this.key_range,this.is_reverse,this.is_unique);a.postfix=this.postfix.slice();a.prefix=this.prefix.slice();return a};ydn.db.query.Iterator.prototype.getKeyRange=function(){return this.key_range};
ydn.db.query.Iterator.prototype.getIndex=function(){var a=this.prefix.concat(this.postfix),b=this.store.getIndexByKeyPath(a);return b||a[a.length-1]==this.store.getKeyPath()&&(b=this.store.getIndexByKeyPath(a.slice(0,a.length-1)))?b:null};ydn.db.query.Iterator.prototype.getIndexName=function(){var a=this.getIndex();return a?a.getName():void 0};ydn.db.query.Iterator.prototype.hasValidIndex=function(){return 0==this.prefix.length&&0==this.postfix.length||!this.usedIndex()?!0:!!this.getIndex()};
ydn.db.query.Iterator.prototype.reverse=function(){var a=this.clone();a.is_reverse=!this.is_reverse;return a};ydn.db.query.Iterator.prototype.unique=function(a){var b=this.clone();b.is_unique=!!a;return b};ydn.db.query.Iterator.prototype.isUnique=function(){return this.is_unique};ydn.db.query.Iterator.prototype.isReverse=function(){return this.is_reverse};
ydn.db.query.Iterator.prototype.usedIndex=function(){return 0<this.prefix.length?!0:1==this.postfix.length?this.postfix[0]!=this.store.getKeyPath():1<this.postfix.length?!0:!1};
ydn.db.query.Iterator.prototype.where=function(a,b,c,d,e){c=ydn.db.KeyRange.where(b,c,d,e);if(0<this.prefix.length)if(this.key_range)if(goog.isDefAndNotNull(this.key_range.lower)&&goog.isDefAndNotNull(this.key_range.upper)&&0==ydn.db.cmp(this.key_range.lower,this.key_range.upper))a=goog.isArray(this.key_range.lower)?this.key_range.lower.slice().push(b):[this.key_range.lower,b],d=goog.isDefAndNotNull(d)?d:"\uffff",c=goog.isArray(this.key_range.upper)?this.key_range.upper.slice().push(d):[this.key_range.upper,
d],this.key_range=ydn.db.KeyRange.where(b,a,d,c);else if(1==this.prefix.length&&this.prefix[0]==a||goog.isArray(a)&&goog.array.equals(this.prefix,a))this.key_range=this.key_range.and(c);else return"cannot use where clause with existing filter";else return"cannot use where clause with existing filter";else this.prefix=goog.isArray(a)?a:[a],this.key_range=this.key_range?this.key_range.and(c):c;return null};ydn.db.query.Iterator.prototype.getPostFix=function(){return this.postfix.slice()};
ydn.db.query.ConjQuery=function(a,b,c,d,e){ydn.db.query.Base.call(this,a,b,c);this.iters=d};goog.inherits(ydn.db.query.ConjQuery,ydn.db.query.Base);ydn.db.query.ConjQuery.DEBUG=!1;ydn.db.query.ConjQuery.prototype.open=function(a,b){var c={push:function(a){}},c=this.isRefJoin()?new ydn.db.algo.ZigzagMerge(c):new ydn.db.algo.SortedMerge(c);return this.db.scan(c,this.getIterableIterators(),ydn.db.base.TransactionMode.READ_WRITE)};
ydn.db.query.ConjQuery.prototype.getIterableIterators=function(){for(var a=[],b=0;b<this.iters.length;b++)a[b]=this.iters[b].getIterator();return a};ydn.db.query.ConjQuery.prototype.isRefJoin=function(){for(var a=0;a<this.iters.length;a++)if(this.iters[a].hasPrefix())return!0;return!1};
ydn.db.query.ConjQuery.prototype.list=function(a){var b=this.type==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY?[]:new ydn.db.Streamer(null,this.iters[0].getStoreName());a=this.isRefJoin()?new ydn.db.algo.ZigzagMerge(b):new ydn.db.algo.SortedMerge(b);a=this.db.scan(a,this.getIterableIterators(),ydn.db.base.TransactionMode.READ_WRITE);var c=a.copy();a.addCallbacks(function(){this.type==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY?c.callback(b):b.done().addBoth(function(a){c.callback(a)})},function(a){c.errback(a)},
this);return c};ydn.db.query.ConjQuery.prototype.getIterators=function(){return this.iters.slice()};ydn.db.query.ConjQuery.prototype.select=function(a){throw Error("not impl");};ydn.db.query.ConjQuery.prototype.reverse=function(){var a=this.iters.map(function(a){return a.reverse()});return new ydn.db.query.ConjQuery(this.db,this.schema,this.type,a)};ydn.db.Query=function(a,b,c,d){ydn.db.query.Base.call(this,a,b,c);this.iter=d};goog.inherits(ydn.db.Query,ydn.db.query.Base);ydn.db.Query.DEBUG=!1;
ydn.db.Query.prototype.copy=function(){return new ydn.db.Query(this.db,this.schema,this.type,this.iter.clone())};ydn.db.Query.prototype.reverse=function(){var a=this.iter.reverse();return new ydn.db.Query(this.db,this.schema,this.type,a)};ydn.db.Query.prototype.unique=function(a){if(!goog.isBoolean(a))throw new ydn.debug.error.ArgumentException("unique value must be a boolean, but "+typeof a+" found");a=this.iter.unique(a);return new ydn.db.Query(this.db,this.schema,this.type,a)};
ydn.db.Query.prototype.order=function(a){var b=goog.isString(a)?[a]:a;a=this.iter.clone();if(b=a.setOrder(b))throw Error(b);return new ydn.db.Query(this.db,this.schema,this.type,a)};
ydn.db.Query.prototype.where=function(a,b,c,d,e){if(this.iter.getIndexName()&&this.iter.getIndexName()!=a){var f=ydn.db.KeyRange.where(b,c,d,e),f=new ydn.db.query.Iterator(this.getStore(),f,this.iter.isReverse(),this.iter.isUnique()),f=new ydn.db.Query(this.db,this.schema,this.type,f);return this.and(f)}if(!this.iter.getIndexName()&&!this.schema.getStore(this.iter.getStoreName()).hasIndex(a))throw new ydn.debug.error.ArgumentException('index "'+a+'" not exists in '+this.iter.getStoreName());f=this.iter.clone();
if(a=f.where(a,b,c,d,e))throw new ydn.debug.error.ArgumentException(a);return new ydn.db.Query(this.db,this.schema,this.type,f)};ydn.db.Query.prototype.getStore=function(){return this.schema.getStore(this.iter.getStoreName())};
ydn.db.Query.prototype.select=function(a){var b=this.getStore(),c=goog.isString(a)?[a]:a,d=this.type;a=this.iter.clone();d=this.iter.getIndexName();if(1==c.length)if(d=c[0],d==ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME||d==b.getKeyPath())d=ydn.db.base.QueryMethod.LIST_PRIMARY_KEY;else if(d&&"*"!=d)if(b.hasIndex(d)){if(b=a.setOrder(c))throw new ydn.debug.error.ArgumentException(b);d=ydn.db.base.QueryMethod.LIST_KEY}else throw new ydn.debug.error.ArgumentException('Invalid select "'+d+'", index not found in store "'+
b.getName()+'"');else d=ydn.db.base.QueryMethod.LIST_VALUE;else if(2==c.length){if(!d)throw new ydn.debug.error.ArgumentException("Only primary key can be selected for this query.");for(var e=0;2>e;e++)if(c[e]!=ydn.db.base.SQLITE_SPECIAL_COLUNM_NAME&&!b.isKeyPath(c[e])&&c[e]!=d)throw new ydn.debug.error.ArgumentException('select field name must be "'+d+'", but "'+c[e]+'" found.');d=ydn.db.base.QueryMethod.LIST_KEYS}else throw new ydn.debug.error.ArgumentException("Selecting more than 2 field names is not supported, but "+
c.length+" fields selected.");return new ydn.db.Query(this.db,this.schema,d,a)};
ydn.db.Query.prototype.list=function(a){a=a||ydn.db.base.DEFAULT_RESULT_LIMIT;var b=ydn.db.base.QueryMethod.LIST_VALUE,c=this.getIterator();this.marker&&this.marker[0]&&(c=c.resume(this.marker[0],this.marker[1]));if(this.type==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY||this.type==ydn.db.base.QueryMethod.LIST_KEYS||this.type==ydn.db.base.QueryMethod.LIST_KEY)b=this.type;a=this.db.listIter(b,c,a,0);a.addCallback(function(a){c.getState()==ydn.db.Iterator.State.RESTING&&(this.marker=[c.getKey(),c.getPrimaryKey()])},
this);return a};ydn.db.Query.prototype.getIterators=function(){return[this.iter.clone()]};ydn.db.Query.prototype.getIterator=function(a){return this.iter.getIterator(!(a||this.type==ydn.db.base.QueryMethod.LIST_PRIMARY_KEY||this.type==ydn.db.base.QueryMethod.LIST_KEYS||this.type==ydn.db.base.QueryMethod.LIST_KEY))};ydn.db.Query.prototype.getOrder=function(){return this.iter.getPostFix()};
ydn.db.Query.prototype.patch=function(a,b){var c=this.getIterator();c.isKeyIterator()&&(c=c.asValueIterator());if(goog.DEBUG){if(1>arguments.length)throw new ydn.debug.error.ArgumentException("too few arguments");if(2==arguments.length){if(!goog.isString(a)&&goog.isArray(a)){if(!goog.isArray(b))throw new ydn.debug.error.ArgumentException("an array is expected for second argument but, "+ydn.json.toShortString(b)+" of type "+typeof b+" found");if(a.length!=b.length)throw new ydn.debug.error.ArgumentException("length of two input arguments must be equal but, "+
a.length+" and "+b.length+" found");}}else if(1==arguments.length){if(!goog.isObject(a))throw new ydn.debug.error.ArgumentException("an object is expected but, "+ydn.json.toShortString(a)+" of type "+typeof a+" found");}else throw new ydn.debug.error.ArgumentException("too many arguments");}var d=this.db.open(function(c){var f=c.getValue();if(goog.isString(a))ydn.db.utils.setValueByKeys(f,a,b);else if(goog.isArray(a))for(var g=0;g<a.length;g++)ydn.db.utils.setValueByKeys(f,a[g],b[g]);else if(goog.isObject(a))for(g in a)a.hasOwnProperty(g)&&
(f[g]=a[g]);d.awaitDeferred(c.update(f))},c,ydn.db.base.TransactionMode.READ_WRITE,this);return d};ydn.db.Query.prototype.open=function(a,b){return this.db.open(a,this.getIterator(),ydn.db.base.TransactionMode.READ_WRITE,b)};ydn.db.Query.prototype.count=function(){return this.iter.usedIndex()?this.iter.isUnique()?this.db.count(this.iter.getIterator()):this.db.count(this.iter.getStoreName(),this.iter.getIndexName(),this.iter.getKeyRange()):this.db.count(this.iter.getStoreName(),this.iter.getKeyRange())};
ydn.db.Query.prototype.clear=function(){return this.iter.usedIndex()?this.db.clear(this.iter.getStoreName(),this.iter.getIndexName(),this.iter.getKeyRange()):this.db.clear(this.iter.getStoreName(),this.iter.getKeyRange())};ydn.db.Query.prototype.and=function(a){a=a.getIterators().concat(this.getIterators());return new ydn.db.query.ConjQuery(this.db,this.schema,this.type,a)};
ydn.db.core.Storage.prototype.from=function(a,b,c,d,e){if(goog.DEBUG&&!goog.isString(a))throw new TypeError('store name "'+a+'"');if(!this.schema.hasStore(a))throw new ydn.debug.error.ArgumentException('Store "'+a+'" not found.');var f=null;if(goog.isDef(b)){if(!goog.isDef(c))throw new ydn.debug.error.ArgumentException("boundary value must be defined.");f=ydn.db.KeyRange.where(b,c,d,e)}else if(goog.isDef(d))throw new ydn.debug.error.ArgumentException("second boundary must not be defined.");a=new ydn.db.query.Iterator(this.schema.getStore(a),
f);return new ydn.db.Query(this.getIndexOperator(),this.schema,null,a)};
ydn.db.core.DbOperator.prototype.from=function(a,b,c,d,e){if(goog.DEBUG&&!goog.isString(a))throw new TypeError('store name "'+a+'"');if(!this.schema.hasStore(a))throw new ydn.debug.error.ArgumentException('Store "'+a+'" not found.');var f=null;if(goog.isDef(b)){if(!goog.isDef(c))throw new ydn.debug.error.ArgumentException("boundary value must be defined.");f=ydn.db.KeyRange.where(b,c,d,e)}else if(goog.isDef(d))throw new ydn.debug.error.ArgumentException("second boundary must not be defined.");a=new ydn.db.query.Iterator(this.schema.getStore(a),
f);return new ydn.db.Query(this,this.schema,null,a)};
ydn.db.query.ConjunctionCursor=function(a,b,c,d){this.cursors=a;this.keys=[];this.primary_keys=[];this.values=[];this.count_=0;this.exited_=this.done_=!1;b&&(this.keys=goog.array.clone(b.keys),this.primary_keys=goog.array.clone(b.primary_keys));goog.isDefAndNotNull(c)&&(this.keys[0]=c);goog.isDefAndNotNull(d)&&(this.primary_keys[0]=d);this.onNext=function(a){throw new ydn.debug.error.InternalError;};this.onFail=function(a){throw new ydn.debug.error.InternalError;}};
ydn.db.query.ConjunctionCursor.DEBUG=!1;ydn.db.query.ConjunctionCursor.prototype.count_=0;ydn.db.query.ConjunctionCursor.prototype.done_=!1;ydn.db.query.ConjunctionCursor.prototype.exited_=!1;ydn.db.query.ConjunctionCursor.prototype.logger=goog.log.getLogger("ydn.db.query.ConjunctionCursor");ydn.db.query.ConjunctionCursor.prototype.getCount=function(){return this.count_};ydn.db.query.ConjunctionCursor.prototype.getKey=function(a){return this.keys[a||0]};
ydn.db.query.ConjunctionCursor.prototype.getPrimaryKey=function(a){a=a||0;return this.cursors[a].isIndexCursor()?this.primary_keys[a]:this.keys[a]};ydn.db.query.ConjunctionCursor.prototype.getValue=function(a){a=a||0;return this.cursors[a].isValueCursor()?this.values[a]:this.getPrimaryKey(a)};ydn.db.query.ConjunctionCursor.prototype.restart=function(a,b){this.done_=!1;this.cursors[0].restart(b,a)};ydn.db.query.ConjunctionCursor.prototype.continuePrimaryKey=function(a){this.cursors[0].continuePrimaryKey(a)};
ydn.db.query.ConjunctionCursor.prototype.continueEffectiveKey=function(a){this.cursors[0].continueEffectiveKey(a)};ydn.db.query.ConjunctionCursor.prototype.advance=function(a){for(var b=0;b<this.cursors.length;b++)this.cursors[b].advance(a)};ydn.db.query.ConjunctionCursor.prototype.update=function(a,b){return this.cursors[b||0].update(a)};ydn.db.query.ConjunctionCursor.prototype.clear=function(a){return this.cursors[a||0].clear()};ydn.db.query.ConjunctionCursor.prototype.hasDone=function(){return this.done_};
ydn.db.query.ConjunctionCursor.prototype.isExited=function(){return this.exited_};ydn.db.query.ConjunctionCursor.prototype.exit=function(){this.exited_=!0;goog.log.finest(this.logger,this+": exit");this.finalize_();this.dispose_()};ydn.db.query.ConjunctionCursor.prototype.finalize_=function(){this.primary_keys=goog.array.map(this.primary_keys,function(a){if(goog.isDefAndNotNull(a))return ydn.db.Key.clone(a)});this.keys=goog.array.map(this.keys,function(a){if(goog.isDefAndNotNull(a))return ydn.db.Key.clone(a)})};
ydn.db.query.ConjunctionCursor.prototype.dispose_=function(){for(var a=0;a<this.cursors.length;a++)this.cursors[a].dispose();goog.log.finest(this.logger,this+" disposed");goog.array.clear(this.values);goog.array.clear(this.cursors)};
goog.DEBUG&&(ydn.db.query.ConjunctionCursor.prototype.toString=function(){for(var a="[",b=0;b<this.keys.length;b++)0<b&&(a+=" "),this.cursors[b]?a+=this.cursors[b].toString():(a+="cursor~{"+this.keys[b],a=goog.isDefAndNotNull(this.primary_keys[b])?a+(";"+this.primary_keys[b]+"}"):a+"}");return"Cursor "+(a+"]")});ydn.db.query.exports={};goog.exportProperty(ydn.db.Query.prototype,"copy",ydn.db.Query.prototype.copy);goog.exportProperty(ydn.db.Query.prototype,"count",ydn.db.Query.prototype.count);
goog.exportProperty(ydn.db.Query.prototype,"list",ydn.db.Query.prototype.list);goog.exportProperty(ydn.db.Query.prototype,"order",ydn.db.Query.prototype.order);goog.exportProperty(ydn.db.Query.prototype,"patch",ydn.db.Query.prototype.patch);goog.exportProperty(ydn.db.Query.prototype,"reverse",ydn.db.Query.prototype.reverse);goog.exportProperty(ydn.db.Query.prototype,"unique",ydn.db.Query.prototype.unique);goog.exportProperty(ydn.db.Query.prototype,"where",ydn.db.Query.prototype.where);
goog.exportProperty(ydn.db.core.Storage.prototype,"from",ydn.db.core.Storage.prototype.from);goog.exportProperty(ydn.db.core.DbOperator.prototype,"from",ydn.db.core.DbOperator.prototype.from);goog.exportProperty(ydn.db.query.ConjunctionCursor.prototype,"getKey",ydn.db.query.ConjunctionCursor.prototype.getKey);goog.exportProperty(ydn.db.query.ConjunctionCursor.prototype,"getPrimaryKey",ydn.db.query.ConjunctionCursor.prototype.getPrimaryKey);
goog.exportProperty(ydn.db.query.ConjunctionCursor.prototype,"getValue",ydn.db.query.ConjunctionCursor.prototype.getValue);goog.exportProperty(ydn.db.query.ConjunctionCursor.prototype,"update",ydn.db.query.ConjunctionCursor.prototype.update);goog.exportProperty(ydn.db.query.ConjunctionCursor.prototype,"clear",ydn.db.query.ConjunctionCursor.prototype.clear);ydn.db.sql.exports={};goog.exportProperty(ydn.db.sql.Storage.prototype,"executeSql",ydn.db.sql.Storage.prototype.executeSql);
goog.exportProperty(ydn.db.sql.DbOperator.prototype,"executeSql",ydn.db.sql.DbOperator.prototype.executeSql);ydn.db.tr.events.exports={};goog.exportProperty(ydn.db.tr.Storage.prototype,"addEventListener",ydn.db.tr.Storage.prototype.addEventListener);goog.exportProperty(ydn.db.tr.Storage.prototype,"removeEventListener",ydn.db.tr.Storage.prototype.removeEventListener);goog.debug.RelativeTimeProvider=function(){this.relativeTimeStart_=goog.now()};goog.debug.RelativeTimeProvider.defaultInstance_=new goog.debug.RelativeTimeProvider;
goog.debug.RelativeTimeProvider.prototype.set=function(a){this.relativeTimeStart_=a};goog.debug.RelativeTimeProvider.prototype.reset=function(){this.set(goog.now())};goog.debug.RelativeTimeProvider.prototype.get=function(){return this.relativeTimeStart_};goog.debug.RelativeTimeProvider.getDefaultInstance=function(){return goog.debug.RelativeTimeProvider.defaultInstance_};goog.dom.tags={};goog.dom.tags.VOID_TAGS_=goog.object.createSet("area base br col command embed hr img input keygen link meta param source track wbr".split(" "));
goog.dom.tags.isVoidTag=function(a){return!0===goog.dom.tags.VOID_TAGS_[a]};goog.string.TypedString=function(){};goog.string.Const=function(){this.stringConstValueWithSecurityContract__googStringSecurityPrivate_="";this.STRING_CONST_TYPE_MARKER__GOOG_STRING_SECURITY_PRIVATE_=goog.string.Const.TYPE_MARKER_};goog.string.Const.prototype.implementsGoogStringTypedString=!0;goog.string.Const.prototype.getTypedStringValue=function(){return this.stringConstValueWithSecurityContract__googStringSecurityPrivate_};
goog.string.Const.prototype.toString=function(){return"Const{"+this.stringConstValueWithSecurityContract__googStringSecurityPrivate_+"}"};goog.string.Const.unwrap=function(a){if(a instanceof goog.string.Const&&a.constructor===goog.string.Const&&a.STRING_CONST_TYPE_MARKER__GOOG_STRING_SECURITY_PRIVATE_===goog.string.Const.TYPE_MARKER_)return a.stringConstValueWithSecurityContract__googStringSecurityPrivate_;goog.asserts.fail("expected object of type Const, got '"+a+"'");return"type_error:Const"};
goog.string.Const.from=function(a){return goog.string.Const.create__googStringSecurityPrivate_(a)};goog.string.Const.TYPE_MARKER_={};goog.string.Const.create__googStringSecurityPrivate_=function(a){var b=new goog.string.Const;b.stringConstValueWithSecurityContract__googStringSecurityPrivate_=a;return b};goog.html={};goog.html.SafeStyle=function(){this.privateDoNotAccessOrElseSafeStyleWrappedValue_="";this.SAFE_STYLE_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeStyle.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_};
goog.html.SafeStyle.prototype.implementsGoogStringTypedString=!0;goog.html.SafeStyle.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={};
goog.html.SafeStyle.fromConstant=function(a){a=goog.string.Const.unwrap(a);if(0===a.length)return goog.html.SafeStyle.EMPTY;goog.html.SafeStyle.checkStyle_(a);goog.asserts.assert(goog.string.endsWith(a,";"),"Last character of style string is not ';': "+a);goog.asserts.assert(goog.string.contains(a,":"),"Style string must contain at least one ':', to specify a \"name: value\" pair: "+a);return goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(a)};
goog.html.SafeStyle.checkStyle_=function(a){goog.asserts.assert(!/[<>]/.test(a),"Forbidden characters in style string: "+a)};goog.html.SafeStyle.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeStyleWrappedValue_};goog.DEBUG&&(goog.html.SafeStyle.prototype.toString=function(){return"SafeStyle{"+this.privateDoNotAccessOrElseSafeStyleWrappedValue_+"}"});
goog.html.SafeStyle.unwrap=function(a){if(a instanceof goog.html.SafeStyle&&a.constructor===goog.html.SafeStyle&&a.SAFE_STYLE_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeStyle.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_)return a.privateDoNotAccessOrElseSafeStyleWrappedValue_;goog.asserts.fail("expected object of type SafeStyle, got '"+a+"'");return"type_error:SafeStyle"};
goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse=function(a){var b=new goog.html.SafeStyle;b.privateDoNotAccessOrElseSafeStyleWrappedValue_=a;return b};goog.html.SafeStyle.EMPTY=goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse("");goog.html.SafeStyle.INNOCUOUS_STRING="zClosurez";
goog.html.SafeStyle.create=function(a){var b="",c;for(c in a){if(!/^[-_a-zA-Z0-9]+$/.test(c))throw Error("Name allows only [-_a-zA-Z0-9], got: "+c);var d=a[c];null!=d&&(d instanceof goog.string.Const?(d=goog.string.Const.unwrap(d),goog.asserts.assert(!/[{;}]/.test(d),"Value does not allow [{;}].")):goog.html.SafeStyle.VALUE_RE_.test(d)||(goog.asserts.fail("String value allows only [-.%_!# a-zA-Z0-9], got: "+d),d=goog.html.SafeStyle.INNOCUOUS_STRING),b+=c+":"+d+";")}if(!b)return goog.html.SafeStyle.EMPTY;
goog.html.SafeStyle.checkStyle_(b);return goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(b)};goog.html.SafeStyle.VALUE_RE_=/^[-.%_!# a-zA-Z0-9]+$/;goog.html.SafeStyle.concat=function(a){var b="",c=function(a){goog.isArray(a)?goog.array.forEach(a,c):b+=goog.html.SafeStyle.unwrap(a)};goog.array.forEach(arguments,c);return b?goog.html.SafeStyle.createSafeStyleSecurityPrivateDoNotAccessOrElse(b):goog.html.SafeStyle.EMPTY};goog.i18n={};goog.i18n.bidi={};goog.i18n.bidi.FORCE_RTL=!1;
goog.i18n.bidi.IS_RTL=goog.i18n.bidi.FORCE_RTL||("ar"==goog.LOCALE.substring(0,2).toLowerCase()||"fa"==goog.LOCALE.substring(0,2).toLowerCase()||"he"==goog.LOCALE.substring(0,2).toLowerCase()||"iw"==goog.LOCALE.substring(0,2).toLowerCase()||"ps"==goog.LOCALE.substring(0,2).toLowerCase()||"sd"==goog.LOCALE.substring(0,2).toLowerCase()||"ug"==goog.LOCALE.substring(0,2).toLowerCase()||"ur"==goog.LOCALE.substring(0,2).toLowerCase()||"yi"==goog.LOCALE.substring(0,2).toLowerCase())&&(2==goog.LOCALE.length||
"-"==goog.LOCALE.substring(2,3)||"_"==goog.LOCALE.substring(2,3))||3<=goog.LOCALE.length&&"ckb"==goog.LOCALE.substring(0,3).toLowerCase()&&(3==goog.LOCALE.length||"-"==goog.LOCALE.substring(3,4)||"_"==goog.LOCALE.substring(3,4));goog.i18n.bidi.Format={LRE:"\u202a",RLE:"\u202b",PDF:"\u202c",LRM:"\u200e",RLM:"\u200f"};goog.i18n.bidi.Dir={LTR:1,RTL:-1,NEUTRAL:0};goog.i18n.bidi.RIGHT="right";goog.i18n.bidi.LEFT="left";goog.i18n.bidi.I18N_RIGHT=goog.i18n.bidi.IS_RTL?goog.i18n.bidi.LEFT:goog.i18n.bidi.RIGHT;
goog.i18n.bidi.I18N_LEFT=goog.i18n.bidi.IS_RTL?goog.i18n.bidi.RIGHT:goog.i18n.bidi.LEFT;goog.i18n.bidi.toDir=function(a,b){return"number"==typeof a?0<a?goog.i18n.bidi.Dir.LTR:0>a?goog.i18n.bidi.Dir.RTL:b?null:goog.i18n.bidi.Dir.NEUTRAL:null==a?null:a?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.LTR};goog.i18n.bidi.ltrChars_="A-Za-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u0300-\u0590\u0800-\u1fff\u200e\u2c00-\ufb1c\ufe00-\ufe6f\ufefd-\uffff";goog.i18n.bidi.rtlChars_="\u0591-\u07ff\u200f\ufb1d-\ufdff\ufe70-\ufefc";
goog.i18n.bidi.htmlSkipReg_=/<[^>]*>|&[^;]+;/g;goog.i18n.bidi.stripHtmlIfNeeded_=function(a,b){return b?a.replace(goog.i18n.bidi.htmlSkipReg_,""):a};goog.i18n.bidi.rtlCharReg_=RegExp("["+goog.i18n.bidi.rtlChars_+"]");goog.i18n.bidi.ltrCharReg_=RegExp("["+goog.i18n.bidi.ltrChars_+"]");goog.i18n.bidi.hasAnyRtl=function(a,b){return goog.i18n.bidi.rtlCharReg_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.hasRtlChar=goog.i18n.bidi.hasAnyRtl;
goog.i18n.bidi.hasAnyLtr=function(a,b){return goog.i18n.bidi.ltrCharReg_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.ltrRe_=RegExp("^["+goog.i18n.bidi.ltrChars_+"]");goog.i18n.bidi.rtlRe_=RegExp("^["+goog.i18n.bidi.rtlChars_+"]");goog.i18n.bidi.isRtlChar=function(a){return goog.i18n.bidi.rtlRe_.test(a)};goog.i18n.bidi.isLtrChar=function(a){return goog.i18n.bidi.ltrRe_.test(a)};goog.i18n.bidi.isNeutralChar=function(a){return!goog.i18n.bidi.isLtrChar(a)&&!goog.i18n.bidi.isRtlChar(a)};
goog.i18n.bidi.ltrDirCheckRe_=RegExp("^[^"+goog.i18n.bidi.rtlChars_+"]*["+goog.i18n.bidi.ltrChars_+"]");goog.i18n.bidi.rtlDirCheckRe_=RegExp("^[^"+goog.i18n.bidi.ltrChars_+"]*["+goog.i18n.bidi.rtlChars_+"]");goog.i18n.bidi.startsWithRtl=function(a,b){return goog.i18n.bidi.rtlDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.isRtlText=goog.i18n.bidi.startsWithRtl;
goog.i18n.bidi.startsWithLtr=function(a,b){return goog.i18n.bidi.ltrDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.isLtrText=goog.i18n.bidi.startsWithLtr;goog.i18n.bidi.isRequiredLtrRe_=/^http:\/\/.*/;goog.i18n.bidi.isNeutralText=function(a,b){a=goog.i18n.bidi.stripHtmlIfNeeded_(a,b);return goog.i18n.bidi.isRequiredLtrRe_.test(a)||!goog.i18n.bidi.hasAnyLtr(a)&&!goog.i18n.bidi.hasAnyRtl(a)};
goog.i18n.bidi.ltrExitDirCheckRe_=RegExp("["+goog.i18n.bidi.ltrChars_+"][^"+goog.i18n.bidi.rtlChars_+"]*$");goog.i18n.bidi.rtlExitDirCheckRe_=RegExp("["+goog.i18n.bidi.rtlChars_+"][^"+goog.i18n.bidi.ltrChars_+"]*$");goog.i18n.bidi.endsWithLtr=function(a,b){return goog.i18n.bidi.ltrExitDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.isLtrExitText=goog.i18n.bidi.endsWithLtr;
goog.i18n.bidi.endsWithRtl=function(a,b){return goog.i18n.bidi.rtlExitDirCheckRe_.test(goog.i18n.bidi.stripHtmlIfNeeded_(a,b))};goog.i18n.bidi.isRtlExitText=goog.i18n.bidi.endsWithRtl;goog.i18n.bidi.rtlLocalesRe_=RegExp("^(ar|ckb|dv|he|iw|fa|nqo|ps|sd|ug|ur|yi|.*[-_](Arab|Hebr|Thaa|Nkoo|Tfng))(?!.*[-_](Latn|Cyrl)($|-|_))($|-|_)","i");goog.i18n.bidi.isRtlLanguage=function(a){return goog.i18n.bidi.rtlLocalesRe_.test(a)};goog.i18n.bidi.bracketGuardHtmlRe_=/(\(.*?\)+)|(\[.*?\]+)|(\{.*?\}+)|(&lt;.*?(&gt;)+)/g;
goog.i18n.bidi.bracketGuardTextRe_=/(\(.*?\)+)|(\[.*?\]+)|(\{.*?\}+)|(<.*?>+)/g;goog.i18n.bidi.guardBracketInHtml=function(a,b){return(void 0===b?goog.i18n.bidi.hasAnyRtl(a):b)?a.replace(goog.i18n.bidi.bracketGuardHtmlRe_,"<span dir=rtl>$&</span>"):a.replace(goog.i18n.bidi.bracketGuardHtmlRe_,"<span dir=ltr>$&</span>")};
goog.i18n.bidi.guardBracketInText=function(a,b){var c=(void 0===b?goog.i18n.bidi.hasAnyRtl(a):b)?goog.i18n.bidi.Format.RLM:goog.i18n.bidi.Format.LRM;return a.replace(goog.i18n.bidi.bracketGuardTextRe_,c+"$&"+c)};goog.i18n.bidi.enforceRtlInHtml=function(a){return"<"==a.charAt(0)?a.replace(/<\w+/,"$& dir=rtl"):"\n<span dir=rtl>"+a+"</span>"};goog.i18n.bidi.enforceRtlInText=function(a){return goog.i18n.bidi.Format.RLE+a+goog.i18n.bidi.Format.PDF};
goog.i18n.bidi.enforceLtrInHtml=function(a){return"<"==a.charAt(0)?a.replace(/<\w+/,"$& dir=ltr"):"\n<span dir=ltr>"+a+"</span>"};goog.i18n.bidi.enforceLtrInText=function(a){return goog.i18n.bidi.Format.LRE+a+goog.i18n.bidi.Format.PDF};goog.i18n.bidi.dimensionsRe_=/:\s*([.\d][.\w]*)\s+([.\d][.\w]*)\s+([.\d][.\w]*)\s+([.\d][.\w]*)/g;goog.i18n.bidi.leftRe_=/left/gi;goog.i18n.bidi.rightRe_=/right/gi;goog.i18n.bidi.tempRe_=/%%%%/g;
goog.i18n.bidi.mirrorCSS=function(a){return a.replace(goog.i18n.bidi.dimensionsRe_,":$1 $4 $3 $2").replace(goog.i18n.bidi.leftRe_,"%%%%").replace(goog.i18n.bidi.rightRe_,goog.i18n.bidi.LEFT).replace(goog.i18n.bidi.tempRe_,goog.i18n.bidi.RIGHT)};goog.i18n.bidi.doubleQuoteSubstituteRe_=/([\u0591-\u05f2])"/g;goog.i18n.bidi.singleQuoteSubstituteRe_=/([\u0591-\u05f2])'/g;
goog.i18n.bidi.normalizeHebrewQuote=function(a){return a.replace(goog.i18n.bidi.doubleQuoteSubstituteRe_,"$1\u05f4").replace(goog.i18n.bidi.singleQuoteSubstituteRe_,"$1\u05f3")};goog.i18n.bidi.wordSeparatorRe_=/\s+/;goog.i18n.bidi.hasNumeralsRe_=/\d/;goog.i18n.bidi.rtlDetectionThreshold_=0.4;
goog.i18n.bidi.estimateDirection=function(a,b){for(var c=0,d=0,e=!1,f=goog.i18n.bidi.stripHtmlIfNeeded_(a,b).split(goog.i18n.bidi.wordSeparatorRe_),g=0;g<f.length;g++){var h=f[g];goog.i18n.bidi.startsWithRtl(h)?(c++,d++):goog.i18n.bidi.isRequiredLtrRe_.test(h)?e=!0:goog.i18n.bidi.hasAnyLtr(h)?d++:goog.i18n.bidi.hasNumeralsRe_.test(h)&&(e=!0)}return 0==d?e?goog.i18n.bidi.Dir.LTR:goog.i18n.bidi.Dir.NEUTRAL:c/d>goog.i18n.bidi.rtlDetectionThreshold_?goog.i18n.bidi.Dir.RTL:goog.i18n.bidi.Dir.LTR};
goog.i18n.bidi.detectRtlDirectionality=function(a,b){return goog.i18n.bidi.estimateDirection(a,b)==goog.i18n.bidi.Dir.RTL};goog.i18n.bidi.setElementDirAndAlign=function(a,b){a&&(b=goog.i18n.bidi.toDir(b))&&(a.style.textAlign=b==goog.i18n.bidi.Dir.RTL?goog.i18n.bidi.RIGHT:goog.i18n.bidi.LEFT,a.dir=b==goog.i18n.bidi.Dir.RTL?"rtl":"ltr")};goog.i18n.bidi.DirectionalString=function(){};
goog.html.SafeUrl=function(){this.privateDoNotAccessOrElseSafeHtmlWrappedValue_="";this.SAFE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_};goog.html.SafeUrl.INNOCUOUS_STRING="about:invalid#zClosurez";goog.html.SafeUrl.prototype.implementsGoogStringTypedString=!0;goog.html.SafeUrl.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeHtmlWrappedValue_};
goog.html.SafeUrl.prototype.implementsGoogI18nBidiDirectionalString=!0;goog.html.SafeUrl.prototype.getDirection=function(){return goog.i18n.bidi.Dir.LTR};goog.DEBUG&&(goog.html.SafeUrl.prototype.toString=function(){return"SafeUrl{"+this.privateDoNotAccessOrElseSafeHtmlWrappedValue_+"}"});
goog.html.SafeUrl.unwrap=function(a){if(a instanceof goog.html.SafeUrl&&a.constructor===goog.html.SafeUrl&&a.SAFE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_)return a.privateDoNotAccessOrElseSafeHtmlWrappedValue_;goog.asserts.fail("expected object of type SafeUrl, got '"+a+"'");return"type_error:SafeUrl"};goog.html.SafeUrl.fromConstant=function(a){return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(goog.string.Const.unwrap(a))};
goog.html.SAFE_URL_PATTERN_=/^(?:(?:https?|mailto):|[^&:/?#]*(?:[/?#]|$))/i;goog.html.SafeUrl.sanitize=function(a){if(a instanceof goog.html.SafeUrl)return a;a=a.implementsGoogStringTypedString?a.getTypedStringValue():String(a);a=goog.html.SAFE_URL_PATTERN_.test(a)?goog.html.SafeUrl.normalize_(a):goog.html.SafeUrl.INNOCUOUS_STRING;return goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse(a)};
goog.html.SafeUrl.normalize_=function(a){try{var b=encodeURI(a)}catch(c){return goog.html.SafeUrl.INNOCUOUS_STRING}return b.replace(goog.html.SafeUrl.NORMALIZE_MATCHER_,function(a){return goog.html.SafeUrl.NORMALIZE_REPLACER_MAP_[a]})};goog.html.SafeUrl.NORMALIZE_MATCHER_=/[()']|%5B|%5D|%25/g;goog.html.SafeUrl.NORMALIZE_REPLACER_MAP_={"'":"%27","(":"%28",")":"%29","%5B":"[","%5D":"]","%25":"%"};goog.html.SafeUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={};
goog.html.SafeUrl.createSafeUrlSecurityPrivateDoNotAccessOrElse=function(a){var b=new goog.html.SafeUrl;b.privateDoNotAccessOrElseSafeHtmlWrappedValue_=a;return b};goog.html.TrustedResourceUrl=function(){this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_="";this.TRUSTED_RESOURCE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_};goog.html.TrustedResourceUrl.prototype.implementsGoogStringTypedString=!0;
goog.html.TrustedResourceUrl.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_};goog.html.TrustedResourceUrl.prototype.implementsGoogI18nBidiDirectionalString=!0;goog.html.TrustedResourceUrl.prototype.getDirection=function(){return goog.i18n.bidi.Dir.LTR};goog.DEBUG&&(goog.html.TrustedResourceUrl.prototype.toString=function(){return"TrustedResourceUrl{"+this.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_+"}"});
goog.html.TrustedResourceUrl.unwrap=function(a){if(a instanceof goog.html.TrustedResourceUrl&&a.constructor===goog.html.TrustedResourceUrl&&a.TRUSTED_RESOURCE_URL_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_)return a.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_;goog.asserts.fail("expected object of type TrustedResourceUrl, got '"+a+"'");return"type_error:TrustedResourceUrl"};goog.html.TrustedResourceUrl.fromConstant=function(a){return goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse(goog.string.Const.unwrap(a))};
goog.html.TrustedResourceUrl.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={};goog.html.TrustedResourceUrl.createTrustedResourceUrlSecurityPrivateDoNotAccessOrElse=function(a){var b=new goog.html.TrustedResourceUrl;b.privateDoNotAccessOrElseTrustedResourceUrlWrappedValue_=a;return b};goog.html.SafeHtml=function(){this.privateDoNotAccessOrElseSafeHtmlWrappedValue_="";this.SAFE_HTML_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_=goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_;this.dir_=null};
goog.html.SafeHtml.prototype.implementsGoogI18nBidiDirectionalString=!0;goog.html.SafeHtml.prototype.getDirection=function(){return this.dir_};goog.html.SafeHtml.prototype.implementsGoogStringTypedString=!0;goog.html.SafeHtml.prototype.getTypedStringValue=function(){return this.privateDoNotAccessOrElseSafeHtmlWrappedValue_};goog.DEBUG&&(goog.html.SafeHtml.prototype.toString=function(){return"SafeHtml{"+this.privateDoNotAccessOrElseSafeHtmlWrappedValue_+"}"});
goog.html.SafeHtml.unwrap=function(a){if(a instanceof goog.html.SafeHtml&&a.constructor===goog.html.SafeHtml&&a.SAFE_HTML_TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_===goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_)return a.privateDoNotAccessOrElseSafeHtmlWrappedValue_;goog.asserts.fail("expected object of type SafeHtml, got '"+a+"'");return"type_error:SafeHtml"};
goog.html.SafeHtml.htmlEscape=function(a){if(a instanceof goog.html.SafeHtml)return a;var b=null;a.implementsGoogI18nBidiDirectionalString&&(b=a.getDirection());a=a.implementsGoogStringTypedString?a.getTypedStringValue():String(a);return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(goog.string.htmlEscape(a),b)};
goog.html.SafeHtml.htmlEscapePreservingNewlines=function(a){if(a instanceof goog.html.SafeHtml)return a;a=goog.html.SafeHtml.htmlEscape(a);return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(goog.string.newLineToBr(goog.html.SafeHtml.unwrap(a)),a.getDirection())};
goog.html.SafeHtml.htmlEscapePreservingNewlinesAndSpaces=function(a){if(a instanceof goog.html.SafeHtml)return a;a=goog.html.SafeHtml.htmlEscape(a);return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(goog.string.whitespaceEscape(goog.html.SafeHtml.unwrap(a)),a.getDirection())};goog.html.SafeHtml.from=goog.html.SafeHtml.htmlEscape;goog.html.SafeHtml.VALID_NAMES_IN_TAG_=/^[a-zA-Z0-9-]+$/;
goog.html.SafeHtml.URL_ATTRIBUTES_=goog.object.createSet("action","cite","data","formaction","href","manifest","poster","src");goog.html.SafeHtml.NOT_ALLOWED_TAG_NAMES_=goog.object.createSet("embed","iframe","link","script","style","template");
goog.html.SafeHtml.create=function(a,b,c){if(!goog.html.SafeHtml.VALID_NAMES_IN_TAG_.test(a))throw Error("Invalid tag name <"+a+">.");if(a.toLowerCase()in goog.html.SafeHtml.NOT_ALLOWED_TAG_NAMES_)throw Error("Tag name <"+a+"> is not allowed for SafeHtml.");return goog.html.SafeHtml.create_(a,null,b,c)};
goog.html.SafeHtml.createEmbed=function(a,b,c){if(goog.string.isEmpty(goog.string.Const.unwrap(b)))throw Error('Must provide non-empty "type"');for(var d in c){var e=d.toLowerCase();if("src"==e||"type"==e)throw Error('Cannot override "src" nor "type" attributes, got "'+d+'" with value "'+c[d]+'"');}a=goog.string.htmlEscape(goog.html.TrustedResourceUrl.unwrap(a));b=goog.string.htmlEscape(goog.string.Const.unwrap(b));return goog.html.SafeHtml.create_("embed",'src="'+a+'" type="'+b+'"',c)};
goog.html.SafeHtml.create_=function(a,b,c,d){var e=null,f="<"+a;b&&(f+=" "+b);if(c)for(var g in c){if(!goog.html.SafeHtml.VALID_NAMES_IN_TAG_.test(g))throw Error('Invalid attribute name "'+g+'".');b=c[g];goog.isDefAndNotNull(b)&&(f+=" "+goog.html.SafeHtml.getAttrNameAndValue_(a,g,b))}goog.isDef(d)?goog.isArray(d)||(d=[d]):d=[];goog.dom.tags.isVoidTag(a.toLowerCase())?(goog.asserts.assert(!d.length,"Void tag <"+a+"> does not allow content."),f+=">"):(e=goog.html.SafeHtml.concat(d),f+=">"+goog.html.SafeHtml.unwrap(e)+
"</"+a+">",e=e.getDirection());(a=c&&c.dir)&&(e=/^(ltr|rtl|auto)$/i.test(a)?goog.i18n.bidi.Dir.NEUTRAL:null);return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(f,e)};
goog.html.SafeHtml.getAttrNameAndValue_=function(a,b,c){if(c instanceof goog.string.Const)c=goog.string.Const.unwrap(c);else if("style"==b.toLowerCase())c=goog.html.SafeHtml.getStyleValue_(c);else{if(/^on/i.test(b))throw Error('Attribute "'+b+'" requires goog.string.Const value, "'+c+'" given.');if(b.toLowerCase()in goog.html.SafeHtml.URL_ATTRIBUTES_)if(c instanceof goog.html.TrustedResourceUrl)c=goog.html.TrustedResourceUrl.unwrap(c);else if(c instanceof goog.html.SafeUrl)c=goog.html.SafeUrl.unwrap(c);
else throw Error('Attribute "'+b+'" on tag "'+a+'" requires goog.html.SafeUrl or goog.string.Const value, "'+c+'" given.');}c.implementsGoogStringTypedString&&(c=c.getTypedStringValue());goog.asserts.assert(goog.isString(c)||goog.isNumber(c),"String or number value expected, got "+typeof c+" with value: "+c);return b+'="'+goog.string.htmlEscape(String(c))+'"'};
goog.html.SafeHtml.getStyleValue_=function(a){if(!goog.isObject(a))throw Error('The "style" attribute requires goog.html.SafeStyle or map of style properties, '+typeof a+" given: "+a);a instanceof goog.html.SafeStyle||(a=goog.html.SafeStyle.create(a));return goog.html.SafeStyle.unwrap(a)};goog.html.SafeHtml.createWithDir=function(a,b,c,d){b=goog.html.SafeHtml.create(b,c,d);b.dir_=a;return b};
goog.html.SafeHtml.concat=function(a){var b=goog.i18n.bidi.Dir.NEUTRAL,c="",d=function(a){goog.isArray(a)?goog.array.forEach(a,d):(a=goog.html.SafeHtml.htmlEscape(a),c+=goog.html.SafeHtml.unwrap(a),a=a.getDirection(),b==goog.i18n.bidi.Dir.NEUTRAL?b=a:a!=goog.i18n.bidi.Dir.NEUTRAL&&b!=a&&(b=null))};goog.array.forEach(arguments,d);return goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse(c,b)};
goog.html.SafeHtml.concatWithDir=function(a,b){var c=goog.html.SafeHtml.concat(goog.array.slice(arguments,1));c.dir_=a;return c};goog.html.SafeHtml.TYPE_MARKER_GOOG_HTML_SECURITY_PRIVATE_={};goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse=function(a,b){var c=new goog.html.SafeHtml;c.privateDoNotAccessOrElseSafeHtmlWrappedValue_=a;c.dir_=b;return c};goog.html.SafeHtml.EMPTY=goog.html.SafeHtml.createSafeHtmlSecurityPrivateDoNotAccessOrElse("",goog.i18n.bidi.Dir.NEUTRAL);
goog.debug.Formatter=function(a){this.prefix_=a||"";this.startTimeProvider_=goog.debug.RelativeTimeProvider.getDefaultInstance()};goog.debug.Formatter.prototype.appendNewline=!0;goog.debug.Formatter.prototype.showAbsoluteTime=!0;goog.debug.Formatter.prototype.showRelativeTime=!0;goog.debug.Formatter.prototype.showLoggerName=!0;goog.debug.Formatter.prototype.showExceptionText=!1;goog.debug.Formatter.prototype.showSeverityLevel=!1;
goog.debug.Formatter.prototype.setStartTimeProvider=function(a){this.startTimeProvider_=a};goog.debug.Formatter.prototype.getStartTimeProvider=function(){return this.startTimeProvider_};goog.debug.Formatter.prototype.resetRelativeTimeStart=function(){this.startTimeProvider_.reset()};
goog.debug.Formatter.getDateTimeStamp_=function(a){a=new Date(a.getMillis());return goog.debug.Formatter.getTwoDigitString_(a.getFullYear()-2E3)+goog.debug.Formatter.getTwoDigitString_(a.getMonth()+1)+goog.debug.Formatter.getTwoDigitString_(a.getDate())+" "+goog.debug.Formatter.getTwoDigitString_(a.getHours())+":"+goog.debug.Formatter.getTwoDigitString_(a.getMinutes())+":"+goog.debug.Formatter.getTwoDigitString_(a.getSeconds())+"."+goog.debug.Formatter.getTwoDigitString_(Math.floor(a.getMilliseconds()/
10))};goog.debug.Formatter.getTwoDigitString_=function(a){return 10>a?"0"+a:String(a)};goog.debug.Formatter.getRelativeTime_=function(a,b){var c=(a.getMillis()-b)/1E3,d=c.toFixed(3),e=0;if(1>c)e=2;else for(;100>c;)e++,c*=10;for(;0<e--;)d=" "+d;return d};goog.debug.HtmlFormatter=function(a){goog.debug.Formatter.call(this,a)};goog.inherits(goog.debug.HtmlFormatter,goog.debug.Formatter);goog.debug.HtmlFormatter.prototype.showExceptionText=!0;
goog.debug.HtmlFormatter.prototype.formatRecord=function(a){return a?this.formatRecordAsHtml(a).getTypedStringValue():""};
goog.debug.HtmlFormatter.prototype.formatRecordAsHtml=function(a){var b;switch(a.getLevel().value){case goog.debug.Logger.Level.SHOUT.value:b="dbg-sh";break;case goog.debug.Logger.Level.SEVERE.value:b="dbg-sev";break;case goog.debug.Logger.Level.WARNING.value:b="dbg-w";break;case goog.debug.Logger.Level.INFO.value:b="dbg-i";break;default:b="dbg-f"}var c=[];c.push(this.prefix_," ");this.showAbsoluteTime&&c.push("[",goog.debug.Formatter.getDateTimeStamp_(a),"] ");this.showRelativeTime&&c.push("[",goog.debug.Formatter.getRelativeTime_(a,
this.startTimeProvider_.get()),"s] ");this.showLoggerName&&c.push("[",a.getLoggerName(),"] ");this.showSeverityLevel&&c.push("[",a.getLevel().name,"] ");var c=goog.html.SafeHtml.htmlEscapePreservingNewlinesAndSpaces(c.join("")),d=goog.html.SafeHtml.EMPTY;this.showExceptionText&&a.getException()&&(d=goog.html.SafeHtml.concat(goog.html.SafeHtml.create("br"),goog.html.SafeHtml.htmlEscapePreservingNewlinesAndSpaces(a.getExceptionText()||"")));a=goog.html.SafeHtml.htmlEscapePreservingNewlinesAndSpaces(a.getMessage());
b=goog.html.SafeHtml.create("span",{"class":b},goog.html.SafeHtml.concat(a,d));return this.appendNewline?goog.html.SafeHtml.concat(c,b,goog.html.SafeHtml.create("br")):goog.html.SafeHtml.concat(c,b)};goog.debug.TextFormatter=function(a){goog.debug.Formatter.call(this,a)};goog.inherits(goog.debug.TextFormatter,goog.debug.Formatter);
goog.debug.TextFormatter.prototype.formatRecord=function(a){var b=[];b.push(this.prefix_," ");this.showAbsoluteTime&&b.push("[",goog.debug.Formatter.getDateTimeStamp_(a),"] ");this.showRelativeTime&&b.push("[",goog.debug.Formatter.getRelativeTime_(a,this.startTimeProvider_.get()),"s] ");this.showLoggerName&&b.push("[",a.getLoggerName(),"] ");this.showSeverityLevel&&b.push("[",a.getLevel().name,"] ");b.push(a.getMessage());this.showExceptionText&&a.getException()&&b.push("\n",a.getExceptionText());
this.appendNewline&&b.push("\n");return b.join("")};goog.debug.Console=function(){this.publishHandler_=goog.bind(this.addLogRecord,this);this.formatter_=new goog.debug.TextFormatter;this.formatter_.showAbsoluteTime=!1;this.formatter_.showExceptionText=!1;this.isCapturing_=this.formatter_.appendNewline=!1;this.logBuffer_="";this.filteredLoggers_={}};goog.debug.Console.prototype.getFormatter=function(){return this.formatter_};
goog.debug.Console.prototype.setCapturing=function(a){if(a!=this.isCapturing_){var b=goog.debug.LogManager.getRoot();a?b.addHandler(this.publishHandler_):(b.removeHandler(this.publishHandler_),this.logBuffer="");this.isCapturing_=a}};
goog.debug.Console.prototype.addLogRecord=function(a){if(!this.filteredLoggers_[a.getLoggerName()]){var b=this.formatter_.formatRecord(a),c=goog.debug.Console.console_;if(c)switch(a.getLevel()){case goog.debug.Logger.Level.SHOUT:goog.debug.Console.logToConsole_(c,"info",b);break;case goog.debug.Logger.Level.SEVERE:goog.debug.Console.logToConsole_(c,"error",b);break;case goog.debug.Logger.Level.WARNING:goog.debug.Console.logToConsole_(c,"warn",b);break;default:goog.debug.Console.logToConsole_(c,"debug",
b)}else this.logBuffer_+=b}};goog.debug.Console.prototype.addFilter=function(a){this.filteredLoggers_[a]=!0};goog.debug.Console.prototype.removeFilter=function(a){delete this.filteredLoggers_[a]};goog.debug.Console.instance=null;goog.debug.Console.console_=goog.global.console;goog.debug.Console.setConsole=function(a){goog.debug.Console.console_=a};
goog.debug.Console.autoInstall=function(){goog.debug.Console.instance||(goog.debug.Console.instance=new goog.debug.Console);goog.global.location&&-1!=goog.global.location.href.indexOf("Debug=true")&&goog.debug.Console.instance.setCapturing(!0)};goog.debug.Console.show=function(){alert(goog.debug.Console.instance.logBuffer_)};goog.debug.Console.logToConsole_=function(a,b,c){if(a[b])a[b](c);else a.log(c)};goog.dom.safe={};goog.dom.safe.setInnerHtml=function(a,b){a.innerHTML=goog.html.SafeHtml.unwrap(b)};
goog.dom.safe.setOuterHtml=function(a,b){a.outerHTML=goog.html.SafeHtml.unwrap(b)};goog.dom.safe.documentWrite=function(a,b){a.write(goog.html.SafeHtml.unwrap(b))};goog.dom.safe.setAnchorHref=function(a,b){var c;c=b instanceof goog.html.SafeUrl?b:goog.html.SafeUrl.sanitize(b);a.href=goog.html.SafeUrl.unwrap(c)};goog.dom.safe.setLocationHref=function(a,b){var c;c=b instanceof goog.html.SafeUrl?b:goog.html.SafeUrl.sanitize(b);a.href=goog.html.SafeUrl.unwrap(c)};
goog.dom.BrowserFeature={CAN_ADD_NAME_OR_TYPE_ATTRIBUTES:!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9),CAN_USE_CHILDREN_ATTRIBUTE:!goog.userAgent.GECKO&&!goog.userAgent.IE||goog.userAgent.IE&&goog.userAgent.isDocumentModeOrHigher(9)||goog.userAgent.GECKO&&goog.userAgent.isVersionOrHigher("1.9.1"),CAN_USE_INNER_TEXT:goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("9"),CAN_USE_PARENT_ELEMENT_PROPERTY:goog.userAgent.IE||goog.userAgent.OPERA||goog.userAgent.WEBKIT,INNER_HTML_NEEDS_SCOPED_ELEMENT:goog.userAgent.IE,
LEGACY_IE_RANGES:goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(9)};
goog.dom.TagName={A:"A",ABBR:"ABBR",ACRONYM:"ACRONYM",ADDRESS:"ADDRESS",APPLET:"APPLET",AREA:"AREA",ARTICLE:"ARTICLE",ASIDE:"ASIDE",AUDIO:"AUDIO",B:"B",BASE:"BASE",BASEFONT:"BASEFONT",BDI:"BDI",BDO:"BDO",BIG:"BIG",BLOCKQUOTE:"BLOCKQUOTE",BODY:"BODY",BR:"BR",BUTTON:"BUTTON",CANVAS:"CANVAS",CAPTION:"CAPTION",CENTER:"CENTER",CITE:"CITE",CODE:"CODE",COL:"COL",COLGROUP:"COLGROUP",COMMAND:"COMMAND",DATA:"DATA",DATALIST:"DATALIST",DD:"DD",DEL:"DEL",DETAILS:"DETAILS",DFN:"DFN",DIALOG:"DIALOG",DIR:"DIR",DIV:"DIV",
DL:"DL",DT:"DT",EM:"EM",EMBED:"EMBED",FIELDSET:"FIELDSET",FIGCAPTION:"FIGCAPTION",FIGURE:"FIGURE",FONT:"FONT",FOOTER:"FOOTER",FORM:"FORM",FRAME:"FRAME",FRAMESET:"FRAMESET",H1:"H1",H2:"H2",H3:"H3",H4:"H4",H5:"H5",H6:"H6",HEAD:"HEAD",HEADER:"HEADER",HGROUP:"HGROUP",HR:"HR",HTML:"HTML",I:"I",IFRAME:"IFRAME",IMG:"IMG",INPUT:"INPUT",INS:"INS",ISINDEX:"ISINDEX",KBD:"KBD",KEYGEN:"KEYGEN",LABEL:"LABEL",LEGEND:"LEGEND",LI:"LI",LINK:"LINK",MAP:"MAP",MARK:"MARK",MATH:"MATH",MENU:"MENU",META:"META",METER:"METER",
NAV:"NAV",NOFRAMES:"NOFRAMES",NOSCRIPT:"NOSCRIPT",OBJECT:"OBJECT",OL:"OL",OPTGROUP:"OPTGROUP",OPTION:"OPTION",OUTPUT:"OUTPUT",P:"P",PARAM:"PARAM",PRE:"PRE",PROGRESS:"PROGRESS",Q:"Q",RP:"RP",RT:"RT",RUBY:"RUBY",S:"S",SAMP:"SAMP",SCRIPT:"SCRIPT",SECTION:"SECTION",SELECT:"SELECT",SMALL:"SMALL",SOURCE:"SOURCE",SPAN:"SPAN",STRIKE:"STRIKE",STRONG:"STRONG",STYLE:"STYLE",SUB:"SUB",SUMMARY:"SUMMARY",SUP:"SUP",SVG:"SVG",TABLE:"TABLE",TBODY:"TBODY",TD:"TD",TEXTAREA:"TEXTAREA",TFOOT:"TFOOT",TH:"TH",THEAD:"THEAD",
TIME:"TIME",TITLE:"TITLE",TR:"TR",TRACK:"TRACK",TT:"TT",U:"U",UL:"UL",VAR:"VAR",VIDEO:"VIDEO",WBR:"WBR"};goog.math.Coordinate=function(a,b){this.x=goog.isDef(a)?a:0;this.y=goog.isDef(b)?b:0};goog.math.Coordinate.prototype.clone=function(){return new goog.math.Coordinate(this.x,this.y)};goog.DEBUG&&(goog.math.Coordinate.prototype.toString=function(){return"("+this.x+", "+this.y+")"});goog.math.Coordinate.equals=function(a,b){return a==b?!0:a&&b?a.x==b.x&&a.y==b.y:!1};
goog.math.Coordinate.distance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return Math.sqrt(c*c+d*d)};goog.math.Coordinate.magnitude=function(a){return Math.sqrt(a.x*a.x+a.y*a.y)};goog.math.Coordinate.azimuth=function(a){return goog.math.angle(0,0,a.x,a.y)};goog.math.Coordinate.squaredDistance=function(a,b){var c=a.x-b.x,d=a.y-b.y;return c*c+d*d};goog.math.Coordinate.difference=function(a,b){return new goog.math.Coordinate(a.x-b.x,a.y-b.y)};
goog.math.Coordinate.sum=function(a,b){return new goog.math.Coordinate(a.x+b.x,a.y+b.y)};goog.math.Coordinate.prototype.ceil=function(){this.x=Math.ceil(this.x);this.y=Math.ceil(this.y);return this};goog.math.Coordinate.prototype.floor=function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);return this};goog.math.Coordinate.prototype.round=function(){this.x=Math.round(this.x);this.y=Math.round(this.y);return this};
goog.math.Coordinate.prototype.translate=function(a,b){a instanceof goog.math.Coordinate?(this.x+=a.x,this.y+=a.y):(this.x+=a,goog.isNumber(b)&&(this.y+=b));return this};goog.math.Coordinate.prototype.scale=function(a,b){var c=goog.isNumber(b)?b:a;this.x*=a;this.y*=c;return this};goog.math.Coordinate.prototype.rotateRadians=function(a,b){var c=b||new goog.math.Coordinate(0,0),d=this.x,e=this.y,f=Math.cos(a),g=Math.sin(a);this.x=(d-c.x)*f-(e-c.y)*g+c.x;this.y=(d-c.x)*g+(e-c.y)*f+c.y};
goog.math.Coordinate.prototype.rotateDegrees=function(a,b){this.rotateRadians(goog.math.toRadians(a),b)};goog.math.Size=function(a,b){this.width=a;this.height=b};goog.math.Size.equals=function(a,b){return a==b?!0:a&&b?a.width==b.width&&a.height==b.height:!1};goog.math.Size.prototype.clone=function(){return new goog.math.Size(this.width,this.height)};goog.DEBUG&&(goog.math.Size.prototype.toString=function(){return"("+this.width+" x "+this.height+")"});
goog.math.Size.prototype.getLongest=function(){return Math.max(this.width,this.height)};goog.math.Size.prototype.getShortest=function(){return Math.min(this.width,this.height)};goog.math.Size.prototype.area=function(){return this.width*this.height};goog.math.Size.prototype.perimeter=function(){return 2*(this.width+this.height)};goog.math.Size.prototype.aspectRatio=function(){return this.width/this.height};goog.math.Size.prototype.isEmpty=function(){return!this.area()};
goog.math.Size.prototype.ceil=function(){this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};goog.math.Size.prototype.fitsInside=function(a){return this.width<=a.width&&this.height<=a.height};goog.math.Size.prototype.floor=function(){this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};goog.math.Size.prototype.round=function(){this.width=Math.round(this.width);this.height=Math.round(this.height);return this};
goog.math.Size.prototype.scale=function(a,b){var c=goog.isNumber(b)?b:a;this.width*=a;this.height*=c;return this};goog.math.Size.prototype.scaleToFit=function(a){a=this.aspectRatio()>a.aspectRatio()?a.width/this.width:a.height/this.height;return this.scale(a)};goog.dom.ASSUME_QUIRKS_MODE=!1;goog.dom.ASSUME_STANDARDS_MODE=!1;goog.dom.COMPAT_MODE_KNOWN_=goog.dom.ASSUME_QUIRKS_MODE||goog.dom.ASSUME_STANDARDS_MODE;
goog.dom.getDomHelper=function(a){return a?new goog.dom.DomHelper(goog.dom.getOwnerDocument(a)):goog.dom.defaultDomHelper_||(goog.dom.defaultDomHelper_=new goog.dom.DomHelper)};goog.dom.getDocument=function(){return document};goog.dom.getElement=function(a){return goog.dom.getElementHelper_(document,a)};goog.dom.getElementHelper_=function(a,b){return goog.isString(b)?a.getElementById(b):b};goog.dom.getRequiredElement=function(a){return goog.dom.getRequiredElementHelper_(document,a)};
goog.dom.getRequiredElementHelper_=function(a,b){goog.asserts.assertString(b);var c=goog.dom.getElementHelper_(a,b);return c=goog.asserts.assertElement(c,"No element found with id: "+b)};goog.dom.$=goog.dom.getElement;goog.dom.getElementsByTagNameAndClass=function(a,b,c){return goog.dom.getElementsByTagNameAndClass_(document,a,b,c)};
goog.dom.getElementsByClass=function(a,b){var c=b||document;return goog.dom.canUseQuerySelector_(c)?c.querySelectorAll("."+a):goog.dom.getElementsByTagNameAndClass_(document,"*",a,b)};goog.dom.getElementByClass=function(a,b){var c=b||document,d=null;return(d=goog.dom.canUseQuerySelector_(c)?c.querySelector("."+a):goog.dom.getElementsByTagNameAndClass_(document,"*",a,b)[0])||null};
goog.dom.getRequiredElementByClass=function(a,b){var c=goog.dom.getElementByClass(a,b);return goog.asserts.assert(c,"No element found with className: "+a)};goog.dom.canUseQuerySelector_=function(a){return!(!a.querySelectorAll||!a.querySelector)};
goog.dom.getElementsByTagNameAndClass_=function(a,b,c,d){a=d||a;b=b&&"*"!=b?b.toUpperCase():"";if(goog.dom.canUseQuerySelector_(a)&&(b||c))return a.querySelectorAll(b+(c?"."+c:""));if(c&&a.getElementsByClassName){a=a.getElementsByClassName(c);if(b){d={};for(var e=0,f=0,g;g=a[f];f++)b==g.nodeName&&(d[e++]=g);d.length=e;return d}return a}a=a.getElementsByTagName(b||"*");if(c){d={};for(f=e=0;g=a[f];f++)b=g.className,"function"==typeof b.split&&goog.array.contains(b.split(/\s+/),c)&&(d[e++]=g);d.length=
e;return d}return a};goog.dom.$$=goog.dom.getElementsByTagNameAndClass;goog.dom.setProperties=function(a,b){goog.object.forEach(b,function(b,d){"style"==d?a.style.cssText=b:"class"==d?a.className=b:"for"==d?a.htmlFor=b:d in goog.dom.DIRECT_ATTRIBUTE_MAP_?a.setAttribute(goog.dom.DIRECT_ATTRIBUTE_MAP_[d],b):goog.string.startsWith(d,"aria-")||goog.string.startsWith(d,"data-")?a.setAttribute(d,b):a[d]=b})};
goog.dom.DIRECT_ATTRIBUTE_MAP_={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};goog.dom.getViewportSize=function(a){return goog.dom.getViewportSize_(a||window)};goog.dom.getViewportSize_=function(a){a=a.document;a=goog.dom.isCss1CompatMode_(a)?a.documentElement:a.body;return new goog.math.Size(a.clientWidth,a.clientHeight)};
goog.dom.getDocumentHeight=function(){return goog.dom.getDocumentHeight_(window)};goog.dom.getDocumentHeight_=function(a){var b=a.document,c=0;if(b){var c=b.body,d=b.documentElement;if(!d||!c)return 0;a=goog.dom.getViewportSize_(a).height;if(goog.dom.isCss1CompatMode_(b)&&d.scrollHeight)c=d.scrollHeight!=a?d.scrollHeight:d.offsetHeight;else{var b=d.scrollHeight,e=d.offsetHeight;d.clientHeight!=e&&(b=c.scrollHeight,e=c.offsetHeight);c=b>a?b>e?b:e:b<e?b:e}}return c};
goog.dom.getPageScroll=function(a){return goog.dom.getDomHelper((a||goog.global||window).document).getDocumentScroll()};goog.dom.getDocumentScroll=function(){return goog.dom.getDocumentScroll_(document)};
goog.dom.getDocumentScroll_=function(a){var b=goog.dom.getDocumentScrollElement_(a);a=goog.dom.getWindow_(a);return goog.userAgent.IE&&goog.userAgent.isVersionOrHigher("10")&&a.pageYOffset!=b.scrollTop?new goog.math.Coordinate(b.scrollLeft,b.scrollTop):new goog.math.Coordinate(a.pageXOffset||b.scrollLeft,a.pageYOffset||b.scrollTop)};goog.dom.getDocumentScrollElement=function(){return goog.dom.getDocumentScrollElement_(document)};
goog.dom.getDocumentScrollElement_=function(a){return!goog.userAgent.WEBKIT&&goog.dom.isCss1CompatMode_(a)?a.documentElement:a.body||a.documentElement};goog.dom.getWindow=function(a){return a?goog.dom.getWindow_(a):window};goog.dom.getWindow_=function(a){return a.parentWindow||a.defaultView};goog.dom.createDom=function(a,b,c){return goog.dom.createDom_(document,arguments)};
goog.dom.createDom_=function(a,b){var c=b[0],d=b[1];if(!goog.dom.BrowserFeature.CAN_ADD_NAME_OR_TYPE_ATTRIBUTES&&d&&(d.name||d.type)){c=["<",c];d.name&&c.push(' name="',goog.string.htmlEscape(d.name),'"');if(d.type){c.push(' type="',goog.string.htmlEscape(d.type),'"');var e={};goog.object.extend(e,d);delete e.type;d=e}c.push(">");c=c.join("")}c=a.createElement(c);d&&(goog.isString(d)?c.className=d:goog.isArray(d)?c.className=d.join(" "):goog.dom.setProperties(c,d));2<b.length&&goog.dom.append_(a,
c,b,2);return c};goog.dom.append_=function(a,b,c,d){function e(c){c&&b.appendChild(goog.isString(c)?a.createTextNode(c):c)}for(;d<c.length;d++){var f=c[d];goog.isArrayLike(f)&&!goog.dom.isNodeLike(f)?goog.array.forEach(goog.dom.isNodeList(f)?goog.array.toArray(f):f,e):e(f)}};goog.dom.$dom=goog.dom.createDom;goog.dom.createElement=function(a){return document.createElement(a)};goog.dom.createTextNode=function(a){return document.createTextNode(String(a))};
goog.dom.createTable=function(a,b,c){return goog.dom.createTable_(document,a,b,!!c)};goog.dom.createTable_=function(a,b,c,d){for(var e=["<tr>"],f=0;f<c;f++)e.push(d?"<td>&nbsp;</td>":"<td></td>");e.push("</tr>");e=e.join("");c=["<table>"];for(f=0;f<b;f++)c.push(e);c.push("</table>");a=a.createElement(goog.dom.TagName.DIV);a.innerHTML=c.join("");return a.removeChild(a.firstChild)};goog.dom.htmlToDocumentFragment=function(a){return goog.dom.htmlToDocumentFragment_(document,a)};
goog.dom.htmlToDocumentFragment_=function(a,b){var c=a.createElement("div");goog.dom.BrowserFeature.INNER_HTML_NEEDS_SCOPED_ELEMENT?(c.innerHTML="<br>"+b,c.removeChild(c.firstChild)):c.innerHTML=b;if(1==c.childNodes.length)return c.removeChild(c.firstChild);for(var d=a.createDocumentFragment();c.firstChild;)d.appendChild(c.firstChild);return d};goog.dom.isCss1CompatMode=function(){return goog.dom.isCss1CompatMode_(document)};
goog.dom.isCss1CompatMode_=function(a){return goog.dom.COMPAT_MODE_KNOWN_?goog.dom.ASSUME_STANDARDS_MODE:"CSS1Compat"==a.compatMode};goog.dom.canHaveChildren=function(a){if(a.nodeType!=goog.dom.NodeType.ELEMENT)return!1;switch(a.tagName){case goog.dom.TagName.APPLET:case goog.dom.TagName.AREA:case goog.dom.TagName.BASE:case goog.dom.TagName.BR:case goog.dom.TagName.COL:case goog.dom.TagName.COMMAND:case goog.dom.TagName.EMBED:case goog.dom.TagName.FRAME:case goog.dom.TagName.HR:case goog.dom.TagName.IMG:case goog.dom.TagName.INPUT:case goog.dom.TagName.IFRAME:case goog.dom.TagName.ISINDEX:case goog.dom.TagName.KEYGEN:case goog.dom.TagName.LINK:case goog.dom.TagName.NOFRAMES:case goog.dom.TagName.NOSCRIPT:case goog.dom.TagName.META:case goog.dom.TagName.OBJECT:case goog.dom.TagName.PARAM:case goog.dom.TagName.SCRIPT:case goog.dom.TagName.SOURCE:case goog.dom.TagName.STYLE:case goog.dom.TagName.TRACK:case goog.dom.TagName.WBR:return!1}return!0};
goog.dom.appendChild=function(a,b){a.appendChild(b)};goog.dom.append=function(a,b){goog.dom.append_(goog.dom.getOwnerDocument(a),a,arguments,1)};goog.dom.removeChildren=function(a){for(var b;b=a.firstChild;)a.removeChild(b)};goog.dom.insertSiblingBefore=function(a,b){b.parentNode&&b.parentNode.insertBefore(a,b)};goog.dom.insertSiblingAfter=function(a,b){b.parentNode&&b.parentNode.insertBefore(a,b.nextSibling)};goog.dom.insertChildAt=function(a,b,c){a.insertBefore(b,a.childNodes[c]||null)};
goog.dom.removeNode=function(a){return a&&a.parentNode?a.parentNode.removeChild(a):null};goog.dom.replaceNode=function(a,b){var c=b.parentNode;c&&c.replaceChild(a,b)};goog.dom.flattenElement=function(a){var b,c=a.parentNode;if(c&&c.nodeType!=goog.dom.NodeType.DOCUMENT_FRAGMENT){if(a.removeNode)return a.removeNode(!1);for(;b=a.firstChild;)c.insertBefore(b,a);return goog.dom.removeNode(a)}};
goog.dom.getChildren=function(a){return goog.dom.BrowserFeature.CAN_USE_CHILDREN_ATTRIBUTE&&void 0!=a.children?a.children:goog.array.filter(a.childNodes,function(a){return a.nodeType==goog.dom.NodeType.ELEMENT})};goog.dom.getFirstElementChild=function(a){return void 0!=a.firstElementChild?a.firstElementChild:goog.dom.getNextElementNode_(a.firstChild,!0)};goog.dom.getLastElementChild=function(a){return void 0!=a.lastElementChild?a.lastElementChild:goog.dom.getNextElementNode_(a.lastChild,!1)};
goog.dom.getNextElementSibling=function(a){return void 0!=a.nextElementSibling?a.nextElementSibling:goog.dom.getNextElementNode_(a.nextSibling,!0)};goog.dom.getPreviousElementSibling=function(a){return void 0!=a.previousElementSibling?a.previousElementSibling:goog.dom.getNextElementNode_(a.previousSibling,!1)};goog.dom.getNextElementNode_=function(a,b){for(;a&&a.nodeType!=goog.dom.NodeType.ELEMENT;)a=b?a.nextSibling:a.previousSibling;return a};
goog.dom.getNextNode=function(a){if(!a)return null;if(a.firstChild)return a.firstChild;for(;a&&!a.nextSibling;)a=a.parentNode;return a?a.nextSibling:null};goog.dom.getPreviousNode=function(a){if(!a)return null;if(!a.previousSibling)return a.parentNode;for(a=a.previousSibling;a&&a.lastChild;)a=a.lastChild;return a};goog.dom.isNodeLike=function(a){return goog.isObject(a)&&0<a.nodeType};goog.dom.isElement=function(a){return goog.isObject(a)&&a.nodeType==goog.dom.NodeType.ELEMENT};
goog.dom.isWindow=function(a){return goog.isObject(a)&&a.window==a};goog.dom.getParentElement=function(a){var b;if(goog.dom.BrowserFeature.CAN_USE_PARENT_ELEMENT_PROPERTY&&!(goog.userAgent.IE&&goog.userAgent.isVersionOrHigher("9")&&!goog.userAgent.isVersionOrHigher("10")&&goog.global.SVGElement&&a instanceof goog.global.SVGElement)&&(b=a.parentElement))return b;b=a.parentNode;return goog.dom.isElement(b)?b:null};
goog.dom.contains=function(a,b){if(a.contains&&b.nodeType==goog.dom.NodeType.ELEMENT)return a==b||a.contains(b);if("undefined"!=typeof a.compareDocumentPosition)return a==b||Boolean(a.compareDocumentPosition(b)&16);for(;b&&a!=b;)b=b.parentNode;return b==a};
goog.dom.compareNodeOrder=function(a,b){if(a==b)return 0;if(a.compareDocumentPosition)return a.compareDocumentPosition(b)&2?1:-1;if(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(9)){if(a.nodeType==goog.dom.NodeType.DOCUMENT)return-1;if(b.nodeType==goog.dom.NodeType.DOCUMENT)return 1}if("sourceIndex"in a||a.parentNode&&"sourceIndex"in a.parentNode){var c=a.nodeType==goog.dom.NodeType.ELEMENT,d=b.nodeType==goog.dom.NodeType.ELEMENT;if(c&&d)return a.sourceIndex-b.sourceIndex;var e=a.parentNode,
f=b.parentNode;return e==f?goog.dom.compareSiblingOrder_(a,b):!c&&goog.dom.contains(e,b)?-1*goog.dom.compareParentsDescendantNodeIe_(a,b):!d&&goog.dom.contains(f,a)?goog.dom.compareParentsDescendantNodeIe_(b,a):(c?a.sourceIndex:e.sourceIndex)-(d?b.sourceIndex:f.sourceIndex)}d=goog.dom.getOwnerDocument(a);c=d.createRange();c.selectNode(a);c.collapse(!0);d=d.createRange();d.selectNode(b);d.collapse(!0);return c.compareBoundaryPoints(goog.global.Range.START_TO_END,d)};
goog.dom.compareParentsDescendantNodeIe_=function(a,b){var c=a.parentNode;if(c==b)return-1;for(var d=b;d.parentNode!=c;)d=d.parentNode;return goog.dom.compareSiblingOrder_(d,a)};goog.dom.compareSiblingOrder_=function(a,b){for(var c=b;c=c.previousSibling;)if(c==a)return-1;return 1};
goog.dom.findCommonAncestor=function(a){var b,c=arguments.length;if(!c)return null;if(1==c)return arguments[0];var d=[],e=Infinity;for(b=0;b<c;b++){for(var f=[],g=arguments[b];g;)f.unshift(g),g=g.parentNode;d.push(f);e=Math.min(e,f.length)}f=null;for(b=0;b<e;b++){for(var g=d[0][b],h=1;h<c;h++)if(g!=d[h][b])return f;f=g}return f};goog.dom.getOwnerDocument=function(a){goog.asserts.assert(a,"Node cannot be null or undefined.");return a.nodeType==goog.dom.NodeType.DOCUMENT?a:a.ownerDocument||a.document};
goog.dom.getFrameContentDocument=function(a){return a.contentDocument||a.contentWindow.document};goog.dom.getFrameContentWindow=function(a){return a.contentWindow||goog.dom.getWindow(goog.dom.getFrameContentDocument(a))};
goog.dom.setTextContent=function(a,b){goog.asserts.assert(null!=a,"goog.dom.setTextContent expects a non-null value for node");if("textContent"in a)a.textContent=b;else if(a.nodeType==goog.dom.NodeType.TEXT)a.data=b;else if(a.firstChild&&a.firstChild.nodeType==goog.dom.NodeType.TEXT){for(;a.lastChild!=a.firstChild;)a.removeChild(a.lastChild);a.firstChild.data=b}else{goog.dom.removeChildren(a);var c=goog.dom.getOwnerDocument(a);a.appendChild(c.createTextNode(String(b)))}};
goog.dom.getOuterHtml=function(a){if("outerHTML"in a)return a.outerHTML;var b=goog.dom.getOwnerDocument(a).createElement("div");b.appendChild(a.cloneNode(!0));return b.innerHTML};goog.dom.findNode=function(a,b){var c=[];return goog.dom.findNodes_(a,b,c,!0)?c[0]:void 0};goog.dom.findNodes=function(a,b){var c=[];goog.dom.findNodes_(a,b,c,!1);return c};goog.dom.findNodes_=function(a,b,c,d){if(null!=a)for(a=a.firstChild;a;){if(b(a)&&(c.push(a),d)||goog.dom.findNodes_(a,b,c,d))return!0;a=a.nextSibling}return!1};
goog.dom.TAGS_TO_IGNORE_={SCRIPT:1,STYLE:1,HEAD:1,IFRAME:1,OBJECT:1};goog.dom.PREDEFINED_TAG_VALUES_={IMG:" ",BR:"\n"};goog.dom.isFocusableTabIndex=function(a){return goog.dom.hasSpecifiedTabIndex_(a)&&goog.dom.isTabIndexFocusable_(a)};goog.dom.setFocusableTabIndex=function(a,b){b?a.tabIndex=0:(a.tabIndex=-1,a.removeAttribute("tabIndex"))};
goog.dom.isFocusable=function(a){var b;return(b=goog.dom.nativelySupportsFocus_(a)?!a.disabled&&(!goog.dom.hasSpecifiedTabIndex_(a)||goog.dom.isTabIndexFocusable_(a)):goog.dom.isFocusableTabIndex(a))&&goog.userAgent.IE?goog.dom.hasNonZeroBoundingRect_(a):b};goog.dom.hasSpecifiedTabIndex_=function(a){a=a.getAttributeNode("tabindex");return goog.isDefAndNotNull(a)&&a.specified};goog.dom.isTabIndexFocusable_=function(a){a=a.tabIndex;return goog.isNumber(a)&&0<=a&&32768>a};
goog.dom.nativelySupportsFocus_=function(a){return a.tagName==goog.dom.TagName.A||a.tagName==goog.dom.TagName.INPUT||a.tagName==goog.dom.TagName.TEXTAREA||a.tagName==goog.dom.TagName.SELECT||a.tagName==goog.dom.TagName.BUTTON};goog.dom.hasNonZeroBoundingRect_=function(a){a=goog.isFunction(a.getBoundingClientRect)?a.getBoundingClientRect():{height:a.offsetHeight,width:a.offsetWidth};return goog.isDefAndNotNull(a)&&0<a.height&&0<a.width};
goog.dom.getTextContent=function(a){if(goog.dom.BrowserFeature.CAN_USE_INNER_TEXT&&"innerText"in a)a=goog.string.canonicalizeNewlines(a.innerText);else{var b=[];goog.dom.getTextContent_(a,b,!0);a=b.join("")}a=a.replace(/ \xAD /g," ").replace(/\xAD/g,"");a=a.replace(/\u200B/g,"");goog.dom.BrowserFeature.CAN_USE_INNER_TEXT||(a=a.replace(/ +/g," "));" "!=a&&(a=a.replace(/^\s*/,""));return a};goog.dom.getRawTextContent=function(a){var b=[];goog.dom.getTextContent_(a,b,!1);return b.join("")};
goog.dom.getTextContent_=function(a,b,c){if(!(a.nodeName in goog.dom.TAGS_TO_IGNORE_))if(a.nodeType==goog.dom.NodeType.TEXT)c?b.push(String(a.nodeValue).replace(/(\r\n|\r|\n)/g,"")):b.push(a.nodeValue);else if(a.nodeName in goog.dom.PREDEFINED_TAG_VALUES_)b.push(goog.dom.PREDEFINED_TAG_VALUES_[a.nodeName]);else for(a=a.firstChild;a;)goog.dom.getTextContent_(a,b,c),a=a.nextSibling};goog.dom.getNodeTextLength=function(a){return goog.dom.getTextContent(a).length};
goog.dom.getNodeTextOffset=function(a,b){for(var c=b||goog.dom.getOwnerDocument(a).body,d=[];a&&a!=c;){for(var e=a;e=e.previousSibling;)d.unshift(goog.dom.getTextContent(e));a=a.parentNode}return goog.string.trimLeft(d.join("")).replace(/ +/g," ").length};
goog.dom.getNodeAtOffset=function(a,b,c){a=[a];for(var d=0,e=null;0<a.length&&d<b;)if(e=a.pop(),!(e.nodeName in goog.dom.TAGS_TO_IGNORE_))if(e.nodeType==goog.dom.NodeType.TEXT)var f=e.nodeValue.replace(/(\r\n|\r|\n)/g,"").replace(/ +/g," "),d=d+f.length;else if(e.nodeName in goog.dom.PREDEFINED_TAG_VALUES_)d+=goog.dom.PREDEFINED_TAG_VALUES_[e.nodeName].length;else for(f=e.childNodes.length-1;0<=f;f--)a.push(e.childNodes[f]);goog.isObject(c)&&(c.remainder=e?e.nodeValue.length+b-d-1:0,c.node=e);return e};
goog.dom.isNodeList=function(a){if(a&&"number"==typeof a.length){if(goog.isObject(a))return"function"==typeof a.item||"string"==typeof a.item;if(goog.isFunction(a))return"function"==typeof a.item}return!1};goog.dom.getAncestorByTagNameAndClass=function(a,b,c,d){if(!b&&!c)return null;var e=b?b.toUpperCase():null;return goog.dom.getAncestor(a,function(a){return(!e||a.nodeName==e)&&(!c||goog.isString(a.className)&&goog.array.contains(a.className.split(/\s+/),c))},!0,d)};
goog.dom.getAncestorByClass=function(a,b,c){return goog.dom.getAncestorByTagNameAndClass(a,null,b,c)};goog.dom.getAncestor=function(a,b,c,d){c||(a=a.parentNode);c=null==d;for(var e=0;a&&(c||e<=d);){if(b(a))return a;a=a.parentNode;e++}return null};goog.dom.getActiveElement=function(a){try{return a&&a.activeElement}catch(b){}return null};
goog.dom.getPixelRatio=function(){var a=goog.dom.getWindow(),b=goog.userAgent.GECKO&&goog.userAgent.MOBILE;return goog.isDef(a.devicePixelRatio)&&!b?a.devicePixelRatio:a.matchMedia?goog.dom.matchesPixelRatio_(0.75)||goog.dom.matchesPixelRatio_(1.5)||goog.dom.matchesPixelRatio_(2)||goog.dom.matchesPixelRatio_(3)||1:1};
goog.dom.matchesPixelRatio_=function(a){return goog.dom.getWindow().matchMedia("(-webkit-min-device-pixel-ratio: "+a+"),(min--moz-device-pixel-ratio: "+a+"),(min-resolution: "+a+"dppx)").matches?a:0};goog.dom.DomHelper=function(a){this.document_=a||goog.global.document||document};goog.dom.DomHelper.prototype.getDomHelper=goog.dom.getDomHelper;goog.dom.DomHelper.prototype.setDocument=function(a){this.document_=a};goog.dom.DomHelper.prototype.getDocument=function(){return this.document_};
goog.dom.DomHelper.prototype.getElement=function(a){return goog.dom.getElementHelper_(this.document_,a)};goog.dom.DomHelper.prototype.getRequiredElement=function(a){return goog.dom.getRequiredElementHelper_(this.document_,a)};goog.dom.DomHelper.prototype.$=goog.dom.DomHelper.prototype.getElement;goog.dom.DomHelper.prototype.getElementsByTagNameAndClass=function(a,b,c){return goog.dom.getElementsByTagNameAndClass_(this.document_,a,b,c)};
goog.dom.DomHelper.prototype.getElementsByClass=function(a,b){return goog.dom.getElementsByClass(a,b||this.document_)};goog.dom.DomHelper.prototype.getElementByClass=function(a,b){return goog.dom.getElementByClass(a,b||this.document_)};goog.dom.DomHelper.prototype.getRequiredElementByClass=function(a,b){return goog.dom.getRequiredElementByClass(a,b||this.document_)};goog.dom.DomHelper.prototype.$$=goog.dom.DomHelper.prototype.getElementsByTagNameAndClass;
goog.dom.DomHelper.prototype.setProperties=goog.dom.setProperties;goog.dom.DomHelper.prototype.getViewportSize=function(a){return goog.dom.getViewportSize(a||this.getWindow())};goog.dom.DomHelper.prototype.getDocumentHeight=function(){return goog.dom.getDocumentHeight_(this.getWindow())};goog.dom.DomHelper.prototype.createDom=function(a,b,c){return goog.dom.createDom_(this.document_,arguments)};goog.dom.DomHelper.prototype.$dom=goog.dom.DomHelper.prototype.createDom;
goog.dom.DomHelper.prototype.createElement=function(a){return this.document_.createElement(a)};goog.dom.DomHelper.prototype.createTextNode=function(a){return this.document_.createTextNode(String(a))};goog.dom.DomHelper.prototype.createTable=function(a,b,c){return goog.dom.createTable_(this.document_,a,b,!!c)};goog.dom.DomHelper.prototype.htmlToDocumentFragment=function(a){return goog.dom.htmlToDocumentFragment_(this.document_,a)};goog.dom.DomHelper.prototype.isCss1CompatMode=function(){return goog.dom.isCss1CompatMode_(this.document_)};
goog.dom.DomHelper.prototype.getWindow=function(){return goog.dom.getWindow_(this.document_)};goog.dom.DomHelper.prototype.getDocumentScrollElement=function(){return goog.dom.getDocumentScrollElement_(this.document_)};goog.dom.DomHelper.prototype.getDocumentScroll=function(){return goog.dom.getDocumentScroll_(this.document_)};goog.dom.DomHelper.prototype.getActiveElement=function(a){return goog.dom.getActiveElement(a||this.document_)};goog.dom.DomHelper.prototype.appendChild=goog.dom.appendChild;
goog.dom.DomHelper.prototype.append=goog.dom.append;goog.dom.DomHelper.prototype.canHaveChildren=goog.dom.canHaveChildren;goog.dom.DomHelper.prototype.removeChildren=goog.dom.removeChildren;goog.dom.DomHelper.prototype.insertSiblingBefore=goog.dom.insertSiblingBefore;goog.dom.DomHelper.prototype.insertSiblingAfter=goog.dom.insertSiblingAfter;goog.dom.DomHelper.prototype.insertChildAt=goog.dom.insertChildAt;goog.dom.DomHelper.prototype.removeNode=goog.dom.removeNode;
goog.dom.DomHelper.prototype.replaceNode=goog.dom.replaceNode;goog.dom.DomHelper.prototype.flattenElement=goog.dom.flattenElement;goog.dom.DomHelper.prototype.getChildren=goog.dom.getChildren;goog.dom.DomHelper.prototype.getFirstElementChild=goog.dom.getFirstElementChild;goog.dom.DomHelper.prototype.getLastElementChild=goog.dom.getLastElementChild;goog.dom.DomHelper.prototype.getNextElementSibling=goog.dom.getNextElementSibling;goog.dom.DomHelper.prototype.getPreviousElementSibling=goog.dom.getPreviousElementSibling;
goog.dom.DomHelper.prototype.getNextNode=goog.dom.getNextNode;goog.dom.DomHelper.prototype.getPreviousNode=goog.dom.getPreviousNode;goog.dom.DomHelper.prototype.isNodeLike=goog.dom.isNodeLike;goog.dom.DomHelper.prototype.isElement=goog.dom.isElement;goog.dom.DomHelper.prototype.isWindow=goog.dom.isWindow;goog.dom.DomHelper.prototype.getParentElement=goog.dom.getParentElement;goog.dom.DomHelper.prototype.contains=goog.dom.contains;goog.dom.DomHelper.prototype.compareNodeOrder=goog.dom.compareNodeOrder;
goog.dom.DomHelper.prototype.findCommonAncestor=goog.dom.findCommonAncestor;goog.dom.DomHelper.prototype.getOwnerDocument=goog.dom.getOwnerDocument;goog.dom.DomHelper.prototype.getFrameContentDocument=goog.dom.getFrameContentDocument;goog.dom.DomHelper.prototype.getFrameContentWindow=goog.dom.getFrameContentWindow;goog.dom.DomHelper.prototype.setTextContent=goog.dom.setTextContent;goog.dom.DomHelper.prototype.getOuterHtml=goog.dom.getOuterHtml;goog.dom.DomHelper.prototype.findNode=goog.dom.findNode;
goog.dom.DomHelper.prototype.findNodes=goog.dom.findNodes;goog.dom.DomHelper.prototype.isFocusableTabIndex=goog.dom.isFocusableTabIndex;goog.dom.DomHelper.prototype.setFocusableTabIndex=goog.dom.setFocusableTabIndex;goog.dom.DomHelper.prototype.isFocusable=goog.dom.isFocusable;goog.dom.DomHelper.prototype.getTextContent=goog.dom.getTextContent;goog.dom.DomHelper.prototype.getNodeTextLength=goog.dom.getNodeTextLength;goog.dom.DomHelper.prototype.getNodeTextOffset=goog.dom.getNodeTextOffset;
goog.dom.DomHelper.prototype.getNodeAtOffset=goog.dom.getNodeAtOffset;goog.dom.DomHelper.prototype.isNodeList=goog.dom.isNodeList;goog.dom.DomHelper.prototype.getAncestorByTagNameAndClass=goog.dom.getAncestorByTagNameAndClass;goog.dom.DomHelper.prototype.getAncestorByClass=goog.dom.getAncestorByClass;goog.dom.DomHelper.prototype.getAncestor=goog.dom.getAncestor;goog.dom.vendor={};
goog.dom.vendor.getVendorJsPrefix=function(){return goog.userAgent.WEBKIT?"Webkit":goog.userAgent.GECKO?"Moz":goog.userAgent.IE?"ms":goog.userAgent.OPERA?"O":null};goog.dom.vendor.getVendorPrefix=function(){return goog.userAgent.WEBKIT?"-webkit":goog.userAgent.GECKO?"-moz":goog.userAgent.IE?"-ms":goog.userAgent.OPERA?"-o":null};
goog.dom.vendor.getPrefixedPropertyName=function(a,b){if(b&&a in b)return a;var c=goog.dom.vendor.getVendorJsPrefix();return c?(c=c.toLowerCase(),c+=goog.string.toTitleCase(a),!goog.isDef(b)||c in b?c:null):null};goog.dom.vendor.getPrefixedEventType=function(a){return((goog.dom.vendor.getVendorJsPrefix()||"")+a).toLowerCase()};goog.math.Box=function(a,b,c,d){this.top=a;this.right=b;this.bottom=c;this.left=d};
goog.math.Box.boundingBox=function(a){for(var b=new goog.math.Box(arguments[0].y,arguments[0].x,arguments[0].y,arguments[0].x),c=1;c<arguments.length;c++){var d=arguments[c];b.top=Math.min(b.top,d.y);b.right=Math.max(b.right,d.x);b.bottom=Math.max(b.bottom,d.y);b.left=Math.min(b.left,d.x)}return b};goog.math.Box.prototype.getWidth=function(){return this.right-this.left};goog.math.Box.prototype.getHeight=function(){return this.bottom-this.top};
goog.math.Box.prototype.clone=function(){return new goog.math.Box(this.top,this.right,this.bottom,this.left)};goog.DEBUG&&(goog.math.Box.prototype.toString=function(){return"("+this.top+"t, "+this.right+"r, "+this.bottom+"b, "+this.left+"l)"});goog.math.Box.prototype.contains=function(a){return goog.math.Box.contains(this,a)};
goog.math.Box.prototype.expand=function(a,b,c,d){goog.isObject(a)?(this.top-=a.top,this.right+=a.right,this.bottom+=a.bottom,this.left-=a.left):(this.top-=a,this.right+=b,this.bottom+=c,this.left-=d);return this};goog.math.Box.prototype.expandToInclude=function(a){this.left=Math.min(this.left,a.left);this.top=Math.min(this.top,a.top);this.right=Math.max(this.right,a.right);this.bottom=Math.max(this.bottom,a.bottom)};
goog.math.Box.equals=function(a,b){return a==b?!0:a&&b?a.top==b.top&&a.right==b.right&&a.bottom==b.bottom&&a.left==b.left:!1};goog.math.Box.contains=function(a,b){return a&&b?b instanceof goog.math.Box?b.left>=a.left&&b.right<=a.right&&b.top>=a.top&&b.bottom<=a.bottom:b.x>=a.left&&b.x<=a.right&&b.y>=a.top&&b.y<=a.bottom:!1};goog.math.Box.relativePositionX=function(a,b){return b.x<a.left?b.x-a.left:b.x>a.right?b.x-a.right:0};
goog.math.Box.relativePositionY=function(a,b){return b.y<a.top?b.y-a.top:b.y>a.bottom?b.y-a.bottom:0};goog.math.Box.distance=function(a,b){var c=goog.math.Box.relativePositionX(a,b),d=goog.math.Box.relativePositionY(a,b);return Math.sqrt(c*c+d*d)};goog.math.Box.intersects=function(a,b){return a.left<=b.right&&b.left<=a.right&&a.top<=b.bottom&&b.top<=a.bottom};goog.math.Box.intersectsWithPadding=function(a,b,c){return a.left<=b.right+c&&b.left<=a.right+c&&a.top<=b.bottom+c&&b.top<=a.bottom+c};
goog.math.Box.prototype.ceil=function(){this.top=Math.ceil(this.top);this.right=Math.ceil(this.right);this.bottom=Math.ceil(this.bottom);this.left=Math.ceil(this.left);return this};goog.math.Box.prototype.floor=function(){this.top=Math.floor(this.top);this.right=Math.floor(this.right);this.bottom=Math.floor(this.bottom);this.left=Math.floor(this.left);return this};
goog.math.Box.prototype.round=function(){this.top=Math.round(this.top);this.right=Math.round(this.right);this.bottom=Math.round(this.bottom);this.left=Math.round(this.left);return this};goog.math.Box.prototype.translate=function(a,b){a instanceof goog.math.Coordinate?(this.left+=a.x,this.right+=a.x,this.top+=a.y,this.bottom+=a.y):(this.left+=a,this.right+=a,goog.isNumber(b)&&(this.top+=b,this.bottom+=b));return this};
goog.math.Box.prototype.scale=function(a,b){var c=goog.isNumber(b)?b:a;this.left*=a;this.right*=a;this.top*=c;this.bottom*=c;return this};goog.math.Rect=function(a,b,c,d){this.left=a;this.top=b;this.width=c;this.height=d};goog.math.Rect.prototype.clone=function(){return new goog.math.Rect(this.left,this.top,this.width,this.height)};goog.math.Rect.prototype.toBox=function(){return new goog.math.Box(this.top,this.left+this.width,this.top+this.height,this.left)};
goog.math.Rect.createFromBox=function(a){return new goog.math.Rect(a.left,a.top,a.right-a.left,a.bottom-a.top)};goog.DEBUG&&(goog.math.Rect.prototype.toString=function(){return"("+this.left+", "+this.top+" - "+this.width+"w x "+this.height+"h)"});goog.math.Rect.equals=function(a,b){return a==b?!0:a&&b?a.left==b.left&&a.width==b.width&&a.top==b.top&&a.height==b.height:!1};
goog.math.Rect.prototype.intersection=function(a){var b=Math.max(this.left,a.left),c=Math.min(this.left+this.width,a.left+a.width);if(b<=c){var d=Math.max(this.top,a.top);a=Math.min(this.top+this.height,a.top+a.height);if(d<=a)return this.left=b,this.top=d,this.width=c-b,this.height=a-d,!0}return!1};
goog.math.Rect.intersection=function(a,b){var c=Math.max(a.left,b.left),d=Math.min(a.left+a.width,b.left+b.width);if(c<=d){var e=Math.max(a.top,b.top),f=Math.min(a.top+a.height,b.top+b.height);if(e<=f)return new goog.math.Rect(c,e,d-c,f-e)}return null};goog.math.Rect.intersects=function(a,b){return a.left<=b.left+b.width&&b.left<=a.left+a.width&&a.top<=b.top+b.height&&b.top<=a.top+a.height};goog.math.Rect.prototype.intersects=function(a){return goog.math.Rect.intersects(this,a)};
goog.math.Rect.difference=function(a,b){var c=goog.math.Rect.intersection(a,b);if(!c||!c.height||!c.width)return[a.clone()];var c=[],d=a.top,e=a.height,f=a.left+a.width,g=a.top+a.height,h=b.left+b.width,k=b.top+b.height;b.top>a.top&&(c.push(new goog.math.Rect(a.left,a.top,a.width,b.top-a.top)),d=b.top,e-=b.top-a.top);k<g&&(c.push(new goog.math.Rect(a.left,k,a.width,g-k)),e=k-d);b.left>a.left&&c.push(new goog.math.Rect(a.left,d,b.left-a.left,e));h<f&&c.push(new goog.math.Rect(h,d,f-h,e));return c};
goog.math.Rect.prototype.difference=function(a){return goog.math.Rect.difference(this,a)};goog.math.Rect.prototype.boundingRect=function(a){var b=Math.max(this.left+this.width,a.left+a.width),c=Math.max(this.top+this.height,a.top+a.height);this.left=Math.min(this.left,a.left);this.top=Math.min(this.top,a.top);this.width=b-this.left;this.height=c-this.top};goog.math.Rect.boundingRect=function(a,b){if(!a||!b)return null;var c=a.clone();c.boundingRect(b);return c};
goog.math.Rect.prototype.contains=function(a){return a instanceof goog.math.Rect?this.left<=a.left&&this.left+this.width>=a.left+a.width&&this.top<=a.top&&this.top+this.height>=a.top+a.height:a.x>=this.left&&a.x<=this.left+this.width&&a.y>=this.top&&a.y<=this.top+this.height};goog.math.Rect.prototype.squaredDistance=function(a){var b=a.x<this.left?this.left-a.x:Math.max(a.x-(this.left+this.width),0);a=a.y<this.top?this.top-a.y:Math.max(a.y-(this.top+this.height),0);return b*b+a*a};
goog.math.Rect.prototype.distance=function(a){return Math.sqrt(this.squaredDistance(a))};goog.math.Rect.prototype.getSize=function(){return new goog.math.Size(this.width,this.height)};goog.math.Rect.prototype.getTopLeft=function(){return new goog.math.Coordinate(this.left,this.top)};goog.math.Rect.prototype.getCenter=function(){return new goog.math.Coordinate(this.left+this.width/2,this.top+this.height/2)};
goog.math.Rect.prototype.getBottomRight=function(){return new goog.math.Coordinate(this.left+this.width,this.top+this.height)};goog.math.Rect.prototype.ceil=function(){this.left=Math.ceil(this.left);this.top=Math.ceil(this.top);this.width=Math.ceil(this.width);this.height=Math.ceil(this.height);return this};goog.math.Rect.prototype.floor=function(){this.left=Math.floor(this.left);this.top=Math.floor(this.top);this.width=Math.floor(this.width);this.height=Math.floor(this.height);return this};
goog.math.Rect.prototype.round=function(){this.left=Math.round(this.left);this.top=Math.round(this.top);this.width=Math.round(this.width);this.height=Math.round(this.height);return this};goog.math.Rect.prototype.translate=function(a,b){a instanceof goog.math.Coordinate?(this.left+=a.x,this.top+=a.y):(this.left+=a,goog.isNumber(b)&&(this.top+=b));return this};goog.math.Rect.prototype.scale=function(a,b){var c=goog.isNumber(b)?b:a;this.left*=a;this.width*=a;this.top*=c;this.height*=c;return this};
goog.style={};goog.style.GET_BOUNDING_CLIENT_RECT_ALWAYS_EXISTS=!1;goog.style.setStyle=function(a,b,c){if(goog.isString(b))goog.style.setStyle_(a,c,b);else for(var d in b)goog.style.setStyle_(a,b[d],d)};goog.style.setStyle_=function(a,b,c){(c=goog.style.getVendorJsStyleName_(a,c))&&(a.style[c]=b)};goog.style.getVendorJsStyleName_=function(a,b){var c=goog.string.toCamelCase(b);if(void 0===a.style[c]){var d=goog.dom.vendor.getVendorJsPrefix()+goog.string.toTitleCase(c);if(void 0!==a.style[d])return d}return c};
goog.style.getVendorStyleName_=function(a,b){var c=goog.string.toCamelCase(b);return void 0===a.style[c]&&(c=goog.dom.vendor.getVendorJsPrefix()+goog.string.toTitleCase(c),void 0!==a.style[c])?goog.dom.vendor.getVendorPrefix()+"-"+b:b};goog.style.getStyle=function(a,b){var c=a.style[goog.string.toCamelCase(b)];return"undefined"!==typeof c?c:a.style[goog.style.getVendorJsStyleName_(a,b)]||""};
goog.style.getComputedStyle=function(a,b){var c=goog.dom.getOwnerDocument(a);return c.defaultView&&c.defaultView.getComputedStyle&&(c=c.defaultView.getComputedStyle(a,null))?c[b]||c.getPropertyValue(b)||"":""};goog.style.getCascadedStyle=function(a,b){return a.currentStyle?a.currentStyle[b]:null};goog.style.getStyle_=function(a,b){return goog.style.getComputedStyle(a,b)||goog.style.getCascadedStyle(a,b)||a.style&&a.style[b]};
goog.style.getComputedBoxSizing=function(a){return goog.style.getStyle_(a,"boxSizing")||goog.style.getStyle_(a,"MozBoxSizing")||goog.style.getStyle_(a,"WebkitBoxSizing")||null};goog.style.getComputedPosition=function(a){return goog.style.getStyle_(a,"position")};goog.style.getBackgroundColor=function(a){return goog.style.getStyle_(a,"backgroundColor")};goog.style.getComputedOverflowX=function(a){return goog.style.getStyle_(a,"overflowX")};
goog.style.getComputedOverflowY=function(a){return goog.style.getStyle_(a,"overflowY")};goog.style.getComputedZIndex=function(a){return goog.style.getStyle_(a,"zIndex")};goog.style.getComputedTextAlign=function(a){return goog.style.getStyle_(a,"textAlign")};goog.style.getComputedCursor=function(a){return goog.style.getStyle_(a,"cursor")};goog.style.getComputedTransform=function(a){var b=goog.style.getVendorStyleName_(a,"transform");return goog.style.getStyle_(a,b)||goog.style.getStyle_(a,"transform")};
goog.style.setPosition=function(a,b,c){var d,e=goog.userAgent.GECKO&&(goog.userAgent.MAC||goog.userAgent.X11)&&goog.userAgent.isVersionOrHigher("1.9");b instanceof goog.math.Coordinate?(d=b.x,b=b.y):(d=b,b=c);a.style.left=goog.style.getPixelStyleValue_(d,e);a.style.top=goog.style.getPixelStyleValue_(b,e)};goog.style.getPosition=function(a){return new goog.math.Coordinate(a.offsetLeft,a.offsetTop)};
goog.style.getClientViewportElement=function(a){a=a?goog.dom.getOwnerDocument(a):goog.dom.getDocument();return!goog.userAgent.IE||goog.userAgent.isDocumentModeOrHigher(9)||goog.dom.getDomHelper(a).isCss1CompatMode()?a.documentElement:a.body};goog.style.getViewportPageOffset=function(a){var b=a.body;a=a.documentElement;return new goog.math.Coordinate(b.scrollLeft||a.scrollLeft,b.scrollTop||a.scrollTop)};
goog.style.getBoundingClientRect_=function(a){var b;try{b=a.getBoundingClientRect()}catch(c){return{left:0,top:0,right:0,bottom:0}}goog.userAgent.IE&&a.ownerDocument.body&&(a=a.ownerDocument,b.left-=a.documentElement.clientLeft+a.body.clientLeft,b.top-=a.documentElement.clientTop+a.body.clientTop);return b};
goog.style.getOffsetParent=function(a){if(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(8))return a.offsetParent;var b=goog.dom.getOwnerDocument(a),c=goog.style.getStyle_(a,"position"),d="fixed"==c||"absolute"==c;for(a=a.parentNode;a&&a!=b;a=a.parentNode)if(c=goog.style.getStyle_(a,"position"),d=d&&"static"==c&&a!=b.documentElement&&a!=b.body,!d&&(a.scrollWidth>a.clientWidth||a.scrollHeight>a.clientHeight||"fixed"==c||"absolute"==c||"relative"==c))return a;return null};
goog.style.getVisibleRectForElement=function(a){for(var b=new goog.math.Box(0,Infinity,Infinity,0),c=goog.dom.getDomHelper(a),d=c.getDocument().body,e=c.getDocument().documentElement,f=c.getDocumentScrollElement();a=goog.style.getOffsetParent(a);)if(!(goog.userAgent.IE&&0==a.clientWidth||goog.userAgent.WEBKIT&&0==a.clientHeight&&a==d||a==d||a==e||"visible"==goog.style.getStyle_(a,"overflow"))){var g=goog.style.getPageOffset(a),h=goog.style.getClientLeftTop(a);g.x+=h.x;g.y+=h.y;b.top=Math.max(b.top,
g.y);b.right=Math.min(b.right,g.x+a.clientWidth);b.bottom=Math.min(b.bottom,g.y+a.clientHeight);b.left=Math.max(b.left,g.x)}d=f.scrollLeft;f=f.scrollTop;b.left=Math.max(b.left,d);b.top=Math.max(b.top,f);c=c.getViewportSize();b.right=Math.min(b.right,d+c.width);b.bottom=Math.min(b.bottom,f+c.height);return 0<=b.top&&0<=b.left&&b.bottom>b.top&&b.right>b.left?b:null};
goog.style.getContainerOffsetToScrollInto=function(a,b,c){var d=goog.style.getPageOffset(a),e=goog.style.getPageOffset(b),f=goog.style.getBorderBox(b),g=d.x-e.x-f.left,d=d.y-e.y-f.top,e=b.clientWidth-a.offsetWidth;a=b.clientHeight-a.offsetHeight;f=b.scrollLeft;b=b.scrollTop;c?(f+=g-e/2,b+=d-a/2):(f+=Math.min(g,Math.max(g-e,0)),b+=Math.min(d,Math.max(d-a,0)));return new goog.math.Coordinate(f,b)};
goog.style.scrollIntoContainerView=function(a,b,c){a=goog.style.getContainerOffsetToScrollInto(a,b,c);b.scrollLeft=a.x;b.scrollTop=a.y};
goog.style.getClientLeftTop=function(a){if(goog.userAgent.GECKO&&!goog.userAgent.isVersionOrHigher("1.9")){var b=parseFloat(goog.style.getComputedStyle(a,"borderLeftWidth"));if(goog.style.isRightToLeft(a))var c=a.offsetWidth-a.clientWidth-b-parseFloat(goog.style.getComputedStyle(a,"borderRightWidth")),b=b+c;return new goog.math.Coordinate(b,parseFloat(goog.style.getComputedStyle(a,"borderTopWidth")))}return new goog.math.Coordinate(a.clientLeft,a.clientTop)};
goog.style.getPageOffset=function(a){var b,c=goog.dom.getOwnerDocument(a),d=goog.style.getStyle_(a,"position");goog.asserts.assertObject(a,"Parameter is required");var e=!goog.style.GET_BOUNDING_CLIENT_RECT_ALWAYS_EXISTS&&goog.userAgent.GECKO&&c.getBoxObjectFor&&!a.getBoundingClientRect&&"absolute"==d&&(b=c.getBoxObjectFor(a))&&(0>b.screenX||0>b.screenY),f=new goog.math.Coordinate(0,0),g=goog.style.getClientViewportElement(c);if(a==g)return f;if(goog.style.GET_BOUNDING_CLIENT_RECT_ALWAYS_EXISTS||
a.getBoundingClientRect)b=goog.style.getBoundingClientRect_(a),a=goog.dom.getDomHelper(c).getDocumentScroll(),f.x=b.left+a.x,f.y=b.top+a.y;else if(c.getBoxObjectFor&&!e)b=c.getBoxObjectFor(a),a=c.getBoxObjectFor(g),f.x=b.screenX-a.screenX,f.y=b.screenY-a.screenY;else{b=a;do{f.x+=b.offsetLeft;f.y+=b.offsetTop;b!=a&&(f.x+=b.clientLeft||0,f.y+=b.clientTop||0);if(goog.userAgent.WEBKIT&&"fixed"==goog.style.getComputedPosition(b)){f.x+=c.body.scrollLeft;f.y+=c.body.scrollTop;break}b=b.offsetParent}while(b&&
b!=a);if(goog.userAgent.OPERA||goog.userAgent.WEBKIT&&"absolute"==d)f.y-=c.body.offsetTop;for(b=a;(b=goog.style.getOffsetParent(b))&&b!=c.body&&b!=g;)f.x-=b.scrollLeft,goog.userAgent.OPERA&&"TR"==b.tagName||(f.y-=b.scrollTop)}return f};goog.style.getPageOffsetLeft=function(a){return goog.style.getPageOffset(a).x};goog.style.getPageOffsetTop=function(a){return goog.style.getPageOffset(a).y};
goog.style.getFramedPageOffset=function(a,b){var c=new goog.math.Coordinate(0,0),d=goog.dom.getWindow(goog.dom.getOwnerDocument(a)),e=a;do{var f=d==b?goog.style.getPageOffset(e):goog.style.getClientPositionForElement_(goog.asserts.assert(e));c.x+=f.x;c.y+=f.y}while(d&&d!=b&&(e=d.frameElement)&&(d=d.parent));return c};
goog.style.translateRectForAnotherFrame=function(a,b,c){if(b.getDocument()!=c.getDocument()){var d=b.getDocument().body;c=goog.style.getFramedPageOffset(d,c.getWindow());c=goog.math.Coordinate.difference(c,goog.style.getPageOffset(d));!goog.userAgent.IE||(goog.userAgent.isDocumentModeOrHigher(9)||b.isCss1CompatMode())||(c=goog.math.Coordinate.difference(c,b.getDocumentScroll()));a.left+=c.x;a.top+=c.y}};
goog.style.getRelativePosition=function(a,b){var c=goog.style.getClientPosition(a),d=goog.style.getClientPosition(b);return new goog.math.Coordinate(c.x-d.x,c.y-d.y)};
goog.style.getClientPositionForElement_=function(a){var b;if(goog.style.GET_BOUNDING_CLIENT_RECT_ALWAYS_EXISTS||a.getBoundingClientRect)b=goog.style.getBoundingClientRect_(a),b=new goog.math.Coordinate(b.left,b.top);else{b=goog.dom.getDomHelper(a).getDocumentScroll();var c=goog.style.getPageOffset(a);b=new goog.math.Coordinate(c.x-b.x,c.y-b.y)}return goog.userAgent.GECKO&&!goog.userAgent.isVersionOrHigher(12)?goog.math.Coordinate.sum(b,goog.style.getCssTranslation(a)):b};
goog.style.getClientPosition=function(a){goog.asserts.assert(a);if(a.nodeType==goog.dom.NodeType.ELEMENT)return goog.style.getClientPositionForElement_(a);var b=goog.isFunction(a.getBrowserEvent),c=a;a.targetTouches&&a.targetTouches.length?c=a.targetTouches[0]:b&&(a.getBrowserEvent().targetTouches&&a.getBrowserEvent().targetTouches.length)&&(c=a.getBrowserEvent().targetTouches[0]);return new goog.math.Coordinate(c.clientX,c.clientY)};
goog.style.setPageOffset=function(a,b,c){var d=goog.style.getPageOffset(a);b instanceof goog.math.Coordinate&&(c=b.y,b=b.x);goog.style.setPosition(a,a.offsetLeft+(b-d.x),a.offsetTop+(c-d.y))};goog.style.setSize=function(a,b,c){if(b instanceof goog.math.Size)c=b.height,b=b.width;else if(void 0==c)throw Error("missing height argument");goog.style.setWidth(a,b);goog.style.setHeight(a,c)};goog.style.getPixelStyleValue_=function(a,b){"number"==typeof a&&(a=(b?Math.round(a):a)+"px");return a};
goog.style.setHeight=function(a,b){a.style.height=goog.style.getPixelStyleValue_(b,!0)};goog.style.setWidth=function(a,b){a.style.width=goog.style.getPixelStyleValue_(b,!0)};goog.style.getSize=function(a){return goog.style.evaluateWithTemporaryDisplay_(goog.style.getSizeWithDisplay_,a)};
goog.style.evaluateWithTemporaryDisplay_=function(a,b){if("none"!=goog.style.getStyle_(b,"display"))return a(b);var c=b.style,d=c.display,e=c.visibility,f=c.position;c.visibility="hidden";c.position="absolute";c.display="inline";var g=a(b);c.display=d;c.position=f;c.visibility=e;return g};
goog.style.getSizeWithDisplay_=function(a){var b=a.offsetWidth,c=a.offsetHeight,d=goog.userAgent.WEBKIT&&!b&&!c;return goog.isDef(b)&&!d||!a.getBoundingClientRect?new goog.math.Size(b,c):(a=goog.style.getBoundingClientRect_(a),new goog.math.Size(a.right-a.left,a.bottom-a.top))};goog.style.getTransformedSize=function(a){if(!a.getBoundingClientRect)return null;a=goog.style.evaluateWithTemporaryDisplay_(goog.style.getBoundingClientRect_,a);return new goog.math.Size(a.right-a.left,a.bottom-a.top)};
goog.style.getBounds=function(a){var b=goog.style.getPageOffset(a);a=goog.style.getSize(a);return new goog.math.Rect(b.x,b.y,a.width,a.height)};goog.style.toCamelCase=function(a){return goog.string.toCamelCase(String(a))};goog.style.toSelectorCase=function(a){return goog.string.toSelectorCase(a)};
goog.style.getOpacity=function(a){var b=a.style;a="";"opacity"in b?a=b.opacity:"MozOpacity"in b?a=b.MozOpacity:"filter"in b&&(b=b.filter.match(/alpha\(opacity=([\d.]+)\)/))&&(a=String(b[1]/100));return""==a?a:Number(a)};goog.style.setOpacity=function(a,b){var c=a.style;"opacity"in c?c.opacity=b:"MozOpacity"in c?c.MozOpacity=b:"filter"in c&&(c.filter=""===b?"":"alpha(opacity="+100*b+")")};
goog.style.setTransparentBackgroundImage=function(a,b){var c=a.style;goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("8")?c.filter='progid:DXImageTransform.Microsoft.AlphaImageLoader(src="'+b+'", sizingMethod="crop")':(c.backgroundImage="url("+b+")",c.backgroundPosition="top left",c.backgroundRepeat="no-repeat")};goog.style.clearTransparentBackgroundImage=function(a){a=a.style;"filter"in a?a.filter="":a.backgroundImage="none"};
goog.style.showElement=function(a,b){goog.style.setElementShown(a,b)};goog.style.setElementShown=function(a,b){a.style.display=b?"":"none"};goog.style.isElementShown=function(a){return"none"!=a.style.display};
goog.style.installStyles=function(a,b){var c=goog.dom.getDomHelper(b),d=null,e=c.getDocument();goog.userAgent.IE&&e.createStyleSheet?(d=e.createStyleSheet(),goog.style.setStyles(d,a)):(e=c.getElementsByTagNameAndClass("head")[0],e||(d=c.getElementsByTagNameAndClass("body")[0],e=c.createDom("head"),d.parentNode.insertBefore(e,d)),d=c.createDom("style"),goog.style.setStyles(d,a),c.appendChild(e,d));return d};goog.style.uninstallStyles=function(a){goog.dom.removeNode(a.ownerNode||a.owningElement||a)};
goog.style.setStyles=function(a,b){goog.userAgent.IE&&goog.isDef(a.cssText)?a.cssText=b:a.innerHTML=b};goog.style.setPreWrap=function(a){a=a.style;goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("8")?(a.whiteSpace="pre",a.wordWrap="break-word"):a.whiteSpace=goog.userAgent.GECKO?"-moz-pre-wrap":"pre-wrap"};
goog.style.setInlineBlock=function(a){a=a.style;a.position="relative";goog.userAgent.IE&&!goog.userAgent.isVersionOrHigher("8")?(a.zoom="1",a.display="inline"):a.display=goog.userAgent.GECKO?goog.userAgent.isVersionOrHigher("1.9a")?"inline-block":"-moz-inline-box":"inline-block"};goog.style.isRightToLeft=function(a){return"rtl"==goog.style.getStyle_(a,"direction")};goog.style.unselectableStyle_=goog.userAgent.GECKO?"MozUserSelect":goog.userAgent.WEBKIT?"WebkitUserSelect":null;
goog.style.isUnselectable=function(a){return goog.style.unselectableStyle_?"none"==a.style[goog.style.unselectableStyle_].toLowerCase():goog.userAgent.IE||goog.userAgent.OPERA?"on"==a.getAttribute("unselectable"):!1};
goog.style.setUnselectable=function(a,b,c){c=c?null:a.getElementsByTagName("*");var d=goog.style.unselectableStyle_;if(d){if(b=b?"none":"",a.style[d]=b,c){a=0;for(var e;e=c[a];a++)e.style[d]=b}}else if(goog.userAgent.IE||goog.userAgent.OPERA)if(b=b?"on":"",a.setAttribute("unselectable",b),c)for(a=0;e=c[a];a++)e.setAttribute("unselectable",b)};goog.style.getBorderBoxSize=function(a){return new goog.math.Size(a.offsetWidth,a.offsetHeight)};
goog.style.setBorderBoxSize=function(a,b){var c=goog.dom.getOwnerDocument(a),d=goog.dom.getDomHelper(c).isCss1CompatMode();if(!goog.userAgent.IE||goog.userAgent.isVersionOrHigher("10")||d&&goog.userAgent.isVersionOrHigher("8"))goog.style.setBoxSizingSize_(a,b,"border-box");else if(c=a.style,d){var d=goog.style.getPaddingBox(a),e=goog.style.getBorderBox(a);c.pixelWidth=b.width-e.left-d.left-d.right-e.right;c.pixelHeight=b.height-e.top-d.top-d.bottom-e.bottom}else c.pixelWidth=b.width,c.pixelHeight=
b.height};
goog.style.getContentBoxSize=function(a){var b=goog.dom.getOwnerDocument(a),c=goog.userAgent.IE&&a.currentStyle;if(c&&goog.dom.getDomHelper(b).isCss1CompatMode()&&"auto"!=c.width&&"auto"!=c.height&&!c.boxSizing)return b=goog.style.getIePixelValue_(a,c.width,"width","pixelWidth"),a=goog.style.getIePixelValue_(a,c.height,"height","pixelHeight"),new goog.math.Size(b,a);c=goog.style.getBorderBoxSize(a);b=goog.style.getPaddingBox(a);a=goog.style.getBorderBox(a);return new goog.math.Size(c.width-a.left-
b.left-b.right-a.right,c.height-a.top-b.top-b.bottom-a.bottom)};
goog.style.setContentBoxSize=function(a,b){var c=goog.dom.getOwnerDocument(a),d=goog.dom.getDomHelper(c).isCss1CompatMode();if(!goog.userAgent.IE||goog.userAgent.isVersionOrHigher("10")||d&&goog.userAgent.isVersionOrHigher("8"))goog.style.setBoxSizingSize_(a,b,"content-box");else if(c=a.style,d)c.pixelWidth=b.width,c.pixelHeight=b.height;else{var d=goog.style.getPaddingBox(a),e=goog.style.getBorderBox(a);c.pixelWidth=b.width+e.left+d.left+d.right+e.right;c.pixelHeight=b.height+e.top+d.top+d.bottom+
e.bottom}};goog.style.setBoxSizingSize_=function(a,b,c){a=a.style;goog.userAgent.GECKO?a.MozBoxSizing=c:goog.userAgent.WEBKIT?a.WebkitBoxSizing=c:a.boxSizing=c;a.width=Math.max(b.width,0)+"px";a.height=Math.max(b.height,0)+"px"};goog.style.getIePixelValue_=function(a,b,c,d){if(/^\d+px?$/.test(b))return parseInt(b,10);var e=a.style[c],f=a.runtimeStyle[c];a.runtimeStyle[c]=a.currentStyle[c];a.style[c]=b;b=a.style[d];a.style[c]=e;a.runtimeStyle[c]=f;return b};
goog.style.getIePixelDistance_=function(a,b){var c=goog.style.getCascadedStyle(a,b);return c?goog.style.getIePixelValue_(a,c,"left","pixelLeft"):0};
goog.style.getBox_=function(a,b){if(goog.userAgent.IE){var c=goog.style.getIePixelDistance_(a,b+"Left"),d=goog.style.getIePixelDistance_(a,b+"Right"),e=goog.style.getIePixelDistance_(a,b+"Top"),f=goog.style.getIePixelDistance_(a,b+"Bottom");return new goog.math.Box(e,d,f,c)}c=goog.style.getComputedStyle(a,b+"Left");d=goog.style.getComputedStyle(a,b+"Right");e=goog.style.getComputedStyle(a,b+"Top");f=goog.style.getComputedStyle(a,b+"Bottom");return new goog.math.Box(parseFloat(e),parseFloat(d),parseFloat(f),
parseFloat(c))};goog.style.getPaddingBox=function(a){return goog.style.getBox_(a,"padding")};goog.style.getMarginBox=function(a){return goog.style.getBox_(a,"margin")};goog.style.ieBorderWidthKeywords_={thin:2,medium:4,thick:6};
goog.style.getIePixelBorder_=function(a,b){if("none"==goog.style.getCascadedStyle(a,b+"Style"))return 0;var c=goog.style.getCascadedStyle(a,b+"Width");return c in goog.style.ieBorderWidthKeywords_?goog.style.ieBorderWidthKeywords_[c]:goog.style.getIePixelValue_(a,c,"left","pixelLeft")};
goog.style.getBorderBox=function(a){if(goog.userAgent.IE&&!goog.userAgent.isDocumentModeOrHigher(9)){var b=goog.style.getIePixelBorder_(a,"borderLeft"),c=goog.style.getIePixelBorder_(a,"borderRight"),d=goog.style.getIePixelBorder_(a,"borderTop");a=goog.style.getIePixelBorder_(a,"borderBottom");return new goog.math.Box(d,c,a,b)}b=goog.style.getComputedStyle(a,"borderLeftWidth");c=goog.style.getComputedStyle(a,"borderRightWidth");d=goog.style.getComputedStyle(a,"borderTopWidth");a=goog.style.getComputedStyle(a,
"borderBottomWidth");return new goog.math.Box(parseFloat(d),parseFloat(c),parseFloat(a),parseFloat(b))};goog.style.getFontFamily=function(a){var b=goog.dom.getOwnerDocument(a),c="";if(b.body.createTextRange&&goog.dom.contains(b,a)){b=b.body.createTextRange();b.moveToElementText(a);try{c=b.queryCommandValue("FontName")}catch(d){c=""}}c||(c=goog.style.getStyle_(a,"fontFamily"));a=c.split(",");1<a.length&&(c=a[0]);return goog.string.stripQuotes(c,"\"'")};goog.style.lengthUnitRegex_=/[^\d]+$/;
goog.style.getLengthUnits=function(a){return(a=a.match(goog.style.lengthUnitRegex_))&&a[0]||null};goog.style.ABSOLUTE_CSS_LENGTH_UNITS_={cm:1,"in":1,mm:1,pc:1,pt:1};goog.style.CONVERTIBLE_RELATIVE_CSS_UNITS_={em:1,ex:1};
goog.style.getFontSize=function(a){var b=goog.style.getStyle_(a,"fontSize"),c=goog.style.getLengthUnits(b);if(b&&"px"==c)return parseInt(b,10);if(goog.userAgent.IE){if(c in goog.style.ABSOLUTE_CSS_LENGTH_UNITS_)return goog.style.getIePixelValue_(a,b,"left","pixelLeft");if(a.parentNode&&a.parentNode.nodeType==goog.dom.NodeType.ELEMENT&&c in goog.style.CONVERTIBLE_RELATIVE_CSS_UNITS_)return a=a.parentNode,c=goog.style.getStyle_(a,"fontSize"),goog.style.getIePixelValue_(a,b==c?"1em":b,"left","pixelLeft")}c=
goog.dom.createDom("span",{style:"visibility:hidden;position:absolute;line-height:0;padding:0;margin:0;border:0;height:1em;"});goog.dom.appendChild(a,c);b=c.offsetHeight;goog.dom.removeNode(c);return b};goog.style.parseStyleAttribute=function(a){var b={};goog.array.forEach(a.split(/\s*;\s*/),function(a){a=a.split(/\s*:\s*/);2==a.length&&(b[goog.string.toCamelCase(a[0].toLowerCase())]=a[1])});return b};
goog.style.toStyleAttribute=function(a){var b=[];goog.object.forEach(a,function(a,d){b.push(goog.string.toSelectorCase(d),":",a,";")});return b.join("")};goog.style.setFloat=function(a,b){a.style[goog.userAgent.IE?"styleFloat":"cssFloat"]=b};goog.style.getFloat=function(a){return a.style[goog.userAgent.IE?"styleFloat":"cssFloat"]||""};
goog.style.getScrollbarWidth=function(a){var b=goog.dom.createElement("div");a&&(b.className=a);b.style.cssText="overflow:auto;position:absolute;top:0;width:100px;height:100px";a=goog.dom.createElement("div");goog.style.setSize(a,"200px","200px");b.appendChild(a);goog.dom.appendChild(goog.dom.getDocument().body,b);a=b.offsetWidth-b.clientWidth;goog.dom.removeNode(b);return a};goog.style.MATRIX_TRANSLATION_REGEX_=/matrix\([0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, [0-9\.\-]+, ([0-9\.\-]+)p?x?, ([0-9\.\-]+)p?x?\)/;
goog.style.getCssTranslation=function(a){a=goog.style.getComputedTransform(a);return a?(a=a.match(goog.style.MATRIX_TRANSLATION_REGEX_))?new goog.math.Coordinate(parseFloat(a[1]),parseFloat(a[2])):new goog.math.Coordinate(0,0):new goog.math.Coordinate(0,0)};
goog.debug.DivConsole=function(a){this.publishHandler_=goog.bind(this.addLogRecord,this);this.formatter_=new goog.debug.HtmlFormatter;this.isCapturing_=this.formatter_.showAbsoluteTime=!1;this.element_=a;this.elementOwnerDocument_=this.element_.ownerDocument||this.element_.document;this.installStyles()};
goog.debug.DivConsole.prototype.installStyles=function(){goog.style.installStyles(".dbg-sev{color:#F00}.dbg-w{color:#C40}.dbg-sh{font-weight:bold;color:#000}.dbg-i{color:#444}.dbg-f{color:#999}.dbg-ev{color:#0A0}.dbg-m{color:#990}.logmsg{border-bottom:1px solid #CCC;padding:2px}.logsep{background-color: #8C8;}.logdiv{border:1px solid #CCC;background-color:#FCFCFC;font:medium monospace}",this.element_);this.element_.className+=" logdiv"};
goog.debug.DivConsole.prototype.setCapturing=function(a){if(a!=this.isCapturing_){var b=goog.debug.LogManager.getRoot();a?b.addHandler(this.publishHandler_):(b.removeHandler(this.publishHandler_),this.logBuffer="");this.isCapturing_=a}};
goog.debug.DivConsole.prototype.addLogRecord=function(a){if(a){var b=100>=this.element_.scrollHeight-this.element_.scrollTop-this.element_.clientHeight,c=this.elementOwnerDocument_.createElement("div");c.className="logmsg";goog.dom.safe.setInnerHtml(c,this.formatter_.formatRecordAsHtml(a));this.element_.appendChild(c);b&&(this.element_.scrollTop=this.element_.scrollHeight)}};goog.debug.DivConsole.prototype.getFormatter=function(){return this.formatter_};
goog.debug.DivConsole.prototype.setFormatter=function(a){this.formatter_=a};goog.debug.DivConsole.prototype.addSeparator=function(){var a=this.elementOwnerDocument_.createElement("div");a.className="logmsg logsep";this.element_.appendChild(a)};goog.debug.DivConsole.prototype.clear=function(){this.element_&&goog.dom.safe.setInnerHtml(this.element_,goog.html.SafeHtml.EMPTY)};ydn.debug.logger_console=null;ydn.debug.logger_div=null;ydn.debug.logger=goog.log.getLogger("ydn.debug");
ydn.debug.log=function(a,b,c){a=a||"ydn";b=goog.isNumber(b)?new goog.debug.Logger.Level("log",b):goog.isString(b)?goog.debug.Logger.Level.getPredefinedLevel(b.toUpperCase()):goog.debug.Logger.Level.FINE;var d=goog.log.getLogger(a);d?d.setLevel(b):goog.DEBUG&&window.console.log("logger "+a+" not available.");goog.isDef(c)?ydn.debug.logger_div||(ydn.debug.logger_div=new goog.debug.DivConsole(c),ydn.debug.logger_div.setCapturing(!0),(a=goog.debug.LogManager.getRoot())&&a.setLevel(goog.debug.Logger.Level.WARNING)):
ydn.debug.logger_console||ydn.debug.logger_div||(ydn.debug.logger_console=new goog.debug.Console,ydn.debug.logger_console.setCapturing(!0),(a=goog.debug.LogManager.getRoot())&&a.setLevel(goog.debug.Logger.Level.WARNING))};ydn.debug.captureOnConsole=function(a){ydn.debug.logger_console.setCapturing(a)};ydn.debug.ILogger=function(){};ydn.debug.ILogger.prototype.log=function(a){};ydn.debug.ILogger.instance=null;
ydn.debug.ILogger.log=function(a){ydn.debug.ILogger.instance&&setTimeout(function(){ydn.debug.ILogger.instance.log(a)},10)};ydn.debug.exports={};goog.DEBUG&&goog.exportSymbol("ydn.debug.log",ydn.debug.log);ydn.db.Storage.main_entry={};goog.exportSymbol("ydn.db.Storage",ydn.db.Storage);
